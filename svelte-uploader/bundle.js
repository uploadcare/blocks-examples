var app=function(){"use strict";function e(){}function t(e){return e()}function i(){return Object.create(null)}function s(e){e.forEach(t)}function r(e){return"function"==typeof e}function n(e,t){return e!=e?t==t:e!==t||e&&"object"==typeof e||"function"==typeof e}let a,o;function l(e,t){return a||(a=document.createElement("a")),a.href=t,e===a.href}function c(e,t){e.appendChild(t)}function h(e,t,i){e.insertBefore(t,i||null)}function d(e){e.parentNode&&e.parentNode.removeChild(e)}function u(e){return document.createElement(e)}function p(){return e=" ",document.createTextNode(e);var e}function m(e,t,i){null==i?e.removeAttribute(t):e.getAttribute(t)!==i&&e.setAttribute(t,i)}function g(e,t,i){t in e?e[t]="boolean"==typeof e[t]&&""===i||i:m(e,t,i)}function b(e){o=e}const f=[],_=[];let y=[];const v=[],w=Promise.resolve();let C=!1;function T(e){y.push(e)}const x=new Set;let $=0;function k(){if(0!==$)return;const e=o;do{try{for(;$<f.length;){const e=f[$];$++,b(e),E(e.$$)}}catch(e){throw f.length=0,$=0,e}for(b(null),f.length=0,$=0;_.length;)_.pop()();for(let e=0;e<y.length;e+=1){const t=y[e];x.has(t)||(x.add(t),t())}y.length=0}while(f.length);for(;v.length;)v.pop()();C=!1,x.clear(),b(e)}function E(e){if(null!==e.fragment){e.update(),s(e.before_update);const t=e.dirty;e.dirty=[-1],e.fragment&&e.fragment.p(e.ctx,t),e.after_update.forEach(T)}}const A=new Set;function S(e,t){const i=e.$$;null!==i.fragment&&(!function(e){const t=[],i=[];y.forEach((s=>-1===e.indexOf(s)?t.push(s):i.push(s))),i.forEach((e=>e())),y=t}(i.after_update),s(i.on_destroy),i.fragment&&i.fragment.d(t),i.on_destroy=i.fragment=null,i.ctx=[])}function I(e,t){-1===e.$$.dirty[0]&&(f.push(e),C||(C=!0,w.then(k)),e.$$.dirty.fill(0)),e.$$.dirty[t/31|0]|=1<<t%31}function U(n,a,l,c,h,u,p,m=[-1]){const g=o;b(n);const f=n.$$={fragment:null,ctx:[],props:u,update:e,not_equal:h,bound:i(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(a.context||(g?g.$$.context:[])),callbacks:i(),dirty:m,skip_bound:!1,root:a.target||g.$$.root};p&&p(f.root);let _=!1;if(f.ctx=l?l(n,a.props||{},((e,t,...i)=>{const s=i.length?i[0]:t;return f.ctx&&h(f.ctx[e],f.ctx[e]=s)&&(!f.skip_bound&&f.bound[e]&&f.bound[e](s),_&&I(n,e)),t})):[],f.update(),_=!0,s(f.before_update),f.fragment=!!c&&c(f.ctx),a.target){if(a.hydrate){const e=function(e){return Array.from(e.childNodes)}(a.target);f.fragment&&f.fragment.l(e),e.forEach(d)}else f.fragment&&f.fragment.c();a.intro&&((y=n.$$.fragment)&&y.i&&(A.delete(y),y.i(v))),function(e,i,n,a){const{fragment:o,after_update:l}=e.$$;o&&o.m(i,n),a||T((()=>{const i=e.$$.on_mount.map(t).filter(r);e.$$.on_destroy?e.$$.on_destroy.push(...i):s(i),e.$$.on_mount=[]})),l.forEach(T)}(n,a.target,a.anchor,a.customElement),k()}var y,v;b(g)}class R{$destroy(){S(this,1),this.$destroy=e}$on(t,i){if(!r(i))return e;const s=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return s.push(i),()=>{const e=s.indexOf(i);-1!==e&&s.splice(e,1)}}$set(e){var t;this.$$set&&(t=e,0!==Object.keys(t).length)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}var L=Object.defineProperty,M=(e,t,i)=>(((e,t,i)=>{t in e?L(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i})(e,"symbol"!=typeof t?t+"":t,i),i);var N=class{constructor(e){e.constructor===Object?this.store=function(e){let t=e=>{var i;for(let s in e)(null==(i=e[s])?void 0:i.constructor)===Object&&(e[s]=t(e[s]));return{...e}};return t(e)}(e):(this._storeIsProxy=!0,this.store=e),this.callbackMap=Object.create(null)}static warn(e,t){console.warn(`Symbiote Data: cannot ${e}. Prop name: `+t)}read(e){return this._storeIsProxy||this.store.hasOwnProperty(e)?this.store[e]:(N.warn("read",e),null)}has(e){return this._storeIsProxy?void 0!==this.store[e]:this.store.hasOwnProperty(e)}add(e,t,i=!1){!i&&Object.keys(this.store).includes(e)||(this.store[e]=t,this.notify(e))}pub(e,t){this._storeIsProxy||this.store.hasOwnProperty(e)?(this.store[e]=t,this.notify(e)):N.warn("publish",e)}multiPub(e){for(let t in e)this.pub(t,e[t])}notify(e){this.callbackMap[e]&&this.callbackMap[e].forEach((t=>{t(this.store[e])}))}sub(e,t,i=!0){return this._storeIsProxy||this.store.hasOwnProperty(e)?(this.callbackMap[e]||(this.callbackMap[e]=new Set),this.callbackMap[e].add(t),i&&t(this.store[e]),{remove:()=>{this.callbackMap[e].delete(t),this.callbackMap[e].size||delete this.callbackMap[e]},callback:t}):(N.warn("subscribe",e),null)}static registerCtx(e,t=Symbol()){let i=N.globalStore.get(t);return i?console.warn('State: context UID "'+t+'" already in use'):(i=new N(e),N.globalStore.set(t,i)),i}static deleteCtx(e){N.globalStore.delete(e)}static getCtx(e,t=!0){return N.globalStore.get(e)||(t&&console.warn('State: wrong context UID - "'+e+'"'),null)}};N.globalStore=new Map;var O=Object.freeze({BIND_ATTR:"set",ATTR_BIND_PRFX:"@",EXT_DATA_CTX_PRFX:"*",NAMED_DATA_CTX_SPLTR:"/",CTX_NAME_ATTR:"ctx-name",CTX_OWNER_ATTR:"ctx-owner",CSS_CTX_PROP:"--ctx-name",EL_REF_ATTR:"ref",AUTO_TAG_PRFX:"sym",REPEAT_ATTR:"repeat",REPEAT_ITEM_TAG_ATTR:"repeat-item-tag",SET_LATER_KEY:"__toSetLater__",USE_TPL:"use-template",ROOT_STYLE_ATTR_NAME:"sym-component"}),D="1234567890QWERTYUIOPASDFGHJKLZXCVBNMqwertyuiopasdfghjklzxcvbnm",P=D.length-1,B=class{static generate(e="XXXXXXXXX-XXX"){let t="";for(let i=0;i<e.length;i++)t+="-"===e[i]?e[i]:D.charAt(Math.random()*P);return t}};function F(e,t,i){let s,r=!0,n=t.split(".");return n.forEach(((t,i)=>{i<n.length-1?e=e[t]:s=t})),e?e[s]=i:r=!1,r}var V="__default__";var z="{{",j="}}",q="skip-text";var H=[function(e,t){[...e.querySelectorAll(`[${O.REPEAT_ATTR}]`)].forEach((e=>{let i,s=e.getAttribute(O.REPEAT_ITEM_TAG_ATTR);if(s&&(i=window.customElements.get(s)),!i){i=class extends t.BaseComponent{constructor(){super(),s||(this.style.display="contents")}};let r=e.innerHTML;i.template=r,i.reg(s)}for(;e.firstChild;)e.firstChild.remove();let r=e.getAttribute(O.REPEAT_ATTR);t.sub(r,(t=>{if(!t){for(;e.firstChild;)e.firstChild.remove();return}let s,r=[...e.children],n=t=>{t.forEach(((e,t)=>{if(r[t])if(r[t].set$)setTimeout((()=>{r[t].set$(e)}));else for(let i in e)r[t][i]=e[i];else{s||(s=new DocumentFragment);let t=new i;Object.assign(t.init$,e),s.appendChild(t)}})),s&&e.appendChild(s);let n=r.slice(t.length,r.length);for(let e of n)e.remove()};if(t.constructor===Array)n(t);else if(t.constructor===Object){let e=[];for(let i in t){let s=t[i];Object.defineProperty(s,"_KEY_",{value:i,enumerable:!0}),e.push(s)}n(e)}else console.warn("Symbiote repeat data type error:"),console.log(t)})),e.removeAttribute(O.REPEAT_ATTR),e.removeAttribute(O.REPEAT_ITEM_TAG_ATTR)}))},function(e,t){if(t.shadowRoot)return;let i=[...e.querySelectorAll("slot")];if(!i.length)return;let s={};i.forEach((e=>{let t=e.getAttribute("name")||V;s[t]={slot:e,fr:document.createDocumentFragment()}})),t.initChildren.forEach((e=>{var t;let i=V;e instanceof Element&&e.hasAttribute("slot")&&(i=e.getAttribute("slot"),e.removeAttribute("slot")),null==(t=s[i])||t.fr.appendChild(e)})),Object.values(s).forEach((e=>{if(e.fr.childNodes.length)e.slot.parentNode.replaceChild(e.fr,e.slot);else if(e.slot.childNodes.length){let t=document.createDocumentFragment();t.append(...e.slot.childNodes),e.slot.parentNode.replaceChild(t,e.slot)}else e.slot.remove()}))},function(e,t){[...e.querySelectorAll(`[${O.EL_REF_ATTR}]`)].forEach((e=>{let i=e.getAttribute(O.EL_REF_ATTR);t.ref[i]=e,e.removeAttribute(O.EL_REF_ATTR)}))},function(e,t){[...e.querySelectorAll(`[${O.BIND_ATTR}]`)].forEach((e=>{let i=e.getAttribute(O.BIND_ATTR).split(";");[...e.attributes].forEach((t=>{if(t.name.startsWith("-")&&t.value){let s=t.name.replace("-","").split("-").map(((e,t)=>e&&t?e[0].toUpperCase()+e.slice(1):e)).join("").split("_").map(((e,t)=>e&&t?e.toUpperCase():e)).join("");i.push(s+":"+t.value),e.removeAttribute(t.name)}})),i.forEach((i=>{if(!i)return;let s,r=i.split(":").map((e=>e.trim())),n=r[0];0===n.indexOf(O.ATTR_BIND_PRFX)&&(s=!0,n=n.replace(O.ATTR_BIND_PRFX,""));let a=r[1].split(",").map((e=>e.trim()));for(let i of a){let r;i.startsWith("!!")?(r="double",i=i.replace("!!","")):i.startsWith("!")&&(r="single",i=i.replace("!","")),t.sub(i,(t=>{"double"===r?t=!!t:"single"===r&&(t=!t),s?(null==t?void 0:t.constructor)===Boolean?t?e.setAttribute(n,""):e.removeAttribute(n):e.setAttribute(n,t):F(e,n,t)||(e[O.SET_LATER_KEY]||(e[O.SET_LATER_KEY]=Object.create(null)),e[O.SET_LATER_KEY][n]=t)}))}})),e.removeAttribute(O.BIND_ATTR)}))},function(e,t){(function(e){let t,i=[],s=document.createTreeWalker(e,NodeFilter.SHOW_TEXT,{acceptNode:e=>{var t;return!(null==(t=e.parentElement)?void 0:t.hasAttribute(q))&&e.textContent.includes(z)&&e.textContent.includes(j)&&1}});for(;t=s.nextNode();)i.push(t);return i})(e).forEach((e=>{let i,s=[];for(;e.textContent.includes(j);)e.textContent.startsWith(z)?(i=e.textContent.indexOf(j)+j.length,e.splitText(i),s.push(e)):(i=e.textContent.indexOf(z),e.splitText(i)),e=e.nextSibling;s.forEach((e=>{let i=e.textContent.replace(z,"").replace(j,"");e.textContent="",t.sub(i,(t=>{e.textContent=t}))}))}))}],K="'",W='"',X=/\\([0-9a-fA-F]{1,6} ?)/g;function G(e){let t=e;var i;(i=e)[0]!==W&&i[0]!==K||i[i.length-1]!==W&&i[i.length-1]!==K||(t=function(e){return e[0]!==W&&e[0]!==K||(e=e.slice(1)),e[e.length-1]!==W&&e[e.length-1]!==K||(e=e.slice(0,-1)),e}(t),t=t.replace(X,((e,t)=>String.fromCodePoint(parseInt(t.trim(),16)))),t=t.replaceAll("\\\n","\\n"),t=function(e){let t="",i="";for(var s=0;s<e.length;s++){const r=e[s+1];"\\"===e[s]&&'"'===r?(t+='\\"',s++):'"'===e[s]&&"\\"!==i?t+='\\"':t+=e[s],i=e[s]}return t}(t),t=W+t+W);try{return JSON.parse(t)}catch(i){throw new Error(`Failed to parse CSS property value: ${t}. Original input: ${e}`)}}var Y=0,J=null,Q=null,Z=class extends HTMLElement{constructor(){super(),M(this,"updateCssData",(()=>{var e;this.dropCssDataCache(),null==(e=this.__boundCssProps)||e.forEach((e=>{let t=this.getCssData(this.__extractCssName(e),!0);null!==t&&this.$[e]!==t&&(this.$[e]=t)}))})),this.init$=Object.create(null),this.cssInit$=Object.create(null),this.tplProcessors=new Set,this.ref=Object.create(null),this.allSubs=new Set,this.pauseRender=!1,this.renderShadow=!1,this.readyToDestroy=!0,this.processInnerHtml=!1,this.allowCustomTemplate=!1,this.ctxOwner=!1}get BaseComponent(){return Z}initCallback(){}__initCallback(){var e;this.__initialized||(this.__initialized=!0,null==(e=this.initCallback)||e.call(this))}render(e,t=this.renderShadow){let i;if(!t&&!this.constructor.__shadowStylesUrl||this.shadowRoot||this.attachShadow({mode:"open"}),this.allowCustomTemplate){let t=this.getAttribute(O.USE_TPL);if(t){let i=this.getRootNode(),s=(null==i?void 0:i.querySelector(t))||document.querySelector(t);s?e=s.content.cloneNode(!0):console.warn(`Symbiote template "${t}" is not found...`)}}if(this.processInnerHtml)for(let e of this.tplProcessors)e(this,this);if(e||this.constructor.template){if(this.constructor.template&&!this.constructor.__tpl&&(this.constructor.__tpl=document.createElement("template"),this.constructor.__tpl.innerHTML=this.constructor.template),(null==e?void 0:e.constructor)===DocumentFragment)i=e;else if((null==e?void 0:e.constructor)===String){let t=document.createElement("template");t.innerHTML=e,i=t.content.cloneNode(!0)}else this.constructor.__tpl&&(i=this.constructor.__tpl.content.cloneNode(!0));for(let e of this.tplProcessors)e(i,this)}let s=()=>{i&&(t&&this.shadowRoot.appendChild(i)||this.appendChild(i)),this.__initCallback()};if(this.constructor.__shadowStylesUrl){t=!0;let e=document.createElement("link");e.rel="stylesheet",e.href=this.constructor.__shadowStylesUrl,e.onload=s,this.shadowRoot.prepend(e)}else s()}addTemplateProcessor(e){this.tplProcessors.add(e)}get autoCtxName(){return this.__autoCtxName||(this.__autoCtxName=B.generate(),this.style.setProperty(O.CSS_CTX_PROP,`'${this.__autoCtxName}'`)),this.__autoCtxName}get cssCtxName(){return this.getCssData(O.CSS_CTX_PROP,!0)}get ctxName(){var e;let t=(null==(e=this.getAttribute(O.CTX_NAME_ATTR))?void 0:e.trim())||this.cssCtxName||this.__cachedCtxName||this.autoCtxName;return this.__cachedCtxName=t,t}get localCtx(){return this.__localCtx||(this.__localCtx=N.registerCtx({},this)),this.__localCtx}get nodeCtx(){return N.getCtx(this.ctxName,!1)||N.registerCtx({},this.ctxName)}static __parseProp(e,t){let i,s;if(e.startsWith(O.EXT_DATA_CTX_PRFX))i=t.nodeCtx,s=e.replace(O.EXT_DATA_CTX_PRFX,"");else if(e.includes(O.NAMED_DATA_CTX_SPLTR)){let t=e.split(O.NAMED_DATA_CTX_SPLTR);i=N.getCtx(t[0]),s=t[1]}else i=t.localCtx,s=e;return{ctx:i,name:s}}sub(e,t,i=!0){let s=e=>{this.isConnected&&t(e)},r=Z.__parseProp(e,this);r.ctx.has(r.name)?this.allSubs.add(r.ctx.sub(r.name,s,i)):window.setTimeout((()=>{this.allSubs.add(r.ctx.sub(r.name,s,i))}))}notify(e){let t=Z.__parseProp(e,this);t.ctx.notify(t.name)}has(e){let t=Z.__parseProp(e,this);return t.ctx.has(t.name)}add(e,t,i=!1){let s=Z.__parseProp(e,this);s.ctx.add(s.name,t,i)}add$(e,t=!1){for(let i in e)this.add(i,e[i],t)}get $(){if(!this.__stateProxy){let e=Object.create(null);this.__stateProxy=new Proxy(e,{set:(e,t,i)=>{let s=Z.__parseProp(t,this);return s.ctx.pub(s.name,i),!0},get:(e,t)=>{let i=Z.__parseProp(t,this);return i.ctx.read(i.name)}})}return this.__stateProxy}set$(e,t=!1){for(let i in e){let s=e[i],r=[String,Number,Boolean];(t||!r.includes(null==s?void 0:s.constructor)||this.$[i]!==s)&&(this.$[i]=s)}}get __ctxOwner(){return this.ctxOwner||this.hasAttribute(O.CTX_OWNER_ATTR)&&"false"!==this.getAttribute(O.CTX_OWNER_ATTR)}__initDataCtx(){let e=this.constructor.__attrDesc;if(e)for(let t of Object.values(e))Object.keys(this.init$).includes(t)||(this.init$[t]="");for(let e in this.init$)if(e.startsWith(O.EXT_DATA_CTX_PRFX))this.nodeCtx.add(e.replace(O.EXT_DATA_CTX_PRFX,""),this.init$[e],this.__ctxOwner);else if(e.includes(O.NAMED_DATA_CTX_SPLTR)){let t=e.split(O.NAMED_DATA_CTX_SPLTR),i=t[0].trim(),s=t[1].trim();if(i&&s){let t=N.getCtx(i,!1);t||(t=N.registerCtx({},i)),t.add(s,this.init$[e])}}else this.localCtx.add(e,this.init$[e]);for(let e in this.cssInit$)this.bindCssData(e,this.cssInit$[e]);this.__dataCtxInitialized=!0}connectedCallback(){var e;if(this.isConnected){if(this.__disconnectTimeout&&window.clearTimeout(this.__disconnectTimeout),!this.connectedOnce){let t=null==(e=this.getAttribute(O.CTX_NAME_ATTR))?void 0:e.trim();if(t&&this.style.setProperty(O.CSS_CTX_PROP,`'${t}'`),this.__initDataCtx(),this[O.SET_LATER_KEY]){for(let e in this[O.SET_LATER_KEY])F(this,e,this[O.SET_LATER_KEY][e]);delete this[O.SET_LATER_KEY]}this.initChildren=[...this.childNodes];for(let e of H)this.addTemplateProcessor(e);if(this.pauseRender)this.__initCallback();else if(this.constructor.__rootStylesLink){let e=this.getRootNode();if(!e)return;if(null==e?void 0:e.querySelector(`link[${O.ROOT_STYLE_ATTR_NAME}="${this.constructor.is}"]`))return void this.render();let t=this.constructor.__rootStylesLink.cloneNode(!0);t.setAttribute(O.ROOT_STYLE_ATTR_NAME,this.constructor.is),t.onload=()=>{this.render()},e.nodeType===Node.DOCUMENT_NODE?e.head.appendChild(t):e.prepend(t)}else this.render()}this.connectedOnce=!0}}destroyCallback(){}disconnectedCallback(){this.connectedOnce&&(this.dropCssDataCache(),this.readyToDestroy&&(this.__disconnectTimeout&&window.clearTimeout(this.__disconnectTimeout),this.__disconnectTimeout=window.setTimeout((()=>{this.destroyCallback();for(let e of this.allSubs)e.remove(),this.allSubs.delete(e);for(let e of this.tplProcessors)this.tplProcessors.delete(e);null==Q||Q.delete(this.updateCssData),(null==Q?void 0:Q.size)||(null==J||J.disconnect(),J=null,Q=null)}),100)))}static reg(e,t=!1){e||(Y++,e=`${O.AUTO_TAG_PRFX}-${Y}`),this.__tag=e,window.customElements.get(e)?console.warn(`${e} - is already in "customElements" registry`):window.customElements.define(e,t?class extends(this){}:this)}static get is(){return this.__tag||this.reg(),this.__tag}static bindAttributes(e){this.observedAttributes=Object.keys(e),this.__attrDesc=e}attributeChangedCallback(e,t,i){var s;if(t===i)return;let r=null==(s=this.constructor.__attrDesc)?void 0:s[e];r?this.__dataCtxInitialized?this.$[r]=i:this.init$[r]=i:this[e]=i}getCssData(e,t=!1){if(this.__cssDataCache||(this.__cssDataCache=Object.create(null)),!Object.keys(this.__cssDataCache).includes(e)){this.__computedStyle||(this.__computedStyle=window.getComputedStyle(this));let i=this.__computedStyle.getPropertyValue(e).trim();try{this.__cssDataCache[e]=G(i)}catch(i){!t&&console.warn(`CSS Data error: ${e}`),this.__cssDataCache[e]=null}}return this.__cssDataCache[e]}__extractCssName(e){return e.split("--").map(((e,t)=>0===t?"":e)).join("--")}__initStyleAttrObserver(){Q||(Q=new Set),Q.add(this.updateCssData),J||(J=new MutationObserver((e=>{"attributes"===e[0].type&&Q.forEach((e=>{e()}))}))).observe(document,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["style"]})}bindCssData(e,t=""){this.__boundCssProps||(this.__boundCssProps=new Set),this.__boundCssProps.add(e);let i=this.getCssData(this.__extractCssName(e),!0);null===i&&(i=t),this.add(e,i),this.__initStyleAttrObserver()}dropCssDataCache(){this.__cssDataCache=null,this.__computedStyle=null}defineAccessor(e,t,i){let s="__"+e;this[s]=this[e],Object.defineProperty(this,e,{set:e=>{this[s]=e,i?window.setTimeout((()=>{null==t||t(e)})):null==t||t(e)},get:()=>this[s]}),this[e]=this[s]}static set shadowStyles(e){let t=new Blob([e],{type:"text/css"});this.__shadowStylesUrl=URL.createObjectURL(t)}static set rootStyles(e){if(!this.__rootStylesLink){let t=new Blob([e],{type:"text/css"}),i=URL.createObjectURL(t),s=document.createElement("link");s.href=i,s.rel="stylesheet",this.__rootStylesLink=s}}},ee=Z;function te(e={tag:"div"}){let t=document.createElement(e.tag);if(e.attributes&&function(e,t){for(let i in t)t[i].constructor===Boolean?t[i]?e.setAttribute(i,""):e.removeAttribute(i):e.setAttribute(i,t[i])}(t,e.attributes),e.styles&&function(e,t){for(let i in t)i.includes("-")?e.style.setProperty(i,t[i]):e.style[i]=t[i]}(t,e.styles),e.properties)for(let i in e.properties)t[i]=e.properties[i];return e.processors&&e.processors.forEach((e=>{e(t)})),e.children&&e.children.forEach((e=>{let i=te(e);t.appendChild(i)})),t}M(ee,"template");var ie="idb-store-ready",se=class{static get readyEventName(){return ie}static open(e="symbiote-db",t="store"){let i=e+"/"+t;return this._reg[i]||(this._reg[i]=new class{_notifyWhenReady(e=null){window.dispatchEvent(new CustomEvent(ie,{detail:{dbName:this.name,storeName:this.storeName,event:e}}))}get _updEventName(){return"symbiote-idb-update_"+this.name}_getUpdateEvent(e){return new CustomEvent(this._updEventName,{detail:{key:this.name,newValue:e}})}_notifySubscribers(e){window.localStorage.removeItem(this.name),window.localStorage.setItem(this.name,e),window.dispatchEvent(this._getUpdateEvent(e))}constructor(e,t){this.name=e,this.storeName=t,this.version=1,this.request=window.indexedDB.open(this.name,this.version),this.request.onupgradeneeded=e=>{this.db=e.target.result,this.objStore=this.db.createObjectStore(t,{keyPath:"_key"}),this.objStore.transaction.oncomplete=e=>{this._notifyWhenReady(e)}},this.request.onsuccess=e=>{this.db=e.target.result,this._notifyWhenReady(e)},this.request.onerror=e=>{console.error(e)},this._subscriptionsMap={},this._updateHandler=e=>{e.key===this.name&&this._subscriptionsMap[e.newValue]&&this._subscriptionsMap[e.newValue].forEach((async t=>{t(await this.read(e.newValue))}))},this._localUpdateHandler=e=>{this._updateHandler(e.detail)},window.addEventListener("storage",this._updateHandler),window.addEventListener(this._updEventName,this._localUpdateHandler)}read(e){let t=this.db.transaction(this.storeName,"readwrite").objectStore(this.storeName).get(e);return new Promise(((i,s)=>{t.onsuccess=t=>{var s;(null==(s=t.target.result)?void 0:s._value)?i(t.target.result._value):(i(null),console.warn(`IDB: cannot read "${e}"`))},t.onerror=e=>{s(e)}}))}write(e,t,i=!1){let s={_key:e,_value:t},r=this.db.transaction(this.storeName,"readwrite").objectStore(this.storeName).put(s);return new Promise(((t,s)=>{r.onsuccess=s=>{i||this._notifySubscribers(e),t(s.target.result)},r.onerror=e=>{s(e)}}))}delete(e,t=!1){let i=this.db.transaction(this.storeName,"readwrite").objectStore(this.storeName).delete(e);return new Promise(((s,r)=>{i.onsuccess=i=>{t||this._notifySubscribers(e),s(i)},i.onerror=e=>{r(e)}}))}getAll(){let e=this.db.transaction(this.storeName,"readwrite").objectStore(this.storeName).getAll();return new Promise(((t,i)=>{e.onsuccess=e=>{let i=e.target.result;t(i.map((e=>e._value)))},e.onerror=e=>{i(e)}}))}subscribe(e,t){this._subscriptionsMap[e]||(this._subscriptionsMap[e]=new Set);let i=this._subscriptionsMap[e];return i.add(t),{remove:()=>{i.delete(t),i.size||delete this._subscriptionsMap[e]}}}stop(){window.removeEventListener("storage",this._updateHandler),this._subscriptionsMap=null,se.clear(this.name)}}(e,t)),this._reg[i]}static clear(e){window.indexedDB.deleteDatabase(e);for(let t in this._reg)t.split("/")[0]===e&&delete this._reg[t]}};M(se,"_reg",Object.create(null));const re=e=>e,ne="{{",ae="}}",oe="plural:";function le(e,t,i={}){let{openToken:s=ne,closeToken:r=ae,transform:n=re}=i;for(let i in t){let a=t[i]?.toString();e=e.replaceAll(s+i+r,"string"==typeof a?n(a):a)}return e}function ce(e,t){[...e.querySelectorAll("[l10n]")].forEach((e=>{let i=e.getAttribute("l10n"),s="textContent";if(i.includes(":")){let e=i.split(":");s=e[0],i=e[1]}let r="l10n:"+i;t.__l10nKeys.push(r),t.add(r,i),t.sub(r,(i=>{e[s]=t.l10n(i)})),e.removeAttribute("l10n")}))}const he=()=>({"*blocksRegistry":new Set}),de=e=>({...he(),"*currentActivity":"","*currentActivityParams":{},"*history":[],"*historyBack":null,"*closeModal":()=>{e.set$({"*modalActive":!1,"*currentActivity":""})}}),ue=e=>({...de(e),"*commonProgress":0,"*uploadList":[],"*outputData":null,"*focusedEntry":null,"*uploadMetadata":null});function pe(e,t){let i,s=(...s)=>{clearTimeout(i),i=setTimeout((()=>e(...s)),t)};return s.cancel=()=>{clearTimeout(i)},s}const me="--uploadcare-blocks-window-height",ge="__UPLOADCARE_BLOCKS_WINDOW_HEIGHT_TRACKER_ENABLED__";function be(){return void 0!==window[ge]&&!!window[ge]}class fe extends ee{static StateConsumerScope=null;allowCustomTemplate=!0;ctxInit=he();init$=this.ctxInit;l10n(e,t={}){if(!e)return"";let i=this.getCssData("--l10n-"+e,!0)||e,s=function(e){const t=[];let i=e.indexOf(ne);for(;-1!==i;){const s=e.indexOf(ae,i),r=e.substring(i+2,s);if(r.startsWith(oe)){const n=e.substring(i+2,s).replace(oe,""),a=n.substring(0,n.indexOf("(")),o=n.substring(n.indexOf("(")+1,n.indexOf(")"));t.push({variable:r,pluralKey:a,countVariable:o})}i=e.indexOf(ne,s)}return t}(i);for(let e of s)t[e.variable]=this.pluralize(e.pluralKey,Number(t[e.countVariable]));return le(i,t)}pluralize(e,t){const i=this.l10n("locale-name")||"en-US",s=new Intl.PluralRules(i).select(t);return this.l10n(`${e}__${s}`)}constructor(){super(),this.activityType=null,this.addTemplateProcessor(ce),this.__l10nKeys=[]}applyL10nKey(e,t){let i="l10n:"+e;this.$[i]=t,this.__l10nKeys.push(e)}findBlockInCtx(e){let t=this.$["*blocksRegistry"];for(let i of t)if(e(i))return!0;return!1}setForCtxTarget(e,t,i){this.findBlockInCtx((t=>t.constructor.StateConsumerScope===e))&&(this.$[t]=i)}setActivity(e){this.findBlockInCtx((t=>t.activityType===e))?this.$["*currentActivity"]=e:console.warn(`Activity type "${e}" not found in the context`)}connectedCallback(){if(be()||(this._destroyInnerHeightTracker=function(){if(be())return;const e=()=>{document.documentElement.style.setProperty(me,`${window.innerHeight}px`),window[ge]=!0},t=pe(e,100);return window.addEventListener("resize",t,{passive:!0}),e(),()=>{window[ge]=!1,window.removeEventListener("resize",t)}}()),this.hasAttribute("retpl")&&(this.constructor.template=null,this.processInnerHtml=!0),this.isConnected&&this.__ctxOwner){let e=N.getCtx(this.ctxName,!1);e&&(e.store={...this.ctxInit})}super.connectedCallback()}disconnectedCallback(){super.disconnectedCallback(),this._destroyInnerHeightTracker?.()}initCallback(){this.$["*blocksRegistry"].add(this)}destroyCallback(){this.$["*blocksRegistry"].delete(this)}fileSizeFmt(e,t=2){let i=["B","KB","MB","GB","TB"],s=e=>this.getCssData("--l10n-unit-"+e.toLowerCase(),!0)||e;if(0===e)return`0 ${s(i[0])}`;let r=t<0?0:t,n=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/1024**n).toFixed(r))+" "+s(i[n])}proxyUrl(e){let t=this.getCssData("--cfg-secure-delivery-proxy",!0);return t?le(t,{previewUrl:e},{transform:e=>window.encodeURIComponent(e)}):e}updateCtxCssData=()=>{let e=this.$["*blocksRegistry"];for(let t of e)t.updateCssData()};static reg(e){e?super.reg(e.startsWith("lr-")?e:"lr-"+e):super.reg()}}class _e extends fe{static StateConsumerScope="modal";_handleBackdropClick=()=>{this._closeDialog()};_closeDialog=()=>{this.setForCtxTarget(_e.StateConsumerScope,"*modalActive",!1)};_handleDialogClose=()=>{this._closeDialog()};_handleDialogClick=e=>{e.target===this.ref.dialog&&this._closeDialog()};init$={...this.ctxInit,"*modalActive":!1,isOpen:!1,closeClicked:this._handleDialogClose};cssInit$={"--cfg-modal-backdrop-strokes":0};show(){this.ref.dialog.showModal?this.ref.dialog.showModal():this.ref.dialog.setAttribute("open","")}hide(){this.ref.dialog.close?this.ref.dialog.close():this.ref.dialog.removeAttribute("open")}initCallback(){if(super.initCallback(),"function"==typeof HTMLDialogElement)this.ref.dialog.addEventListener("close",this._handleDialogClose),this.ref.dialog.addEventListener("click",this._handleDialogClick);else{this.setAttribute("dialog-fallback","");let e=document.createElement("div");e.className="backdrop",this.appendChild(e),e.addEventListener("click",this._handleBackdropClick)}this.sub("*modalActive",(e=>{this.$.isOpen!==e&&(this.$.isOpen=e),e&&this.getCssData("--cfg-modal-scroll-lock")?document.body.style.overflow="hidden":document.body.style.overflow=null})),this.sub("--cfg-modal-backdrop-strokes",(e=>{e?this.setAttribute("strokes",""):this.removeAttribute("strokes")})),this.sub("isOpen",(e=>{e?this.show():this.hide()}))}destroyCallback(){super.destroyCallback(),this.ref.dialog.removeEventListener("close",this._handleDialogClose),this.ref.dialog.removeEventListener("click",this._handleDialogClick)}}_e.template='\n  <dialog ref="dialog">\n    <slot></slot>\n  </dialog>\n';const ye="active",ve="___ACTIVITY_IS_ACTIVE___";class we extends fe{historyTracked=!1;ctxInit=de(this);_debouncedHistoryFlush=pe(this._historyFlush.bind(this),10);initCallback(){super.initCallback(),this.hasAttribute("current-activity")&&this.sub("*currentActivity",(e=>{this.setAttribute("current-activity",e)})),this.activityType&&(this.hasAttribute("activity")||this.setAttribute("activity",this.activityType),this.sub("*currentActivity",(e=>{let t=this.ctxName+this.activityType,i=we._activityRegistry[t];this.activityType!==e&&this[ve]?(this[ve]=!1,this.removeAttribute(ye),i?.deactivateCallback?.()):this.activityType!==e||this[ve]||(this.$["*historyBack"]=this.historyBack.bind(this),this[ve]=!0,this.setAttribute(ye,""),i?.activateCallback?.(),this._debouncedHistoryFlush()),e||(this.$["*history"]=[])})))}_historyFlush(){let e=this.$["*history"];e&&(e.length>10&&(e=e.slice(e.length-11,e.length-1)),this.historyTracked&&e.push(this.activityType),this.$["*history"]=e)}static _activityRegistry=Object.create(null);get isActivityActive(){return this[ve]}registerActivity(e,t={}){const{onActivate:i,onDeactivate:s}=t;we._activityRegistry||(we._activityRegistry=Object.create(null));let r=this.ctxName+e;we._activityRegistry[r]={activateCallback:i,deactivateCallback:s}}get activityParams(){return this.$["*currentActivityParams"]}get initActivity(){return this.getCssData("--cfg-init-activity")}get doneActivity(){return this.getCssData("--cfg-done-activity")}historyBack(){let e=this.$["*history"];if(e){let t=e.pop();for(;t===this.activityType;)t=e.pop();this.$["*currentActivity"]=t,this.$["*history"]=e,t||this.setForCtxTarget(_e.StateConsumerScope,"*modalActive",!1)}}}we.activities=Object.freeze({START_FROM:"start-from",CAMERA:"camera",DRAW:"draw",UPLOAD_LIST:"upload-list",URL:"url",CONFIRMATION:"confirmation",CLOUD_IMG_EDIT:"cloud-image-edit",EXTERNAL:"external",DETAILS:"details"});const Ce=["image/*","image/heif","image/heif-sequence","image/heic","image/heic-sequence","image/avif","image/avif-sequence",".heif",".heifs",".heic",".heics",".avif",".avifs"],Te=e=>e?e.map((e=>e?.split(","))).flat().filter((e=>"string"==typeof e&&e)).map((e=>e.trim())):[],xe=(e,t)=>t.some((t=>t.endsWith("*")?(t=t.replace("*",""),e.startsWith(t)):e===t)),$e=e=>{let t=e?.type;return!!t&&xe(t,Ce)};function ke(e){return"[object Object]"===Object.prototype.toString.call(e)}const Ee=/\W|_/g;function Ae(e){return e.split(Ee).map(((e,t)=>e.charAt(0)[t>0?"toUpperCase":"toLowerCase"]()+e.slice(1))).join("")}function Se(e,{ignoreKeys:t}={ignoreKeys:[]}){return Array.isArray(e)?e.map((e=>Ie(e,{ignoreKeys:t}))):e}function Ie(e,{ignoreKeys:t}={ignoreKeys:[]}){if(Array.isArray(e))return Se(e,{ignoreKeys:t});if(!ke(e))return e;const i={};for(const s of Object.keys(e)){let r=e[s];t.includes(s)?i[s]=r:(ke(r)?r=Ie(r,{ignoreKeys:t}):Array.isArray(r)&&(r=Se(r,{ignoreKeys:t})),i[Ae(s)]=r)}return i}const Ue=e=>new Promise((t=>setTimeout(t,e)));function Re({libraryName:e,libraryVersion:t,userAgent:i,publicKey:s="",integration:r=""}){const n="JavaScript";if("string"==typeof i)return i;if("function"==typeof i)return i({publicKey:s,libraryName:e,libraryVersion:t,languageName:n,integration:r});return`${[e,t,s].filter(Boolean).join("/")} (${[n,r].filter(Boolean).join("; ")})`}const Le={factor:2,time:100};class Me extends Error{constructor(e){super(),this.name="UploadcareNetworkError",this.message="Network error",Object.setPrototypeOf(this,Me.prototype),this.originalProgressEvent=e}}const Ne=(e,t)=>{e&&(e.aborted?Promise.resolve().then(t):e.addEventListener("abort",(()=>t()),{once:!0}))};class Oe extends Error{constructor(e="Request canceled"){super(e),this.isCancel=!0,Object.setPrototypeOf(this,Oe.prototype)}}const De=({check:e,interval:t=500,timeout:i,signal:s})=>new Promise(((r,n)=>{let a,o;Ne(s,(()=>{a&&clearTimeout(a),n(new Oe("Poll cancelled"))})),i&&(o=setTimeout((()=>{a&&clearTimeout(a),n(new Oe("Timed out"))}),i));const l=()=>{try{Promise.resolve(e(s)).then((e=>{e?(o&&clearTimeout(o),r(e)):a=setTimeout(l,t)})).catch((e=>{o&&clearTimeout(o),n(e)}))}catch(e){o&&clearTimeout(o),n(e)}};a=setTimeout(l,0)})),Pe={baseCDN:"https://ucarecdn.com",baseURL:"https://upload.uploadcare.com",maxContentLength:52428800,retryThrottledRequestMaxTimes:1,retryNetworkErrorMaxTimes:3,multipartMinFileSize:26214400,multipartChunkSize:5242880,multipartMinLastPartSize:1048576,maxConcurrentRequests:4,pollingTimeoutMilliseconds:1e4,pusherKey:"79ae88bd931ea68464d9"},Be="application/octet-stream",Fe="original",Ve=({method:e,url:t,data:i,headers:s={},signal:r,onProgress:n})=>new Promise(((a,o)=>{const l=new XMLHttpRequest,c=e?.toUpperCase()||"GET";let h=!1;l.open(c,t,!0),s&&Object.entries(s).forEach((e=>{const[t,i]=e;void 0!==i&&!Array.isArray(i)&&l.setRequestHeader(t,i)})),l.responseType="text",Ne(r,(()=>{h=!0,l.abort(),o(new Oe)})),l.onload=()=>{if(200!=l.status)o(new Error(`Error ${l.status}: ${l.statusText}`));else{const e={method:c,url:t,data:i,headers:s||void 0,signal:r,onProgress:n},o=l.getAllResponseHeaders().trim().split(/[\r\n]+/),h={};o.forEach((function(e){const t=e.split(": "),i=t.shift(),s=t.join(": ");i&&void 0!==i&&(h[i]=s)}));const d=l.response,u=l.status;a({request:e,data:d,headers:h,status:u})}},l.onerror=e=>{h||o(new Me(e))},n&&"function"==typeof n&&(l.upload.onprogress=e=>{e.lengthComputable?n({isComputable:!0,value:e.loaded/e.total}):n({isComputable:!1})}),i?l.send(i):l.send()}));const ze=({name:e})=>e?[e]:[],je=function(e,...t){return e};var qe=()=>new FormData;const He=e=>"undefined"!=typeof Blob&&e instanceof Blob,Ke=e=>"undefined"!=typeof File&&e instanceof File,We=e=>"undefined"!=typeof Buffer&&e instanceof Buffer,Xe=e=>!!e&&"object"==typeof e&&!Array.isArray(e)&&"uri"in e&&"string"==typeof e.uri,Ge=e=>He(e)||Ke(e)||We(e)||Xe(e),Ye=e=>"string"==typeof e||"number"==typeof e||void 0===e,Je=e=>!!e&&"object"==typeof e&&!Array.isArray(e),Qe=e=>!!e&&"object"==typeof e&&"data"in e&&Ge(e.data);function Ze(e,t,i){if(Qe(i)){const{name:s,contentType:r}=i,n=je(i.data,s,r),a=ze({name:s,contentType:r});e.push([t,n,...a])}else if(Je(i))for(const[s,r]of Object.entries(i))void 0!==r&&e.push([`${t}[${s}]`,String(r)]);else Ye(i)&&i&&e.push([t,i.toString()])}function et(e){const t=qe(),i=function(e){const t=[];for(const[i,s]of Object.entries(e))Ze(t,i,s);return t}(e);for(const e of i){const[i,s,...r]=e;t.append(i,s,...r)}return t}class tt extends Error{constructor(e,t,i,s,r){super(),this.name="UploadClientError",this.message=e,this.code=t,this.request=i,this.response=s,this.headers=r,Object.setPrototypeOf(this,tt.prototype)}}const it=(e,t,i)=>{const s=new URL(e);return s.pathname=(s.pathname+t).replace("//","/"),i&&(s.search=(e=>{const t=new URLSearchParams;for(const[i,s]of Object.entries(e))s&&"object"==typeof s&&!Array.isArray(s)?Object.entries(s).filter((e=>e[1]??!1)).forEach((e=>t.set(`${i}[${e[0]}]`,String(e[1])))):Array.isArray(s)?s.forEach((e=>{t.append(`${i}[]`,e)})):"string"==typeof s&&s?t.set(i,s):"number"==typeof s&&t.set(i,s.toString());return t.toString()})(i)),s.toString()};const st="UploadcareUploadClient",rt="6.4.1";function nt(e){return Re({libraryName:st,libraryVersion:rt,...e})}const at="RequestThrottledError",ot=15e3,lt=1e3;function ct(e,t){const{retryThrottledRequestMaxTimes:i,retryNetworkErrorMaxTimes:s}=t;return function(e,t=Le){let i=0;return function e(s){const r=Math.round(t.time*t.factor**i);return s({attempt:i,retry:t=>Ue(t??r).then((()=>(i+=1,e(s))))})}(e)}((({attempt:t,retry:r})=>e().catch((e=>{if("response"in e&&e?.code===at&&t<i)return r(function(e){const{headers:t}=e||{};if(!t||"string"!=typeof t["retry-after"])return ot;const i=parseInt(t["retry-after"],10);return Number.isFinite(i)?1e3*i:ot}(e));if(e instanceof Me&&t<s)return r((t+1)*lt);throw e}))))}const ht=e=>{let t="";return(He(e)||Ke(e)||Xe(e))&&(t=e.type),t||Be},dt=e=>{let t="";return Ke(e)&&e.name?t=e.name:He(e)||We(e)?t="":Xe(e)&&e.name&&(t=e.name),t||Fe};function ut(e){return void 0===e||"auto"===e?"auto":e?"1":"0"}var pt,mt;!function(e){e.Token="token",e.FileInfo="file_info"}(pt||(pt={})),function(e){e.Unknown="unknown",e.Waiting="waiting",e.Progress="progress",e.Error="error",e.Success="success"}(mt||(mt={}));const gt=e=>"status"in e&&e.status===mt.Error;function bt(e,{publicKey:t,baseURL:i=Pe.baseURL,signal:s,source:r,integration:n,userAgent:a,retryThrottledRequestMaxTimes:o=Pe.retryThrottledRequestMaxTimes,retryNetworkErrorMaxTimes:l=Pe.retryNetworkErrorMaxTimes}){return ct((()=>Ve({method:"GET",headers:{"X-UC-User-Agent":nt({publicKey:t,integration:n,userAgent:a})},url:it(i,"/info/",{jsonerrors:1,pub_key:t,file_id:e,source:r}),signal:s}).then((({data:e,headers:t,request:i})=>{const s=Ie(JSON.parse(e));if("error"in s)throw new tt(s.error.content,s.error.errorCode,i,s,t);return s}))),{retryThrottledRequestMaxTimes:o,retryNetworkErrorMaxTimes:l})}function ft({file:e,publicKey:t,baseURL:i,source:s,integration:r,userAgent:n,retryThrottledRequestMaxTimes:a,retryNetworkErrorMaxTimes:o,signal:l,onProgress:c}){return De({check:l=>bt(e,{publicKey:t,baseURL:i,signal:l,source:s,integration:r,userAgent:n,retryThrottledRequestMaxTimes:a,retryNetworkErrorMaxTimes:o}).then((e=>e.isReady?e:(c&&c({isComputable:!0,value:1}),!1))),signal:l})}class _t{constructor(e,{baseCDN:t=Pe.baseCDN,fileName:i}={}){this.name=null,this.size=null,this.isStored=null,this.isImage=null,this.mimeType=null,this.cdnUrl=null,this.s3Url=null,this.originalFilename=null,this.imageInfo=null,this.videoInfo=null,this.contentInfo=null,this.metadata=null,this.s3Bucket=null;const{uuid:s,s3Bucket:r}=e,n=it(t,`${s}/`),a=r?it(`https://${r}.s3.amazonaws.com/`,`${s}/${e.filename}`):null;this.uuid=s,this.name=i||e.filename,this.size=e.size,this.isStored=e.isStored,this.isImage=e.isImage,this.mimeType=e.mimeType,this.cdnUrl=n,this.originalFilename=e.originalFilename,this.imageInfo=e.imageInfo,this.videoInfo=e.videoInfo,this.contentInfo=e.contentInfo,this.metadata=e.metadata||null,this.s3Bucket=r||null,this.s3Url=a}}const yt=(e,{publicKey:t,fileName:i,baseURL:s,secureSignature:r,secureExpire:n,store:a,contentType:o,signal:l,onProgress:c,source:h,integration:d,userAgent:u,retryThrottledRequestMaxTimes:p,retryNetworkErrorMaxTimes:m,baseCDN:g,metadata:b})=>function(e,{publicKey:t,fileName:i,contentType:s,baseURL:r=Pe.baseURL,secureSignature:n,secureExpire:a,store:o,signal:l,onProgress:c,source:h="local",integration:d,userAgent:u,retryThrottledRequestMaxTimes:p=Pe.retryThrottledRequestMaxTimes,retryNetworkErrorMaxTimes:m=Pe.retryNetworkErrorMaxTimes,metadata:g}){return ct((()=>Ve({method:"POST",url:it(r,"/base/",{jsonerrors:1}),headers:{"X-UC-User-Agent":nt({publicKey:t,integration:d,userAgent:u})},data:et({file:{data:e,name:i||dt(e),contentType:s||ht(e)},UPLOADCARE_PUB_KEY:t,UPLOADCARE_STORE:ut(o),signature:n,expire:a,source:h,metadata:g}),signal:l,onProgress:c}).then((({data:e,headers:t,request:i})=>{const s=Ie(JSON.parse(e));if("error"in s)throw new tt(s.error.content,s.error.errorCode,i,s,t);return s}))),{retryNetworkErrorMaxTimes:m,retryThrottledRequestMaxTimes:p})}(e,{publicKey:t,fileName:i,contentType:o,baseURL:s,secureSignature:r,secureExpire:n,store:a,signal:l,onProgress:c,source:h,integration:d,userAgent:u,retryThrottledRequestMaxTimes:p,retryNetworkErrorMaxTimes:m,metadata:b}).then((({file:e})=>ft({file:e,publicKey:t,baseURL:s,source:h,integration:d,userAgent:u,retryThrottledRequestMaxTimes:p,retryNetworkErrorMaxTimes:m,onProgress:c,signal:l}))).then((e=>new _t(e,{baseCDN:g}))),vt=(e,{publicKey:t,fileName:i,baseURL:s,signal:r,onProgress:n,source:a,integration:o,userAgent:l,retryThrottledRequestMaxTimes:c,retryNetworkErrorMaxTimes:h,baseCDN:d})=>bt(e,{publicKey:t,baseURL:s,signal:r,source:a,integration:o,userAgent:l,retryThrottledRequestMaxTimes:c,retryNetworkErrorMaxTimes:h}).then((e=>new _t(e,{baseCDN:d,fileName:i}))).then((e=>(n&&n({isComputable:!0,value:1}),e))),wt=(e,{signal:t}={})=>{let i=null,s=null;const r=e.map((()=>new AbortController));return Ne(t,(()=>{r.forEach((e=>e.abort()))})),Promise.all(e.map(((e,t)=>{const n=(e=>()=>{s=e,r.forEach(((t,i)=>i!==e&&t.abort()))})(t);return Promise.resolve().then((()=>e({stopRace:n,signal:r[t].signal}))).then((e=>(n(),e))).catch((e=>(i=e,null)))}))).then((e=>{if(null===s)throw i;return e[s]}))};var Ct=window.WebSocket;class Tt{constructor(){this.events=Object.create({})}emit(e,t){this.events[e]?.forEach((e=>e(t)))}on(e,t){this.events[e]=this.events[e]||[],this.events[e].push(t)}off(e,t){this.events[e]=t?this.events[e].filter((e=>e!==t)):[]}}class xt{constructor(e,t=3e4){this.ws=void 0,this.queue=[],this.isConnected=!1,this.subscribers=0,this.emmitter=new Tt,this.disconnectTimeoutId=null,this.key=e,this.disconnectTime=t}connect(){if(this.disconnectTimeoutId&&clearTimeout(this.disconnectTimeoutId),!this.isConnected&&!this.ws){const e=`wss://ws.pusherapp.com/app/${this.key}?protocol=5&client=js&version=1.12.2`;this.ws=new Ct(e),this.ws.addEventListener("error",(e=>{this.emmitter.emit("error",new Error(e.message))})),this.emmitter.on("connected",(()=>{this.isConnected=!0,this.queue.forEach((e=>this.send(e.event,e.data))),this.queue=[]})),this.ws.addEventListener("message",(e=>{const t=JSON.parse(e.data.toString());switch(t.event){case"pusher:connection_established":this.emmitter.emit("connected",void 0);break;case"pusher:ping":this.send("pusher:pong",{});break;case"progress":case"success":case"fail":this.emmitter.emit(t.channel,((e,t)=>"success"===e?{status:mt.Success,...t}:"progress"===e?{status:mt.Progress,...t}:{status:mt.Error,...t})(t.event,JSON.parse(t.data)))}}))}}disconnect(){const e=()=>{this.ws?.close(),this.ws=void 0,this.isConnected=!1};this.disconnectTime?this.disconnectTimeoutId=setTimeout((()=>{e()}),this.disconnectTime):e()}send(e,t){const i=JSON.stringify({event:e,data:t});this.ws?.send(i)}subscribe(e,t){this.subscribers+=1,this.connect();const i=`task-status-${e}`,s={event:"pusher:subscribe",data:{channel:i}};this.emmitter.on(i,t),this.isConnected?this.send(s.event,s.data):this.queue.push(s)}unsubscribe(e){this.subscribers-=1;const t=`task-status-${e}`,i={event:"pusher:unsubscribe",data:{channel:t}};this.emmitter.off(t),this.isConnected?this.send(i.event,i.data):this.queue=this.queue.filter((e=>e.data.channel!==t)),0===this.subscribers&&this.disconnect()}onError(e){return this.emmitter.on("error",e),()=>this.emmitter.off("error",e)}}let $t=null;const kt=e=>{if(!$t){const t="undefined"==typeof window?0:3e4;$t=new xt(e,t)}return $t};function Et({token:e,publicKey:t,baseURL:i,integration:s,userAgent:r,retryThrottledRequestMaxTimes:n,retryNetworkErrorMaxTimes:a,onProgress:o,signal:l}){return De({check:l=>function(e,{publicKey:t,baseURL:i=Pe.baseURL,signal:s,integration:r,userAgent:n,retryThrottledRequestMaxTimes:a=Pe.retryThrottledRequestMaxTimes,retryNetworkErrorMaxTimes:o=Pe.retryNetworkErrorMaxTimes}={}){return ct((()=>Ve({method:"GET",headers:t?{"X-UC-User-Agent":nt({publicKey:t,integration:r,userAgent:n})}:void 0,url:it(i,"/from_url/status/",{jsonerrors:1,token:e}),signal:s}).then((({data:e,headers:t,request:i})=>{const s=Ie(JSON.parse(e));if("error"in s&&!gt(s))throw new tt(s.error.content,void 0,i,s,t);return s}))),{retryNetworkErrorMaxTimes:o,retryThrottledRequestMaxTimes:a})}(e,{publicKey:t,baseURL:i,integration:s,userAgent:r,retryThrottledRequestMaxTimes:n,retryNetworkErrorMaxTimes:a,signal:l}).then((t=>{switch(t.status){case mt.Error:return new tt(t.error,t.errorCode);case mt.Waiting:return!1;case mt.Unknown:return new tt(`Token "${e}" was not found.`);case mt.Progress:return o&&("unknown"===t.total?o({isComputable:!1}):o({isComputable:!0,value:t.done/t.total})),!1;case mt.Success:return o&&o({isComputable:!0,value:t.done/t.total}),t;default:throw new Error("Unknown status")}})),signal:l})}const At=(e,{publicKey:t,fileName:i,baseURL:s,baseCDN:r,checkForUrlDuplicates:n,saveUrlForRecurrentUploads:a,secureSignature:o,secureExpire:l,store:c,signal:h,onProgress:d,source:u,integration:p,userAgent:m,retryThrottledRequestMaxTimes:g,pusherKey:b=Pe.pusherKey,metadata:f})=>{return Promise.resolve((_=b,void kt(_).connect())).then((()=>function(e,{publicKey:t,baseURL:i=Pe.baseURL,store:s,fileName:r,checkForUrlDuplicates:n,saveUrlForRecurrentUploads:a,secureSignature:o,secureExpire:l,source:c="url",signal:h,integration:d,userAgent:u,retryThrottledRequestMaxTimes:p=Pe.retryThrottledRequestMaxTimes,retryNetworkErrorMaxTimes:m=Pe.retryNetworkErrorMaxTimes,metadata:g}){return ct((()=>Ve({method:"POST",headers:{"X-UC-User-Agent":nt({publicKey:t,integration:d,userAgent:u})},url:it(i,"/from_url/",{jsonerrors:1,pub_key:t,source_url:e,store:ut(s),filename:r,check_URL_duplicates:n?1:void 0,save_URL_duplicates:a?1:void 0,signature:o,expire:l,source:c,metadata:g}),signal:h}).then((({data:e,headers:t,request:i})=>{const s=Ie(JSON.parse(e));if("error"in s)throw new tt(s.error.content,s.error.errorCode,i,s,t);return s}))),{retryNetworkErrorMaxTimes:m,retryThrottledRequestMaxTimes:p})}(e,{publicKey:t,fileName:i,baseURL:s,checkForUrlDuplicates:n,saveUrlForRecurrentUploads:a,secureSignature:o,secureExpire:l,store:c,signal:h,source:u,integration:p,userAgent:m,retryThrottledRequestMaxTimes:g,metadata:f}))).catch((e=>(kt(b)?.disconnect(),Promise.reject(e)))).then((e=>e.type===pt.FileInfo?e:wt([({signal:i})=>Et({token:e.token,publicKey:t,baseURL:s,integration:p,userAgent:m,retryThrottledRequestMaxTimes:g,onProgress:d,signal:i}),({signal:t})=>(({token:e,pusherKey:t,signal:i,onProgress:s})=>new Promise(((r,n)=>{const a=kt(t),o=a.onError(n),l=()=>{o(),a.unsubscribe(e)};Ne(i,(()=>{l(),n(new Oe("pusher cancelled"))})),a.subscribe(e,(e=>{switch(e.status){case mt.Progress:s&&("unknown"===e.total?s({isComputable:!1}):s({isComputable:!0,value:e.done/e.total}));break;case mt.Success:l(),s&&s({isComputable:!0,value:e.done/e.total}),r(e);break;case mt.Error:l(),n(new tt(e.msg,e.error_code))}}))})))({token:e.token,pusherKey:b,signal:t,onProgress:d})],{signal:h}))).then((e=>{if(e instanceof tt)throw e;return e})).then((e=>ft({file:e.uuid,publicKey:t,baseURL:s,integration:p,userAgent:m,retryThrottledRequestMaxTimes:g,onProgress:d,signal:h}))).then((e=>new _t(e,{baseCDN:r})));var _},St=new WeakMap,It=async e=>{if(We(e))return e.length;if(Ke(e)||He(e))return e.size;if(Xe(e)){return(await(async e=>{if(St.has(e))return St.get(e);const t=await fetch(e.uri).then((e=>e.blob()));return St.set(e,t),t})(e)).size}throw new Error("Unknown file type. Cannot determine file size.")},Ut=(e,t=Pe.multipartMinFileSize)=>e>=t,Rt=e=>{const t=new RegExp("[a-f0-9]{8}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{12}");return!Ge(e)&&t.test(e)},Lt=e=>{const t=new RegExp("^(?:\\w+:)?\\/\\/([^\\s\\.]+\\.\\S{2}|localhost[\\:?\\d]*)\\S*$");return!Ge(e)&&t.test(e)},Mt=async(e,t,i)=>s=>((e,t,i,s)=>{const r=s*t,n=Math.min(r+s,i);return e.slice(r,n)})(e,s,t,i),Nt=(e,t,{publicKey:i,contentType:s,onProgress:r,signal:n,integration:a,retryThrottledRequestMaxTimes:o,retryNetworkErrorMaxTimes:l})=>function(e,t,{contentType:i,signal:s,onProgress:r,retryThrottledRequestMaxTimes:n=Pe.retryThrottledRequestMaxTimes,retryNetworkErrorMaxTimes:a=Pe.retryNetworkErrorMaxTimes}){return ct((()=>Ve({method:"PUT",url:t,data:e,onProgress:r,signal:s,headers:{"Content-Type":i||Be}}).then((e=>(r&&r({isComputable:!0,value:1}),e))).then((({status:e})=>({code:e})))),{retryThrottledRequestMaxTimes:n,retryNetworkErrorMaxTimes:a})}(e,t,{publicKey:i,contentType:s,onProgress:r,signal:n,integration:a,retryThrottledRequestMaxTimes:o,retryNetworkErrorMaxTimes:l}),Ot=async(e,{publicKey:t,fileName:i,fileSize:s,baseURL:r,secureSignature:n,secureExpire:a,store:o,signal:l,onProgress:c,source:h,integration:d,userAgent:u,retryThrottledRequestMaxTimes:p,retryNetworkErrorMaxTimes:m,contentType:g,multipartChunkSize:b=Pe.multipartChunkSize,maxConcurrentRequests:f=Pe.maxConcurrentRequests,baseCDN:_,metadata:y})=>{const v=s??await It(e);let w;const C=(e,t)=>{if(!c)return;w||(w=Array(e).fill(0));return i=>{var s;i.isComputable&&(w[t]=i.value,c({isComputable:!0,value:(s=w,s.reduce(((e,t)=>e+t),0)/e)}))}};return g||(g=ht(e)),function(e,{publicKey:t,contentType:i,fileName:s,multipartChunkSize:r=Pe.multipartChunkSize,baseURL:n="",secureSignature:a,secureExpire:o,store:l,signal:c,source:h="local",integration:d,userAgent:u,retryThrottledRequestMaxTimes:p=Pe.retryThrottledRequestMaxTimes,retryNetworkErrorMaxTimes:m=Pe.retryNetworkErrorMaxTimes,metadata:g}){return ct((()=>Ve({method:"POST",url:it(n,"/multipart/start/",{jsonerrors:1}),headers:{"X-UC-User-Agent":nt({publicKey:t,integration:d,userAgent:u})},data:et({filename:s||Fe,size:e,content_type:i||Be,part_size:r,UPLOADCARE_STORE:ut(l),UPLOADCARE_PUB_KEY:t,signature:a,expire:o,source:h,metadata:g}),signal:c}).then((({data:e,headers:t,request:i})=>{const s=Ie(JSON.parse(e));if("error"in s)throw new tt(s.error.content,s.error.errorCode,i,s,t);return s.parts=Object.keys(s.parts).map((e=>s.parts[e])),s}))),{retryThrottledRequestMaxTimes:p,retryNetworkErrorMaxTimes:m})}(v,{publicKey:t,contentType:g,fileName:i||dt(e),baseURL:r,secureSignature:n,secureExpire:a,store:o,signal:l,source:h,integration:d,userAgent:u,retryThrottledRequestMaxTimes:p,retryNetworkErrorMaxTimes:m,metadata:y}).then((async({uuid:i,parts:s})=>{const r=await Mt(e,v,b);return Promise.all([i,(n=f,a=s.map(((e,i)=>()=>Nt(r(i),e,{publicKey:t,contentType:g,onProgress:C(s.length,i),signal:l,integration:d,retryThrottledRequestMaxTimes:p,retryNetworkErrorMaxTimes:m}))),new Promise(((e,t)=>{const i=[];let s=!1,r=a.length;const o=[...a],l=()=>{const n=a.length-o.length,c=o.shift();c&&c().then((t=>{s||(i[n]=t,r-=1,r?l():e(i))})).catch((e=>{s=!0,t(e)}))};for(let e=0;e<n;e++)l()})))]);var n,a})).then((([e])=>function(e,{publicKey:t,baseURL:i=Pe.baseURL,source:s="local",signal:r,integration:n,userAgent:a,retryThrottledRequestMaxTimes:o=Pe.retryThrottledRequestMaxTimes,retryNetworkErrorMaxTimes:l=Pe.retryNetworkErrorMaxTimes}){return ct((()=>Ve({method:"POST",url:it(i,"/multipart/complete/",{jsonerrors:1}),headers:{"X-UC-User-Agent":nt({publicKey:t,integration:n,userAgent:a})},data:et({uuid:e,UPLOADCARE_PUB_KEY:t,source:s}),signal:r}).then((({data:e,headers:t,request:i})=>{const s=Ie(JSON.parse(e));if("error"in s)throw new tt(s.error.content,s.error.errorCode,i,s,t);return s}))),{retryThrottledRequestMaxTimes:o,retryNetworkErrorMaxTimes:l})}(e,{publicKey:t,baseURL:r,source:h,integration:d,userAgent:u,retryThrottledRequestMaxTimes:p,retryNetworkErrorMaxTimes:m}))).then((e=>e.isReady?e:ft({file:e.uuid,publicKey:t,baseURL:r,source:h,integration:d,userAgent:u,retryThrottledRequestMaxTimes:p,retryNetworkErrorMaxTimes:m,onProgress:c,signal:l}))).then((e=>new _t(e,{baseCDN:_})))};async function Dt(e,{publicKey:t,fileName:i,baseURL:s=Pe.baseURL,secureSignature:r,secureExpire:n,store:a,signal:o,onProgress:l,source:c,integration:h,userAgent:d,retryThrottledRequestMaxTimes:u,retryNetworkErrorMaxTimes:p,contentType:m,multipartMinFileSize:g,multipartChunkSize:b,maxConcurrentRequests:f,baseCDN:_=Pe.baseCDN,checkForUrlDuplicates:y,saveUrlForRecurrentUploads:v,pusherKey:w,metadata:C}){if(Ge(e)){const y=await It(e);return Ut(y,g)?Ot(e,{publicKey:t,contentType:m,multipartChunkSize:b,fileSize:y,fileName:i,baseURL:s,secureSignature:r,secureExpire:n,store:a,signal:o,onProgress:l,source:c,integration:h,userAgent:d,maxConcurrentRequests:f,retryThrottledRequestMaxTimes:u,retryNetworkErrorMaxTimes:p,baseCDN:_,metadata:C}):yt(e,{publicKey:t,fileName:i,contentType:m,baseURL:s,secureSignature:r,secureExpire:n,store:a,signal:o,onProgress:l,source:c,integration:h,userAgent:d,retryThrottledRequestMaxTimes:u,retryNetworkErrorMaxTimes:p,baseCDN:_,metadata:C})}if(Lt(e))return At(e,{publicKey:t,fileName:i,baseURL:s,baseCDN:_,checkForUrlDuplicates:y,saveUrlForRecurrentUploads:v,secureSignature:r,secureExpire:n,store:a,signal:o,onProgress:l,source:c,integration:h,userAgent:d,retryThrottledRequestMaxTimes:u,retryNetworkErrorMaxTimes:p,pusherKey:w,metadata:C});if(Rt(e))return vt(e,{publicKey:t,fileName:i,baseURL:s,signal:o,onProgress:l,source:c,integration:h,userAgent:d,retryThrottledRequestMaxTimes:u,retryNetworkErrorMaxTimes:p,baseCDN:_});throw new TypeError(`File uploading from "${e}" is not supported`)}class Pt{constructor(e,t){this.storedAt=null,this.uuid=e.id,this.filesCount=e.filesCount,this.totalSize=Object.values(e.files).reduce(((e,t)=>e+t.size),0),this.isStored=!!e.datetimeStored,this.isImage=!!Object.values(e.files).filter((e=>e.isImage)).length,this.cdnUrl=e.cdnUrl,this.files=t,this.createdAt=e.datetimeCreated,this.storedAt=e.datetimeStored}}const Bt=e=>{for(const t of e)if(!Ge(t))return!1;return!0},Ft=e=>{for(const t of e)if(!Rt(t))return!1;return!0},Vt=e=>{for(const t of e)if(!Lt(t))return!1;return!0};function zt(e,{publicKey:t,fileName:i,baseURL:s=Pe.baseURL,secureSignature:r,secureExpire:n,store:a,signal:o,onProgress:l,source:c,integration:h,userAgent:d,retryThrottledRequestMaxTimes:u,retryNetworkErrorMaxTimes:p,contentType:m,multipartChunkSize:g=Pe.multipartChunkSize,baseCDN:b=Pe.baseCDN,checkForUrlDuplicates:f,saveUrlForRecurrentUploads:_,jsonpCallback:y}){if(!Bt(e)&&!Vt(e)&&!Ft(e))throw new TypeError(`Group uploading from "${e}" is not supported`);let v,w=!0;const C=e.length,T=(e,t)=>{if(!l)return;v||(v=Array(e).fill(0));return i=>{if(!i.isComputable||!w)return w=!1,void l({isComputable:!1});var s;v[t]=i.value,l({isComputable:!0,value:(s=v,s.reduce(((e,t)=>e+t))/e)})}};return Promise.all(e.map(((e,l)=>Dt(e,{publicKey:t,fileName:i,baseURL:s,secureSignature:r,secureExpire:n,store:a,signal:o,onProgress:T(C,l),source:c,integration:h,userAgent:d,retryThrottledRequestMaxTimes:u,retryNetworkErrorMaxTimes:p,contentType:m,multipartChunkSize:g,baseCDN:b,checkForUrlDuplicates:f,saveUrlForRecurrentUploads:_})))).then((e=>function(e,{publicKey:t,baseURL:i=Pe.baseURL,jsonpCallback:s,secureSignature:r,secureExpire:n,signal:a,source:o,integration:l,userAgent:c,retryThrottledRequestMaxTimes:h=Pe.retryThrottledRequestMaxTimes,retryNetworkErrorMaxTimes:d=Pe.retryNetworkErrorMaxTimes}){return ct((()=>Ve({method:"POST",headers:{"X-UC-User-Agent":nt({publicKey:t,integration:l,userAgent:c})},url:it(i,"/group/",{jsonerrors:1,pub_key:t,files:e,callback:s,signature:r,expire:n,source:o}),signal:a}).then((({data:e,headers:t,request:i})=>{const s=Ie(JSON.parse(e));if("error"in s)throw new tt(s.error.content,s.error.errorCode,i,s,t);return s}))),{retryNetworkErrorMaxTimes:d,retryThrottledRequestMaxTimes:h})}(e.map((e=>e.uuid)),{publicKey:t,baseURL:s,jsonpCallback:y,secureSignature:r,secureExpire:n,signal:o,source:c,integration:h,userAgent:d,retryThrottledRequestMaxTimes:u,retryNetworkErrorMaxTimes:p}).then((t=>new Pt(t,e))).then((e=>(l&&l({isComputable:!0,value:1}),e)))))}const jt=Object.freeze({file:{type:File,value:null},externalUrl:{type:String,value:null},fileName:{type:String,value:null},fileSize:{type:Number,value:null},lastModified:{type:Number,value:Date.now()},uploadProgress:{type:Number,value:0},uuid:{type:String,value:null},isImage:{type:Boolean,value:!1},mimeType:{type:String,value:null},uploadError:{type:Error,value:null,nullable:!0},validationErrorMsg:{type:String,value:null,nullable:!0},ctxName:{type:String,value:null},cdnUrl:{type:String,value:null},cdnUrlModifiers:{type:String,value:null},fileInfo:{type:_t,value:null},isUploading:{type:Boolean,value:!1},abortController:{type:AbortController,value:null,nullable:!0},thumbUrl:{type:String,value:null,nullable:!0}}),qt="blocks",Ht="0.20.1";function Kt(e){return Re({...e,libraryName:qt,libraryVersion:Ht})}const Wt="[Typed State] Wrong property name: ";class Xt{constructor(e,t){this.__typedSchema=e,this.__ctxId=t||B.generate(),this.__schema=Object.keys(e).reduce(((t,i)=>(t[i]=e[i].value,t)),{}),this.__data=N.registerCtx(this.__schema,this.__ctxId)}get uid(){return this.__ctxId}setValue(e,t){if(!this.__typedSchema.hasOwnProperty(e))return void console.warn(Wt+e);let i=this.__typedSchema[e];t?.constructor===i.type||t instanceof i.type||i.nullable&&null===t?this.__data.pub(e,t):console.warn("[Typed State] Wrong property type: "+e)}setMultipleValues(e){for(let t in e)this.setValue(t,e[t])}getValue(e){if(this.__typedSchema.hasOwnProperty(e))return this.__data.read(e);console.warn(Wt+e)}subscribe(e,t){return this.__data.sub(e,t)}remove(){N.deleteCtx(this.__ctxId)}}class Gt{constructor(e){this.__typedSchema=e.typedSchema,this.__ctxId=e.ctxName||B.generate(),this.__data=N.registerCtx({},this.__ctxId),this.__watchList=e.watchList||[],this.__handler=e.handler||null,this.__subsMap=Object.create(null),this.__observers=new Set,this.__items=new Set,this.__removed=new Set,this.__added=new Set;let t=Object.create(null);this.__notifyObservers=(e,i)=>{this.__observeTimeout&&window.clearTimeout(this.__observeTimeout),t[e]||(t[e]=new Set),t[e].add(i),this.__observeTimeout=window.setTimeout((()=>{this.__observers.forEach((e=>{e({...t})})),t=Object.create(null)}))}}notify(){this.__notifyTimeout&&window.clearTimeout(this.__notifyTimeout),this.__notifyTimeout=window.setTimeout((()=>{let e=this.__added,t=this.__removed;this.__added.clear(),this.__removed.clear(),this.__handler?.([...this.__items],e,t)}))}add(e){let t=new Xt(this.__typedSchema);for(let i in e)t.setValue(i,e[i]);return this.__data.add(t.uid,t),this.__added.add(t),this.__watchList.forEach((e=>{this.__subsMap[t.uid]||(this.__subsMap[t.uid]=[]),this.__subsMap[t.uid].push(t.subscribe(e,(()=>{this.__notifyObservers(e,t.uid)})))})),this.__items.add(t.uid),this.notify(),t}read(e){return this.__data.read(e)}readProp(e,t){return this.read(e).getValue(t)}publishProp(e,t,i){this.read(e).setValue(t,i)}remove(e){this.__removed.add(this.__data.read(e)),this.__items.delete(e),this.notify(),this.__data.pub(e,null),delete this.__subsMap[e]}clearAll(){this.__items.forEach((e=>{this.remove(e)}))}observe(e){this.__observers.add(e)}unobserve(e){this.__observers.delete(e)}findItems(e){let t=[];return this.__items.forEach((i=>{let s=this.read(i);e(s)&&t.push(i)})),t}items(){return[...this.__items]}get size(){return this.__items.size}destroy(){N.deleteCtx(this.__data),this.__observers=null;for(let e in this.__subsMap)this.__subsMap[e].forEach((e=>{e.remove()})),delete this.__subsMap[e]}}const Yt={UPLOAD_START:"UPLOAD_START",REMOVE:"REMOVE",UPLOAD_PROGRESS:"UPLOAD_PROGRESS",UPLOAD_FINISH:"UPLOAD_FINISH",UPLOAD_ERROR:"UPLOAD_ERROR",VALIDATION_ERROR:"VALIDATION_ERROR",CDN_MODIFICATION:"CLOUD_MODIFICATION",DATA_OUTPUT:"DATA_OUTPUT",DONE_FLOW:"DONE_FLOW",INIT_FLOW:"INIT_FLOW"};class Jt{constructor(e){this.ctx=e.ctx,this.type=e.type,this.data=e.data}}class Qt{static eName(e){return"LR_"+e}static _timeoutStore=Object.create(null);static emit(e,t=window,i=!0){let s=()=>{t.dispatchEvent(new CustomEvent(this.eName(e.type),{detail:e}))};if(!i)return void s();let r=e.type+e.ctx;this._timeoutStore[r]&&window.clearTimeout(this._timeoutStore[r]),this._timeoutStore[r]=window.setTimeout((()=>{s(),delete this._timeoutStore[r]}),20)}}class Zt extends we{ctxInit=ue(this);__initialUploadMetadata=null;setUploadMetadata(e){this.connectedOnce?this.$["*uploadMetadata"]=e:this.__initialUploadMetadata=e}initCallback(){super.initCallback(),this.__initialUploadMetadata&&(this.$["*uploadMetadata"]=this.__initialUploadMetadata)}destroyCallback(){super.destroyCallback();let e=this.$["*blocksRegistry"];e.has(this)&&(this.uploadCollection.unobserve(this._handleCollectionUpdate),e.delete(this))}addFiles(e){e.forEach((e=>{this.uploadCollection.add({file:e,isImage:$e(e),mimeType:e.type,fileName:e.name,fileSize:e.size})}))}openSystemDialog(e={}){let t=Te([this.getCssData("--cfg-accept"),...this.getCssData("--cfg-img-only")?Ce:[]]).join(",");this.getCssData("--cfg-accept")&&this.getCssData("--cfg-img-only")&&console.warn("There could be a mistake.\nBoth `--cfg-accept` and `--cfg-img-only` parameters are set.\nThe value of `--cfg-accept` will be concatenated with the internal image mime types list."),this.fileInput=document.createElement("input"),this.fileInput.type="file",this.fileInput.multiple=!!this.getCssData("--cfg-multiple"),e.captureCamera?(this.fileInput.capture="",this.fileInput.accept=Ce.join(",")):this.fileInput.accept=t,this.fileInput.dispatchEvent(new MouseEvent("click")),this.fileInput.onchange=()=>{this.addFiles([...this.fileInput.files]),this.$["*currentActivity"]=we.activities.UPLOAD_LIST,this.setForCtxTarget(_e.StateConsumerScope,"*modalActive",!0),this.fileInput.value="",this.fileInput=null}}get sourceList(){let e=null;return this.getCssData("--cfg-source-list")&&(e=this.getCssData("--cfg-source-list").split(",").map((e=>e.trim()))),e}initFlow(e=!1){if(this.$["*uploadList"]?.length&&!e)this.set$({"*currentActivity":we.activities.UPLOAD_LIST}),this.setForCtxTarget(_e.StateConsumerScope,"*modalActive",!0);else if(1===this.sourceList?.length){let e=this.sourceList[0];"local"===e?(this.$["*currentActivity"]=we.activities.UPLOAD_LIST,this?.openSystemDialog()):(Object.values(Zt.extSrcList).includes(e)?this.set$({"*currentActivityParams":{externalSourceType:e},"*currentActivity":we.activities.EXTERNAL}):this.$["*currentActivity"]=e,this.setForCtxTarget(_e.StateConsumerScope,"*modalActive",!0))}else this.set$({"*currentActivity":we.activities.START_FROM}),this.setForCtxTarget(_e.StateConsumerScope,"*modalActive",!0);Qt.emit(new Jt({type:Yt.INIT_FLOW,ctx:this.ctxName}),void 0,!1)}doneFlow(){this.set$({"*currentActivity":this.doneActivity,"*history":this.doneActivity?[this.doneActivity]:[]}),this.$["*currentActivity"]||this.setForCtxTarget(_e.StateConsumerScope,"*modalActive",!1),Qt.emit(new Jt({type:Yt.DONE_FLOW,ctx:this.ctxName}),void 0,!1)}get uploadCollection(){if(!this.has("*uploadCollection")){let e=new Gt({typedSchema:jt,watchList:["uploadProgress","uuid","uploadError","validationErrorMsg","cdnUrlModifiers"],handler:(e,t,i)=>{for(let e of i)e?.getValue("abortController")?.abort(),e?.setValue("abortController",null),URL.revokeObjectURL(e?.getValue("thumbUrl"));this.$["*uploadList"]=e.map((e=>({uid:e})))}});e.observe(this._handleCollectionUpdate),this.add("*uploadCollection",e)}return this.$["*uploadCollection"]}_handleCollectionUpdate=e=>{let t=this.uploadCollection;if(e.uploadProgress){let e=0,i=t.findItems((e=>!e.getValue("uploadError")));i.forEach((i=>{e+=t.readProp(i,"uploadProgress")}));let s=Math.round(e/i.length);this.$["*commonProgress"]=s,Qt.emit(new Jt({type:Yt.UPLOAD_PROGRESS,ctx:this.ctxName,data:s}),void 0,100===s)}if(e.uuid){let e=t.findItems((e=>!!e.getValue("uuid"))),i=t.findItems((e=>!!e.getValue("uploadError")||!!e.getValue("validationErrorMsg")));if(t.size-i.length===e.length){let e=this.getOutputData((e=>!!e.getValue("uuid")));Qt.emit(new Jt({type:Yt.UPLOAD_FINISH,ctx:this.ctxName,data:e}))}}if(e.uploadError){t.findItems((e=>!!e.getValue("uploadError"))).forEach((e=>{Qt.emit(new Jt({type:Yt.UPLOAD_ERROR,ctx:this.ctxName,data:t.readProp(e,"uploadError")}),void 0,!1)}))}if(e.validationErrorMsg){t.findItems((e=>!!e.getValue("validationErrorMsg"))).forEach((e=>{Qt.emit(new Jt({type:Yt.VALIDATION_ERROR,ctx:this.ctxName,data:t.readProp(e,"validationErrorMsg")}),void 0,!1)}))}if(e.cdnUrlModifiers){t.findItems((e=>!!e.getValue("cdnUrlModifiers"))).forEach((e=>{Qt.emit(new Jt({type:Yt.CDN_MODIFICATION,ctx:this.ctxName,data:N.getCtx(e).store}),void 0,!1)}))}};getUploadClientOptions(){let e=this.getCssData("--cfg-store",!0),t={store:null===e?void 0:!!e,publicKey:this.getCssData("--cfg-pubkey"),baseCDN:this.getCssData("--cfg-cdn-cname"),baseURL:this.getCssData("--cfg-base-url"),userAgent:Kt,integration:this.getCssData("--cfg-user-agent-integration"),secureSignature:this.getCssData("--cfg-secure-signature"),secureExpire:this.getCssData("--cfg-secure-expire"),retryThrottledRequestMaxTimes:this.getCssData("--cfg-retry-throttled-request-max-times"),multipartMinFileSize:this.getCssData("--cfg-multipart-min-file-size"),multipartChunkSize:this.getCssData("--cfg-multipart-chunk-size"),maxConcurrentRequests:this.getCssData("--cfg-max-concurrent-requests"),multipartMaxAttempts:this.getCssData("--cfg-multipart-max-attempts"),checkForUrlDuplicates:!!this.getCssData("--cfg-check-for-url-duplicates"),saveUrlForRecurrentUploads:!!this.getCssData("--cfg-save-url-for-recurrent-uploads"),metadata:this.$["*uploadMetadata"]};return console.log("Upload client options:",t),t}getOutputData(e){let t=[];return this.uploadCollection.findItems(e).forEach((e=>{let i=N.getCtx(e).store,s=i.fileInfo||{name:i.fileName,fileSize:i.fileSize,isImage:i.isImage,mimeType:i.mimeType},r={...s,cdnUrlModifiers:i.cdnUrlModifiers,cdnUrl:i.cdnUrl||s.cdnUrl};t.push(r)})),t}}Zt.extSrcList=Object.freeze({FACEBOOK:"facebook",DROPBOX:"dropbox",GDRIVE:"gdrive",GPHOTOS:"gphotos",INSTAGRAM:"instagram",FLICKR:"flickr",VK:"vk",EVERNOTE:"evernote",BOX:"box",ONEDRIVE:"onedrive",HUDDLE:"huddle"}),Zt.sourceTypes=Object.freeze({LOCAL:"local",URL:"url",CAMERA:"camera",DRAW:"draw",...Zt.extSrcList}),Object.values(Yt).forEach((e=>{let t=Qt.eName(e);window.addEventListener(t,(e=>{if([Yt.UPLOAD_FINISH,Yt.REMOVE,Yt.CDN_MODIFICATION].includes(e.detail.type)){let t=N.getCtx(e.detail.ctx),i=t.read("uploadCollection"),s=[];i.items().forEach((e=>{let t=N.getCtx(e).store,i=t.fileInfo;if(i){let e={...i,cdnUrlModifiers:t.cdnUrlModifiers,cdnUrl:t.cdnUrl||i.cdnUrl};s.push(e)}})),Qt.emit(new Jt({type:Yt.DATA_OUTPUT,ctx:e.detail.ctx,data:s})),t.pub("outputData",s)}}))}));class ei extends fe{init$={...this.ctxInit,name:"",path:"",size:"24",viewBox:""};initCallback(){super.initCallback(),this.sub("name",(e=>{if(!e)return;let t=this.getCssData(`--icon-${e}`);t&&(this.$.path=t)})),this.sub("path",(e=>{if(!e)return;e.trimStart().startsWith("<")?(this.setAttribute("raw",""),this.ref.svg.innerHTML=e):(this.removeAttribute("raw"),this.ref.svg.innerHTML=`<path fill-rule="evenodd" d="${e}"></path>`)})),this.sub("size",(e=>{this.$.viewBox=`0 0 ${e} ${e}`}))}}ei.template='\n  <svg ref="svg" xmlns="http://www.w3.org/2000/svg" set="@viewBox: viewBox; @height: size; @width: size"></svg>\n',ei.bindAttributes({name:"name",size:"size"});const ti=e=>{if("string"!=typeof e||!e)return"";let t=e.trim();return t.startsWith("-/")?t=t.slice(2):t.startsWith("/")&&(t=t.slice(1)),t.endsWith("/")&&(t=t.slice(0,t.length-1)),t},ii=(...e)=>e.filter((e=>"string"==typeof e&&e)).map((e=>ti(e))).join("/-/"),si=(...e)=>{let t=ii(...e);return t?`-/${t}/`:""};function ri(e){let t=new URL(e),i=t.pathname+t.search+t.hash,s=i.lastIndexOf("http"),r=i.lastIndexOf("/"),n="";return s>=0?n=i.slice(s):r>=0&&(n=i.slice(r+1)),n}function ni(e){let t=new URL(e),i=ri(e),s=ai(i)?oi(i).pathname:i;return t.pathname=t.pathname.replace(s,""),t.search="",t.hash="",t.toString()}function ai(e){return e.startsWith("http")}function oi(e){let t=new URL(e);return{pathname:t.origin+t.pathname||"",search:t.search||"",hash:t.hash||""}}const li=(e,t,i)=>{let s=new URL(ni(e));if(i=i||ri(e),s.pathname.startsWith("//")&&(s.pathname=s.pathname.replace("//","/")),ai(i)){let e=oi(i);s.pathname=s.pathname+(t||"")+(e.pathname||""),s.search=e.search,s.hash=e.hash}else s.pathname=s.pathname+(t||"")+(i||"");return s.toString()},ci=(e,t)=>{let i=new URL(e);return i.pathname=t+"/",i.toString()},hi=Object.freeze({"dev-mode":{},pubkey:{},uuid:{},src:{},lazy:{default:1},intersection:{},breakpoints:{},"cdn-cname":{default:"https://ucarecdn.com"},"proxy-cname":{},"secure-delivery-proxy":{},"hi-res-support":{default:1},"ultra-res-support":{},format:{default:"auto"},"cdn-operations":{},progressive:{},quality:{default:"smart"},"is-background-for":{}}),di="--lr-img-",ui="unresolved",pi=!window.location.host.trim()||window.location.host.includes(":")||window.location.hostname.includes("localhost"),mi=Object.create(null);for(let e in hi)mi[di+e]=hi[e]?.default||"";class gi extends ee{cssInit$=mi;$$(e){return this.$[di+e]}set$$(e){for(let t in e)this.$[di+t]=e[t]}sub$$(e,t){this.sub(di+e,(e=>{null!==e&&""!==e&&t(e)}))}_fmtAbs(e){return!e.includes("//")&&!pi&&(e=new URL(e,document.baseURI).href),e}_getCdnModifiers(e=""){return si(e&&`resize/${e}`,this.$$("cdn-operations")||"",`format/${this.$$("format")||hi.format.default}`,`quality/${this.$$("quality")||hi.quality.default}`)}_getUrlBase(e=""){if(this.$$("src").startsWith("data:")||this.$$("src").startsWith("blob:"))return this.$$("src");if(pi&&this.$$("src")&&!this.$$("src").includes("//"))return this._proxyUrl(this.$$("src"));let t=this._getCdnModifiers(e);return this.$$("src").startsWith(this.$$("cdn-cname"))?li(this.$$("src"),t):this.$$("cdn-cname")&&this.$$("uuid")||this.$$("uuid")?this._proxyUrl(li(ci(this.$$("cdn-cname"),this.$$("uuid")),t)):this.$$("proxy-cname")?this._proxyUrl(li(this.$$("proxy-cname"),t,this._fmtAbs(this.$$("src")))):this.$$("pubkey")?this._proxyUrl(li(`https://${this.$$("pubkey")}.ucr.io/`,t,this._fmtAbs(this.$$("src")))):void 0}_proxyUrl(e){return this.$$("secure-delivery-proxy")?le(this.$$("secure-delivery-proxy"),{previewUrl:e},{transform:e=>window.encodeURIComponent(e)}):e}_getElSize(e,t=1,i=!0){let s=e.getBoundingClientRect(),r=t*Math.round(s.width),n=i?"":t*Math.round(s.height);return r||n?`${r||""}x${n||""}`:null}_setupEventProxy(e){let t=e=>{e.stopPropagation();let t=new Event(e.type,e);this.dispatchEvent(t)},i=["load","error"];for(let s of i)e.addEventListener(s,t)}get img(){return this._img||(this._img=new Image,this._setupEventProxy(this.img),this._img.setAttribute(ui,""),this.img.onload=()=>{this.img.removeAttribute(ui)},this.initAttributes(),this.appendChild(this._img)),this._img}get bgSelector(){return this.$$("is-background-for")}initAttributes(){[...this.attributes].forEach((e=>{hi[e.name]||this.img.setAttribute(e.name,e.value)}))}get breakpoints(){if(this.$$("breakpoints")){let e=new Set;return this.$$("breakpoints").split(",").forEach((t=>{e.add(parseFloat(t.trim()))})),e}return null}renderBg(e){let t=new Set;this.breakpoints?this.breakpoints.forEach((e=>{t.add(`url("${this._getUrlBase(e+"x")}") ${e}w`),this.$$("hi-res-support")&&t.add(`url("${this._getUrlBase(2*e+"x")}") ${2*e}w`),this.$$("ultra-res-support")&&t.add(`url("${this._getUrlBase(3*e+"x")}") ${3*e}w`)})):(t.add(`url("${this._getUrlBase(this._getElSize(e))}") 1x`),this.$$("hi-res-support")&&t.add(`url("${this._getUrlBase(this._getElSize(e,2))}") 2x`),this.$$("ultra-res-support")&&t.add(`url("${this._getUrlBase(this._getElSize(e,3))}") 3x`));let i=`image-set(${[...t].join(", ")})`;e.style.setProperty("background-image",i),e.style.setProperty("background-image","-webkit-"+i)}getSrcset(){let e=new Set;return this.breakpoints?this.breakpoints.forEach((t=>{e.add(this._getUrlBase(t+"x")+` ${t}w`),this.$$("hi-res-support")&&e.add(this._getUrlBase(2*t+"x")+` ${2*t}w`),this.$$("ultra-res-support")&&e.add(this._getUrlBase(3*t+"x")+` ${3*t}w`)})):(e.add(this._getUrlBase(this._getElSize(this.img))+" 1x"),this.$$("hi-res-support")&&e.add(this._getUrlBase(this._getElSize(this.img,2))+" 2x"),this.$$("ultra-res-support")&&e.add(this._getUrlBase(this._getElSize(this.img,3))+" 3x")),[...e].join()}getSrc(){return this._getUrlBase()}init(){this.bgSelector?[...document.querySelectorAll(this.bgSelector)].forEach((e=>{this.$$("intersection")?this.initIntersection(e,(()=>{this.renderBg(e)})):this.renderBg(e)})):this.$$("intersection")?this.initIntersection(this.img,(()=>{this.img.srcset=this.getSrcset(),this.img.src=this.getSrc()})):(this.img.srcset=this.getSrcset(),this.img.src=this.getSrc())}initIntersection(e,t){this._isnObserver=new IntersectionObserver((i=>{i.forEach((i=>{i.isIntersecting&&(t(),this._isnObserver.unobserve(e))}))}),{root:null,rootMargin:"0px"}),this._isnObserver.observe(e),this._observed||(this._observed=new Set),this._observed.add(e)}destroyCallback(){super.destroyCallback(),this._isnObserver&&(this._observed.forEach((e=>{this._isnObserver.unobserve(e)})),this._isnObserver=null)}static get observedAttributes(){return Object.keys(hi)}attributeChangedCallback(e,t,i){window.setTimeout((()=>{this.$[di+e]=i}))}}class bi extends Zt{init$={...this.ctxInit,"*simpleButtonText":"",onClick:()=>{this.initFlow()}};initCallback(){super.initCallback(),this.bindCssData("--cfg-multiple"),this.sub("--cfg-multiple",(e=>{this.$["*simpleButtonText"]=e?this.l10n("upload-files"):this.l10n("upload-file")}))}}bi.template='\n  <lr-drop-area>\n    <button type="button" set="onclick: onClick">\n      <lr-icon name="upload"></lr-icon>\n      <span>{{*simpleButtonText}}</span>\n      <slot></slot>\n      <div class="visual-drop-area"></div>\n    </button>\n  </lr-drop-area>\n';function fi(e){return new Promise((t=>{"function"!=typeof window.FileReader&&t(!1);try{let i=new FileReader;i.onerror=()=>{t(!0)};let s=e=>{"loadend"!==e.type&&i.abort(),t(!1)};i.onloadend=s,i.onprogress=s,i.readAsDataURL(e)}catch(e){t(!1)}}))}function _i(e){return new Promise((t=>{let i=0,s=[],r=e=>{e||(console.warn("Unexpectedly received empty content entry",{scope:"drag-and-drop"}),t(null)),e.isFile?(i++,e.file((e=>{i--,s.push(e),0===i&&t(s)}))):e.isDirectory&&n(e.createReader())},n=e=>{i++,e.readEntries((e=>{i--;for(let t of e)r(t);0===i&&t(s)}))};r(e)}))}const yi={ACTIVE:0,INACTIVE:1,NEAR:2,OVER:3};let vi=["focus"],wi=100,Ci=new Map;function Ti(e){let t=0,i=document.body,s=new Set,r=yi.INACTIVE,n=t=>{e.shouldIgnore()&&t!==yi.INACTIVE||(r!==t&&s.forEach((e=>e(t))),r=t)};var a;a=t=>e.onChange(t),s.add(a);let o=()=>{t=0,n(yi.INACTIVE)},l=()=>{t+=1,r===yi.INACTIVE&&n(yi.ACTIVE)},c=()=>{t-=1,t>0||n(yi.INACTIVE)},h=e=>{e.preventDefault(),t=0,n(yi.INACTIVE)},d=t=>{t.preventDefault();let i=[t.x,t.y],s=e.element.getBoundingClientRect(),r=Math.floor(function(e,t){let i=Math.max(Math.min(e[0],t.x+t.width),t.x),s=Math.max(Math.min(e[1],t.y+t.height),t.y);return Math.sqrt((e[0]-i)*(e[0]-i)+(e[1]-s)*(e[1]-s))}(i,s)),a=r<wi,o=t.composedPath().includes(e.element);Ci.set(e.element,r);let l=Math.min(...Ci.values())===r;n(o&&l?yi.OVER:a&&l?yi.NEAR:yi.ACTIVE)},u=async t=>{t.preventDefault();let i=await function(e){let t=[],i=[];for(let s=0;s<e.items.length;s++){let r=e.items[s];if(r)if("file"===r.kind){if("function"==typeof r.webkitGetAsEntry||"function"==typeof r.getAsEntry){let e="function"==typeof r.webkitGetAsEntry?r.webkitGetAsEntry():r.getAsEntry();i.push(_i(e).then((e=>{t.push(...e)})));continue}let e=r.getAsFile();i.push(fi(e).then((i=>{i||t.push(e)})))}else"string"===r.kind&&r.type.match("^text/uri-list")&&i.push(new Promise((e=>{r.getAsString((i=>{t.push(i),e()}))})))}return Promise.all(i).then((()=>t))}(t.dataTransfer);e.onItems(i),n(yi.INACTIVE)};return i.addEventListener("drop",h),i.addEventListener("dragleave",c),i.addEventListener("dragenter",l),i.addEventListener("dragover",d),e.element.addEventListener("drop",u),vi.forEach((e=>{window.addEventListener(e,o)})),()=>{Ci.delete(e.element),i.removeEventListener("drop",h),i.removeEventListener("dragleave",c),i.removeEventListener("dragenter",l),i.removeEventListener("dragover",d),e.element.removeEventListener("drop",u),vi.forEach((e=>{window.removeEventListener(e,o)}))}}class xi extends Zt{init$={...this.ctxInit,state:yi.INACTIVE,withIcon:!1,isClickable:!1,isFullscreen:!1,text:this.l10n("drop-files-here"),"lr-drop-area/targets":null};isActive(){const e=this.getBoundingClientRect(),t=e.width>0&&e.height>0,i=e.top>=0&&e.left>=0&&e.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&e.right<=(window.innerWidth||document.documentElement.clientWidth),s=window.getComputedStyle(this),r="hidden"!==s.visibility&&"none"!==s.display;return t&&r&&i}initCallback(){super.initCallback(),this.$["lr-drop-area/targets"]||(this.$["lr-drop-area/targets"]=new Set),this.$["lr-drop-area/targets"].add(this),this.defineAccessor("clickable",(e=>{this.set$({isClickable:"string"==typeof e})})),this.defineAccessor("with-icon",(e=>{this.set$({withIcon:"string"==typeof e})})),this.defineAccessor("fullscreen",(e=>{this.set$({isFullscreen:"string"==typeof e})})),this.defineAccessor("text",(e=>{e?this.set$({text:this.l10n(e)||e}):this.set$({text:this.l10n("drop-files-here")})})),this._destroyDropzone=Ti({element:this,shouldIgnore:()=>this._isDisabled(),onChange:e=>{this.$.state=e},onItems:e=>{if(!e.length)return;let t=this.getCssData("--cfg-multiple"),i=this.getCssData("--cfg-multiple-max"),s=this.uploadCollection.size;t&&i?e=e.slice(0,i-s-1):t||(e=e.slice(0,s>0?0:1)),e.forEach((e=>{if("string"==typeof e)return void this.uploadCollection.add({externalUrl:e});let t=$e(e);this.uploadCollection.add({file:e,isImage:t,mimeType:e.type,fileName:e.name,fileSize:e.size})})),this.uploadCollection.size&&(this.set$({"*currentActivity":we.activities.UPLOAD_LIST}),this.setForCtxTarget(_e.StateConsumerScope,"*modalActive",!0))}});let e=this.ref["content-wrapper"];e&&(this._destroyContentWrapperDropzone=Ti({element:e,onChange:t=>{const i=Object.entries(yi).find((([,e])=>e===t))?.[0].toLowerCase();i&&e.setAttribute("drag-state",i)},onItems:()=>{},shouldIgnore:()=>this._isDisabled()})),this.sub("state",(e=>{const t=Object.entries(yi).find((([,t])=>t===e))?.[0].toLowerCase();t&&this.setAttribute("drag-state",t)})),this.$.isClickable&&(this._onAreaClicked=()=>{this.openSystemDialog()},this.addEventListener("click",this._onAreaClicked))}_isDisabled(){if(!this._couldHandleFiles())return!0;if(!this.$.isFullscreen)return!1;return[...this.$["lr-drop-area/targets"]].filter((e=>e!==this)).filter((e=>e.isActive())).length>0}_couldHandleFiles(){let e=this.getCssData("--cfg-multiple"),t=this.getCssData("--cfg-multiple-max"),i=this.uploadCollection.size;return!(e&&t&&i>=t)&&!(!e&&i>0)}destroyCallback(){super.destroyCallback(),this.$["lr-drop-area/targets"]?.remove?.(this),this._destroyDropzone?.(),this._destroyContentWrapperDropzone?.(),this._onAreaClicked&&this.removeEventListener("click",this._onAreaClicked)}}xi.template='\n  <slot>\n    <div ref="content-wrapper" class="content-wrapper">\n      <div class="icon-container" set="@hidden: !withIcon">\n        <lr-icon name="default"></lr-icon>\n        <lr-icon name="arrow-down"></lr-icon>\n      </div>\n      <span class="text">{{text}}</span>\n    </div>\n  </slot>\n',xi.bindAttributes({"with-icon":null,clickable:null,text:null,fullscreen:null});class $i extends Zt{_registeredTypes={};init$={...this.ctxInit,iconName:"default"};initTypes(){this.registerType({type:Zt.sourceTypes.LOCAL,onClick:()=>{this.openSystemDialog()}}),this.registerType({type:Zt.sourceTypes.URL,activity:we.activities.URL,textKey:"from-url"}),this.registerType({type:Zt.sourceTypes.CAMERA,activity:we.activities.CAMERA,onClick:()=>{var e=void 0!==document.createElement("input").capture;return e&&this.openSystemDialog({captureCamera:!0}),!e}}),this.registerType({type:"draw",activity:we.activities.DRAW,icon:"edit-draw"});for(let e of Object.values(Zt.extSrcList))this.registerType({type:e,activity:we.activities.EXTERNAL,activityParams:{externalSourceType:e}})}initCallback(){super.initCallback(),this.initTypes(),this.setAttribute("role","button"),this.defineAccessor("type",(e=>{e&&this.applyType(e)}))}registerType(e){this._registeredTypes[e.type]=e}getType(e){return this._registeredTypes[e]}applyType(e){const t=this._registeredTypes[e];if(!t)return void console.warn("Unsupported source type: "+e);const{textKey:i=e,icon:s=e,activity:r,onClick:n,activityParams:a={}}=t;this.applyL10nKey("src-type",`src-type-${i}`),this.$.iconName=s,this.onclick=e=>{(n?n(e):!!r)&&this.set$({"*currentActivityParams":a,"*currentActivity":r})}}}$i.template='\n  <lr-icon set="@name: iconName"></lr-icon>\n  <div class="txt" l10n="src-type"></div>\n',$i.bindAttributes({type:null});class ki{caption="";text="";iconName="";isError=!1}class Ei extends fe{init$={...this.ctxInit,iconName:"info",captionTxt:"Message caption",msgTxt:"Message...","*message":null,onClose:()=>{this.$["*message"]=null}};initCallback(){super.initCallback(),this.sub("*message",(e=>{e?(this.setAttribute("active",""),this.set$({captionTxt:e.caption||"",msgTxt:e.text||"",iconName:e.isError?"error":"info"}),e.isError?this.setAttribute("error",""):this.removeAttribute("error")):this.removeAttribute("active")}))}}function Ai(e){let t=new Blob([e],{type:"image/svg+xml"});return URL.createObjectURL(t)}function Si(e="hsl(209, 21%, 65%)",t=32,i=32){return Ai(`\n  <svg width="${t}" height="${i}" viewBox="0 0 30 30" fill="none" xmlns="http://www.w3.org/2000/svg">\n    <path fill-rule="evenodd" fill="${e}" d="M9.68848 8.70068C9.68848 8.42454 9.91233 8.20068 10.1885 8.20068H15.0885C15.2211 8.20068 15.3483 8.25336 15.442 8.34713L20.342 13.2471C20.4358 13.3409 20.4885 13.4681 20.4885 13.6007V21.3007C20.4885 21.5768 20.2646 21.8007 19.9885 21.8007H10.1885C9.91233 21.8007 9.68848 21.5768 9.68848 21.3007V8.70068ZM10.6885 9.20068V20.8007H19.4885V14.1007L15.0885 14.1007C14.8123 14.1007 14.5885 13.8768 14.5885 13.6007L14.5885 9.20068H10.6885ZM15.5885 9.90779L18.7814 13.1007L15.5885 13.1007L15.5885 9.90779Z"/>\n  </svg>\n  `)}Ei.template='\n  <div class="heading">\n    <lr-icon set="@name: iconName"></lr-icon>\n    <div class="caption">{{captionTxt}}</div>\n    <button type="button" set="onclick: onClose">\n      <lr-icon name="close"></lr-icon>\n    </button>\n  </div>\n  <div class="msg">{{msgTxt}}</div>\n';const Ii=Object.freeze({FINISHED:Symbol(0),FAILED:Symbol(1),UPLOADING:Symbol(2),IDLE:Symbol(3)});class Ui extends Zt{pauseRender=!0;_entrySubs=new Set;_entry=null;_isIntersecting=!1;_debouncedGenerateThumb=pe(this._generateThumbnail.bind(this),100);_debouncedCalculateState=pe(this._calculateState.bind(this),0);_renderedOnce=!1;cssInit$={"--cfg-use-cloud-image-editor":0};init$={...this.ctxInit,uid:"",itemName:"",errorText:"",thumbUrl:"",progressValue:0,progressVisible:!1,progressUnknown:!1,badgeIcon:"",isFinished:!1,isFailed:!1,isUploading:!1,isFocused:!1,isEditable:!1,state:Ii.IDLE,"*uploadTrigger":null,onEdit:()=>{this.set$({"*focusedEntry":this._entry}),this.findBlockInCtx((e=>e.activityType===we.activities.DETAILS))?this.$["*currentActivity"]=we.activities.DETAILS:this.$["*currentActivity"]=we.activities.CLOUD_IMG_EDIT},onRemove:()=>{let e=this._entry.getValue("uuid");if(e){let t=this.getOutputData((t=>t.getValue("uuid")===e));Qt.emit(new Jt({type:Yt.REMOVE,ctx:this.ctxName,data:t}))}this.uploadCollection.remove(this.$.uid)},onUpload:()=>{this.upload()}};_reset(){for(let e of this._entrySubs)e.remove();this._debouncedGenerateThumb.cancel(),this._entrySubs=new Set,this._entry=null,this._isIntersecting=!1}_observerCallback(e){let[t]=e;this._isIntersecting=t.isIntersecting,t.isIntersecting&&!this._renderedOnce&&(this.render(),this._renderedOnce=!0),0===t.intersectionRatio?this._debouncedGenerateThumb.cancel():this._debouncedGenerateThumb()}_calculateState(){let e=this._entry,t=Ii.IDLE;e.getValue("uploadError")||e.getValue("validationErrorMsg")?t=Ii.FAILED:e.getValue("isUploading")?t=Ii.UPLOADING:e.getValue("uuid")&&(t=Ii.FINISHED),this.$.state!==t&&(this.$.state=t)}async _generateThumbnail(){let e=this._entry;if(e.getValue("uuid")&&e.getValue("isImage")){let t=this.getCssData("--cfg-thumb-size")||76,i=this.proxyUrl(li(ci(this.getCssData("--cfg-cdn-cname"),this._entry.getValue("uuid")),si(e.getValue("cdnUrlModifiers"),`scale_crop/${t}x${t}/center`))),s=e.getValue("thumbUrl");return e.setValue("thumbUrl",i),void URL.revokeObjectURL(s)}if(!e.getValue("thumbUrl"))if(e.getValue("file")?.type.includes("image"))try{let t=await function(e,t=40){if("image/svg+xml"===e.type)return URL.createObjectURL(e);let i=document.createElement("canvas"),s=i.getContext("2d"),r=new Image,n=new Promise(((e,n)=>{r.onload=()=>{let a=r.height/r.width;a>1?(i.width=t,i.height=t*a):(i.height=t,i.width=t/a),s.fillStyle="rgb(240, 240, 240)",s.fillRect(0,0,i.width,i.height),s.drawImage(r,0,0,i.width,i.height),i.toBlob((t=>{if(!t)return void n();let i=URL.createObjectURL(t);e(i)}))},r.onerror=e=>{n(e)}}));return r.src=URL.createObjectURL(e),n}(e.getValue("file"),this.getCssData("--cfg-thumb-size")||76);e.setValue("thumbUrl",t)}catch(t){let i=window.getComputedStyle(this).getPropertyValue("--clr-generic-file-icon");e.setValue("thumbUrl",Si(i))}else{let t=window.getComputedStyle(this).getPropertyValue("--clr-generic-file-icon");e.setValue("thumbUrl",Si(t))}}_showMessage(e,t,i){let s=new ki;s.caption=t,s.text=i,s.isError="error"===e,this.set$({badgeIcon:`badge-${e}`,"*message":s})}_subEntry(e,t){let i=this._entry.subscribe(e,t);this._entrySubs.add(i)}_handleEntryId(e){this._reset();let t=this.uploadCollection?.read(e);this._entry=t,t&&(this._subEntry("validationErrorMsg",(e=>{this._debouncedCalculateState(),this.$.errorText=e})),this._subEntry("uploadError",(e=>{this._debouncedCalculateState(),this.$.errorText=e?.message})),this._subEntry("isUploading",(()=>{this._debouncedCalculateState()})),this._subEntry("uploadProgress",(e=>{this.$.progressValue=e})),this._subEntry("fileName",(e=>{this.$.itemName=e||t.getValue("externalUrl")||this.l10n("file-no-name")})),this._subEntry("fileSize",(e=>{let i=this.getCssData("--cfg-max-local-file-size-bytes");i&&e&&e>i&&t.setValue("validationErrorMsg",this.l10n("files-max-size-limit-error",{maxFileSize:i}))})),this._subEntry("mimeType",(e=>{if(!e)return;let i=this.getCssData("--cfg-img-only"),s=this.getCssData("--cfg-accept"),r=Te([...i?Ce:[],s]);r.length>0&&!xe(e,r)&&t.setValue("validationErrorMsg",this.l10n("file-type-not-allowed"))})),this._subEntry("isImage",(e=>{let i=this.getCssData("--cfg-img-only");t.getValue("externalUrl")&&!t.getValue("uuid")&&i&&!e||i&&!e&&t.setValue("validationErrorMsg",this.l10n("images-only-accepted"))})),this._subEntry("externalUrl",(e=>{this.$.itemName=t.getValue("fileName")||e||this.l10n("file-no-name")})),this._subEntry("uuid",(e=>{this._debouncedCalculateState(),e&&this._debouncedGenerateThumb()})),this._subEntry("cdnUrlModifiers",(()=>{this._debouncedGenerateThumb()})),this._subEntry("thumbUrl",(e=>{this.$.thumbUrl=e?`url(${e})`:""})),this.getCssData("--cfg-confirm-upload")||this.upload(),this._isIntersecting&&this._debouncedGenerateThumb())}initCallback(){super.initCallback(),this.sub("uid",(e=>{this._handleEntryId(e)})),this.sub("state",(e=>{this._handleState(e)})),this.sub("--cfg-use-cloud-image-editor",(()=>{this._handleState(this.$.state)})),this.onclick=()=>{Ui.activeInstances.forEach((e=>{e===this?e.setAttribute("focused",""):e.removeAttribute("focused")}))},this.$["*uploadTrigger"]=null,this.sub("*uploadTrigger",(e=>{e&&this.isConnected&&this.upload()})),Ui.activeInstances.add(this)}_handleState(e){this.set$({isFailed:e===Ii.FAILED,isUploading:e===Ii.UPLOADING,isFinished:e===Ii.FINISHED,progressVisible:e===Ii.UPLOADING,isEditable:this.$["--cfg-use-cloud-image-editor"]&&e===Ii.FINISHED&&this._entry?.getValue("isImage")}),e===Ii.FAILED?this.$.badgeIcon="badge-error":e===Ii.FINISHED&&(this.$.badgeIcon="badge-success"),e===Ii.UPLOADING?this.$.isFocused=!1:this.$.progressValue=0}destroyCallback(){super.destroyCallback(),Ui.activeInstances.delete(this),this._reset()}connectedCallback(){super.connectedCallback(),this._observer=new window.IntersectionObserver(this._observerCallback.bind(this),{root:this.parentElement,rootMargin:"50% 0px 50% 0px",threshold:[0,1]}),this._observer.observe(this)}disconnectedCallback(){super.disconnectedCallback(),this._debouncedGenerateThumb.cancel(),this._observer?.disconnect()}async upload(){let e=this._entry;if(e.getValue("uuid")||e.getValue("isUploading")||e.getValue("validationErrorMsg"))return;let t=this.getOutputData((e=>!e.getValue("uuid")));Qt.emit(new Jt({type:Yt.UPLOAD_START,ctx:this.ctxName,data:t})),this._debouncedCalculateState(),e.setValue("isUploading",!0),e.setValue("uploadError",null),e.setValue("validationErrorMsg",null),!e.getValue("file")&&e.getValue("externalUrl")&&(this.$.progressUnknown=!0);try{let t=new AbortController;e.setValue("abortController",t);let i=await Dt(e.getValue("file")||e.getValue("externalUrl"),{...this.getUploadClientOptions(),fileName:e.getValue("fileName"),onProgress:t=>{if(t.isComputable){let i=100*t.value;e.setValue("uploadProgress",i)}this.$.progressUnknown=!t.isComputable},signal:t.signal});e.setMultipleValues({fileInfo:i,isUploading:!1,fileName:i.name,fileSize:i.size,isImage:i.isImage,mimeType:i.mimeType,uuid:i.uuid,cdnUrl:i.cdnUrl}),e===this._entry&&this._debouncedCalculateState()}catch(t){e.setMultipleValues({abortController:null,isUploading:!1,uploadProgress:0}),e===this._entry&&this._debouncedCalculateState(),t?.isCancel||e.setValue("uploadError",t)}}}Ui.template='\n  <div class="inner" set="@finished: isFinished; @uploading: isUploading; @failed: isFailed; @focused: isFocused">\n    <div class="thumb" set="style.backgroundImage: thumbUrl">\n      <div class="badge">\n        <lr-icon set="@name: badgeIcon"></lr-icon>\n      </div>\n    </div>\n    <div class="file-name-wrapper">\n      <span class="file-name" set="@title: itemName">{{itemName}}</span>\n      <span class="file-error" set="@hidden: !errorText">{{errorText}}</span>\n    </div>\n    <div class="file-actions">\n      <button type="button" class="edit-btn mini-btn" set="onclick: onEdit; @hidden: !isEditable">\n        <lr-icon name="edit-file"></lr-icon>\n      </button>\n      <button type="button" class="remove-btn mini-btn" set="onclick: onRemove;">\n        <lr-icon name="remove-file"></lr-icon>\n      </button>\n      <button type="button" class="upload-btn mini-btn" set="onclick: onUpload;">\n        <lr-icon name="upload"></lr-icon>\n      </button>\n    </div>\n    <lr-progress-bar\n      class="progress-bar"\n      set="value: progressValue; visible: progressVisible; unknown: progressUnknown"\n    >\n    </lr-progress-bar>\n  </div>\n',Ui.activeInstances=new Set;class Ri extends Zt{historyTracked=!0;activityType=we.activities.UPLOAD_LIST;init$={...this.ctxInit,doneBtnVisible:!1,doneBtnEnabled:!1,uploadBtnVisible:!1,addMoreBtnVisible:!1,addMoreBtnEnabled:!1,headerText:"",hasFiles:!1,onAdd:()=>{this.initFlow(!0)},onUpload:()=>{this.$["*uploadTrigger"]={},this._updateUploadsState()},onDone:()=>{this.doneFlow()},onCancel:()=>{let e=this.getOutputData((e=>!!e.getValue("uuid")));Qt.emit(new Jt({type:Yt.REMOVE,ctx:this.ctxName,data:e})),this.uploadCollection.clearAll()}};cssInit$={"--cfg-show-empty-list":0,"--cfg-multiple":1,"--cfg-multiple-min":0,"--cfg-multiple-max":0,"--cfg-confirm-upload":1,"--cfg-source-list":""};_debouncedHandleCollectionUpdate=pe((()=>{this._updateUploadsState(),this._updateCountLimitMessage()}),0);_validateFilesCount(){let e=!!this.getCssData("--cfg-multiple"),t=e?this.getCssData("--cfg-multiple-min")??0:1,i=e?this.getCssData("--cfg-multiple-max")??0:1,s=this.uploadCollection.size,r=!!t&&s<t,n=!!i&&s>i;return{passed:!r&&!n,tooFew:r,tooMany:n,min:t,max:i,exact:i===s}}_updateCountLimitMessage(){let e=this.uploadCollection.size,t=this._validateFilesCount();if(e&&!t.passed){let i=new ki,s=t.tooFew?"files-count-limit-error-too-few":"files-count-limit-error-too-many";i.caption=this.l10n("files-count-limit-error-title"),i.text=this.l10n(s,{min:t.min,max:t.max,total:e}),i.isError=!0,this.set$({"*message":i})}}_updateUploadsState(){let e=this.uploadCollection.items(),t={total:e.length,succeed:0,uploading:0,failed:0};for(let i of e){let e=this.uploadCollection.read(i);e.getValue("uuid")&&!e.getValue("validationErrorMsg")&&(t.succeed+=1),e.getValue("isUploading")&&(t.uploading+=1),(e.getValue("validationErrorMsg")||e.getValue("uploadError"))&&(t.failed+=1)}let i=t.total===t.succeed+t.failed,{passed:s,tooMany:r,exact:n}=this._validateFilesCount(),a=0===t.failed,o=t.total>0&&s&&a,l=!i&&t.total-t.succeed-t.uploading-t.failed>0&&s;this.set$({doneBtnVisible:i,doneBtnEnabled:o,uploadBtnVisible:l,addMoreBtnEnabled:0===t.total||!r&&!n,addMoreBtnVisible:!n||this.getCssData("--cfg-multiple"),headerText:this._getHeaderText(t)})}_getHeaderText(e){const t=t=>{const i=e[t];return this.l10n(`header-${t}`,{count:i})};return e.uploading>0?t("uploading"):e.failed>0?t("failed"):e.succeed>0?t("succeed"):t("total")}initCallback(){super.initCallback(),this.registerActivity(this.activityType),this.sub("--cfg-multiple",this._debouncedHandleCollectionUpdate),this.sub("--cfg-multiple-min",this._debouncedHandleCollectionUpdate),this.sub("--cfg-multiple-max",this._debouncedHandleCollectionUpdate),this.sub("*currentActivity",(e=>{0!==this.uploadCollection?.size||this.getCssData("--cfg-show-empty-list")||e!==this.activityType||(this.$["*currentActivity"]=this.initActivity)})),this.uploadCollection.observe(this._debouncedHandleCollectionUpdate),this.sub("*uploadList",(e=>{this._debouncedHandleCollectionUpdate(),this.set$({hasFiles:e.length>0}),0!==e?.length||this.getCssData("--cfg-show-empty-list")||this.historyBack()}))}destroyCallback(){super.destroyCallback(),this.uploadCollection.unobserve(this._debouncedHandleCollectionUpdate)}}Ri.template='\n  <lr-activity-header>\n    <span class="header-text">{{headerText}}</span>\n    <button type="button" class="mini-btn close-btn" set="onclick: *closeModal">\n      <lr-icon name="close"></lr-icon>\n    </button>\n  </lr-activity-header>\n\n  <div class="no-files" set="@hidden: hasFiles">\n    <slot name="empty"><span l10n="no-files"></span></slot>\n  </div>\n\n  <div class="files" repeat="*uploadList" repeat-item-tag="lr-file-item"></div>\n\n  <div class="toolbar">\n    <button type="button" class="cancel-btn secondary-btn" set="onclick: onCancel;" l10n="clear"></button>\n    <div class="toolbar-spacer"></div>\n    <button\n      type="button"\n      class="add-more-btn secondary-btn"\n      set="onclick: onAdd; @disabled: !addMoreBtnEnabled; @hidden: !addMoreBtnVisible"\n    >\n      <lr-icon name="add"></lr-icon><span l10n="add-more"></span>\n    </button>\n    <button\n      type="button"\n      class="upload-btn primary-btn"\n      set="@hidden: !uploadBtnVisible; onclick: onUpload;"\n      l10n="upload"\n    ></button>\n    <button\n      type="button"\n      class="done-btn primary-btn"\n      set="@hidden: !doneBtnVisible; onclick: onDone;  @disabled: !doneBtnEnabled"\n      l10n="done"\n    ></button>\n  </div>\n\n  <lr-drop-area ghost></lr-drop-area>\n';class Li extends Zt{activityType=we.activities.URL;init$={...this.ctxInit,importDisabled:!0,onUpload:()=>{let e=this.ref.input.value;this.uploadCollection.add({externalUrl:e}),this.$["*currentActivity"]=we.activities.UPLOAD_LIST},onCancel:()=>{this.historyBack()},onInput:e=>{let t=e.target.value;this.set$({importDisabled:!t})}};initCallback(){super.initCallback(),this.registerActivity(this.activityType)}}Li.template='\n  <lr-activity-header>\n    <button type="button" class="mini-btn" set="onclick: *historyBack">\n      <lr-icon name="back"></lr-icon>\n    </button>\n    <div>\n      <lr-icon name="url"></lr-icon>\n      <span l10n="caption-from-url"></span>\n    </div>\n    <button type="button" class="mini-btn close-btn" set="onclick: *closeModal">\n      <lr-icon name="close"></lr-icon>\n    </button>\n  </lr-activity-header>\n  <div class="content">\n    <input placeholder="https://" class="url-input" type="text" ref="input" set="oninput: onInput" />\n    <button\n      type="button"\n      class="url-upload-btn primary-btn"\n      set="onclick: onUpload; @disabled: importDisabled"\n    ></button>\n  </div>\n';const Mi=()=>void 0!==navigator.permissions;class Ni extends Zt{activityType=we.activities.CAMERA;_unsubPermissions=null;init$={...this.ctxInit,video:null,videoTransformCss:null,shotBtnDisabled:!0,videoHidden:!0,messageHidden:!0,requestBtnHidden:Mi(),l10nMessage:null,originalErrorMessage:null,cameraSelectOptions:null,cameraSelectHidden:!0,onCameraSelectChange:e=>{this._selectedCameraId=e.target.value,this._capture()},onCancel:()=>{this.historyBack()},onShot:()=>{this._shot()},onRequestPermissions:()=>{this._capture()}};cssInit$={"--cfg-camera-mirror":1};_onActivate=()=>{Mi()&&this._subscribePermissions(),this._capture()};_onDeactivate=()=>{this._unsubPermissions&&this._unsubPermissions(),this._stopCapture()};_handlePermissionsChange=()=>{this._capture()};_setPermissionsState=pe((e=>{this.$.originalErrorMessage=null,this.classList.toggle("initialized","granted"===e),"granted"===e?this.set$({videoHidden:!1,shotBtnDisabled:!1,messageHidden:!0}):"prompt"===e?(this.$.l10nMessage=this.l10n("camera-permissions-prompt"),this.set$({videoHidden:!0,shotBtnDisabled:!0,messageHidden:!1}),this._stopCapture()):(this.$.l10nMessage=this.l10n("camera-permissions-denied"),this.set$({videoHidden:!0,shotBtnDisabled:!0,messageHidden:!1}),this._stopCapture())}),300);async _subscribePermissions(){try{(await navigator.permissions.query({name:"camera"})).addEventListener("change",this._handlePermissionsChange)}catch(e){console.log("Failed to use permissions API. Fallback to manual request mode.",e),this._capture()}}async _capture(){let e={video:{width:{ideal:1920},height:{ideal:1080},frameRate:{ideal:30}},audio:!1};this._selectedCameraId&&(e.video.deviceId={exact:this._selectedCameraId}),this._canvas=document.createElement("canvas"),this._ctx=this._canvas.getContext("2d");try{this._setPermissionsState("prompt");let t=await navigator.mediaDevices.getUserMedia(e);t.addEventListener("inactive",(()=>{this._setPermissionsState("denied")})),this.$.video=t,this._capturing=!0,this._setPermissionsState("granted")}catch(e){this._setPermissionsState("denied"),this.$.originalErrorMessage=e.message}}_stopCapture(){this._capturing&&(this.$.video?.getTracks()[0].stop(),this.$.video=null,this._capturing=!1)}_shot(){this._canvas.height=this.ref.video.videoHeight,this._canvas.width=this.ref.video.videoWidth,this._ctx.drawImage(this.ref.video,0,0);let e=Date.now(),t=`camera-${e}.png`;this._canvas.toBlob((i=>{let s=new File([i],t,{lastModified:e,type:"image/png"});this.uploadCollection.add({file:s,fileName:t,fileSize:s.size,isImage:!0,mimeType:s.type}),this.set$({"*currentActivity":we.activities.UPLOAD_LIST})}))}async initCallback(){super.initCallback(),this.registerActivity(this.activityType,{onActivate:this._onActivate,onDeactivate:this._onDeactivate}),this.sub("--cfg-camera-mirror",(e=>{this.$.videoTransformCss=e?"scaleX(-1)":null}));try{let e=(await navigator.mediaDevices.enumerateDevices()).filter((e=>"videoinput"===e.kind)).map(((e,t)=>({text:e.label.trim()||`${this.l10n("caption-camera")} ${t+1}`,value:e.deviceId})));e.length>1&&(this.$.cameraSelectOptions=e,this.$.cameraSelectHidden=!1)}catch(e){}}}Ni.template='\n  <lr-activity-header>\n    <button type="button" class="mini-btn" set="onclick: *historyBack">\n      <lr-icon name="back"></lr-icon>\n    </button>\n    <div set="@hidden: !cameraSelectHidden">\n      <lr-icon name="camera"></lr-icon>\n      <span l10n="caption-camera"></span>\n    </div>\n    <lr-select\n      class="camera-select"\n      set="$.options: cameraSelectOptions; @hidden: cameraSelectHidden; onchange: onCameraSelectChange"\n    >\n    </lr-select>\n    <button type="button" class="mini-btn close-btn" set="onclick: *closeModal">\n      <lr-icon name="close"></lr-icon>\n    </button>\n  </lr-activity-header>\n  <div class="content">\n    <video\n      autoplay\n      playsinline\n      set="srcObject: video; style.transform: videoTransformCss; @hidden: videoHidden"\n      ref="video"\n    ></video>\n    <div class="message-box" set="@hidden: messageHidden">\n      <span>{{l10nMessage}}</span>\n      <span>{{originalErrorMessage}}</span>\n      <button\n        type="button"\n        set="onclick: onRequestPermissions; @hidden: requestBtnHidden"\n        l10n="camera-permissions-request"\n      ></button>\n    </div>\n    <button type="button" class="shot-btn" set="onclick: onShot; @disabled: shotBtnDisabled">\n      <lr-icon name="camera"></lr-icon>\n    </button>\n  </div>\n';class Oi extends Zt{activityType=we.activities.DETAILS;pauseRender=!0;init$={...this.ctxInit,checkerboard:!1,fileSize:null,fileName:"",cdnUrl:"",errorTxt:"",cloudEditBtnHidden:!0,onNameInput:null,onBack:()=>{this.historyBack()},onRemove:()=>{this.uploadCollection.remove(this.entry.uid),this.historyBack()},onCloudEdit:()=>{this.entry.getValue("uuid")&&(this.$["*currentActivity"]=we.activities.CLOUD_IMG_EDIT)}};cssInit$={"--cfg-use-cloud-image-editor":0,"--cfg-use-local-image-editor":0};showNonImageThumb(){let e=Si(window.getComputedStyle(this).getPropertyValue("--clr-generic-file-icon"),108,108);this.ref.filePreview.setImageUrl(e),this.set$({checkerboard:!1})}initCallback(){super.initCallback(),this.render(),this.$.fileSize=this.l10n("file-size-unknown"),this.registerActivity(this.activityType,{onDeactivate:()=>{this.ref.filePreview.clear()}}),this.sub("*focusedEntry",(e=>{if(!e)return;this._entrySubs?this._entrySubs.forEach((e=>{this._entrySubs.delete(e),e.remove()})):this._entrySubs=new Set,this.entry=e;let t=e.getValue("file");if(t){this._file=t;let i=$e(this._file);i&&!e.getValue("cdnUrl")&&(this.ref.filePreview.setImageFile(this._file),this.set$({checkerboard:!0})),i||this.showNonImageThumb()}let i=(e,t)=>{this._entrySubs.add(this.entry.subscribe(e,t))};i("fileName",(e=>{this.$.fileName=e,this.$.onNameInput=()=>{let e=this.ref.file_name_input.value;Object.defineProperty(this._file,"name",{writable:!0,value:e}),this.entry.setValue("fileName",e)}})),i("fileSize",(e=>{this.$.fileSize=Number.isFinite(e)?this.fileSizeFmt(e):this.l10n("file-size-unknown")})),i("uploadError",(e=>{this.$.errorTxt=e?.message})),i("externalUrl",(e=>{e&&(this.entry.getValue("uuid")||this.showNonImageThumb())})),i("cdnUrl",(e=>{const t=this.$["--cfg-use-cloud-image-editor"]&&e&&this.entry.getValue("isImage");if(e&&this.ref.filePreview.clear(),this.set$({cdnUrl:e,cloudEditBtnHidden:!t}),e&&this.entry.getValue("isImage")){let t=li(e,si("format/auto","preview"));this.ref.filePreview.setImageUrl(this.proxyUrl(t))}}))}))}}Oi.template='\n  <lr-activity-header>\n    <button type="button" class="mini-btn" set="onclick: *historyBack">\n      <lr-icon name="back"></lr-icon>\n    </button>\n    <span l10n="caption-edit-file"></span>\n    <button type="button" class="mini-btn close-btn" set="onclick: *closeModal">\n      <lr-icon name="close"></lr-icon>\n    </button>\n  </lr-activity-header>\n  <div class="content">\n    <lr-tabs tab-list="tab-view, tab-details">\n      <div tab-ctx="tab-details" class="details">\n        <div class="info-block">\n          <div class="info-block_name" l10n="file-name"></div>\n          <input\n            name="name-input"\n            ref="file_name_input"\n            set="value: fileName; oninput: onNameInput; @disabled: !!cdnUrl"\n            type="text"\n          />\n        </div>\n\n        <div class="info-block">\n          <div class="info-block_name" l10n="file-size"></div>\n          <div>{{fileSize}}</div>\n        </div>\n\n        <div class="info-block">\n          <div class="info-block_name" l10n="cdn-url"></div>\n          <a class="cdn-link" target="_blank" set="@href: cdnUrl; @disabled: !cdnUrl">{{cdnUrl}}</a>\n        </div>\n\n        <div>{{errorTxt}}</div>\n      </div>\n\n      <lr-file-preview tab-ctx="tab-view" set="@checkerboard: checkerboard;" ref="filePreview"> </lr-file-preview>\n    </lr-tabs>\n\n    <div class="toolbar" set="@edit-disabled: cloudEditBtnHidden">\n      <button type="button" class="edit-btn secondary-btn" set="onclick: onCloudEdit; @hidden: cloudEditBtnHidden;">\n        <lr-icon name="edit"></lr-icon>\n        <span l10n="edit-image"></span>\n      </button>\n      <button type="button" class="remove-btn secondary-btn" set="onclick: onRemove">\n        <lr-icon name="remove"></lr-icon>\n        <span l10n="remove-from-list"></span>\n      </button>\n      <div></div>\n      <button type="button" class="back-btn primary-btn" set="onclick: onBack">\n        <span l10n="ok"></span>\n      </button>\n    </div>\n  </div>\n';class Di{captionL10nStr="confirm-your-action";messageL10Str="are-you-sure";confirmL10nStr="yes";denyL10nStr="no";confirmAction(){console.log("Confirmed")}denyAction(){this.historyBack()}}class Pi extends we{activityType=we.activities.CONFIRMATION;_defaults=new Di;init$={...this.ctxInit,activityCaption:"",messageTxt:"",confirmBtnTxt:"",denyBtnTxt:"","*confirmation":null,onConfirm:this._defaults.confirmAction,onDeny:this._defaults.denyAction.bind(this)};initCallback(){super.initCallback(),this.set$({messageTxt:this.l10n(this._defaults.messageL10Str),confirmBtnTxt:this.l10n(this._defaults.confirmL10nStr),denyBtnTxt:this.l10n(this._defaults.denyL10nStr)}),this.sub("*confirmation",(e=>{e&&this.set$({"*currentActivity":we.activities.CONFIRMATION,activityCaption:this.l10n(e.captionL10nStr),messageTxt:this.l10n(e.messageL10Str),confirmBtnTxt:this.l10n(e.confirmL10nStr),denyBtnTxt:this.l10n(e.denyL10nStr),onDeny:()=>{e.denyAction()},onConfirm:()=>{e.confirmAction()}})}))}}Pi.template='\n  <lr-activity-header>\n    <button type="button" class="mini-btn" set="onclick: *historyBack">\n      <lr-icon name="back"></lr-icon>\n    </button>\n    <span>{{activityCaption}}</span>\n    <button type="button" class="mini-btn close-btn" set="onclick: *closeModal">\n      <lr-icon name="close"></lr-icon>\n    </button>\n  </lr-activity-header>\n\n  <div class="message">{{messageTxt}}</div>\n  <div class="toolbar">\n    <button type="button" class="deny-btn secondary-btn" set="onclick: onDeny">{{denyBtnTxt}}</button>\n    <button type="button" class="confirm-btn primary-btn" set="onclick: onConfirm">{{confirmBtnTxt}}</button>\n  </div>\n';class Bi extends Zt{init$={...this.ctxInit,visible:!1,unknown:!1,value:0,"*commonProgress":0};initCallback(){super.initCallback(),this.uploadCollection.observe((()=>{let e=this.uploadCollection.items().some((e=>this.uploadCollection.read(e).getValue("isUploading")));this.$.visible=e})),this.sub("visible",(e=>{e?this.setAttribute("active",""):this.removeAttribute("active")})),this.sub("*commonProgress",(e=>{this.$.value=e}))}}Bi.template='\n  <lr-progress-bar set="visible: visible; unknown: unknown; value: value"></lr-progress-bar>\n';class Fi extends fe{_value=0;_unknownMode=!1;init$={...this.ctxInit,width:0,opacity:0};initCallback(){super.initCallback(),this.defineAccessor("value",(e=>{void 0!==e&&(this._value=e,this._unknownMode||this.style.setProperty("--l-width",this._value.toString()))})),this.defineAccessor("visible",(e=>{this.ref.line.classList.toggle("progress--hidden",!e)})),this.defineAccessor("unknown",(e=>{this._unknownMode=e,this.ref.line.classList.toggle("progress--unknown",e)}))}}Fi.template=' <div ref="line" class="progress"></div> ';const Vi="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mNkYAAAAAYAAjCB0C8AAAAASUVORK5CYII=";class zi extends fe{init$={...this.ctxInit,checkerboard:!1,src:Vi};constructor(){super()}initCallback(){super.initCallback(),this.sub("checkerboard",(()=>{this.style.backgroundImage=this.hasAttribute("checkerboard")?`url(${function(e="#fff",t="rgba(0, 0, 0, .1)"){return Ai(`<svg height="20" width="20" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">\n    <rect x="0" y="0" width="20" height="20" fill="${e}" />\n    <rect x="0" y="0" width="10" height="10" fill="${t}" />\n    <rect x="10" y="10" width="10" height="10" fill="${t}" />\n  </svg>`)}()})`:"unset"}))}destroyCallback(){super.destroyCallback(),URL.revokeObjectURL(this._lastObjectUrl)}setImage(e){this.$.src=e.src}setImageFile(e){let t=URL.createObjectURL(e);this.$.src=t,this._lastObjectUrl=t}setImageUrl(e){this.$.src=e}clear(){URL.revokeObjectURL(this._lastObjectUrl),this.$.src=Vi}}function ji(...e){return e.reduce(((e,t)=>{if("string"==typeof t)return e[t]=!0,e;for(let i of Object.keys(t))e[i]=t[i];return e}),{})}function qi(...e){let t=ji(...e);return Object.keys(t).reduce(((e,i)=>(t[i]&&e.push(i),e)),[]).join(" ")}function Hi(e,t){let i,s=(...s)=>{clearTimeout(i),i=setTimeout((()=>e(...s)),t)};return s.cancel=()=>{clearTimeout(i)},s}zi.template=' <lr-img class="img-view" ref="img" set="@src: src; style.aa: src;" /> ',zi.bindAttributes({checkerboard:"checkerboard"});const Ki={brightness:0,exposure:0,gamma:100,contrast:0,saturation:0,vibrance:0,warmth:0,enhance:0,filter:0,rotate:0};const Wi=["enhance","brightness","exposure","gamma","contrast","saturation","vibrance","warmth","filter","mirror","flip","rotate","crop"];function Xi(e){return ii(...Wi.filter((t=>void 0!==e[t]&&null!==e[t])).map((t=>function(e,t){if("number"==typeof t)return Ki[e]!==t?`${e}/${t}`:"";if("boolean"==typeof t)return t&&Ki[e]!==t?`${e}`:"";if("filter"===e){if(!t||Ki[e]===t.amount)return"";let{name:i,amount:s}=t;return`${e}/${i}/${s}`}if("crop"===e){if(!t)return"";let{dimensions:i,coords:s}=t;return`${e}/${i.join("x")}/${s.join(",")}`}return""}(t,e[t]))).filter((e=>!!e)))}const Gi=ii("format/auto","progressive/yes"),Yi=([e])=>void 0!==e?Number(e):void 0,Ji=()=>!0,Qi={enhance:Yi,brightness:Yi,exposure:Yi,gamma:Yi,contrast:Yi,saturation:Yi,vibrance:Yi,warmth:Yi,filter:([e,t])=>({name:e,amount:void 0!==t?Number(t):100}),mirror:Ji,flip:Ji,rotate:Yi,crop:([e,t])=>({dimensions:e.split("x").map(Number),coords:t.split(",").map(Number)})};function Zi(e){return{"*originalUrl":null,"*faderEl":null,"*cropperEl":null,"*imgEl":null,"*imgContainerEl":null,"*networkProblems":!1,"*imageSize":null,"*editorTransformations":{},entry:null,extension:null,editorMode:!1,modalCaption:"",isImage:!1,msg:"",src:Vi,fileType:"",showLoader:!1,uuid:null,cdnUrl:null,"presence.networkProblems":!1,"presence.modalCaption":!0,"presence.editorToolbar":!1,"presence.viewerToolbar":!0,"*on.retryNetwork":()=>{let t=e.querySelectorAll("img");for(let e of t){let t=e.src;e.src=Vi,e.src=t}e.$["*networkProblems"]=!1},"*on.apply":t=>{if(!t)return;let i=e.$["*originalUrl"],s=si(Xi(t)),r={originalUrl:i,cdnUrlModifiers:s,cdnUrl:li(i,si(s,"preview")),transformations:t};e.dispatchEvent(new CustomEvent("apply",{detail:r,bubbles:!0,composed:!0})),e.remove()},"*on.cancel":()=>{e.remove(),e.dispatchEvent(new CustomEvent("cancel",{bubbles:!0,composed:!0}))}}}const es=`\n  <div class="wrapper wrapper_desktop">\n    <lr-presence-toggle class="network_problems_splash" set="visible: presence.networkProblems;">\n      <div class="network_problems_content">\n        <div class="network_problems_icon">\n          <lr-icon size="20" name="sad"></lr-icon>\n        </div>\n        <div class="network_problems_text">Network error</div>\n      </div>\n      <div class="network_problems_footer">\n        <lr-btn-ui theme="primary" text="Retry" set="onclick: *on.retryNetwork"></lr-btn-ui>\n      </div>\n    </lr-presence-toggle>\n    <div class="viewport">\n      <div class="file_type_outer">\n        <div class="file_type">{{fileType}}</div>\n      </div>\n      <div class="image_container" ref="img-container-el">\n        <img src="${Vi}" class="image image_visible_from_editor" ref="img-el" />\n        <lr-editor-image-cropper ref="cropper-el"></lr-editor-image-cropper>\n        <lr-editor-image-fader ref="fader-el"></lr-editor-image-fader>\n      </div>\n      <div class="info_pan">{{msg}}</div>\n    </div>\n    <div class="toolbar">\n      <lr-line-loader-ui set="active: showLoader"></lr-line-loader-ui>\n      <div class="toolbar_content toolbar_content__editor">\n        <lr-editor-toolbar></lr-editor-toolbar>\n      </div>\n    </div>\n  </div>\n`,ts="crop",is="sliders",ss="filters",rs=[ts,is,ss],ns=["brightness","exposure","gamma","contrast","saturation","vibrance","warmth","enhance"],as=["adaris","briaril","calarel","carris","cynarel","cyren","elmet","elonni","enzana","erydark","fenralan","ferand","galen","gavin","gethriel","iorill","iothari","iselva","jadis","lavra","misiara","namala","nerion","nethari","pamaya","sarnar","sedis","sewen","sorahel","sorlen","tarian","thellassan","varriel","varven","vevera","virkas","yedis","yllara","zatvel","zevcen"],os=["rotate","mirror","flip"],ls={brightness:{zero:Ki.brightness,range:[-100,100],keypointsNumber:2},exposure:{zero:Ki.exposure,range:[-500,500],keypointsNumber:2},gamma:{zero:Ki.gamma,range:[0,1e3],keypointsNumber:2},contrast:{zero:Ki.contrast,range:[-100,500],keypointsNumber:2},saturation:{zero:Ki.saturation,range:[-100,500],keypointsNumber:1},vibrance:{zero:Ki.vibrance,range:[-100,500],keypointsNumber:1},warmth:{zero:Ki.warmth,range:[-100,100],keypointsNumber:1},enhance:{zero:Ki.enhance,range:[0,100],keypointsNumber:1},filter:{zero:Ki.filter,range:[0,100],keypointsNumber:1}};class cs extends fe{pauseRender=!0;get ctxName(){return this.autoCtxName}init$={...this.ctxInit,...Zi(this)};_debouncedShowLoader=Hi(this._showLoader.bind(this),300);_showLoader(e){this.$.showLoader=e}_waitForSize(){return new Promise(((e,t)=>{const i=setTimeout((()=>{t(new Error("[cloud-image-editor] timout waiting for non-zero container size"))}),3e3),s=new ResizeObserver((([t])=>{t.contentRect.width>0&&t.contentRect.height>0&&(e(),clearTimeout(i),s.disconnect())}));s.observe(this)}))}cssInit$={"--cfg-cdn-cname":"https://ucarecdn.com"};async connectedCallback(){super.connectedCallback();try{await this._waitForSize()}catch(e){return void(this.isConnected&&console.error(e.message))}this.render(),this.$["*faderEl"]=this.ref["fader-el"],this.$["*cropperEl"]=this.ref["cropper-el"],this.$["*imgContainerEl"]=this.ref["img-container-el"],this.ref["img-el"].addEventListener("load",(e=>{this._imgLoading=!1,this._debouncedShowLoader(!1),this.$.src!==Vi&&(this.$["*networkProblems"]=!1)})),this.ref["img-el"].addEventListener("error",(e=>{this._imgLoading=!1,this._debouncedShowLoader(!1),this.$["*networkProblems"]=!0})),this.sub("src",(e=>{let t=this.ref["img-el"];t.src!==e&&(this._imgLoading=!0,t.src=e||Vi)})),this.sub("*tabId",(e=>{this.ref["img-el"].className=qi("image",{image_hidden_to_cropper:e===ts,image_hidden_effects:e!==ts})}))}initCallback(){if(super.initCallback(),this.$.cdnUrl){let e=function(e){let t=new URL(e),{pathname:i}=t;const s=i.indexOf("/"),r=i.indexOf("/",s+1);return i.substring(s+1,r)}(this.$.cdnUrl);this.$["*originalUrl"]=ci(this.$.cdnUrl,e);let t=function(e){let t={};for(let i of e){let[e,...s]=i.split("/");if(!Wi.includes(e))continue;const r=(0,Qi[e])(s);t[e]=r}return t}(function(e){let t=ni(e),i=new URL(t),s=i.pathname.indexOf("/-/");return-1===s?[]:i.pathname.substring(s).split("/-/").filter(Boolean).map((e=>ti(e)))}(this.$.cdnUrl));this.$["*editorTransformations"]=t}else{if(!this.$.uuid)throw new Error("No UUID nor CDN URL provided");this.$["*originalUrl"]=ci(this.localCtx.read("--cfg-cdn-cname"),this.$.uuid)}this.classList.add("editor_ON"),this.sub("*networkProblems",(e=>{this.$["presence.networkProblems"]=e,this.$["presence.modalCaption"]=!e})),this.sub("*editorTransformations",(e=>{let t=this.$["*originalUrl"],i=si(Xi(e)),s={originalUrl:t,cdnUrlModifiers:i,cdnUrl:li(t,si(i,"preview")),transformations:e};this.dispatchEvent(new CustomEvent("change",{detail:s,bubbles:!0,composed:!0}))}),!1);try{fetch(li(this.$["*originalUrl"],si("json"))).then((e=>e.json())).then((({width:e,height:t})=>{this.$["*imageSize"]={width:e,height:t}}))}catch(e){e&&console.error("Failed to load image info",e)}}}cs.template=es,cs.bindAttributes({uuid:"uuid","cdn-url":"cdnUrl"});const hs=24,ds=34,us=1.5,ps=100/3,ms=2*hs+ds;function gs(e,t){for(let i in t)e.setAttributeNS(null,i,t[i].toString())}function bs(e,t={}){let i=document.createElementNS("http://www.w3.org/2000/svg",e);return gs(i,t),i}function fs(e,t){let{x:i,y:s,width:r,height:n}=e,a=t.includes("w")?0:1,o=t.includes("n")?0:1,l=[-1,1][a],c=[-1,1][o],h=[i+a*r+us*l,s+o*n+us*c-hs*c],d=[i+a*r+us*l,s+o*n+us*c],u=[i+a*r-hs*l+us*l,s+o*n+us*c];return{d:`M ${h[0]} ${h[1]} L ${d[0]} ${d[1]} L ${u[0]} ${u[1]}`,center:d}}function _s(e,t){let i,s,{x:r,y:n,width:a,height:o}=e,l=["n","s"].includes(t)?.5:{w:0,e:1}[t],c=["w","e"].includes(t)?.5:{n:0,s:1}[t],h=[-1,1][l],d=[-1,1][c];return["n","s"].includes(t)?(i=[r+l*a-ds/2,n+c*o+us*d],s=[r+l*a+ds/2,n+c*o+us*d]):(i=[r+l*a+us*h,n+c*o-ds/2],s=[r+l*a+us*h,n+c*o+ds/2]),{d:`M ${i[0]} ${i[1]} L ${s[0]} ${s[1]}`,center:[s[0]-(s[0]-i[0])/2,s[1]-(s[1]-i[1])/2]}}function ys(e,t){let{x:i}=e,{y:s}=e;return e.x<t.x?i=t.x:e.x+e.width>t.x+t.width&&(i=t.x+t.width-e.width),e.y<t.y?s=t.y:e.y+e.height>t.y+t.height&&(s=t.y+t.height-e.height),{...e,x:i,y:s}}function vs(e,[t,i],s){let{x:r,y:n,width:a,height:o}=e;if(s.includes("n")){let e=o;o=Math.max(i,o),n=n+e-o}if(s.includes("s")&&(o=Math.max(i,o)),s.includes("w")){let e=a;a=Math.max(t,a),r=r+e-a}return s.includes("e")&&(a=Math.max(t,a)),{x:r,y:n,width:a,height:o}}class ws extends fe{init$={...this.ctxInit,dragging:!1};constructor(){super(),this._handlePointerUp=this._handlePointerUp_.bind(this),this._handlePointerMove=this._handlePointerMove_.bind(this),this._handleSvgPointerMove=this._handleSvgPointerMove_.bind(this)}_shouldThumbBeDisabled(e){let t=this.$["*imageBox"];if(!t)return;if(""===e&&t.height<=ms&&t.width<=ms)return!0;let i=t.height<=ms&&(e.includes("n")||e.includes("s")),s=t.width<=ms&&(e.includes("e")||e.includes("w"));return i||s}_createBackdrop(){let e=this.$["*cropBox"];if(!e)return;let{x:t,y:i,width:s,height:r}=e,n=this.ref["svg-el"],a=bs("mask",{id:"backdrop-mask"}),o=bs("rect",{x:0,y:0,width:"100%",height:"100%",fill:"white"}),l=bs("rect",{x:t,y:i,width:s,height:r,fill:"black"});a.appendChild(o),a.appendChild(l);let c=bs("rect",{x:0,y:0,width:"100%",height:"100%",fill:"var(--color-image-background)","fill-opacity":.85,mask:"url(#backdrop-mask)"});n.appendChild(c),n.appendChild(a),this._backdropMask=a,this._backdropMaskInner=l}_resizeBackdrop(){this._backdropMask&&(this._backdropMask.style.display="none",window.requestAnimationFrame((()=>{this._backdropMask.style.display="block"})))}_updateBackdrop(){let e=this.$["*cropBox"];if(!e)return;let{x:t,y:i,width:s,height:r}=e;gs(this._backdropMaskInner,{x:t,y:i,width:s,height:r})}_updateFrame(){let e=this.$["*cropBox"];if(e){for(let t of Object.values(this._frameThumbs)){let{direction:i,pathNode:s,interactionNode:r,groupNode:n}=t,a=""===i,o=2===i.length;if(a){let{x:t,y:i,width:s,height:n}=e,a=[t+s/2,i+n/2];gs(r,{r:Math.min(s,n)/3,cx:a[0],cy:a[1]})}else{let{d:t,center:n}=o?fs(e,i):_s(e,i);gs(r,{cx:n[0],cy:n[1]}),gs(s,{d:t})}let l=this._shouldThumbBeDisabled(i);n.setAttribute("class",qi("thumb",{"thumb--hidden":l,"thumb--visible":!l}))}gs(this._frameGuides,{x:e.x-.5,y:e.y-.5,width:e.width+1,height:e.height+1})}}_createThumbs(){let e={};for(let t=0;t<3;t++)for(let i=0;i<3;i++){let s=`${["n","","s"][t]}${["w","","e"][i]}`,r=bs("g");r.classList.add("thumb"),r.setAttribute("with-effects","");let n=bs("circle",{r:hs+us,fill:"transparent"}),a=bs("path",{stroke:"currentColor",fill:"none","stroke-width":3});r.appendChild(a),r.appendChild(n),e[s]={direction:s,pathNode:a,interactionNode:n,groupNode:r},n.addEventListener("pointerdown",this._handlePointerDown.bind(this,s))}return e}_createGuides(){let e=bs("svg"),t=bs("rect",{x:0,y:0,width:"100%",height:"100%",fill:"none",stroke:"#000000","stroke-width":1,"stroke-opacity":.5});e.appendChild(t);for(let t=1;t<=2;t++){let i=bs("line",{x1:ps*t+"%",y1:"0%",x2:ps*t+"%",y2:"100%",stroke:"#000000","stroke-width":1,"stroke-opacity":.3});e.appendChild(i)}for(let t=1;t<=2;t++){let i=bs("line",{x1:"0%",y1:ps*t+"%",x2:"100%",y2:ps*t+"%",stroke:"#000000","stroke-width":1,"stroke-opacity":.3});e.appendChild(i)}return e.classList.add("guides","guides--semi-hidden"),e}_createFrame(){let e=this.ref["svg-el"],t=document.createDocumentFragment(),i=this._createGuides();t.appendChild(i);let s=this._createThumbs();for(let{groupNode:e}of Object.values(s))t.appendChild(e);e.appendChild(t),this._frameThumbs=s,this._frameGuides=i}_handlePointerDown(e,t){let i=this._frameThumbs[e];if(this._shouldThumbBeDisabled(e))return;let s=this.$["*cropBox"],{x:r,y:n}=this.ref["svg-el"].getBoundingClientRect(),a=t.x-r,o=t.y-n;this.$.dragging=!0,this._draggingThumb=i,this._dragStartPoint=[a,o],this._dragStartCrop={...s}}_handlePointerUp_(e){this._updateCursor(),this.$.dragging&&(e.stopPropagation(),e.preventDefault(),this.$.dragging=!1)}_handlePointerMove_(e){if(!this.$.dragging)return;e.stopPropagation(),e.preventDefault();let t=this.ref["svg-el"],{x:i,y:s}=t.getBoundingClientRect(),r=e.x-i,n=e.y-s,a=r-this._dragStartPoint[0],o=n-this._dragStartPoint[1],{direction:l}=this._draggingThumb,c=this.$["*imageBox"],h=this._dragStartCrop;""===l?(h=function(e,[t,i]){return{...e,x:e.x+t,y:e.y+i}}(h,[a,o]),h=ys(h,c)):(h=function(e,[t,i],s){let{x:r,y:n,width:a,height:o}=e;return s.includes("n")&&(n+=i,o-=i),s.includes("s")&&(o+=i),s.includes("w")&&(r+=t,a-=t),s.includes("e")&&(a+=t),{x:r,y:n,width:a,height:o}}(h,[a,o],l),h=function(e,t){let i=Math.max(e.x,t.x),s=Math.min(e.x+e.width,t.x+t.width),r=Math.max(e.y,t.y);return{x:i,y:r,width:s-i,height:Math.min(e.y+e.height,t.y+t.height)-r}}(h,c)),h=vs(h,[Math.min(c.width,ms),Math.min(c.height,ms)],l),Object.values(h).every((e=>Number.isFinite(e)&&e>=0))?this.$["*cropBox"]=h:console.error("CropFrame is trying to create invalid rectangle",{payload:h})}_handleSvgPointerMove_(e){let t=Object.values(this._frameThumbs).find((t=>{if(this._shouldThumbBeDisabled(t.direction))return!1;let i=t.groupNode.getBoundingClientRect(),s=function(e,[t,i]){return e.x<=t&&t<=e.x+e.width&&e.y<=i&&i<=e.y+e.height}({x:i.x,y:i.y,width:i.width,height:i.height},[e.x,e.y]);return s}));this._hoverThumb=t,this._updateCursor()}_updateCursor(){let e=this._hoverThumb;var t;this.ref["svg-el"].style.cursor=e?""===(t=e.direction)?"move":["e","w"].includes(t)?"ew-resize":["n","s"].includes(t)?"ns-resize":["nw","se"].includes(t)?"nwse-resize":"nesw-resize":"initial"}_render(){this._updateBackdrop(),this._updateFrame()}toggleThumbs(e){Object.values(this._frameThumbs).map((({groupNode:e})=>e)).forEach((t=>{t.setAttribute("class",qi("thumb",{"thumb--hidden":!e,"thumb--visible":e}))}))}initCallback(){super.initCallback(),this._createBackdrop(),this._createFrame(),this.sub("*imageBox",(()=>{this._resizeBackdrop(),window.requestAnimationFrame((()=>{this._render()}))})),this.sub("*cropBox",(e=>{e&&(this._guidesHidden=e.height<=ms||e.width<=ms,window.requestAnimationFrame((()=>{this._render()})))})),this.sub("dragging",(e=>{this._frameGuides.setAttribute("class",qi({"guides--hidden":this._guidesHidden,"guides--visible":!this._guidesHidden&&e,"guides--semi-hidden":!this._guidesHidden&&!e}))})),this.ref["svg-el"].addEventListener("pointermove",this._handleSvgPointerMove,!0),document.addEventListener("pointermove",this._handlePointerMove,!0),document.addEventListener("pointerup",this._handlePointerUp,!0)}destroyCallback(){super.destroyCallback(),document.removeEventListener("pointermove",this._handlePointerMove),document.removeEventListener("pointerup",this._handlePointerUp)}}ws.template=' <svg class="svg" ref="svg-el" xmlns="http://www.w3.org/2000/svg"></svg> ';class Cs extends fe{init$={...this.ctxInit,active:!1,title:"",icon:"","on.click":null};initCallback(){super.initCallback(),this._titleEl=this.ref["title-el"],this._iconEl=this.ref["icon-el"],this.setAttribute("role","button"),-1===this.tabIndex&&(this.tabIndex=0),this.sub("title",(e=>{this._titleEl&&(this._titleEl.style.display=e?"block":"none")})),this.sub("active",(e=>{this.className=qi({active:e,not_active:!e})})),this.sub("on.click",(e=>{this.onclick=e}))}}Cs.template='\n  <div class="before"></div>\n  <lr-icon size="20" set="@name: icon;"></lr-icon>\n  <div class="title" ref="title-el">{{title}}</div>\n';class Ts extends Cs{initCallback(){super.initCallback(),this.defineAccessor("operation",(e=>{e&&(this._operation=e,this.$.icon=e)})),this.$["on.click"]=e=>{let t=this.$["*cropperEl"].getValue(this._operation),i=function(e,t){return"rotate"===e?function(e){let t=e+90;return t=t>=360?0:t,t}(t):["mirror","flip"].includes(e)?!t:null}(this._operation,t);this.$["*cropperEl"].setValue(this._operation,i)}}}const xs="filter",$s="color_operation",ks="original";class Es extends fe{init$={...this.ctxInit,disabled:!1,min:0,max:100,value:0,defaultValue:0,zero:0,"on.input":e=>{this.$["*faderEl"].set(e),this.$.value=e}};setOperation(e,t){this._controlType="filter"===e?xs:$s,this._operation=e,this._iconName=e,this._title=e.toUpperCase(),this._filter=t,this._initializeValues(),this.$["*faderEl"].activate({url:this.$["*originalUrl"],operation:this._operation,value:this._filter===ks?void 0:this.$.value,filter:this._filter===ks?void 0:this._filter,fromViewer:!1})}_initializeValues(){let{range:e,zero:t}=ls[this._operation],[i,s]=e;this.$.min=i,this.$.max=s,this.$.zero=t;let r=this.$["*editorTransformations"][this._operation];if(this._controlType===xs){let e=s;if(r){let{name:t,amount:i}=r;e=t===this._filter?i:s}this.$.value=e,this.$.defaultValue=e}if(this._controlType===$s){let e=void 0!==r?r:t;this.$.value=e,this.$.defaultValue=e}}apply(){let e;e=this._controlType===xs?this._filter===ks?null:{name:this._filter,amount:this.$.value}:this.$.value;let t={...this.$["*editorTransformations"],[this._operation]:e};this.$["*editorTransformations"]=t}cancel(){this.$["*faderEl"].deactivate({hide:!1})}initCallback(){super.initCallback(),this.sub("*originalUrl",(e=>{this._originalUrl=e})),this.sub("value",(e=>{let t=`${this._filter||this._operation} ${e}`;this.$["*operationTooltip"]=t}))}}function As(e){let t=new Image;return{promise:new Promise(((i,s)=>{t.src=e,t.onload=i,t.onerror=s})),image:t,cancel:()=>{0===t.naturalWidth&&(t.src=Vi)}}}function Ss(e){let t=[];for(let i of e){let e=As(i);t.push(e)}let i=t.map((e=>e.image));return{promise:Promise.allSettled(t.map((e=>e.promise))),images:i,cancel:()=>{t.forEach((e=>{e.cancel()}))}}}Es.template='\n  <lr-slider-ui\n    ref="slider-el"\n    set="disabled: disabled; min: min; max: max; defaultValue: defaultValue; zero: zero; onInput: on.input;"\n  ></lr-slider-ui>\n';class Is extends Cs{init$={...this.ctxInit,active:!1,title:"",icon:"",isOriginal:!1,iconSize:"20","on.click":null};_previewSrc(){let e=parseInt(window.getComputedStyle(this).getPropertyValue("--l-base-min-width"),10),t=window.devicePixelRatio,i=Math.ceil(t*e),s=t>=2?"lightest":"normal",r={...this.$["*editorTransformations"]};return r[this._operation]=this._filter!==ks?{name:this._filter,amount:100}:void 0,li(this._originalUrl,si(Gi,Xi(r),`quality/${s}`,`scale_crop/${i}x${i}/center`))}_observerCallback(e,t){if(e[0].isIntersecting){let e=this.proxyUrl(this._previewSrc()),i=this.ref["preview-el"],{promise:s,cancel:r}=As(e);this._cancelPreload=r,s.catch((e=>{this.$["*networkProblems"]=!0,console.error("Failed to load image",{error:e})})).finally((()=>{i.style.backgroundImage=`url(${e})`,i.setAttribute("loaded",""),t.unobserve(this)}))}else this._cancelPreload&&this._cancelPreload()}initCallback(){super.initCallback(),this.$["on.click"]=e=>{this.$.active?this.$.isOriginal||(this.$["*sliderEl"].setOperation(this._operation,this._filter),this.$["*showSlider"]=!0):(this.$["*sliderEl"].setOperation(this._operation,this._filter),this.$["*sliderEl"].apply()),this.$["*currentFilter"]=this._filter},this.defineAccessor("filter",(e=>{this._operation="filter",this._filter=e,this.$.isOriginal=e===ks,this.$.icon=this.$.isOriginal?"original":"slider"})),this._observer=new window.IntersectionObserver(this._observerCallback.bind(this),{threshold:[0,1]});let e=this.$["*originalUrl"];this._originalUrl=e,this.$.isOriginal?this.ref["icon-el"].classList.add("original-icon"):this._observer.observe(this),this.sub("*currentFilter",(e=>{this.$.active=e&&e===this._filter})),this.sub("isOriginal",(e=>{this.$.iconSize=e?40:20})),this.sub("active",(e=>{if(this.$.isOriginal)return;this.ref["icon-el"].style.opacity=e?"1":"0";let t=this.ref["preview-el"];e?t.style.opacity="0":t.style.backgroundImage&&(t.style.opacity="1")})),this.sub("*networkProblems",(e=>{if(!e){let e=this.proxyUrl(this._previewSrc()),t=this.ref["preview-el"];t.style.backgroundImage&&(t.style.backgroundImage="none",t.style.backgroundImage=`url(${e})`)}}))}destroyCallback(){super.destroyCallback(),this._observer?.disconnect(),this._cancelPreload&&this._cancelPreload()}}Is.template='\n  <div class="before"></div>\n  <div class="preview" ref="preview-el"></div>\n  <lr-icon size="40" ref="icon-el" set="@name: icon; @size: iconSize;"></lr-icon>\n';class Us extends Cs{_operation="";initCallback(){super.initCallback(),this.$["on.click"]=e=>{this.$["*sliderEl"].setOperation(this._operation),this.$["*showSlider"]=!0,this.$["*currentOperation"]=this._operation},this.defineAccessor("operation",(e=>{e&&(this._operation=e,this.$.icon=e,this.$.title=this.l10n(e))})),this.sub("*editorTransformations",(e=>{if(!this._operation)return;let{zero:t}=ls[this._operation],i=e[this._operation],s=void 0!==i&&i!==t;this.$.active=s}))}}function Rs(e,t,i){let s=window.devicePixelRatio,r=Math.min(Math.ceil(t*s),3e3),n=s>=2?"lightest":"normal";return li(e,si(Gi,Xi(i),`quality/${n}`,`stretch/off/-/resize/${r}x`))}function Ls(e,t,i){return Math.min(Math.max(e,t),i)}function Ms({width:e,height:t},i){let s=i/90%2!=0;return{width:s?t:e,height:s?e:t}}class Ns extends fe{init$={...this.ctxInit,image:null,"*padding":20,"*operations":{rotate:0,mirror:!1,flip:!1},"*imageBox":{x:0,y:0,width:0,height:0},"*cropBox":{x:0,y:0,width:0,height:0}};constructor(){super(),this._commitDebounced=Hi(this._commit.bind(this),300),this._handleResizeDebounced=Hi(this._handleResize.bind(this),10)}_handleResize(){this.isConnected&&(this.deactivate(),this.activate(this._imageSize,{fromViewer:!1}))}_syncTransformations(){let e=function(e,t){let i={};for(let s of t){let t=e[s];(e.hasOwnProperty(s)||void 0!==t)&&(i[s]=t)}return i}(this.$["*editorTransformations"],Object.keys(this.$["*operations"])),t={...this.$["*operations"],...e};this.$["*operations"]=t}_initCanvas(){let e=this.ref["canvas-el"],t=e.getContext("2d"),i=this.offsetWidth,s=this.offsetHeight,r=window.devicePixelRatio;e.style.width=`${i}px`,e.style.height=`${s}px`,e.width=i*r,e.height=s*r,t.scale(r,r),this._canvas=e,this._ctx=t}_alignImage(){if(!this._isActive||!this.$.image)return;let e=this.$.image,t=this.$["*padding"],i=this.$["*operations"],{rotate:s}=i,r=this.offsetWidth,n=this.offsetHeight,a=Ms({width:e.naturalWidth,height:e.naturalHeight},s);if(a.width>r-2*t||a.height>n-2*t){let e=a.width/a.height;if(e>r/n){let i=r-2*t,s=i/e,a=0+t,o=t+(n-2*t)/2-s/2;this.$["*imageBox"]={x:a,y:o,width:i,height:s}}else{let i=n-2*t,s=i*e,a=t+(r-2*t)/2-s/2,o=0+t;this.$["*imageBox"]={x:a,y:o,width:s,height:i}}}else{let{width:e,height:i}=a,s=t+(r-2*t)/2-e/2,o=t+(n-2*t)/2-i/2;this.$["*imageBox"]={x:s,y:o,width:e,height:i}}}_alignCrop(){let e=this.$["*cropBox"],t=this.$["*imageBox"],i=this.$["*operations"],{rotate:s}=i,r=this.$["*editorTransformations"].crop;if(r){let{dimensions:[t,i],coords:[n,a]}=r,{width:o,x:l,y:c}=this.$["*imageBox"],{width:h}=Ms(this._imageSize,s),d=o/h;e={x:l+n*d,y:c+a*d,width:t*d,height:i*d}}else e={x:t.x,y:t.y,width:t.width,height:t.height};e=vs(e,[Math.min(t.width,ms),Math.min(t.height,ms)],"se"),e=ys(e,t),this.$["*cropBox"]=e}_drawImage(){let e=this.$.image,t=this.$["*imageBox"],i=this.$["*operations"],{mirror:s,flip:r,rotate:n}=i,a=this._ctx,o=Ms({width:t.width,height:t.height},n);a.save(),a.translate(t.x+t.width/2,t.y+t.height/2),a.rotate(n*Math.PI*-1/180),a.scale(s?-1:1,r?-1:1),a.drawImage(e,-o.width/2,-o.height/2,o.width,o.height),a.restore()}_draw(){if(!this._isActive||!this.$.image)return;let e=this._canvas;this._ctx.clearRect(0,0,e.width,e.height),this._drawImage()}_animateIn({fromViewer:e}){this.$.image&&(this.ref["frame-el"].toggleThumbs(!0),this._transitionToImage(),setTimeout((()=>{this.className=qi({active_from_viewer:e,active_from_editor:!e,inactive_to_editor:!1})})))}_calculateDimensions(){let e=this.$["*cropBox"],t=this.$["*imageBox"],i=this.$["*operations"],{rotate:s}=i,{width:r,height:n}=t,{width:a,height:o}=Ms(this._imageSize,s),{width:l,height:c}=e,h=r/a,d=n/o;return[Ls(Math.round(l/h),1,a),Ls(Math.round(c/d),1,o)]}_calculateCrop(){let e=this.$["*cropBox"],t=this.$["*imageBox"],i=this.$["*operations"],{rotate:s}=i,{width:r,height:n,x:a,y:o}=t,{width:l,height:c}=Ms(this._imageSize,s),{x:h,y:d}=e,u=r/l,p=n/c,m=this._calculateDimensions(),g={dimensions:m,coords:[Ls(Math.round((h-a)/u),0,l-m[0]),Ls(Math.round((d-o)/p),0,c-m[1])]};if(function(e){return!e||[({dimensions:e,coords:t})=>[...e,...t].every((e=>Number.isInteger(e)&&Number.isFinite(e))),({dimensions:e,coords:t})=>e.every((e=>e>0))&&t.every((e=>e>=0))].every((t=>t(e)))}(g)){if(m[0]!==l||m[1]!==c)return g}else console.error("Cropper is trying to create invalid crop object",{payload:g})}_commit(){if(!this.isConnected)return;let e=this.$["*operations"],{rotate:t,mirror:i,flip:s}=e,r=this._calculateCrop(),n={...this.$["*editorTransformations"],crop:r,rotate:t,mirror:i,flip:s};this.$["*editorTransformations"]=n}setValue(e,t){console.log(`Apply cropper operation [${e}=${t}]`),this.$["*operations"]={...this.$["*operations"],[e]:t},this._isActive&&(this._alignImage(),this._alignCrop(),this._draw())}getValue(e){return this.$["*operations"][e]}async activate(e,{fromViewer:t}){if(!this._isActive){this._isActive=!0,this._imageSize=e,this.removeEventListener("transitionend",this._reset),this._initCanvas();try{this.$.image=await this._waitForImage(this.$["*originalUrl"],this.$["*editorTransformations"]),this._syncTransformations(),this._alignImage(),this._alignCrop(),this._draw(),this._animateIn({fromViewer:t})}catch(e){console.error("Failed to activate cropper",{error:e})}}}deactivate(){this._isActive&&(this._commit(),this._isActive=!1,this._transitionToCrop(),this.className=qi({active_from_viewer:!1,active_from_editor:!1,inactive_to_editor:!0}),this.ref["frame-el"].toggleThumbs(!1),this.addEventListener("transitionend",this._reset,{once:!0}))}_transitionToCrop(){let e=this._calculateDimensions(),t=Math.min(this.offsetWidth,e[0])/this.$["*cropBox"].width,i=Math.min(this.offsetHeight,e[1])/this.$["*cropBox"].height,s=Math.min(t,i),r=this.$["*cropBox"].x+this.$["*cropBox"].width/2,n=this.$["*cropBox"].y+this.$["*cropBox"].height/2;this.style.transform=`scale(${s}) translate(${(this.offsetWidth/2-r)/s}px, ${(this.offsetHeight/2-n)/s}px)`,this.style.transformOrigin=`${r}px ${n}px`}_transitionToImage(){let e=this.$["*cropBox"].x+this.$["*cropBox"].width/2,t=this.$["*cropBox"].y+this.$["*cropBox"].height/2;this.style.transform="scale(1)",this.style.transformOrigin=`${e}px ${t}px`}_reset(){this._isActive||(this.$.image=null)}_waitForImage(e,t){let i=this.offsetWidth;t={...t,crop:void 0,rotate:void 0,flip:void 0,mirror:void 0};let s=this.proxyUrl(Rs(e,i,t)),{promise:r,cancel:n,image:a}=As(s),o=this._handleImageLoading(s);return a.addEventListener("load",o,{once:!0}),a.addEventListener("error",o,{once:!0}),this._cancelPreload&&this._cancelPreload(),this._cancelPreload=n,r.then((()=>a)).catch((e=>(console.error("Failed to load image",{error:e}),this.$["*networkProblems"]=!0,Promise.resolve(a))))}_handleImageLoading(e){let t="crop",i=this.$["*loadingOperations"];return i.get(t)||i.set(t,new Map),i.get(t).get(e)||(i.set(t,i.get(t).set(e,!0)),this.$["*loadingOperations"]=i),()=>{i?.get(t)?.has(e)&&(i.get(t).delete(e),this.$["*loadingOperations"]=i)}}initCallback(){super.initCallback(),this._observer=new ResizeObserver((([e])=>{e.contentRect.width>0&&e.contentRect.height>0&&this._isActive&&this.$.image&&this._handleResizeDebounced()})),this._observer.observe(this),this.sub("*imageBox",(()=>{this._draw()})),this.sub("*cropBox",(e=>{this.$.image&&this._commitDebounced()})),setTimeout((()=>{this.sub("*networkProblems",(e=>{e||this._isActive&&this.activate(this._imageSize,{fromViewer:!1})}))}),0)}destroyCallback(){super.destroyCallback(),this._observer?.disconnect()}}function Os(e,t,i){let s=Array(i);for(let r=--i;r>=0;r--)s[r]=Math.ceil((r*t+(i-r)*e)/i);return s}function Ds(e,t){let i=ls[e].keypointsNumber,{range:s,zero:r}=ls[e];return[...new Set([...Os(s[0],r,i+1),...Os(r,s[1],i+1),r,t])].sort(((e,t)=>e-t))}Ns.template='\n  <canvas class="canvas" ref="canvas-el"></canvas>\n  <lr-crop-frame ref="frame-el"></lr-crop-frame>\n';class Ps extends fe{initCallback(){super.initCallback(),this.addEventListener("wheel",(e=>{e.preventDefault();let{deltaY:t,deltaX:i}=e;Math.abs(i)>1?this.scrollLeft+=i:this.scrollLeft+=t}))}}Ps.template=" <slot></slot> ";class Bs extends fe{constructor(){super(),this.init$={...this.ctxInit,"*sliderEl":null,"*loadingOperations":new Map,"*showSlider":!1,"*currentFilter":ks,"*currentOperation":null,"*tabId":ts,showLoader:!1,filters:as,colorOperations:ns,cropOperations:os,"*operationTooltip":null,"l10n.cancel":this.l10n("cancel"),"l10n.apply":this.l10n("apply"),"presence.mainToolbar":!0,"presence.subToolbar":!1,"presence.tabContent.crop":!1,"presence.tabContent.sliders":!1,"presence.tabContent.filters":!1,"presence.subTopToolbarStyles":{hidden:"sub-toolbar--top-hidden",visible:"sub-toolbar--visible"},"presence.subBottomToolbarStyles":{hidden:"sub-toolbar--bottom-hidden",visible:"sub-toolbar--visible"},"presence.tabContentStyles":{hidden:"tab-content--hidden",visible:"tab-content--visible"},"on.cancel":e=>{this._cancelPreload&&this._cancelPreload(),this.$["*on.cancel"]()},"on.apply":e=>{this.$["*on.apply"](this.$["*editorTransformations"])},"on.applySlider":e=>{this.ref["slider-el"].apply(),this._onSliderClose()},"on.cancelSlider":e=>{this.ref["slider-el"].cancel(),this._onSliderClose()},"on.clickTab":e=>{let t=e.currentTarget.getAttribute("data-id");this._activateTab(t,{fromViewer:!1})}},this._debouncedShowLoader=Hi(this._showLoader.bind(this),500)}_onSliderClose(){this.$["*showSlider"]=!1,this.$["*tabId"]===is&&this.ref["tooltip-el"].classList.toggle("info-tooltip_visible",!1)}_createOperationControl(e){let t=Us.is&&new Us;return t.operation=e,t}_createFilterControl(e){let t=Is.is&&new Is;return t.filter=e,t}_createToggleControl(e){let t=Ts.is&&new Ts;return t.operation=e,t}_renderControlsList(e){let t=this.ref[`controls-list-${e}`],i=document.createDocumentFragment();e===ts?this.$.cropOperations.forEach((e=>{let t=this._createToggleControl(e);i.appendChild(t)})):e===ss?[ks,...this.$.filters].forEach((e=>{let t=this._createFilterControl(e);i.appendChild(t)})):e===is&&this.$.colorOperations.forEach((e=>{let t=this._createOperationControl(e);i.appendChild(t)})),i.childNodes.forEach(((e,t)=>{t===i.childNodes.length-1&&e.classList.add("controls-list_last-item")})),t.innerHTML="",t.appendChild(i)}_activateTab(e,{fromViewer:t}){this.$["*tabId"]=e,e===ts?(this.$["*faderEl"].deactivate(),this.$["*cropperEl"].activate(this.$["*imageSize"],{fromViewer:t})):(this.$["*faderEl"].activate({url:this.$["*originalUrl"],fromViewer:t}),this.$["*cropperEl"].deactivate());for(let t of rs){let i=t===e;this.ref[`tab-toggle-${t}`].active=i,i?(this._renderControlsList(e),this._syncTabIndicator()):this._unmountTabControls(t),this.$[`presence.tabContent.${t}`]=i}}_unmountTabControls(e){let t=this.ref[`controls-list-${e}`];t&&(t.innerHTML="")}_syncTabIndicator(){let e=this.ref[`tab-toggle-${this.$["*tabId"]}`];this.ref["tabs-indicator"].style.transform=`translateX(${e.offsetLeft}px)`}_preloadEditedImage(){if(this.$["*imgContainerEl"]&&this.$["*originalUrl"]){let e=this.$["*imgContainerEl"].offsetWidth,t=this.proxyUrl(Rs(this.$["*originalUrl"],e,this.$["*editorTransformations"]));this._cancelPreload&&this._cancelPreload();let{cancel:i}=Ss([t]);this._cancelPreload=()=>{i(),this._cancelPreload=void 0}}}_showLoader(e){this.$.showLoader=e}_updateInfoTooltip=Hi((()=>{let e=this.$["*editorTransformations"],t="",i=!1;if(this.$["*tabId"]===ss)if(i=!0,this.$["*currentFilter"]&&e?.filter?.name===this.$["*currentFilter"]){let i=e?.filter?.amount||100;t=this.l10n(this.$["*currentFilter"])+" "+i}else t=this.l10n(ks);else if(this.$["*tabId"]===is&&this.$["*currentOperation"]){i=!0;let s=e?.[this.$["*currentOperation"]]||ls[this.$["*currentOperation"]].zero;t=this.$["*currentOperation"]+" "+s}i&&(this.$["*operationTooltip"]=t),this.ref["tooltip-el"].classList.toggle("info-tooltip_visible",i)}),0);initCallback(){super.initCallback(),this.$["*sliderEl"]=this.ref["slider-el"],this.sub("*imageSize",(e=>{e&&setTimeout((()=>{this._activateTab(this.$["*tabId"],{fromViewer:!0})}),0)})),this.sub("*editorTransformations",(e=>{let t=e?.filter?.name;this.$["*currentFilter"]!==t&&(this.$["*currentFilter"]=t)})),this.sub("*currentFilter",(()=>{this._updateInfoTooltip()})),this.sub("*currentOperation",(()=>{this._updateInfoTooltip()})),this.sub("*tabId",(()=>{this._updateInfoTooltip()})),this.sub("*originalUrl",(e=>{this.$["*faderEl"]&&this.$["*faderEl"].deactivate()})),this.sub("*editorTransformations",(e=>{this._preloadEditedImage(),this.$["*faderEl"]&&this.$["*faderEl"].setTransformations(e)})),this.sub("*loadingOperations",(e=>{let t=!1;for(let[,i]of e.entries()){if(t)break;for(let[,e]of i.entries())if(e){t=!0;break}}this._debouncedShowLoader(t)})),this.sub("*showSlider",(e=>{this.$["presence.subToolbar"]=e,this.$["presence.mainToolbar"]=!e})),this._updateInfoTooltip()}}Bs.template=`\n  <lr-line-loader-ui set="active: showLoader"></lr-line-loader-ui>\n  <div class="info-tooltip_container">\n    <div class="info-tooltip_wrapper">\n      <div ref="tooltip-el" class="info-tooltip info-tooltip_hidden">{{*operationTooltip}}</div>\n    </div>\n  </div>\n  <div class="toolbar-container">\n    <lr-presence-toggle class="sub-toolbar" set="visible: presence.mainToolbar; styles: presence.subTopToolbarStyles">\n      <div class="tab-content-row">${rs.map((function(e){return`\n    <lr-presence-toggle class="tab-content" set="visible: presence.tabContent.${e}; styles: presence.tabContentStyles">\n      <lr-editor-scroller hidden-scrollbar>\n        <div class="controls-list_align">\n          <div class="controls-list_inner" ref="controls-list-${e}"></div>\n        </div>\n      </lr-editor-scroller>\n    </lr-presence-toggle>\n  `})).join("")}</div>\n      <div class="controls-row">\n        <lr-btn-ui theme="boring" icon="closeMax" set="onclick: on.cancel"> </lr-btn-ui>\n        <div class="tab-toggles">\n          <div ref="tabs-indicator" class="tab-toggles_indicator"></div>\n          ${rs.map((function(e){return`\n    <lr-btn-ui\n      theme="boring"\n      ref="tab-toggle-${e}"\n      data-id="${e}"\n      icon="${e}"\n      tabindex="0"\n      set="onclick: on.clickTab;"\n    >\n    </lr-btn-ui>\n  `})).join("")}\n        </div>\n        <lr-btn-ui theme="primary" icon="done" set="onclick: on.apply"> </lr-btn-ui>\n      </div>\n    </lr-presence-toggle>\n    <lr-presence-toggle class="sub-toolbar" set="visible: presence.subToolbar; styles: presence.subBottomToolbarStyles">\n      <div class="slider">\n        <lr-editor-slider ref="slider-el"></lr-editor-slider>\n      </div>\n      <div class="controls-row">\n        <lr-btn-ui theme="boring" set="@text: l10n.cancel; onclick: on.cancelSlider;"> </lr-btn-ui>\n        <lr-btn-ui theme="primary" set="@text: l10n.apply; onclick: on.applySlider;"> </lr-btn-ui>\n      </div>\n    </lr-presence-toggle>\n  </div>\n`;class Fs extends fe{constructor(){super(),this._iconReversed=!1,this._iconSingle=!1,this._iconHidden=!1,this.init$={...this.ctxInit,text:"",icon:"",iconCss:this._iconCss(),theme:null},this.defineAccessor("active",(e=>{e?this.setAttribute("active",""):this.removeAttribute("active")}))}_iconCss(){return qi("icon",{icon_left:!this._iconReversed,icon_right:this._iconReversed,icon_hidden:this._iconHidden,icon_single:this._iconSingle})}initCallback(){super.initCallback(),this.sub("icon",(e=>{this._iconSingle=!this.$.text,this._iconHidden=!e,this.$.iconCss=this._iconCss()})),this.sub("theme",(e=>{"custom"!==e&&(this.className=e)})),this.sub("text",(e=>{this._iconSingle=!1})),this.setAttribute("role","button"),-1===this.tabIndex&&(this.tabIndex=0),this.hasAttribute("theme")||this.setAttribute("theme","default")}set reverse(e){this.hasAttribute("reverse")?(this.style.flexDirection="row-reverse",this._iconReversed=!0):(this._iconReversed=!1,this.style.flexDirection=null)}}Fs.bindAttributes({text:"text",icon:"icon",reverse:"reverse",theme:"theme"}),Fs.template='\n  <lr-icon size="20" set="className: iconCss; @name: icon;"></lr-icon>\n  <div class="text">{{text}}</div>\n';class Vs extends fe{constructor(){super(),this._active=!1,this._handleTransitionEndRight=()=>{let e=this.ref["line-el"];e.style.transition="initial",e.style.opacity="0",e.style.transform="translateX(-101%)",this._active&&this._start()}}initCallback(){super.initCallback(),this.defineAccessor("active",(e=>{"boolean"==typeof e&&(e?this._start():this._stop())}))}_start(){this._active=!0;let{width:e}=this.getBoundingClientRect(),t=this.ref["line-el"];t.style.transition="transform 1s",t.style.opacity="1",t.style.transform=`translateX(${e}px)`,t.addEventListener("transitionend",this._handleTransitionEndRight,{once:!0})}_stop(){this._active=!1}}Vs.template='\n  <div class="inner">\n    <div class="line" ref="line-el"></div>\n  </div>\n';const zs="transition",js="visible",qs="hidden";class Hs extends fe{constructor(){super(),this._visible=!1,this._visibleStyle=js,this._hiddenStyle=qs,this._externalTransitions=!1,this.defineAccessor("styles",(e=>{e&&(this._externalTransitions=!0,this._visibleStyle=e.visible,this._hiddenStyle=e.hidden)})),this.defineAccessor("visible",(e=>{"boolean"==typeof e&&(this._visible=e,this._handleVisible())}))}_handleVisible(){this.style.visibility=this._visible?"inherit":"hidden",function(e,...t){let i=ji(...t);for(let t of Object.keys(i))e.classList.toggle(t,i[t])}(this,{[zs]:!this._externalTransitions,[this._visibleStyle]:this._visible,[this._hiddenStyle]:!this._visible}),this.setAttribute("aria-hidden",this._visible?"false":"true")}initCallback(){super.initCallback(),this.setAttribute("hidden",""),this._externalTransitions||this.classList.add(zs),this._handleVisible(),setTimeout((()=>this.removeAttribute("hidden")),0)}}Hs.template=" <slot></slot> ";class Ks extends fe{init$={...this.ctxInit,disabled:!1,min:0,max:100,onInput:null,onChange:null,defaultValue:null,"on.sliderInput":()=>{let e=parseInt(this.ref["input-el"].value,10);this._updateValue(e),this.$.onInput&&this.$.onInput(e)},"on.sliderChange":()=>{let e=parseInt(this.ref["input-el"].value,10);this.$.onChange&&this.$.onChange(e)}};constructor(){super(),this.setAttribute("with-effects","")}initCallback(){super.initCallback(),this.defineAccessor("disabled",(e=>{this.$.disabled=e})),this.defineAccessor("min",(e=>{this.$.min=e})),this.defineAccessor("max",(e=>{this.$.max=e})),this.defineAccessor("defaultValue",(e=>{this.$.defaultValue=e,this.ref["input-el"].value=e,this._updateValue(e)})),this.defineAccessor("zero",(e=>{this._zero=e})),this.defineAccessor("onInput",(e=>{e&&(this.$.onInput=e)})),this.defineAccessor("onChange",(e=>{e&&(this.$.onChange=e)})),this._updateSteps(),this._observer=new ResizeObserver((()=>{this._updateSteps();let e=parseInt(this.ref["input-el"].value,10);this._updateValue(e)})),this._observer.observe(this),this._thumbSize=parseInt(window.getComputedStyle(this).getPropertyValue("--l-thumb-size"),10),setTimeout((()=>{let e=parseInt(this.ref["input-el"].value,10);this._updateValue(e)}),0),this.sub("disabled",(e=>{let t=this.ref["input-el"];e?t.setAttribute("disabled","disabled"):t.removeAttribute("disabled")}));let e=this.ref["input-el"];e.addEventListener("focus",(()=>{this.style.setProperty("--color-effect","var(--hover-color-rgb)")})),e.addEventListener("blur",(()=>{this.style.setProperty("--color-effect","var(--idle-color-rgb)")}))}_updateValue(e){this._updateZeroDot(e);let{width:t}=this.getBoundingClientRect(),i=100/(this.$.max-this.$.min)*(e-this.$.min)*(t-this._thumbSize)/100;window.requestAnimationFrame((()=>{this.ref["thumb-el"].style.transform=`translateX(${i}px)`}))}_updateZeroDot(e){if(!this._zeroDotEl)return;e===this._zero?this._zeroDotEl.style.opacity="0":this._zeroDotEl.style.opacity="0.2";let{width:t}=this.getBoundingClientRect(),i=100/(this.$.max-this.$.min)*(this._zero-this.$.min)*(t-this._thumbSize)/100;window.requestAnimationFrame((()=>{this._zeroDotEl.style.transform=`translateX(${i}px)`}))}_updateSteps(){let e=this.ref["steps-el"],{width:t}=e.getBoundingClientRect(),i=Math.ceil(t/2),s=Math.ceil(i/15)-2;if(this._stepsCount===s)return;let r=document.createDocumentFragment(),n=document.createElement("div"),a=document.createElement("div");n.className="minor-step",a.className="border-step",r.appendChild(a);for(let e=0;e<s;e++)r.appendChild(n.cloneNode());r.appendChild(a.cloneNode());for(let e=0;e<s;e++)r.appendChild(n.cloneNode());r.appendChild(a.cloneNode());let o=document.createElement("div");o.className="zero-dot",r.appendChild(o),this._zeroDotEl=o,e.innerHTML="",e.appendChild(r),this._stepsCount=s}destroyCallback(){this._observer?.disconnect()}}Ks.template='\n  <div class="steps" ref="steps-el"></div>\n  <div ref="thumb-el" class="thumb"></div>\n  <input\n    class="input"\n    type="range"\n    ref="input-el"\n    tabindex="0"\n    set="oninput: on.sliderInput; onchange: on.sliderChange; @min: min; @max: max; @value: defaultValue;"\n  />\n';let Ws={};window.addEventListener("message",(e=>{let t;try{t=JSON.parse(e.data)}catch(e){return}if(t?.type in Ws){let i=Ws[t.type];for(let[s,r]of i)e.source===s&&r(t)}}));let Xs=e=>Object.keys(e).reduce(((t,i)=>{let s=e[i],r=Object.keys(s).reduce(((e,t)=>e+`${t}: ${s[t]};`),"");return t+`${i}{${r}}`}),"");function Gs({textColor:e,backgroundColor:t,linkColor:i,linkColorHover:s,shadeColor:r}){let n=`solid 1px ${r}`;return Xs({body:{color:e,"background-color":t},".side-bar":{background:"inherit","border-right":n},".main-content":{background:"inherit"},".main-content-header":{background:"inherit"},".main-content-footer":{background:"inherit"},".list-table-row":{color:"inherit"},".list-table-row:hover":{background:r},".list-table-row .list-table-cell-a, .list-table-row .list-table-cell-b":{"border-top":n},".list-table-body .list-items":{"border-bottom":n},".bread-crumbs a":{color:i},".bread-crumbs a:hover":{color:s},".main-content.loading":{background:`${t} url(/static/images/loading_spinner.gif) center no-repeat`,"background-size":"25px 25px"},".list-icons-item":{background:`center no-repeat ${r}`},".source-gdrive .side-bar-menu a, .source-gphotos .side-bar-menu a":{color:i},".source-gdrive .side-bar-menu a, .source-gphotos .side-bar-menu a:hover":{color:s},".side-bar-menu a":{color:i},".side-bar-menu a:hover":{color:s},".source-gdrive .side-bar-menu .current, .source-gdrive .side-bar-menu a:hover, .source-gphotos .side-bar-menu .current, .source-gphotos .side-bar-menu a:hover":{color:s},".source-vk .side-bar-menu a":{color:i},".source-vk .side-bar-menu a:hover":{color:s,background:"none"}})}class Ys extends Zt{activityType=we.activities.EXTERNAL;init$={...this.ctxInit,activityIcon:"",activityCaption:"",counter:0,onDone:()=>{this.$["*currentActivity"]=we.activities.UPLOAD_LIST},onCancel:()=>{this.historyBack()}};_iframe=null;initCallback(){super.initCallback(),this.registerActivity(this.activityType,{onActivate:()=>{let{externalSourceType:e}=this.activityParams;this.set$({activityCaption:`${e?.[0].toUpperCase()}${e?.slice(1)}`,activityIcon:e}),this.$.counter=0,this.mountIframe()}}),this.sub("*currentActivity",(e=>{e!==this.activityType&&this.unmountIframe()}))}sendMessage(e){this._iframe.contentWindow.postMessage(JSON.stringify(e),"*")}async handleFileSelected(e){this.$.counter=this.$.counter+1;let{url:t,filename:i}=e;this.uploadCollection.add({externalUrl:t,fileName:i})}handleIframeLoad(e){this.applyStyles()}getCssValue(e){return window.getComputedStyle(this).getPropertyValue(e).trim()}applyStyles(){let e={backgroundColor:this.getCssValue("--clr-background-light"),textColor:this.getCssValue("--clr-txt"),shadeColor:this.getCssValue("--clr-shade-lv1"),linkColor:"#157cfc",linkColorHover:"#3891ff"};this.sendMessage({type:"embed-css",style:Gs(e)})}remoteUrl(){let e=this.getCssData("--cfg-pubkey"),t=(!1).toString(),{externalSourceType:i}=this.activityParams;return`https://social.uploadcare.com/window3/${i}?${function(e){let t=[];for(let[i,s]of Object.entries(e))null==s||"string"==typeof s&&0===s.length||t.push(`${i}=${encodeURIComponent(s)}`);return t.join("&")}({lang:"en",widget_version:"3.11.3",public_key:e,images_only:t,pass_window_open:!1,session_key:this.getCssData("--cfg-remote-tab-session-key")})}`}mountIframe(){let e=te({tag:"iframe",attributes:{src:this.remoteUrl(),marginheight:0,marginwidth:0,frameborder:0,allowTransparency:!0}});var t,i,s;e.addEventListener("load",this.handleIframeLoad.bind(this)),this.ref.iframeWrapper.innerHTML="",this.ref.iframeWrapper.appendChild(e),t="file-selected",i=e.contentWindow,s=this.handleFileSelected.bind(this),t in Ws||(Ws[t]=[]),Ws[t].push([i,s]),this._iframe=e}unmountIframe(){var e,t;this._iframe&&(e="file-selected",t=this._iframe.contentWindow,e in Ws&&(Ws[e]=Ws[e].filter((e=>e[0]!==t)))),this.ref.iframeWrapper.innerHTML="",this._iframe=void 0}}Ys.template='\n  <lr-activity-header>\n    <button type="button" class="mini-btn" set="onclick: *historyBack">\n      <lr-icon name="back"></lr-icon>\n    </button>\n    <div>\n      <lr-icon set="@name: activityIcon"></lr-icon>\n      <span>{{activityCaption}}</span>\n    </div>\n    <button type="button" class="mini-btn close-btn" set="onclick: *historyBack">\n      <lr-icon name="close"></lr-icon>\n    </button>\n  </lr-activity-header>\n  <div class="content">\n    <div ref="iframeWrapper" class="iframe-wrapper"></div>\n    <div class="toolbar">\n      <button type="button" class="cancel-btn secondary-btn" set="onclick: onCancel" l10n="cancel"></button>\n      <div></div>\n      <div class="selected-counter"><span l10n="selected-count"></span>{{counter}}</div>\n      <button type="button" class="done-btn primary-btn" set="onclick: onDone; @disabled: !counter">\n        <lr-icon name="check"></lr-icon>\n      </button>\n    </div>\n  </div>\n';class Js extends fe{setCurrentTab(e){if(!e)return;[...this.ref.context.querySelectorAll("[tab-ctx]")].forEach((t=>{t.getAttribute("tab-ctx")===e?t.removeAttribute("hidden"):t.setAttribute("hidden","")}));for(let t in this._tabMap)t===e?this._tabMap[t].setAttribute("current",""):this._tabMap[t].removeAttribute("current")}initCallback(){super.initCallback(),this._tabMap={},this.defineAccessor("tab-list",(e=>{if(!e)return;e.split(",").map((e=>e.trim())).forEach((e=>{let t=te({tag:"div",attributes:{class:"tab"},properties:{onclick:()=>{this.setCurrentTab(e)}}});t.textContent=this.l10n(e),this.ref.row.appendChild(t),this._tabMap[e]=t}))})),this.defineAccessor("default",(e=>{this.setCurrentTab(e)})),this.hasAttribute("default")||this.setCurrentTab(Object.keys(this._tabMap)[0])}}Js.bindAttributes({"tab-list":null,default:null}),Js.template='\n  <div ref="row" class="tabs-row"></div>\n  <div ref="context" class="tabs-context">\n    <slot></slot>\n  </div>\n';class Qs extends Zt{processInnerHtml=!0;init$={...this.ctxInit,output:null,filesData:null};cssInit$={"--cfg-group-output":0};get dict(){return Qs.dict}get validationInput(){return this._validationInputElement}initCallback(){if(super.initCallback(),this.hasAttribute(this.dict.FORM_INPUT_ATTR)&&(this._dynamicInputsContainer=document.createElement("div"),this.appendChild(this._dynamicInputsContainer),this.hasAttribute(this.dict.INPUT_REQUIRED))){let e=document.createElement("input");e.type="text",e.name="__UPLOADCARE_VALIDATION_INPUT__",e.required=!0,this.appendChild(e),this._validationInputElement=e}this.sub("output",(e=>{if(e){if(this.hasAttribute(this.dict.FIRE_EVENT_ATTR)&&this.dispatchEvent(new CustomEvent(this.dict.EVENT_NAME,{bubbles:!0,composed:!0,detail:{timestamp:Date.now(),ctxName:this.ctxName,data:e}})),this.hasAttribute(this.dict.FORM_INPUT_ATTR)){this._dynamicInputsContainer.innerHTML="";let t=e.groupData?[e.groupData.cdnUrl]:e.map((e=>e.cdnUrl));for(let e of t){let t=document.createElement("input");t.type="hidden",t.name=this.getAttribute(this.dict.INPUT_NAME_ATTR)||this.ctxName,t.value=e,this._dynamicInputsContainer.appendChild(t)}this.hasAttribute(this.dict.INPUT_REQUIRED)&&(this._validationInputElement.value=t.length?"__VALUE__":"")}this.hasAttribute(this.dict.CONSOLE_ATTR)&&console.log(e)}}),!1),this.sub(this.dict.SRC_CTX_KEY,(async e=>{if(!e)return this.$.output=null,void(this.$.filesData=null);if(this.$.filesData=e,this.getCssData("--cfg-group-output")||this.hasAttribute(this.dict.GROUP_ATTR)){let t=e.map((e=>e.uuid)),i=await zt(t,{...this.getUploadClientOptions()});this.$.output={groupData:i,files:e}}else this.$.output=e}),!1)}}Qs.dict={SRC_CTX_KEY:"*outputData",EVENT_NAME:"lr-data-output",FIRE_EVENT_ATTR:"use-event",CONSOLE_ATTR:"use-console",GROUP_ATTR:"use-group",FORM_INPUT_ATTR:"use-input",INPUT_NAME_ATTR:"input-name",INPUT_REQUIRED:"input-required"};class Zs extends fe{init$={...this.ctxInit,currentText:"",options:[],selectHtml:"",onSelect:e=>{e.preventDefault(),e.stopPropagation(),this.value=this.ref.select.value,this.$.currentText=this.$.options.find((e=>e.value==this.value))?.text||"",this.dispatchEvent(new Event("change"))}};initCallback(){super.initCallback(),this.sub("options",(e=>{this.$.currentText=e?.[0]?.text||"";let t="";e?.forEach((e=>{t+=`<option value="${e.value}">${e.text}</option>`})),this.$.selectHtml=t}))}}Zs.template='\n  <button>\n    {{currentText}}\n    <lr-icon name="select"></lr-icon>\n    <select ref="select" set="innerHTML: selectHtml; onchange: onSelect"></select>\n  </button>\n';const er="play",tr="pause",ir="fullscreen-on",sr="fullscreen-off",rr="unmute",nr="mute",ar="captions",or="captions-off",lr=e=>{e.requestFullscreen?e.requestFullscreen():e.webkitRequestFullscreen&&e.webkitRequestFullscreen()},cr=()=>{document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen&&document.webkitExitFullscreen()};class hr extends fe{togglePlay(){this._video.paused||this._video.ended?this._video.play():this._video.pause()}toggleFullscreen(){(document.fullscreenElement||document.webkitFullscreenElement)===this?cr():lr(this)}toggleCaptions(){this.$.capIcon===or?(this.$.capIcon=ar,this._video.textTracks[0].mode="showing",window.localStorage.setItem(hr.is+":captions","1")):(this.$.capIcon=or,this._video.textTracks[0].mode="hidden",window.localStorage.removeItem(hr.is+":captions"))}toggleSound(){this.$.volIcon===rr?(this.$.volIcon=nr,this.$.volumeDisabled=!0,this._video.muted=!0):(this.$.volIcon=rr,this.$.volumeDisabled=!1,this._video.muted=!1)}setVolume(e){window.localStorage.setItem(hr.is+":volume",e);let t=e?e/100:0;this._video.volume=t}get progress(){return this.ref.progress}init$={...this.ctxInit,src:"",ppIcon:er,fsIcon:ir,volIcon:rr,capIcon:or,totalTime:"00:00",currentTime:"00:00",progressCssWidth:"0",hasSubtitles:!1,volumeDisabled:!1,volumeValue:0,onPP:()=>{this.togglePlay()},onFs:()=>{this.toggleFullscreen()},onCap:()=>{this.toggleCaptions()},onMute:()=>{this.toggleSound()},onVolChange:e=>{let t=parseFloat(e.currentTarget.$.value);this.setVolume(t)},progressClicked:e=>{let t=this.progress.getBoundingClientRect();this._video.currentTime=this._video.duration*(e.offsetX/t.width)}};_getUrl(e){return e.includes("/")?e:`https://ucarecdn.com/${e}/`}_desc2attrs(e){let t=[];for(let i in e){let s="src"===i?this._getUrl(e[i]):e[i];t.push(`${i}="${s}"`)}return t.join(" ")}_timeFmt(e){let t=new Date(1e3*Math.round(e));return[t.getMinutes(),t.getSeconds()].map((e=>e<10?"0"+e:e)).join(":")}_initTracks(){[...this._video.textTracks].forEach((e=>{e.mode="hidden"})),window.localStorage.getItem(hr.is+":captions")&&this.toggleCaptions()}_castAttributes(){let e=["autoplay","loop","muted"];[...this.attributes].forEach((t=>{e.includes(t.name)&&this._video.setAttribute(t.name,t.value)}))}initCallback(){super.initCallback(),this._video=this.ref.video,this._castAttributes(),this._video.addEventListener("play",(()=>{this.$.ppIcon=tr,this.setAttribute("playback","")})),this._video.addEventListener("pause",(()=>{this.$.ppIcon=er,this.removeAttribute("playback")})),this.addEventListener("fullscreenchange",(e=>{console.log(e),document.fullscreenElement===this?this.$.fsIcon=sr:this.$.fsIcon=ir})),this.sub("src",(e=>{if(!e)return;let t=this._getUrl(e);this._video.src=t})),this.sub("video",(async e=>{if(!e)return;let t=await(await window.fetch(this._getUrl(e))).json();t.poster&&(this._video.poster=this._getUrl(t.poster));let i="";t?.sources.forEach((e=>{i+=`<source ${this._desc2attrs(e)} />`})),t.tracks&&(t.tracks.forEach((e=>{i+=`<track ${this._desc2attrs(e)} />`})),this.$.hasSubtitles=!0),this._video.innerHTML+=i,this._initTracks(),console.log(t)})),this._video.addEventListener("loadedmetadata",(e=>{this.$.currentTime=this._timeFmt(this._video.currentTime),this.$.totalTime=this._timeFmt(this._video.duration)})),this._video.addEventListener("timeupdate",(e=>{let t=Math.round(this._video.currentTime/this._video.duration*100);this.$.progressCssWidth=t+"%",this.$.currentTime=this._timeFmt(this._video.currentTime)}));let e=window.localStorage.getItem(hr.is+":volume");if(e){let t=parseFloat(e);this.setVolume(t),this.$.volumeValue=t}}}hr.template='\n  <div class="video-wrapper">\n    <video ref="video" preload="metadata" crossorigin="anonymous"></video>\n  </div>\n\n  <div class="toolbar">\n    <div class="progress" ref="progress" set -onclick="progressClicked">\n      <div class="bar" set -style.width="progressCssWidth"></div>\n    </div>\n\n    <div class="tb-block">\n      <button set -onclick="onPP">\n        <lr-icon set -@name="ppIcon"></lr-icon>\n      </button>\n      <div class="timer">{{currentTime}} / {{totalTime}}</div>\n    </div>\n\n    <div class="tb-block">\n      <button set -onclick="onCap" -@hidden="!hasSubtitles">\n        <lr-icon set -@name="capIcon"></lr-icon>\n      </button>\n\n      <button set -onclick="onMute">\n        <lr-icon set -@name="volIcon"></lr-icon>\n      </button>\n\n      <lr-range type="range" set -onchange="onVolChange" -@disabled="volumeDisabled" -value="volumeValue"> </lr-range>\n\n      <button set -onclick="onFs">\n        <lr-icon set -@name="fsIcon"></lr-icon>\n      </button>\n    </div>\n  </div>\n',hr.bindAttributes({video:"video",src:"src"});class dr extends fe{pauseRender=!0;shadowReadyCallback(){}initCallback(){super.initCallback(),this.setAttribute("hidden","");let e=this.getAttribute("css-src");if(e){this.renderShadow=!0,this.attachShadow({mode:"open"});let t=document.createElement("link");t.rel="stylesheet",t.type="text/css",t.href=e,t.onload=()=>{window.requestAnimationFrame((()=>{this.render(),window.setTimeout((()=>{this.removeAttribute("hidden"),this.shadowReadyCallback()}))}))},this.shadowRoot.appendChild(t)}else this.render(),this.removeAttribute("hidden"),this.shadowReadyCallback()}}class ur extends dr{ctxInit=ue(this);ctxOwner=!0;_template=null;static set template(e){this._template=e+"<slot></slot>"}static get template(){return this._template}}class pr extends ur{}pr.template="\n  <lr-simple-btn></lr-simple-btn>\n\n  <lr-modal strokes block-body-scrolling>\n    <lr-start-from>\n      <lr-drop-area with-icon clickable></lr-drop-area>\n      <lr-source-list wrap></lr-source-list>\n      <lr-copyright></lr-copyright>\n    </lr-start-from>\n    <lr-upload-list></lr-upload-list>\n    <lr-camera-source></lr-camera-source>\n    <lr-url-source></lr-url-source>\n    <lr-external-source></lr-external-source>\n    <lr-cloud-image-editor></lr-cloud-image-editor>\n  </lr-modal>\n\n  <lr-message-box></lr-message-box>\n  <lr-progress-bar-common></lr-progress-bar-common>\n";class mr extends ur{pauseRender=!0;init$={...this.ctxInit,selectClicked:()=>{this.ref.uBlock.openSystemDialog()}};shadowReadyCallback(){const e=this.ref.uBlock;this.sub("*currentActivity",(t=>{t||(this.$["*currentActivity"]=e.initActivity||we.activities.START_FROM)})),this.sub("*uploadList",(t=>{0===t?.length&&(this.$["*currentActivity"]=e.initActivity||we.activities.START_FROM)}))}}mr.template='\n  <lr-start-from>\n    <lr-drop-area clickable l10n="choose-file"></lr-drop-area>\n    <lr-copyright></lr-copyright>\n  </lr-start-from>\n  <lr-upload-list ref="uBlock"></lr-upload-list>\n  <lr-message-box></lr-message-box>\n';class gr extends ur{init$={...this.ctxInit,dropAreaHidden:!1};shadowReadyCallback(){const e=this.ref.uBlock;this.sub("*currentActivity",(t=>{t||(this.$["*currentActivity"]=e.initActivity||we.activities.START_FROM)})),window.customElements.whenDefined(e.tagName.toLowerCase()).then((()=>{1!==e.sourceList.length||e.sourceList.includes(Zt.sourceTypes.LOCAL)||(this.$.dropAreaHidden=!0)}))}}function br(e){for(let t in e){let i=[...t].reduce(((e,t)=>(t.toUpperCase()===t&&(t="-"+t.toLowerCase()),e+t)),"");i.startsWith("-")&&(i=i.replace("-","")),i.startsWith("lr-")||(i="lr-"+i),e[t].reg&&e[t].reg(i)}}gr.template=' <lr-start-from>\n    <lr-drop-area set="@hidden: dropAreaHidden" with-icon clickable></lr-drop-area>\n    <lr-source-list wrap></lr-source-list>\n    <lr-copyright></lr-copyright>\n  </lr-start-from>\n  <lr-upload-list ref="uBlock"></lr-upload-list>\n  <lr-camera-source></lr-camera-source>\n  <lr-url-source></lr-url-source>\n  <lr-external-source></lr-external-source>\n  <lr-message-box></lr-message-box>\n  <lr-progress-bar></lr-progress-bar>\n  <lr-cloud-image-editor></lr-cloud-image-editor>';const fr="__lr-blocks__";var _r=Object.freeze({__proto__:null,ActivityBlock:we,ActivityHeader:class extends we{},BaseComponent:ee,Block:fe,CameraSource:Ni,CloudEditor:cs,CloudImageEditor:class extends Zt{activityType=we.activities.CLOUD_IMG_EDIT;init$={...this.ctxInit,cdnUrl:null};initCallback(){super.initCallback(),this.bindCssData("--cfg-pubkey"),this.registerActivity(this.activityType,{onActivate:()=>this.mountEditor(),onDeactivate:()=>this.unmountEditor()}),this.sub("*focusedEntry",(e=>{e&&(this.entry=e,this.entry.subscribe("cdnUrl",(e=>{e&&(this.$.cdnUrl=e)})))}))}handleApply(e){let t=e.detail;this.entry.setMultipleValues({cdnUrl:t.cdnUrl,cdnUrlModifiers:t.cdnUrlModifiers}),this.historyBack()}handleCancel(){this.historyBack()}mountEditor(){let e=new cs;e.classList.add("lr-cldtr-common");let t=this.$.cdnUrl;e.setAttribute("cdn-url",t),e.addEventListener("apply",(e=>this.handleApply(e))),e.addEventListener("cancel",(()=>this.handleCancel())),this.innerHTML="",this.appendChild(e)}unmountEditor(){this.innerHTML=""}},ConfirmationDialog:Pi,Copyright:class extends fe{cssInit$={"--cfg-remove-copyright":0};init$={...this.ctxInit,removeCopyright:!1};initCallback(){super.initCallback(),this.sub("--cfg-remove-copyright",(e=>{this.$.removeCopyright=!!e}))}static template='\n    <a\n      href="https://uploadcare.com/?utm_source=copyright&utm_medium=referral&utm_campaign=v4"\n      target="_blank noopener"\n      class="credits"\n      set="@hidden: removeCopyright"\n      >Powered by Uploadcare</a\n    >\n  '},CropFrame:ws,Data:N,DataOutput:Qs,DropArea:xi,EditorCropButtonControl:Ts,EditorFilterControl:Is,EditorImageCropper:Ns,EditorImageFader:class extends fe{constructor(){super(),this._isActive=!1,this._hidden=!0,this._addKeypointDebounced=Hi(this._addKeypoint.bind(this),600),this.classList.add("inactive_to_cropper")}_handleImageLoading(e){let t=this._operation,i=this.$["*loadingOperations"];return i.get(t)||i.set(t,new Map),i.get(t).get(e)||(i.set(t,i.get(t).set(e,!0)),this.$["*loadingOperations"]=i),()=>{i?.get(t)?.has(e)&&(i.get(t).delete(e),this.$["*loadingOperations"]=i)}}_flush(){window.cancelAnimationFrame(this._raf),this._raf=window.requestAnimationFrame((()=>{for(let e of this._keypoints){let{image:t}=e;t&&(t.style.opacity=e.opacity.toString(),t.style.zIndex=e.zIndex.toString())}}))}_imageSrc({url:e=this._url,filter:t=this._filter,operation:i,value:s}={}){let r={...this._transformations};i&&(r[i]=t?{name:t,amount:s}:s);let n=this.offsetWidth;return this.proxyUrl(Rs(e,n,r))}_constructKeypoint(e,t){return{src:this._imageSrc({operation:e,value:t}),image:null,opacity:0,zIndex:0,value:t}}_isSame(e,t){return this._operation===e&&this._filter===t}_addKeypoint(e,t,i){let s=()=>!this._isSame(e,t)||this._value!==i||!!this._keypoints.find((e=>e.value===i));if(s())return;let r=this._constructKeypoint(e,i),n=new Image;n.src=r.src;let a=this._handleImageLoading(r.src);n.addEventListener("load",a,{once:!0}),n.addEventListener("error",a,{once:!0}),r.image=n,n.classList.add("fader-image"),n.addEventListener("load",(()=>{if(s())return;let t=this._keypoints,a=t.findIndex((e=>e.value>i)),o=a<t.length?t[a].image:null;!this._container||o&&!this._container.contains(o)||(t.splice(a,0,r),this._container.insertBefore(n,o),this._update(e,i))}),{once:!0}),n.addEventListener("error",(()=>{this.$["*networkProblems"]=!0}),{once:!0})}set(e){e="string"==typeof e?parseInt(e,10):e,this._update(this._operation,e),this._addKeypointDebounced(this._operation,this._filter,e)}_update(e,t){this._operation=e,this._value=t;let{zero:i}=ls[e],s=this._keypoints.map((e=>e.value)),r=function(e,t,i){let s=(r=e,r.reduce(((e,t,i)=>i<r.length-1?[...e,[t,r[i+1]]]:e),[])).find((([e,i])=>e<=t&&t<=i));var r;return e.map((e=>{let r=Math.abs(s[0]-s[1]),n=Math.abs(t-s[0])/r;return s[0]===e?t>i?1:1-n:s[1]===e?t>=i?n:1:0}))}(s,t,i),n=function(e,t){return e.map(((i,s)=>i<t?e.length-s:s))}(s,i);for(let[e,t]of Object.entries(this._keypoints))t.opacity=r[e],t.zIndex=n[e];this._flush()}_createPreviewImage(){let e=new Image;return e.classList.add("fader-image","fader-image--preview"),e.style.opacity="0",e}async _initNodes(){let e=document.createDocumentFragment();this._previewImage=this._previewImage||this._createPreviewImage(),!this.contains(this._previewImage)&&e.appendChild(this._previewImage);let t=document.createElement("div");e.appendChild(t);let i=this._keypoints.map((e=>e.src)),{images:s,promise:r,cancel:n}=Ss(i);s.forEach((e=>{let t=this._handleImageLoading(e.src);e.addEventListener("load",t),e.addEventListener("error",t)})),this._cancelLastImages=()=>{n(),this._cancelLastImages=void 0};let a=this._operation,o=this._filter;await r,this._isActive&&this._isSame(a,o)&&(this._container&&this._container.remove(),this._container=t,this._keypoints.forEach(((e,t)=>{let i=s[t];i.classList.add("fader-image"),e.image=i,this._container.appendChild(i)})),this.appendChild(e),this._flush())}setTransformations(e){if(this._transformations=e,this._previewImage){let e=this._imageSrc(),t=this._handleImageLoading(e);this._previewImage.src=e,this._previewImage.addEventListener("load",t,{once:!0}),this._previewImage.addEventListener("error",t,{once:!0}),this._previewImage.style.opacity="1",this._previewImage.addEventListener("error",(()=>{this.$["*networkProblems"]=!0}),{once:!0})}}preload({url:e,filter:t,operation:i,value:s}){this._cancelBatchPreload&&this._cancelBatchPreload();let r=Ds(i,s).map((s=>this._imageSrc({url:e,filter:t,operation:i,value:s}))),{cancel:n}=Ss(r);this._cancelBatchPreload=n}_setOriginalSrc(e){let t=this._previewImage||this._createPreviewImage();if(!this.contains(t)&&this.appendChild(t),this._previewImage=t,t.src===e)return t.style.opacity="1",t.style.transform="scale(1)",void(this.className=qi({active_from_viewer:this._fromViewer,active_from_cropper:!this._fromViewer,inactive_to_cropper:!1}));t.style.opacity="0";let i=this._handleImageLoading(e);t.addEventListener("error",i,{once:!0}),t.src=e,t.addEventListener("load",(()=>{i(),t&&(t.style.opacity="1",t.style.transform="scale(1)",this.className=qi({active_from_viewer:this._fromViewer,active_from_cropper:!this._fromViewer,inactive_to_cropper:!1}))}),{once:!0}),t.addEventListener("error",(()=>{this.$["*networkProblems"]=!0}),{once:!0})}activate({url:e,operation:t,value:i,filter:s,fromViewer:r}){if(this._isActive=!0,this._hidden=!1,this._url=e,this._operation=t||"initial",this._value=i,this._filter=s,this._fromViewer=r,"number"!=typeof i&&!s){let e=this._imageSrc({operation:t,value:i});return this._setOriginalSrc(e),void(this._container&&this._container.remove())}this._keypoints=Ds(t,i).map((e=>this._constructKeypoint(t,e))),this._update(t,i),this._initNodes()}deactivate({hide:e=!0}={}){this._isActive=!1,this._cancelLastImages&&this._cancelLastImages(),this._cancelBatchPreload&&this._cancelBatchPreload(),e&&!this._hidden?(this._hidden=!0,this._previewImage&&(this._previewImage.style.transform="scale(1)"),this.className=qi({active_from_viewer:!1,active_from_cropper:!1,inactive_to_cropper:!0}),this.addEventListener("transitionend",(()=>{this._container&&this._container.remove()}),{once:!0})):this._container&&this._container.remove()}},EditorOperationControl:Us,EditorScroller:Ps,EditorSlider:Es,EditorToolbar:Bs,ExternalSource:Ys,FileItem:Ui,FilePreview:zi,FileUploaderInline:gr,FileUploaderMinimal:mr,FileUploaderRegular:pr,Icon:ei,Img:class extends gi{initCallback(){super.initCallback(),this.sub$$("src",(()=>{this.init()})),this.sub$$("uuid",(()=>{this.init()})),this.sub$$("lazy",(e=>{this.$$("is-background-for")||(this.img.loading=e?"lazy":"eager")}))}},LineLoaderUi:Vs,LrBtnUi:Fs,MessageBox:Ei,Modal:_e,PresenceToggle:Hs,ProgressBar:Fi,ProgressBarCommon:Bi,Select:Zs,ShadowWrapper:dr,SimpleBtn:bi,SliderUi:Ks,SourceBtn:$i,SourceList:class extends fe{cssInit$={"--cfg-source-list":""};initCallback(){super.initCallback(),this.sub("--cfg-source-list",(e=>{if(!e)return;let t=e.split(",").map((e=>e.trim())),i="";t.forEach((e=>{i+=`<lr-source-btn type="${e}"></lr-source-btn>`})),this.getCssData("--cfg-source-list-wrap")?this.innerHTML=i:this.outerHTML=i}))}},StartFrom:class extends we{historyTracked=!0;activityType="start-from";initCallback(){super.initCallback(),this.registerActivity(this.activityType)}},Tabs:Js,UploadCtxProvider:class extends Zt{},UploadDetails:Oi,UploadList:Ri,UploaderBlock:Zt,UrlSource:Li,Video:hr,connectBlocksFrom:async function(e,t=!1){return new Promise(((i,s)=>{if("object"!=typeof document)return void i(null);if("object"==typeof window&&window[fr])return void i(window[fr]);let r=document.createElement("script");r.type="module",r.src=e,r.onerror=()=>{s()},r.onload=()=>{let e=window[fr];t&&br(e),i(e)},document.head.appendChild(r)}))},registerBlocks:br});function yr(e,t,i){const s=e.slice();return s[2]=t[i],s}function vr(e){let t,i;return{c(){t=u("img"),l(t.src,i="https://ucarecdn.com/"+e[2].uuid+"/"+(e[2].cdnUrlModifiers||"")+"-/preview/-/scale_crop/400x400/")||m(t,"src",i),m(t,"width","200"),m(t,"alt","Uploadcare uploaded file")},m(e,i){h(e,t,i)},p(e,s){1&s&&!l(t.src,i="https://ucarecdn.com/"+e[2].uuid+"/"+(e[2].cdnUrlModifiers||"")+"-/preview/-/scale_crop/400x400/")&&m(t,"src",i)},d(e){e&&d(t)}}}function wr(t){let i,s,r,n,a,o,l,b=t[0],f=[];for(let e=0;e<b.length;e+=1)f[e]=vr(yr(t,b,e));return{c(){i=u("div"),s=u("lr-file-uploader-regular"),r=u("lr-data-output"),n=p(),a=u("div");for(let e=0;e<f.length;e+=1)f[e].c();g(r,"use-event",""),r.hidden=!0,g(r,"class","uploader-cfg svelte-5i7ef"),g(s,"class","uploader-cfg svelte-5i7ef"),g(s,"css-src","https://unpkg.com/@uploadcare/blocks@"+Ht+"/web/file-uploader-regular.min.css"),m(a,"class","output svelte-5i7ef"),m(i,"class","wrapper svelte-5i7ef")},m(e,d){h(e,i,d),c(i,s),c(s,r),c(i,n),c(i,a);for(let e=0;e<f.length;e+=1)f[e]&&f[e].m(a,null);var u,p,m,g;o||(u=r,p="lr-data-output",m=t[1],u.addEventListener(p,m,g),l=()=>u.removeEventListener(p,m,g),o=!0)},p(e,[t]){if(1&t){let i;for(b=e[0],i=0;i<b.length;i+=1){const s=yr(e,b,i);f[i]?f[i].p(s,t):(f[i]=vr(s),f[i].c(),f[i].m(a,null))}for(;i<f.length;i+=1)f[i].d(1);f.length=b.length}},i:e,o:e,d(e){e&&d(i),function(e,t){for(let i=0;i<e.length;i+=1)e[i]&&e[i].d(t)}(f,e),o=!1,l()}}}function Cr(e,t,i){br(_r);let s=[];return[s,function(e){const{data:t}=e.detail;i(0,s=t)}]}return new class extends R{constructor(e){super(),U(this,e,Cr,wr,n,{})}}({target:document.body})}();
//# sourceMappingURL=bundle.js.map

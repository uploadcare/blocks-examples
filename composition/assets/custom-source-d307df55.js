var Ya=Object.defineProperty;var Za=(i,s,e)=>s in i?Ya(i,s,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[s]=e;var p=(i,s,e)=>(Za(i,typeof s!="symbol"?s+"":s,e),e),gs=(i,s,e)=>{if(!s.has(i))throw TypeError("Cannot "+e)};var se=(i,s,e)=>(gs(i,s,"read from private field"),e?e.call(i):s.get(i)),ft=(i,s,e)=>{if(s.has(i))throw TypeError("Cannot add the same private member more than once");s instanceof WeakSet?s.add(i):s.set(i,e)},Jt=(i,s,e,t)=>(gs(i,s,"write to private field"),t?t.call(i,e):s.set(i,e),e);var $i=(i,s,e)=>(gs(i,s,"access private method"),e);(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))t(r);new MutationObserver(r=>{for(const n of r)if(n.type==="childList")for(const a of n.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&t(a)}).observe(document,{childList:!0,subtree:!0});function e(r){const n={};return r.integrity&&(n.integrity=r.integrity),r.referrerPolicy&&(n.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?n.credentials="include":r.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function t(r){if(r.ep)return;r.ep=!0;const n=e(r);fetch(r.href,n)}})();var Ja=Object.defineProperty,Qa=(i,s,e)=>s in i?Ja(i,s,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[s]=e,zs=(i,s,e)=>(Qa(i,typeof s!="symbol"?s+"":s,e),e);function eo(i){let s=e=>{var t;for(let r in e)((t=e[r])==null?void 0:t.constructor)===Object&&(e[r]=s(e[r]));return{...e}};return s(i)}var X=class{constructor(i){i.constructor===Object?this.store=eo(i):(this._storeIsProxy=!0,this.store=i),this.callbackMap=Object.create(null)}static warn(i,s){console.warn(`Symbiote Data: cannot ${i}. Prop name: `+s)}read(i){return!this._storeIsProxy&&!this.store.hasOwnProperty(i)?(X.warn("read",i),null):this.store[i]}has(i){return this._storeIsProxy?this.store[i]!==void 0:this.store.hasOwnProperty(i)}add(i,s,e=!1){!e&&Object.keys(this.store).includes(i)||(this.store[i]=s,this.notify(i))}pub(i,s){if(!this._storeIsProxy&&!this.store.hasOwnProperty(i)){X.warn("publish",i);return}this.store[i]=s,this.notify(i)}multiPub(i){for(let s in i)this.pub(s,i[s])}notify(i){this.callbackMap[i]&&this.callbackMap[i].forEach(s=>{s(this.store[i])})}sub(i,s,e=!0){return!this._storeIsProxy&&!this.store.hasOwnProperty(i)?(X.warn("subscribe",i),null):(this.callbackMap[i]||(this.callbackMap[i]=new Set),this.callbackMap[i].add(s),e&&s(this.store[i]),{remove:()=>{this.callbackMap[i].delete(s),this.callbackMap[i].size||delete this.callbackMap[i]},callback:s})}static registerCtx(i,s=Symbol()){let e=X.globalStore.get(s);return e?console.warn('State: context UID "'+s+'" already in use'):(e=new X(i),X.globalStore.set(s,e)),e}static deleteCtx(i){X.globalStore.delete(i)}static getCtx(i,s=!0){return X.globalStore.get(i)||(s&&console.warn('State: wrong context UID - "'+i+'"'),null)}};X.globalStore=new Map;var B=Object.freeze({BIND_ATTR:"set",ATTR_BIND_PRFX:"@",EXT_DATA_CTX_PRFX:"*",NAMED_DATA_CTX_SPLTR:"/",CTX_NAME_ATTR:"ctx-name",CTX_OWNER_ATTR:"ctx-owner",CSS_CTX_PROP:"--ctx-name",EL_REF_ATTR:"ref",AUTO_TAG_PRFX:"sym",REPEAT_ATTR:"repeat",REPEAT_ITEM_TAG_ATTR:"repeat-item-tag",SET_LATER_KEY:"__toSetLater__",USE_TPL:"use-template",ROOT_STYLE_ATTR_NAME:"sym-component"}),on="1234567890QWERTYUIOPASDFGHJKLZXCVBNMqwertyuiopasdfghjklzxcvbnm",to=on.length-1,Hs=class{static generate(i="XXXXXXXXX-XXX"){let s="";for(let e=0;e<i.length;e++)s+=i[e]==="-"?i[e]:on.charAt(Math.random()*to);return s}};function ln(i,s,e){let t=!0,r,n=s.split(".");return n.forEach((a,o)=>{o<n.length-1?i=i[a]:r=a}),i?i[r]=e:t=!1,t}function io(i){return i.split("-").map((s,e)=>s&&e?s[0].toUpperCase()+s.slice(1):s).join("").split("_").map((s,e)=>s&&e?s.toUpperCase():s).join("")}function so(i,s){[...i.querySelectorAll(`[${B.REPEAT_ATTR}]`)].forEach(e=>{let t=e.getAttribute(B.REPEAT_ITEM_TAG_ATTR),r;if(t&&(r=window.customElements.get(t)),!r){r=class extends s.BaseComponent{constructor(){super(),t||(this.style.display="contents")}};let a=e.innerHTML;r.template=a,r.reg(t)}for(;e.firstChild;)e.firstChild.remove();let n=e.getAttribute(B.REPEAT_ATTR);s.sub(n,a=>{if(!a){for(;e.firstChild;)e.firstChild.remove();return}let o=[...e.children],l,c=u=>{u.forEach((h,m)=>{if(o[m])if(o[m].set$)setTimeout(()=>{o[m].set$(h)});else for(let f in h)o[m][f]=h[f];else{l||(l=new DocumentFragment);let f=new r;Object.assign(f.init$,h),l.appendChild(f)}}),l&&e.appendChild(l);let d=o.slice(u.length,o.length);for(let h of d)h.remove()};if(a.constructor===Array)c(a);else if(a.constructor===Object){let u=[];for(let d in a){let h=a[d];Object.defineProperty(h,"_KEY_",{value:d,enumerable:!0}),u.push(h)}c(u)}else console.warn("Symbiote repeat data type error:"),console.log(a)}),e.removeAttribute(B.REPEAT_ATTR),e.removeAttribute(B.REPEAT_ITEM_TAG_ATTR)})}var Tr="__default__";function ro(i,s){if(s.shadowRoot)return;let e=[...i.querySelectorAll("slot")];if(!e.length)return;let t={};e.forEach(r=>{let n=r.getAttribute("name")||Tr;t[n]={slot:r,fr:document.createDocumentFragment()}}),s.initChildren.forEach(r=>{var n;let a=Tr;r instanceof Element&&r.hasAttribute("slot")&&(a=r.getAttribute("slot"),r.removeAttribute("slot")),(n=t[a])==null||n.fr.appendChild(r)}),Object.values(t).forEach(r=>{if(r.fr.childNodes.length)r.slot.parentNode.replaceChild(r.fr,r.slot);else if(r.slot.childNodes.length){let n=document.createDocumentFragment();n.append(...r.slot.childNodes),r.slot.parentNode.replaceChild(n,r.slot)}else r.slot.remove()})}function no(i,s){[...i.querySelectorAll(`[${B.EL_REF_ATTR}]`)].forEach(e=>{let t=e.getAttribute(B.EL_REF_ATTR);s.ref[t]=e,e.removeAttribute(B.EL_REF_ATTR)})}function ao(i,s){[...i.querySelectorAll(`[${B.BIND_ATTR}]`)].forEach(e=>{let r=e.getAttribute(B.BIND_ATTR).split(";");[...e.attributes].forEach(n=>{if(n.name.startsWith("-")&&n.value){let a=io(n.name.replace("-",""));r.push(a+":"+n.value),e.removeAttribute(n.name)}}),r.forEach(n=>{if(!n)return;let a=n.split(":").map(u=>u.trim()),o=a[0],l;o.indexOf(B.ATTR_BIND_PRFX)===0&&(l=!0,o=o.replace(B.ATTR_BIND_PRFX,""));let c=a[1].split(",").map(u=>u.trim());for(let u of c){let d;u.startsWith("!!")?(d="double",u=u.replace("!!","")):u.startsWith("!")&&(d="single",u=u.replace("!","")),s.sub(u,h=>{d==="double"?h=!!h:d==="single"&&(h=!h),l?(h==null?void 0:h.constructor)===Boolean?h?e.setAttribute(o,""):e.removeAttribute(o):e.setAttribute(o,h):ln(e,o,h)||(e[B.SET_LATER_KEY]||(e[B.SET_LATER_KEY]=Object.create(null)),e[B.SET_LATER_KEY][o]=h)})}}),e.removeAttribute(B.BIND_ATTR)})}var Ri="{{",si="}}",oo="skip-text";function lo(i){let s,e=[],t=document.createTreeWalker(i,NodeFilter.SHOW_TEXT,{acceptNode:r=>{var n;return!((n=r.parentElement)!=null&&n.hasAttribute(oo))&&r.textContent.includes(Ri)&&r.textContent.includes(si)&&1}});for(;s=t.nextNode();)e.push(s);return e}var co=function(i,s){lo(i).forEach(t=>{let r=[],n;for(;t.textContent.includes(si);)t.textContent.startsWith(Ri)?(n=t.textContent.indexOf(si)+si.length,t.splitText(n),r.push(t)):(n=t.textContent.indexOf(Ri),t.splitText(n)),t=t.nextSibling;r.forEach(a=>{let o=a.textContent.replace(Ri,"").replace(si,"");a.textContent="",s.sub(o,l=>{a.textContent=l})})})},uo=[so,ro,no,ao,co],Bi="'",Bt='"',ho=/\\([0-9a-fA-F]{1,6} ?)/g;function fo(i){return(i[0]===Bt||i[0]===Bi)&&(i[i.length-1]===Bt||i[i.length-1]===Bi)}function po(i){return(i[0]===Bt||i[0]===Bi)&&(i=i.slice(1)),(i[i.length-1]===Bt||i[i.length-1]===Bi)&&(i=i.slice(0,-1)),i}function mo(i){let s="",e="";for(var t=0;t<i.length;t++){const r=i[t+1];i[t]==="\\"&&r==='"'?(s+='\\"',t++):i[t]==='"'&&e!=="\\"?s+='\\"':s+=i[t],e=i[t]}return s}function go(i){let s=i;fo(i)&&(s=po(s),s=s.replace(ho,(e,t)=>String.fromCodePoint(parseInt(t.trim(),16))),s=s.replaceAll(`\\
`,"\\n"),s=mo(s),s=Bt+s+Bt);try{return JSON.parse(s)}catch{throw new Error(`Failed to parse CSS property value: ${s}. Original input: ${i}`)}}var Ar=0,xt=null,Ve=null,Je=class extends HTMLElement{constructor(){super(),zs(this,"updateCssData",()=>{var i;this.dropCssDataCache(),(i=this.__boundCssProps)==null||i.forEach(s=>{let e=this.getCssData(this.__extractCssName(s),!0);e!==null&&this.$[s]!==e&&(this.$[s]=e)})}),this.init$=Object.create(null),this.cssInit$=Object.create(null),this.tplProcessors=new Set,this.ref=Object.create(null),this.allSubs=new Set,this.pauseRender=!1,this.renderShadow=!1,this.readyToDestroy=!0,this.processInnerHtml=!1,this.allowCustomTemplate=!1,this.ctxOwner=!1}get BaseComponent(){return Je}initCallback(){}__initCallback(){var i;this.__initialized||(this.__initialized=!0,(i=this.initCallback)==null||i.call(this))}render(i,s=this.renderShadow){let e;if((s||this.constructor.__shadowStylesUrl)&&!this.shadowRoot&&this.attachShadow({mode:"open"}),this.allowCustomTemplate){let r=this.getAttribute(B.USE_TPL);if(r){let n=this.getRootNode(),a=(n==null?void 0:n.querySelector(r))||document.querySelector(r);a?i=a.content.cloneNode(!0):console.warn(`Symbiote template "${r}" is not found...`)}}if(this.processInnerHtml)for(let r of this.tplProcessors)r(this,this);if(i||this.constructor.template){if(this.constructor.template&&!this.constructor.__tpl&&(this.constructor.__tpl=document.createElement("template"),this.constructor.__tpl.innerHTML=this.constructor.template),(i==null?void 0:i.constructor)===DocumentFragment)e=i;else if((i==null?void 0:i.constructor)===String){let r=document.createElement("template");r.innerHTML=i,e=r.content.cloneNode(!0)}else this.constructor.__tpl&&(e=this.constructor.__tpl.content.cloneNode(!0));for(let r of this.tplProcessors)r(e,this)}let t=()=>{e&&(s&&this.shadowRoot.appendChild(e)||this.appendChild(e)),this.__initCallback()};if(this.constructor.__shadowStylesUrl){s=!0;let r=document.createElement("link");r.rel="stylesheet",r.href=this.constructor.__shadowStylesUrl,r.onload=t,this.shadowRoot.prepend(r)}else t()}addTemplateProcessor(i){this.tplProcessors.add(i)}get autoCtxName(){return this.__autoCtxName||(this.__autoCtxName=Hs.generate(),this.style.setProperty(B.CSS_CTX_PROP,`'${this.__autoCtxName}'`)),this.__autoCtxName}get cssCtxName(){return this.getCssData(B.CSS_CTX_PROP,!0)}get ctxName(){var i;let s=((i=this.getAttribute(B.CTX_NAME_ATTR))==null?void 0:i.trim())||this.cssCtxName||this.__cachedCtxName||this.autoCtxName;return this.__cachedCtxName=s,s}get localCtx(){return this.__localCtx||(this.__localCtx=X.registerCtx({},this)),this.__localCtx}get nodeCtx(){return X.getCtx(this.ctxName,!1)||X.registerCtx({},this.ctxName)}static __parseProp(i,s){let e,t;if(i.startsWith(B.EXT_DATA_CTX_PRFX))e=s.nodeCtx,t=i.replace(B.EXT_DATA_CTX_PRFX,"");else if(i.includes(B.NAMED_DATA_CTX_SPLTR)){let r=i.split(B.NAMED_DATA_CTX_SPLTR);e=X.getCtx(r[0]),t=r[1]}else e=s.localCtx,t=i;return{ctx:e,name:t}}sub(i,s,e=!0){let t=n=>{this.isConnected&&s(n)},r=Je.__parseProp(i,this);r.ctx.has(r.name)?this.allSubs.add(r.ctx.sub(r.name,t,e)):window.setTimeout(()=>{this.allSubs.add(r.ctx.sub(r.name,t,e))})}notify(i){let s=Je.__parseProp(i,this);s.ctx.notify(s.name)}has(i){let s=Je.__parseProp(i,this);return s.ctx.has(s.name)}add(i,s,e=!1){let t=Je.__parseProp(i,this);t.ctx.add(t.name,s,e)}add$(i,s=!1){for(let e in i)this.add(e,i[e],s)}get $(){if(!this.__stateProxy){let i=Object.create(null);this.__stateProxy=new Proxy(i,{set:(s,e,t)=>{let r=Je.__parseProp(e,this);return r.ctx.pub(r.name,t),!0},get:(s,e)=>{let t=Je.__parseProp(e,this);return t.ctx.read(t.name)}})}return this.__stateProxy}set$(i,s=!1){for(let e in i){let t=i[e];s||![String,Number,Boolean].includes(t==null?void 0:t.constructor)?this.$[e]=t:this.$[e]!==t&&(this.$[e]=t)}}get __ctxOwner(){return this.ctxOwner||this.hasAttribute(B.CTX_OWNER_ATTR)&&this.getAttribute(B.CTX_OWNER_ATTR)!=="false"}__initDataCtx(){let i=this.constructor.__attrDesc;if(i)for(let s of Object.values(i))Object.keys(this.init$).includes(s)||(this.init$[s]="");for(let s in this.init$)if(s.startsWith(B.EXT_DATA_CTX_PRFX))this.nodeCtx.add(s.replace(B.EXT_DATA_CTX_PRFX,""),this.init$[s],this.__ctxOwner);else if(s.includes(B.NAMED_DATA_CTX_SPLTR)){let e=s.split(B.NAMED_DATA_CTX_SPLTR),t=e[0].trim(),r=e[1].trim();if(t&&r){let n=X.getCtx(t,!1);n||(n=X.registerCtx({},t)),n.add(r,this.init$[s])}}else this.localCtx.add(s,this.init$[s]);for(let s in this.cssInit$)this.bindCssData(s,this.cssInit$[s]);this.__dataCtxInitialized=!0}connectedCallback(){var i;if(this.isConnected){if(this.__disconnectTimeout&&window.clearTimeout(this.__disconnectTimeout),!this.connectedOnce){let s=(i=this.getAttribute(B.CTX_NAME_ATTR))==null?void 0:i.trim();if(s&&this.style.setProperty(B.CSS_CTX_PROP,`'${s}'`),this.__initDataCtx(),this[B.SET_LATER_KEY]){for(let e in this[B.SET_LATER_KEY])ln(this,e,this[B.SET_LATER_KEY][e]);delete this[B.SET_LATER_KEY]}this.initChildren=[...this.childNodes];for(let e of uo)this.addTemplateProcessor(e);if(this.pauseRender)this.__initCallback();else if(this.constructor.__rootStylesLink){let e=this.getRootNode();if(!e)return;if(e==null?void 0:e.querySelector(`link[${B.ROOT_STYLE_ATTR_NAME}="${this.constructor.is}"]`)){this.render();return}let r=this.constructor.__rootStylesLink.cloneNode(!0);r.setAttribute(B.ROOT_STYLE_ATTR_NAME,this.constructor.is),r.onload=()=>{this.render()},e.nodeType===Node.DOCUMENT_NODE?e.head.appendChild(r):e.prepend(r)}else this.render()}this.connectedOnce=!0}}destroyCallback(){}disconnectedCallback(){this.connectedOnce&&(this.dropCssDataCache(),this.readyToDestroy&&(this.__disconnectTimeout&&window.clearTimeout(this.__disconnectTimeout),this.__disconnectTimeout=window.setTimeout(()=>{this.destroyCallback();for(let i of this.allSubs)i.remove(),this.allSubs.delete(i);for(let i of this.tplProcessors)this.tplProcessors.delete(i);Ve==null||Ve.delete(this.updateCssData),Ve!=null&&Ve.size||(xt==null||xt.disconnect(),xt=null,Ve=null)},100)))}static reg(i,s=!1){i||(Ar++,i=`${B.AUTO_TAG_PRFX}-${Ar}`),this.__tag=i;let e=window.customElements.get(i);if(e){!s&&e!==this&&console.warn([`Element with tag name "${i}" already registered.`,`You're trying to override it with another class "${this.name}".`,"This is most likely a mistake.","New element will not be registered."].join(`
`));return}window.customElements.define(i,s?class extends this{}:this)}static get is(){return this.__tag||this.reg(),this.__tag}static bindAttributes(i){this.observedAttributes=Object.keys(i),this.__attrDesc=i}attributeChangedCallback(i,s,e){var t;if(s===e)return;let r=(t=this.constructor.__attrDesc)==null?void 0:t[i];r?this.__dataCtxInitialized?this.$[r]=e:this.init$[r]=e:this[i]=e}getCssData(i,s=!1){if(this.__cssDataCache||(this.__cssDataCache=Object.create(null)),!Object.keys(this.__cssDataCache).includes(i)){this.__computedStyle||(this.__computedStyle=window.getComputedStyle(this));let e=this.__computedStyle.getPropertyValue(i).trim();try{this.__cssDataCache[i]=go(e)}catch{!s&&console.warn(`CSS Data error: ${i}`),this.__cssDataCache[i]=null}}return this.__cssDataCache[i]}__extractCssName(i){return i.split("--").map((s,e)=>e===0?"":s).join("--")}__initStyleAttrObserver(){Ve||(Ve=new Set),Ve.add(this.updateCssData),xt||(xt=new MutationObserver(i=>{i[0].type==="attributes"&&Ve.forEach(s=>{s()})}),xt.observe(document,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["style"]}))}bindCssData(i,s=""){this.__boundCssProps||(this.__boundCssProps=new Set),this.__boundCssProps.add(i);let e=this.getCssData(this.__extractCssName(i),!0);e===null&&(e=s),this.add(i,e),this.__initStyleAttrObserver()}dropCssDataCache(){this.__cssDataCache=null,this.__computedStyle=null}defineAccessor(i,s,e){let t="__"+i;this[t]=this[i],Object.defineProperty(this,i,{set:r=>{this[t]=r,e?window.setTimeout(()=>{s==null||s(r)}):s==null||s(r)},get:()=>this[t]}),this[i]=this[t]}static set shadowStyles(i){let s=new Blob([i],{type:"text/css"});this.__shadowStylesUrl=URL.createObjectURL(s)}static set rootStyles(i){if(!this.__rootStylesLink){let s=new Blob([i],{type:"text/css"}),e=URL.createObjectURL(s),t=document.createElement("link");t.href=e,t.rel="stylesheet",this.__rootStylesLink=t}}},Yi=Je;zs(Yi,"template");function vo(i,s){for(let e in s)e.includes("-")?i.style.setProperty(e,s[e]):i.style[e]=s[e]}function _o(i,s){for(let e in s)s[e].constructor===Boolean?s[e]?i.setAttribute(e,""):i.removeAttribute(e):i.setAttribute(e,s[e])}function js(i={tag:"div"}){let s=document.createElement(i.tag);if(i.attributes&&_o(s,i.attributes),i.styles&&vo(s,i.styles),i.properties)for(let e in i.properties)s[e]=i.properties[e];return i.processors&&i.processors.forEach(e=>{e(s)}),i.children&&i.children.forEach(e=>{let t=js(e);s.appendChild(t)}),s}var cn="idb-store-ready",bo="symbiote-db",yo="symbiote-idb-update_",Eo=class{_notifyWhenReady(i=null){window.dispatchEvent(new CustomEvent(cn,{detail:{dbName:this.name,storeName:this.storeName,event:i}}))}get _updEventName(){return yo+this.name}_getUpdateEvent(i){return new CustomEvent(this._updEventName,{detail:{key:this.name,newValue:i}})}_notifySubscribers(i){window.localStorage.removeItem(this.name),window.localStorage.setItem(this.name,i),window.dispatchEvent(this._getUpdateEvent(i))}constructor(i,s){this.name=i,this.storeName=s,this.version=1,this.request=window.indexedDB.open(this.name,this.version),this.request.onupgradeneeded=e=>{this.db=e.target.result,this.objStore=this.db.createObjectStore(s,{keyPath:"_key"}),this.objStore.transaction.oncomplete=t=>{this._notifyWhenReady(t)}},this.request.onsuccess=e=>{this.db=e.target.result,this._notifyWhenReady(e)},this.request.onerror=e=>{console.error(e)},this._subscriptionsMap={},this._updateHandler=e=>{e.key===this.name&&this._subscriptionsMap[e.newValue]&&this._subscriptionsMap[e.newValue].forEach(async r=>{r(await this.read(e.newValue))})},this._localUpdateHandler=e=>{this._updateHandler(e.detail)},window.addEventListener("storage",this._updateHandler),window.addEventListener(this._updEventName,this._localUpdateHandler)}read(i){let e=this.db.transaction(this.storeName,"readwrite").objectStore(this.storeName).get(i);return new Promise((t,r)=>{e.onsuccess=n=>{var a;(a=n.target.result)!=null&&a._value?t(n.target.result._value):(t(null),console.warn(`IDB: cannot read "${i}"`))},e.onerror=n=>{r(n)}})}write(i,s,e=!1){let t={_key:i,_value:s},n=this.db.transaction(this.storeName,"readwrite").objectStore(this.storeName).put(t);return new Promise((a,o)=>{n.onsuccess=l=>{e||this._notifySubscribers(i),a(l.target.result)},n.onerror=l=>{o(l)}})}delete(i,s=!1){let t=this.db.transaction(this.storeName,"readwrite").objectStore(this.storeName).delete(i);return new Promise((r,n)=>{t.onsuccess=a=>{s||this._notifySubscribers(i),r(a)},t.onerror=a=>{n(a)}})}getAll(){let s=this.db.transaction(this.storeName,"readwrite").objectStore(this.storeName).getAll();return new Promise((e,t)=>{s.onsuccess=r=>{let n=r.target.result;e(n.map(a=>a._value))},s.onerror=r=>{t(r)}})}subscribe(i,s){this._subscriptionsMap[i]||(this._subscriptionsMap[i]=new Set);let e=this._subscriptionsMap[i];return e.add(s),{remove:()=>{e.delete(s),e.size||delete this._subscriptionsMap[i]}}}stop(){window.removeEventListener("storage",this._updateHandler),this._subscriptionsMap=null,un.clear(this.name)}},un=class{static get readyEventName(){return cn}static open(i=bo,s="store"){let e=i+"/"+s;return this._reg[e]||(this._reg[e]=new Eo(i,s)),this._reg[e]}static clear(i){window.indexedDB.deleteDatabase(i);for(let s in this._reg)s.split("/")[0]===i&&delete this._reg[s]}};zs(un,"_reg",Object.create(null));function Ct(i,s){let e,t=(...r)=>{clearTimeout(e),e=setTimeout(()=>i(...r),s)};return t.cancel=()=>{clearTimeout(e)},t}const Co="--uploadcare-blocks-window-height",zi="__UPLOADCARE_BLOCKS_WINDOW_HEIGHT_TRACKER_ENABLED__";function dn(){return typeof window[zi]>"u"?!1:!!window[zi]}function wo(){if(dn())return;const i=()=>{document.documentElement.style.setProperty(Co,`${window.innerHeight}px`),window[zi]=!0},s=Ct(i,100);return window.addEventListener("resize",s,{passive:!0}),i(),()=>{window[zi]=!1,window.removeEventListener("resize",s)}}const To=i=>i,Ss="{{",hn="}}",Sr="plural:";function xs(i,s,e={}){var a;let{openToken:t=Ss,closeToken:r=hn,transform:n=To}=e;for(let o in s){let l=(a=s[o])==null?void 0:a.toString();i=i.replaceAll(t+o+r,typeof l=="string"?n(l):l)}return i}function Ao(i){const s=[];let e=i.indexOf(Ss);for(;e!==-1;){const t=i.indexOf(hn,e),r=i.substring(e+2,t);if(r.startsWith(Sr)){const n=i.substring(e+2,t).replace(Sr,""),a=n.substring(0,n.indexOf("(")),o=n.substring(n.indexOf("(")+1,n.indexOf(")"));s.push({variable:r,pluralKey:a,countVariable:o})}e=i.indexOf(Ss,t)}return s}function xr(i){return Object.prototype.toString.call(i)==="[object Object]"}const So=/\W|_/g;function xo(i){return i.split(So).map((s,e)=>s.charAt(0)[e>0?"toUpperCase":"toLowerCase"]()+s.slice(1)).join("")}function $r(i,{ignoreKeys:s}={ignoreKeys:[]}){return Array.isArray(i)?i.map(e=>Ye(e,{ignoreKeys:s})):i}function Ye(i,{ignoreKeys:s}={ignoreKeys:[]}){if(Array.isArray(i))return $r(i,{ignoreKeys:s});if(!xr(i))return i;const e={};for(const t of Object.keys(i)){let r=i[t];if(s.includes(t)){e[t]=r;continue}xr(r)?r=Ye(r,{ignoreKeys:s}):Array.isArray(r)&&(r=$r(r,{ignoreKeys:s})),e[xo(t)]=r}return e}const $o=i=>new Promise(s=>setTimeout(s,i));function fn({libraryName:i,libraryVersion:s,userAgent:e,publicKey:t="",integration:r=""}){const n="JavaScript";if(typeof e=="string")return e;if(typeof e=="function")return e({publicKey:t,libraryName:i,libraryVersion:s,languageName:n,integration:r});const a=[i,s,t].filter(Boolean).join("/"),o=[n,r].filter(Boolean).join("; ");return`${a} (${o})`}const Io={factor:2,time:100};function ko(i,s=Io){let e=0;function t(r){const n=Math.round(s.time*s.factor**e);return r({attempt:e,retry:o=>$o(o??n).then(()=>(e+=1,t(r)))})}return t(i)}class Zi extends Error{constructor(e){super();p(this,"originalProgressEvent");this.name="UploadcareNetworkError",this.message="Network error",Object.setPrototypeOf(this,Zi.prototype),this.originalProgressEvent=e}}const Ji=(i,s)=>{i&&(i.aborted?Promise.resolve().then(s):i.addEventListener("abort",()=>s(),{once:!0}))};class zt extends Error{constructor(e="Request canceled"){super(e);p(this,"isCancel",!0);Object.setPrototypeOf(this,zt.prototype)}}const Oo=500,pn=({check:i,interval:s=Oo,timeout:e,signal:t})=>new Promise((r,n)=>{let a,o;Ji(t,()=>{a&&clearTimeout(a),n(new zt("Poll cancelled"))}),e&&(o=setTimeout(()=>{a&&clearTimeout(a),n(new zt("Timed out"))},e));const l=()=>{try{Promise.resolve(i(t)).then(c=>{c?(o&&clearTimeout(o),r(c)):a=setTimeout(l,s)}).catch(c=>{o&&clearTimeout(o),n(c)})}catch(c){o&&clearTimeout(o),n(c)}};a=setTimeout(l,0)}),z={baseCDN:"https://ucarecdn.com",baseURL:"https://upload.uploadcare.com",maxContentLength:50*1024*1024,retryThrottledRequestMaxTimes:1,retryNetworkErrorMaxTimes:3,multipartMinFileSize:25*1024*1024,multipartChunkSize:5*1024*1024,multipartMinLastPartSize:1024*1024,maxConcurrentRequests:4,pollingTimeoutMilliseconds:1e4,pusherKey:"79ae88bd931ea68464d9"},Qi="application/octet-stream",mn="original",ot=({method:i,url:s,data:e,headers:t={},signal:r,onProgress:n})=>new Promise((a,o)=>{const l=new XMLHttpRequest,c=(i==null?void 0:i.toUpperCase())||"GET";let u=!1;l.open(c,s,!0),t&&Object.entries(t).forEach(d=>{const[h,m]=d;typeof m<"u"&&!Array.isArray(m)&&l.setRequestHeader(h,m)}),l.responseType="text",Ji(r,()=>{u=!0,l.abort(),o(new zt)}),l.onload=()=>{if(l.status!=200)o(new Error(`Error ${l.status}: ${l.statusText}`));else{const d={method:c,url:s,data:e,headers:t||void 0,signal:r,onProgress:n},h=l.getAllResponseHeaders().trim().split(/[\r\n]+/),m={};h.forEach(function(b){const y=b.split(": "),_=y.shift(),v=y.join(": ");_&&typeof _<"u"&&(m[_]=v)});const f=l.response,g=l.status;a({request:d,data:f,headers:m,status:g})}},l.onerror=d=>{u||o(new Zi(d))},n&&typeof n=="function"&&(l.upload.onprogress=d=>{d.lengthComputable?n({isComputable:!0,value:d.loaded/d.total}):n({isComputable:!1})}),e?l.send(e):l.send()});function Lo(i,...s){return i}const Ro=({name:i})=>i?[i]:[],Po=Lo;var Uo=()=>new FormData;const gn=i=>!1,es=i=>typeof Blob<"u"&&i instanceof Blob,ts=i=>typeof File<"u"&&i instanceof File,is=i=>!!i&&typeof i=="object"&&!Array.isArray(i)&&"uri"in i&&typeof i.uri=="string",vi=i=>es(i)||ts(i)||gn()||is(i),No=i=>typeof i=="string"||typeof i=="number"||typeof i>"u",Do=i=>!!i&&typeof i=="object"&&!Array.isArray(i),Mo=i=>!!i&&typeof i=="object"&&"data"in i&&vi(i.data);function Fo(i,s,e){if(Mo(e)){const{name:t,contentType:r}=e,n=Po(e.data,t,r??Qi),a=Ro({name:t,contentType:r});i.push([s,n,...a])}else if(Do(e))for(const[t,r]of Object.entries(e))typeof r<"u"&&i.push([`${s}[${t}]`,String(r)]);else No(e)&&e&&i.push([s,e.toString()])}function Vo(i){const s=[];for(const[e,t]of Object.entries(i))Fo(s,e,t);return s}function Ws(i){const s=Uo(),e=Vo(i);for(const t of e){const[r,n,...a]=t;s.append(r,n,...a)}return s}class pe extends Error{constructor(e,t,r,n,a){super();p(this,"isCancel");p(this,"code");p(this,"request");p(this,"response");p(this,"headers");this.name="UploadClientError",this.message=e,this.code=t,this.request=r,this.response=n,this.headers=a,Object.setPrototypeOf(this,pe.prototype)}}const Bo=i=>{const s=new URLSearchParams;for(const[e,t]of Object.entries(i))t&&typeof t=="object"&&!Array.isArray(t)?Object.entries(t).filter(r=>r[1]??!1).forEach(r=>s.set(`${e}[${r[0]}]`,String(r[1]))):Array.isArray(t)?t.forEach(r=>{s.append(`${e}[]`,r)}):typeof t=="string"&&t?s.set(e,t):typeof t=="number"&&s.set(e,t.toString());return s.toString()},Xe=(i,s,e)=>{const t=new URL(i);return t.pathname=(t.pathname+s).replace("//","/"),e&&(t.search=Bo(e)),t.toString()};var zo="6.6.1";const Ho="UploadcareUploadClient",jo=zo;function At(i){return fn({libraryName:Ho,libraryVersion:jo,...i})}const Wo="RequestThrottledError",Ir=15e3,Go=1e3;function Xo(i){const{headers:s}=i||{};if(!s||typeof s["retry-after"]!="string")return Ir;const e=parseInt(s["retry-after"],10);return Number.isFinite(e)?e*1e3:Ir}function lt(i,s){const{retryThrottledRequestMaxTimes:e,retryNetworkErrorMaxTimes:t}=s;return ko(({attempt:r,retry:n})=>i().catch(a=>{if("response"in a&&(a==null?void 0:a.code)===Wo&&r<e)return n(Xo(a));if(a instanceof Zi&&r<t)return n((r+1)*Go);throw a}))}const vn=i=>{let s="";return(es(i)||ts(i)||is(i))&&(s=i.type),s||Qi},_n=i=>{let s="";return ts(i)&&i.name?s=i.name:es(i)||gn()?s="":is(i)&&i.name&&(s=i.name),s||mn};function Gs(i){return typeof i>"u"||i==="auto"?"auto":i?"1":"0"}function qo(i,{publicKey:s,fileName:e,contentType:t,baseURL:r=z.baseURL,secureSignature:n,secureExpire:a,store:o,signal:l,onProgress:c,source:u="local",integration:d,userAgent:h,retryThrottledRequestMaxTimes:m=z.retryThrottledRequestMaxTimes,retryNetworkErrorMaxTimes:f=z.retryNetworkErrorMaxTimes,metadata:g}){return lt(()=>ot({method:"POST",url:Xe(r,"/base/",{jsonerrors:1}),headers:{"X-UC-User-Agent":At({publicKey:s,integration:d,userAgent:h})},data:Ws({file:{data:i,name:e||_n(i),contentType:t||vn(i)},UPLOADCARE_PUB_KEY:s,UPLOADCARE_STORE:Gs(o),signature:n,expire:a,source:u,metadata:g}),signal:l,onProgress:c}).then(({data:b,headers:y,request:_})=>{const v=Ye(JSON.parse(b));if("error"in v)throw new pe(v.error.content,v.error.errorCode,_,v,y);return v}),{retryNetworkErrorMaxTimes:f,retryThrottledRequestMaxTimes:m})}var $s;(function(i){i.Token="token",i.FileInfo="file_info"})($s||($s={}));function Ko(i,{publicKey:s,baseURL:e=z.baseURL,store:t,fileName:r,checkForUrlDuplicates:n,saveUrlForRecurrentUploads:a,secureSignature:o,secureExpire:l,source:c="url",signal:u,integration:d,userAgent:h,retryThrottledRequestMaxTimes:m=z.retryThrottledRequestMaxTimes,retryNetworkErrorMaxTimes:f=z.retryNetworkErrorMaxTimes,metadata:g}){return lt(()=>ot({method:"POST",headers:{"X-UC-User-Agent":At({publicKey:s,integration:d,userAgent:h})},url:Xe(e,"/from_url/",{jsonerrors:1,pub_key:s,source_url:i,store:Gs(t),filename:r,check_URL_duplicates:n?1:void 0,save_URL_duplicates:a?1:void 0,signature:o,expire:l,source:c,metadata:g}),signal:u}).then(({data:b,headers:y,request:_})=>{const v=Ye(JSON.parse(b));if("error"in v)throw new pe(v.error.content,v.error.errorCode,_,v,y);return v}),{retryNetworkErrorMaxTimes:f,retryThrottledRequestMaxTimes:m})}var de;(function(i){i.Unknown="unknown",i.Waiting="waiting",i.Progress="progress",i.Error="error",i.Success="success"})(de||(de={}));const Yo=i=>"status"in i&&i.status===de.Error;function Zo(i,{publicKey:s,baseURL:e=z.baseURL,signal:t,integration:r,userAgent:n,retryThrottledRequestMaxTimes:a=z.retryThrottledRequestMaxTimes,retryNetworkErrorMaxTimes:o=z.retryNetworkErrorMaxTimes}={}){return lt(()=>ot({method:"GET",headers:s?{"X-UC-User-Agent":At({publicKey:s,integration:r,userAgent:n})}:void 0,url:Xe(e,"/from_url/status/",{jsonerrors:1,token:i}),signal:t}).then(({data:l,headers:c,request:u})=>{const d=Ye(JSON.parse(l));if("error"in d&&!Yo(d))throw new pe(d.error.content,void 0,u,d,c);return d}),{retryNetworkErrorMaxTimes:o,retryThrottledRequestMaxTimes:a})}function Jo(i,{publicKey:s,baseURL:e=z.baseURL,jsonpCallback:t,secureSignature:r,secureExpire:n,signal:a,source:o,integration:l,userAgent:c,retryThrottledRequestMaxTimes:u=z.retryThrottledRequestMaxTimes,retryNetworkErrorMaxTimes:d=z.retryNetworkErrorMaxTimes}){return lt(()=>ot({method:"POST",headers:{"X-UC-User-Agent":At({publicKey:s,integration:l,userAgent:c})},url:Xe(e,"/group/",{jsonerrors:1,pub_key:s,files:i,callback:t,signature:r,expire:n,source:o}),signal:a}).then(({data:h,headers:m,request:f})=>{const g=Ye(JSON.parse(h));if("error"in g)throw new pe(g.error.content,g.error.errorCode,f,g,m);return g}),{retryNetworkErrorMaxTimes:d,retryThrottledRequestMaxTimes:u})}function bn(i,{publicKey:s,baseURL:e=z.baseURL,signal:t,source:r,integration:n,userAgent:a,retryThrottledRequestMaxTimes:o=z.retryThrottledRequestMaxTimes,retryNetworkErrorMaxTimes:l=z.retryNetworkErrorMaxTimes}){return lt(()=>ot({method:"GET",headers:{"X-UC-User-Agent":At({publicKey:s,integration:n,userAgent:a})},url:Xe(e,"/info/",{jsonerrors:1,pub_key:s,file_id:i,source:r}),signal:t}).then(({data:c,headers:u,request:d})=>{const h=Ye(JSON.parse(c));if("error"in h)throw new pe(h.error.content,h.error.errorCode,d,h,u);return h}),{retryThrottledRequestMaxTimes:o,retryNetworkErrorMaxTimes:l})}function Qo(i,{publicKey:s,contentType:e,fileName:t,multipartChunkSize:r=z.multipartChunkSize,baseURL:n="",secureSignature:a,secureExpire:o,store:l,signal:c,source:u="local",integration:d,userAgent:h,retryThrottledRequestMaxTimes:m=z.retryThrottledRequestMaxTimes,retryNetworkErrorMaxTimes:f=z.retryNetworkErrorMaxTimes,metadata:g}){return lt(()=>ot({method:"POST",url:Xe(n,"/multipart/start/",{jsonerrors:1}),headers:{"X-UC-User-Agent":At({publicKey:s,integration:d,userAgent:h})},data:Ws({filename:t||mn,size:i,content_type:e||Qi,part_size:r,UPLOADCARE_STORE:Gs(l),UPLOADCARE_PUB_KEY:s,signature:a,expire:o,source:u,metadata:g}),signal:c}).then(({data:b,headers:y,request:_})=>{const v=Ye(JSON.parse(b));if("error"in v)throw new pe(v.error.content,v.error.errorCode,_,v,y);return v.parts=Object.keys(v.parts).map(O=>v.parts[O]),v}),{retryThrottledRequestMaxTimes:m,retryNetworkErrorMaxTimes:f})}function el(i,s,{contentType:e,signal:t,onProgress:r,retryThrottledRequestMaxTimes:n=z.retryThrottledRequestMaxTimes,retryNetworkErrorMaxTimes:a=z.retryNetworkErrorMaxTimes}){return lt(()=>ot({method:"PUT",url:s,data:i,onProgress:r,signal:t,headers:{"Content-Type":e||Qi}}).then(o=>(r&&r({isComputable:!0,value:1}),o)).then(({status:o})=>({code:o})),{retryThrottledRequestMaxTimes:n,retryNetworkErrorMaxTimes:a})}function tl(i,{publicKey:s,baseURL:e=z.baseURL,source:t="local",signal:r,integration:n,userAgent:a,retryThrottledRequestMaxTimes:o=z.retryThrottledRequestMaxTimes,retryNetworkErrorMaxTimes:l=z.retryNetworkErrorMaxTimes}){return lt(()=>ot({method:"POST",url:Xe(e,"/multipart/complete/",{jsonerrors:1}),headers:{"X-UC-User-Agent":At({publicKey:s,integration:n,userAgent:a})},data:Ws({uuid:i,UPLOADCARE_PUB_KEY:s,source:t}),signal:r}).then(({data:c,headers:u,request:d})=>{const h=Ye(JSON.parse(c));if("error"in h)throw new pe(h.error.content,h.error.errorCode,d,h,u);return h}),{retryThrottledRequestMaxTimes:o,retryNetworkErrorMaxTimes:l})}function Xs({file:i,publicKey:s,baseURL:e,source:t,integration:r,userAgent:n,retryThrottledRequestMaxTimes:a,retryNetworkErrorMaxTimes:o,signal:l,onProgress:c}){return pn({check:u=>bn(i,{publicKey:s,baseURL:e,signal:u,source:t,integration:r,userAgent:n,retryThrottledRequestMaxTimes:a,retryNetworkErrorMaxTimes:o}).then(d=>d.isReady?d:(c&&c({isComputable:!0,value:1}),!1)),signal:l})}class _i{constructor(s,{baseCDN:e=z.baseCDN,fileName:t}={}){p(this,"uuid");p(this,"name",null);p(this,"size",null);p(this,"isStored",null);p(this,"isImage",null);p(this,"mimeType",null);p(this,"cdnUrl",null);p(this,"s3Url",null);p(this,"originalFilename",null);p(this,"imageInfo",null);p(this,"videoInfo",null);p(this,"contentInfo",null);p(this,"metadata",null);p(this,"s3Bucket",null);const{uuid:r,s3Bucket:n}=s,a=Xe(e,`${r}/`),o=n?Xe(`https://${n}.s3.amazonaws.com/`,`${r}/${s.filename}`):null;this.uuid=r,this.name=t||s.filename,this.size=s.size,this.isStored=s.isStored,this.isImage=s.isImage,this.mimeType=s.mimeType,this.cdnUrl=a,this.originalFilename=s.originalFilename,this.imageInfo=s.imageInfo,this.videoInfo=s.videoInfo,this.contentInfo=s.contentInfo,this.metadata=s.metadata||null,this.s3Bucket=n||null,this.s3Url=o}}const il=(i,{publicKey:s,fileName:e,baseURL:t,secureSignature:r,secureExpire:n,store:a,contentType:o,signal:l,onProgress:c,source:u,integration:d,userAgent:h,retryThrottledRequestMaxTimes:m,retryNetworkErrorMaxTimes:f,baseCDN:g,metadata:b})=>qo(i,{publicKey:s,fileName:e,contentType:o,baseURL:t,secureSignature:r,secureExpire:n,store:a,signal:l,onProgress:c,source:u,integration:d,userAgent:h,retryThrottledRequestMaxTimes:m,retryNetworkErrorMaxTimes:f,metadata:b}).then(({file:y})=>Xs({file:y,publicKey:s,baseURL:t,source:u,integration:d,userAgent:h,retryThrottledRequestMaxTimes:m,retryNetworkErrorMaxTimes:f,onProgress:c,signal:l})).then(y=>new _i(y,{baseCDN:g})),sl=(i,{publicKey:s,fileName:e,baseURL:t,signal:r,onProgress:n,source:a,integration:o,userAgent:l,retryThrottledRequestMaxTimes:c,retryNetworkErrorMaxTimes:u,baseCDN:d})=>bn(i,{publicKey:s,baseURL:t,signal:r,source:a,integration:o,userAgent:l,retryThrottledRequestMaxTimes:c,retryNetworkErrorMaxTimes:u}).then(h=>new _i(h,{baseCDN:d,fileName:e})).then(h=>(n&&n({isComputable:!0,value:1}),h)),rl=(i,{signal:s}={})=>{let e=null,t=null;const r=i.map(()=>new AbortController),n=a=>()=>{t=a,r.forEach((o,l)=>l!==a&&o.abort())};return Ji(s,()=>{r.forEach(a=>a.abort())}),Promise.all(i.map((a,o)=>{const l=n(o);return Promise.resolve().then(()=>a({stopRace:l,signal:r[o].signal})).then(c=>(l(),c)).catch(c=>(e=c,null))})).then(a=>{if(t===null)throw e;return a[t]})};var nl=window.WebSocket;class al{constructor(){p(this,"events",Object.create({}))}emit(s,e){var t;(t=this.events[s])==null||t.forEach(r=>r(e))}on(s,e){this.events[s]=this.events[s]||[],this.events[s].push(e)}off(s,e){e?this.events[s]=this.events[s].filter(t=>t!==e):this.events[s]=[]}}const ol=(i,s)=>i==="success"?{status:de.Success,...s}:i==="progress"?{status:de.Progress,...s}:{status:de.Error,...s};class ll{constructor(s,e=3e4){p(this,"key");p(this,"disconnectTime");p(this,"ws");p(this,"queue",[]);p(this,"isConnected",!1);p(this,"subscribers",0);p(this,"emmitter",new al);p(this,"disconnectTimeoutId",null);this.key=s,this.disconnectTime=e}connect(){if(this.disconnectTimeoutId&&clearTimeout(this.disconnectTimeoutId),!this.isConnected&&!this.ws){const s=`wss://ws.pusherapp.com/app/${this.key}?protocol=5&client=js&version=1.12.2`;this.ws=new nl(s),this.ws.addEventListener("error",e=>{this.emmitter.emit("error",new Error(e.message))}),this.emmitter.on("connected",()=>{this.isConnected=!0,this.queue.forEach(e=>this.send(e.event,e.data)),this.queue=[]}),this.ws.addEventListener("message",e=>{const t=JSON.parse(e.data.toString());switch(t.event){case"pusher:connection_established":{this.emmitter.emit("connected",void 0);break}case"pusher:ping":{this.send("pusher:pong",{});break}case"progress":case"success":case"fail":this.emmitter.emit(t.channel,ol(t.event,JSON.parse(t.data)))}})}}disconnect(){const s=()=>{var e;(e=this.ws)==null||e.close(),this.ws=void 0,this.isConnected=!1};this.disconnectTime?this.disconnectTimeoutId=setTimeout(()=>{s()},this.disconnectTime):s()}send(s,e){var r;const t=JSON.stringify({event:s,data:e});(r=this.ws)==null||r.send(t)}subscribe(s,e){this.subscribers+=1,this.connect();const t=`task-status-${s}`,r={event:"pusher:subscribe",data:{channel:t}};this.emmitter.on(t,e),this.isConnected?this.send(r.event,r.data):this.queue.push(r)}unsubscribe(s){this.subscribers-=1;const e=`task-status-${s}`,t={event:"pusher:unsubscribe",data:{channel:e}};this.emmitter.off(e),this.isConnected?this.send(t.event,t.data):this.queue=this.queue.filter(r=>r.data.channel!==e),this.subscribers===0&&this.disconnect()}onError(s){return this.emmitter.on("error",s),()=>this.emmitter.off("error",s)}}let vs=null;const qs=i=>{if(!vs){const s=typeof window>"u"?0:3e4;vs=new ll(i,s)}return vs},cl=i=>{qs(i).connect()};function ul({token:i,publicKey:s,baseURL:e,integration:t,userAgent:r,retryThrottledRequestMaxTimes:n,retryNetworkErrorMaxTimes:a,onProgress:o,signal:l}){return pn({check:c=>Zo(i,{publicKey:s,baseURL:e,integration:t,userAgent:r,retryThrottledRequestMaxTimes:n,retryNetworkErrorMaxTimes:a,signal:c}).then(u=>{switch(u.status){case de.Error:return new pe(u.error,u.errorCode);case de.Waiting:return!1;case de.Unknown:return new pe(`Token "${i}" was not found.`);case de.Progress:return o&&(u.total==="unknown"?o({isComputable:!1}):o({isComputable:!0,value:u.done/u.total})),!1;case de.Success:return o&&o({isComputable:!0,value:u.done/u.total}),u;default:throw new Error("Unknown status")}}),signal:l})}const dl=({token:i,pusherKey:s,signal:e,onProgress:t})=>new Promise((r,n)=>{const a=qs(s),o=a.onError(n),l=()=>{o(),a.unsubscribe(i)};Ji(e,()=>{l(),n(new zt("pusher cancelled"))}),a.subscribe(i,c=>{switch(c.status){case de.Progress:{t&&(c.total==="unknown"?t({isComputable:!1}):t({isComputable:!0,value:c.done/c.total}));break}case de.Success:{l(),t&&t({isComputable:!0,value:c.done/c.total}),r(c);break}case de.Error:l(),n(new pe(c.msg,c.error_code))}})}),hl=(i,{publicKey:s,fileName:e,baseURL:t,baseCDN:r,checkForUrlDuplicates:n,saveUrlForRecurrentUploads:a,secureSignature:o,secureExpire:l,store:c,signal:u,onProgress:d,source:h,integration:m,userAgent:f,retryThrottledRequestMaxTimes:g,pusherKey:b=z.pusherKey,metadata:y})=>Promise.resolve(cl(b)).then(()=>Ko(i,{publicKey:s,fileName:e,baseURL:t,checkForUrlDuplicates:n,saveUrlForRecurrentUploads:a,secureSignature:o,secureExpire:l,store:c,signal:u,source:h,integration:m,userAgent:f,retryThrottledRequestMaxTimes:g,metadata:y})).catch(_=>{const v=qs(b);return v==null||v.disconnect(),Promise.reject(_)}).then(_=>_.type===$s.FileInfo?_:rl([({signal:v})=>ul({token:_.token,publicKey:s,baseURL:t,integration:m,userAgent:f,retryThrottledRequestMaxTimes:g,onProgress:d,signal:v}),({signal:v})=>dl({token:_.token,pusherKey:b,signal:v,onProgress:d})],{signal:u})).then(_=>{if(_ instanceof pe)throw _;return _}).then(_=>Xs({file:_.uuid,publicKey:s,baseURL:t,integration:m,userAgent:f,retryThrottledRequestMaxTimes:g,onProgress:d,signal:u})).then(_=>new _i(_,{baseCDN:r})),_s=new WeakMap,fl=async i=>{if(_s.has(i))return _s.get(i);const s=await fetch(i.uri).then(e=>e.blob());return _s.set(i,s),s},yn=async i=>{if(ts(i)||es(i))return i.size;if(is(i))return(await fl(i)).size;throw new Error("Unknown file type. Cannot determine file size.")},pl=(i,s=z.multipartMinFileSize)=>i>=s,En=i=>{const s="[a-f0-9]{8}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{12}",e=new RegExp(s);return!vi(i)&&e.test(i)},Cn=i=>{const s="^(?:\\w+:)?\\/\\/([^\\s\\.]+\\.\\S{2}|localhost[\\:?\\d]*)\\S*$",e=new RegExp(s);return!vi(i)&&e.test(i)},ml=(i,s)=>new Promise((e,t)=>{const r=[];let n=!1,a=s.length;const o=[...s],l=()=>{const c=s.length-o.length,u=o.shift();u&&u().then(d=>{n||(r[c]=d,a-=1,a?l():e(r))}).catch(d=>{n=!0,t(d)})};for(let c=0;c<i;c++)l()}),gl=(i,s,e,t)=>{const r=t*s,n=Math.min(r+t,e);return i.slice(r,n)},vl=async(i,s,e)=>t=>gl(i,t,s,e),_l=(i,s,{publicKey:e,contentType:t,onProgress:r,signal:n,integration:a,retryThrottledRequestMaxTimes:o,retryNetworkErrorMaxTimes:l})=>el(i,s,{publicKey:e,contentType:t,onProgress:r,signal:n,integration:a,retryThrottledRequestMaxTimes:o,retryNetworkErrorMaxTimes:l}),bl=async(i,{publicKey:s,fileName:e,fileSize:t,baseURL:r,secureSignature:n,secureExpire:a,store:o,signal:l,onProgress:c,source:u,integration:d,userAgent:h,retryThrottledRequestMaxTimes:m,retryNetworkErrorMaxTimes:f,contentType:g,multipartChunkSize:b=z.multipartChunkSize,maxConcurrentRequests:y=z.maxConcurrentRequests,baseCDN:_,metadata:v})=>{const O=t??await yn(i);let x;const R=(E,S)=>{if(!c)return;x||(x=Array(E).fill(0));const U=$=>$.reduce((C,A)=>C+A,0);return $=>{$.isComputable&&(x[S]=$.value,c({isComputable:!0,value:U(x)/E}))}};return g||(g=vn(i)),Qo(O,{publicKey:s,contentType:g,fileName:e||_n(i),baseURL:r,secureSignature:n,secureExpire:a,store:o,signal:l,source:u,integration:d,userAgent:h,retryThrottledRequestMaxTimes:m,retryNetworkErrorMaxTimes:f,metadata:v}).then(async({uuid:E,parts:S})=>{const U=await vl(i,O,b);return Promise.all([E,ml(y,S.map(($,C)=>()=>_l(U(C),$,{publicKey:s,contentType:g,onProgress:R(S.length,C),signal:l,integration:d,retryThrottledRequestMaxTimes:m,retryNetworkErrorMaxTimes:f})))])}).then(([E])=>tl(E,{publicKey:s,baseURL:r,source:u,integration:d,userAgent:h,retryThrottledRequestMaxTimes:m,retryNetworkErrorMaxTimes:f})).then(E=>E.isReady?E:Xs({file:E.uuid,publicKey:s,baseURL:r,source:u,integration:d,userAgent:h,retryThrottledRequestMaxTimes:m,retryNetworkErrorMaxTimes:f,onProgress:c,signal:l})).then(E=>new _i(E,{baseCDN:_}))};async function wn(i,{publicKey:s,fileName:e,baseURL:t=z.baseURL,secureSignature:r,secureExpire:n,store:a,signal:o,onProgress:l,source:c,integration:u,userAgent:d,retryThrottledRequestMaxTimes:h,retryNetworkErrorMaxTimes:m,contentType:f,multipartMinFileSize:g,multipartChunkSize:b,maxConcurrentRequests:y,baseCDN:_=z.baseCDN,checkForUrlDuplicates:v,saveUrlForRecurrentUploads:O,pusherKey:x,metadata:R}){if(vi(i)){const E=await yn(i);return pl(E,g)?bl(i,{publicKey:s,contentType:f,multipartChunkSize:b,fileSize:E,fileName:e,baseURL:t,secureSignature:r,secureExpire:n,store:a,signal:o,onProgress:l,source:c,integration:u,userAgent:d,maxConcurrentRequests:y,retryThrottledRequestMaxTimes:h,retryNetworkErrorMaxTimes:m,baseCDN:_,metadata:R}):il(i,{publicKey:s,fileName:e,contentType:f,baseURL:t,secureSignature:r,secureExpire:n,store:a,signal:o,onProgress:l,source:c,integration:u,userAgent:d,retryThrottledRequestMaxTimes:h,retryNetworkErrorMaxTimes:m,baseCDN:_,metadata:R})}if(Cn(i))return hl(i,{publicKey:s,fileName:e,baseURL:t,baseCDN:_,checkForUrlDuplicates:v,saveUrlForRecurrentUploads:O,secureSignature:r,secureExpire:n,store:a,signal:o,onProgress:l,source:c,integration:u,userAgent:d,retryThrottledRequestMaxTimes:h,retryNetworkErrorMaxTimes:m,pusherKey:x,metadata:R});if(En(i))return sl(i,{publicKey:s,fileName:e,baseURL:t,signal:o,onProgress:l,source:c,integration:u,userAgent:d,retryThrottledRequestMaxTimes:h,retryNetworkErrorMaxTimes:m,baseCDN:_});throw new TypeError(`File uploading from "${i}" is not supported`)}class yl{constructor(s,e){p(this,"uuid");p(this,"filesCount");p(this,"totalSize");p(this,"isStored");p(this,"isImage");p(this,"cdnUrl");p(this,"files");p(this,"createdAt");p(this,"storedAt",null);this.uuid=s.id,this.filesCount=s.filesCount,this.totalSize=Object.values(s.files).reduce((t,r)=>t+r.size,0),this.isStored=!!s.datetimeStored,this.isImage=!!Object.values(s.files).filter(t=>t.isImage).length,this.cdnUrl=s.cdnUrl,this.files=e,this.createdAt=s.datetimeCreated,this.storedAt=s.datetimeStored}}const El=i=>{for(const s of i)if(!vi(s))return!1;return!0},Cl=i=>{for(const s of i)if(!En(s))return!1;return!0},wl=i=>{for(const s of i)if(!Cn(s))return!1;return!0};function Tl(i,{publicKey:s,fileName:e,baseURL:t=z.baseURL,secureSignature:r,secureExpire:n,store:a,signal:o,onProgress:l,source:c,integration:u,userAgent:d,retryThrottledRequestMaxTimes:h,retryNetworkErrorMaxTimes:m,contentType:f,multipartChunkSize:g=z.multipartChunkSize,baseCDN:b=z.baseCDN,checkForUrlDuplicates:y,saveUrlForRecurrentUploads:_,jsonpCallback:v}){if(!El(i)&&!wl(i)&&!Cl(i))throw new TypeError(`Group uploading from "${i}" is not supported`);let O,x=!0;const R=i.length,E=(S,U)=>{if(!l)return;O||(O=Array(S).fill(0));const $=C=>C.reduce((A,I)=>A+I)/S;return C=>{if(!C.isComputable||!x){x=!1,l({isComputable:!1});return}O[U]=C.value,l({isComputable:!0,value:$(O)})}};return Promise.all(i.map((S,U)=>wn(S,{publicKey:s,fileName:e,baseURL:t,secureSignature:r,secureExpire:n,store:a,signal:o,onProgress:E(R,U),source:c,integration:u,userAgent:d,retryThrottledRequestMaxTimes:h,retryNetworkErrorMaxTimes:m,contentType:f,multipartChunkSize:g,baseCDN:b,checkForUrlDuplicates:y,saveUrlForRecurrentUploads:_}))).then(S=>{const U=S.map($=>$.uuid);return Jo(U,{publicKey:s,baseURL:t,jsonpCallback:v,secureSignature:r,secureExpire:n,signal:o,source:c,integration:u,userAgent:d,retryThrottledRequestMaxTimes:h,retryNetworkErrorMaxTimes:m}).then($=>new yl($,S)).then($=>(l&&l({isComputable:!0,value:1}),$))})}var vt,Dt,_t,Mt,Ft,Vt,Pi;class Al{constructor(s){ft(this,Vt);ft(this,vt,1);ft(this,Dt,[]);ft(this,_t,0);ft(this,Mt,new WeakMap);ft(this,Ft,new WeakMap);Jt(this,vt,s)}add(s){return new Promise((e,t)=>{se(this,Mt).set(s,e),se(this,Ft).set(s,t),se(this,Dt).push(s),$i(this,Vt,Pi).call(this)})}get pending(){return se(this,Dt).length}get running(){return se(this,_t)}set concurrency(s){Jt(this,vt,s),$i(this,Vt,Pi).call(this)}get concurrency(){return se(this,vt)}}vt=new WeakMap,Dt=new WeakMap,_t=new WeakMap,Mt=new WeakMap,Ft=new WeakMap,Vt=new WeakSet,Pi=function(){const s=se(this,vt)-se(this,_t);for(let e=0;e<s;e++){const t=se(this,Dt).shift();if(!t)return;const r=se(this,Mt).get(t),n=se(this,Ft).get(t);if(!r||!n)throw new Error("Unexpected behavior: resolver or rejector is undefined");Jt(this,_t,se(this,_t)+1),t().finally(()=>{se(this,Mt).delete(t),se(this,Ft).delete(t),Jt(this,_t,se(this,_t)-1),$i(this,Vt,Pi).call(this)}).then(a=>r(a)).catch(a=>n(a))}};const Tn=()=>({"*blocksRegistry":new Set}),An=i=>({...Tn(),"*currentActivity":"","*currentActivityParams":{},"*history":[],"*historyBack":null,"*closeModal":()=>{i.set$({"*modalActive":!1,"*currentActivity":""})}}),Sn=i=>({...An(i),"*commonProgress":0,"*uploadList":[],"*outputData":null,"*focusedEntry":null,"*uploadMetadata":null,"*uploadQueue":new Al(1)});function Sl(i,s){[...i.querySelectorAll("[l10n]")].forEach(e=>{let t=e.getAttribute("l10n"),r="textContent";if(t.includes(":")){let a=t.split(":");r=a[0],t=a[1]}let n="l10n:"+t;s.__l10nKeys.push(n),s.add(n,t),s.sub(n,a=>{e[r]=s.l10n(a)}),e.removeAttribute("l10n")})}const he=i=>`*cfg/${i}`,bt=i=>{var s;return(s=i.match(/[A-Z]{2,}(?=[A-Z][a-z]+[0-9]*|\b)|[A-Z]?[a-z]+[0-9]*|[A-Z]|[0-9]+/g))==null?void 0:s.map(e=>e.toLowerCase()).join("-")},kr=new Set;function xn(i){kr.has(i)||(kr.add(i),console.warn(i))}const $n=(i,s)=>new Intl.PluralRules(i).select(s),bs="lr-";class J extends Yi{constructor(){super();p(this,"allowCustomTemplate",!0);p(this,"init$",Tn());p(this,"updateCtxCssData",()=>{let e=this.$["*blocksRegistry"];for(let t of e)t.isConnected&&t.updateCssData()});this.activityType=null,this.addTemplateProcessor(Sl),this.__l10nKeys=[]}l10n(e,t={}){if(!e)return"";let r=this.getCssData("--l10n-"+e,!0)||e,n=Ao(r);for(let o of n)t[o.variable]=this.pluralize(o.pluralKey,Number(t[o.countVariable]));return xs(r,t)}pluralize(e,t){const r=this.l10n("locale-name")||"en-US",n=$n(r,t);return this.l10n(`${e}__${n}`)}applyL10nKey(e,t){let r="l10n:"+e;this.$[r]=t,this.__l10nKeys.push(e)}hasBlockInCtx(e){let t=this.$["*blocksRegistry"];for(let r of t)if(e(r))return!0;return!1}setForCtxTarget(e,t,r){this.hasBlockInCtx(n=>n.constructor.StateConsumerScope===e)&&(this.$[t]=r)}setActivity(e){if(this.hasBlockInCtx(t=>t.activityType===e)){this.$["*currentActivity"]=e;return}console.warn(`Activity type "${e}" not found in the context`)}connectedCallback(){const e=this.constructor.className;e&&this.classList.toggle(`${bs}${e}`,!0),dn()||(this._destroyInnerHeightTracker=wo()),this.hasAttribute("retpl")&&(this.constructor.template=null,this.processInnerHtml=!0),super.connectedCallback()}disconnectedCallback(){var e;super.disconnectedCallback(),(e=this._destroyInnerHeightTracker)==null||e.call(this)}initCallback(){this.$["*blocksRegistry"].add(this)}destroyCallback(){this.$["*blocksRegistry"].delete(this)}fileSizeFmt(e,t=2){let r=["B","KB","MB","GB","TB"],n=c=>this.getCssData("--l10n-unit-"+c.toLowerCase(),!0)||c;if(e===0)return`0 ${n(r[0])}`;let a=1024,o=t<0?0:t,l=Math.floor(Math.log(e)/Math.log(a));return parseFloat((e/a**l).toFixed(o))+" "+n(r[l])}proxyUrl(e){let t=this.cfg.secureDeliveryProxy;return t?xs(t,{previewUrl:e},{transform:r=>window.encodeURIComponent(r)}):e}parseCfgProp(e){return{ctx:this.nodeCtx,name:e.replace("*","")}}get cfg(){if(!this.__cfgProxy){let e=Object.create(null);this.__cfgProxy=new Proxy(e,{get:(t,r)=>{const n=he(r),a=this.parseCfgProp(n);return a.ctx.has(a.name)?a.ctx.read(a.name):(xn("Using CSS variables for configuration is deprecated. Please use `lr-config` instead. See migration guide: https://uploadcare.com/docs/file-uploader/migration-to-0.25.0/"),this.getCssData(`--cfg-${bt(r)}`))}})}return this.__cfgProxy}subConfigValue(e,t){const r=this.parseCfgProp(he(e));r.ctx.has(r.name)?this.sub(he(e),t):(this.bindCssData(`--cfg-${bt(e)}`),this.sub(`--cfg-${bt(e)}`,t))}static reg(e){if(!e){super.reg();return}super.reg(e.startsWith(bs)?e:bs+e)}}p(J,"StateConsumerScope",null),p(J,"className","");const Cr=class extends J{constructor(){super(...arguments);p(this,"_handleBackdropClick",()=>{this._closeDialog()});p(this,"_closeDialog",()=>{this.setForCtxTarget(Cr.StateConsumerScope,"*modalActive",!1)});p(this,"_handleDialogClose",()=>{this._closeDialog()});p(this,"_handleDialogClick",e=>{e.target===this.ref.dialog&&this._closeDialog()});p(this,"init$",{...this.init$,"*modalActive":!1,isOpen:!1,closeClicked:this._handleDialogClose})}show(){this.ref.dialog.showModal?this.ref.dialog.showModal():this.ref.dialog.setAttribute("open","")}hide(){this.ref.dialog.close?this.ref.dialog.close():this.ref.dialog.removeAttribute("open")}initCallback(){if(super.initCallback(),typeof HTMLDialogElement=="function")this.ref.dialog.addEventListener("close",this._handleDialogClose),this.ref.dialog.addEventListener("click",this._handleDialogClick);else{this.setAttribute("dialog-fallback","");let e=document.createElement("div");e.className="backdrop",this.appendChild(e),e.addEventListener("click",this._handleBackdropClick)}this.sub("*modalActive",e=>{this.$.isOpen!==e&&(this.$.isOpen=e),e&&this.cfg.modalScrollLock?document.body.style.overflow="hidden":document.body.style.overflow=""}),this.subConfigValue("modalBackdropStrokes",e=>{e?this.setAttribute("strokes",""):this.removeAttribute("strokes")}),this.sub("isOpen",e=>{e?this.show():this.hide()})}destroyCallback(){super.destroyCallback(),document.body.style.overflow="",this.ref.dialog.removeEventListener("close",this._handleDialogClose),this.ref.dialog.removeEventListener("click",this._handleDialogClick)}};let Ee=Cr;p(Ee,"StateConsumerScope","modal");Ee.template=`
  <dialog ref="dialog">
    <slot></slot>
  </dialog>
`;const Or="active",Qt="___ACTIVITY_IS_ACTIVE___",Ue=class extends J{constructor(){super(...arguments);p(this,"historyTracked",!1);p(this,"init$",An(this));p(this,"_debouncedHistoryFlush",Ct(this._historyFlush.bind(this),10))}_deactivate(){var t;let e=Ue._activityRegistry[this.activityKey];this[Qt]=!1,this.removeAttribute(Or),(t=e==null?void 0:e.deactivateCallback)==null||t.call(e)}_activate(){var t;let e=Ue._activityRegistry[this.activityKey];this.$["*historyBack"]=this.historyBack.bind(this),this[Qt]=!0,this.setAttribute(Or,""),(t=e==null?void 0:e.activateCallback)==null||t.call(e),this._debouncedHistoryFlush()}initCallback(){super.initCallback(),this.hasAttribute("current-activity")&&this.sub("*currentActivity",e=>{this.setAttribute("current-activity",e)}),this.activityType&&(this.hasAttribute("activity")||this.setAttribute("activity",this.activityType),this.sub("*currentActivity",e=>{this.activityType!==e&&this[Qt]?this._deactivate():this.activityType===e&&!this[Qt]&&this._activate(),e||(this.$["*history"]=[])}))}_historyFlush(){let e=this.$["*history"];e&&(e.length>10&&(e=e.slice(e.length-11,e.length-1)),this.historyTracked&&e.push(this.activityType),this.$["*history"]=e)}_isActivityRegistered(){return this.activityType&&!!Ue._activityRegistry[this.activityKey]}get isActivityActive(){return this[Qt]}registerActivity(e,t={}){const{onActivate:r,onDeactivate:n}=t;Ue._activityRegistry||(Ue._activityRegistry=Object.create(null)),Ue._activityRegistry[this.activityKey]={activateCallback:r,deactivateCallback:n}}unregisterActivity(){this.isActivityActive&&this._deactivate(),Ue._activityRegistry[this.activityKey]=void 0}destroyCallback(){super.destroyCallback(),this._isActivityRegistered()&&this.unregisterActivity(),Object.keys(Ue._activityRegistry).length===0&&(this.$["*currentActivity"]=null)}get activityKey(){return this.ctxName+this.activityType}get activityParams(){return this.$["*currentActivityParams"]}get initActivity(){return this.getCssData("--cfg-init-activity")}get doneActivity(){return this.getCssData("--cfg-done-activity")}historyBack(){let e=this.$["*history"];if(e){let t=e.pop();for(;t===this.activityType;)t=e.pop();this.$["*currentActivity"]=t,this.$["*history"]=e,t||this.setForCtxTarget(Ee.StateConsumerScope,"*modalActive",!1)}}};let F=Ue;p(F,"_activityRegistry",Object.create(null));F.activities=Object.freeze({START_FROM:"start-from",CAMERA:"camera",DRAW:"draw",UPLOAD_LIST:"upload-list",URL:"url",CONFIRMATION:"confirmation",CLOUD_IMG_EDIT:"cloud-image-edit",EXTERNAL:"external",DETAILS:"details"});const qe=(i,s=",")=>i.trim().split(s).map(e=>e.trim()).filter(e=>e.length>0),Ui=["image/*","image/heif","image/heif-sequence","image/heic","image/heic-sequence","image/avif","image/avif-sequence",".heif",".heifs",".heic",".heics",".avif",".avifs"],Lr=i=>i?i.filter(s=>typeof s=="string").map(s=>qe(s)).flat():[],In=(i,s)=>s.some(e=>e.endsWith("*")?(e=e.replace("*",""),i.startsWith(e)):i===e),xl=(i,s)=>s.some(e=>e.startsWith(".")?i.toLowerCase().endsWith(e.toLowerCase()):!1),Is=i=>{let s=i==null?void 0:i.type;return s?In(s,Ui):!1},$l=Object.freeze({file:{type:File,value:null},externalUrl:{type:String,value:null},fileName:{type:String,value:null,nullable:!0},fileSize:{type:Number,value:null,nullable:!0},lastModified:{type:Number,value:Date.now()},uploadProgress:{type:Number,value:0},uuid:{type:String,value:null},isImage:{type:Boolean,value:!1},mimeType:{type:String,value:null,nullable:!0},uploadError:{type:Error,value:null,nullable:!0},validationErrorMsg:{type:String,value:null,nullable:!0},validationMultipleLimitMsg:{type:String,value:null,nullable:!0},ctxName:{type:String,value:null},cdnUrl:{type:String,value:null},cdnUrlModifiers:{type:String,value:null},fileInfo:{type:_i,value:null},isUploading:{type:Boolean,value:!1},abortController:{type:AbortController,value:null,nullable:!0},thumbUrl:{type:String,value:null,nullable:!0},silentUpload:{type:Boolean,value:!1},source:{type:String,value:!1,nullable:!0}}),kn="blocks",On="0.25.6";function Il(i){return fn({...i,libraryName:kn,libraryVersion:On})}const Rr="[Typed State] Wrong property name: ",kl="[Typed State] Wrong property type: ";class Ol{constructor(s,e){this.__typedSchema=s,this.__ctxId=e||Hs.generate(),this.__schema=Object.keys(s).reduce((t,r)=>(t[r]=s[r].value,t),{}),this.__data=X.registerCtx(this.__schema,this.__ctxId)}get uid(){return this.__ctxId}setValue(s,e){if(!this.__typedSchema.hasOwnProperty(s)){console.warn(Rr+s);return}let t=this.__typedSchema[s];if((e==null?void 0:e.constructor)===t.type||e instanceof t.type||t.nullable&&e===null){this.__data.pub(s,e);return}console.warn(kl+s)}setMultipleValues(s){for(let e in s)this.setValue(e,s[e])}getValue(s){if(!this.__typedSchema.hasOwnProperty(s)){console.warn(Rr+s);return}return this.__data.read(s)}subscribe(s,e){return this.__data.sub(s,e)}remove(){X.deleteCtx(this.__ctxId)}}class Ll{constructor(s){this.__typedSchema=s.typedSchema,this.__ctxId=s.ctxName||Hs.generate(),this.__data=X.registerCtx({},this.__ctxId),this.__watchList=s.watchList||[],this.__handler=s.handler||null,this.__subsMap=Object.create(null),this.__observers=new Set,this.__items=new Set,this.__removed=new Set,this.__added=new Set;let e=Object.create(null);this.__notifyObservers=(t,r)=>{this.__observeTimeout&&window.clearTimeout(this.__observeTimeout),e[t]||(e[t]=new Set),e[t].add(r),this.__observeTimeout=window.setTimeout(()=>{this.__observers.forEach(n=>{n({...e})}),e=Object.create(null)})}}notify(){this.__notifyTimeout&&window.clearTimeout(this.__notifyTimeout),this.__notifyTimeout=window.setTimeout(()=>{var t;let s=new Set(this.__added),e=new Set(this.__removed);this.__added.clear(),this.__removed.clear(),(t=this.__handler)==null||t.call(this,[...this.__items],s,e)})}setHandler(s){this.__handler=s,this.notify()}getHandler(){return this.__handler}removeHandler(){this.__handler=null}add(s){let e=new Ol(this.__typedSchema);for(let t in s)e.setValue(t,s[t]);return this.__data.add(e.uid,e),this.__added.add(e),this.__watchList.forEach(t=>{this.__subsMap[e.uid]||(this.__subsMap[e.uid]=[]),this.__subsMap[e.uid].push(e.subscribe(t,()=>{this.__notifyObservers(t,e.uid)}))}),this.__items.add(e.uid),this.notify(),e}read(s){return this.__data.read(s)}readProp(s,e){return this.read(s).getValue(e)}publishProp(s,e,t){this.read(s).setValue(e,t)}remove(s){this.__removed.add(this.__data.read(s)),this.__items.delete(s),this.notify(),this.__data.pub(s,null),delete this.__subsMap[s]}clearAll(){this.__items.forEach(s=>{this.remove(s)})}observe(s){this.__observers.add(s)}unobserve(s){this.__observers.delete(s)}findItems(s){let e=[];return this.__items.forEach(t=>{let r=this.read(t);s(r)&&e.push(t)}),e}items(){return[...this.__items]}get size(){return this.__items.size}destroy(){X.deleteCtx(this.__data),this.__observers=null,this.__handler=null;for(let s in this.__subsMap)this.__subsMap[s].forEach(e=>{e.remove()}),delete this.__subsMap[s]}}const oe={UPLOAD_START:"UPLOAD_START",REMOVE:"REMOVE",UPLOAD_PROGRESS:"UPLOAD_PROGRESS",UPLOAD_FINISH:"UPLOAD_FINISH",UPLOAD_ERROR:"UPLOAD_ERROR",VALIDATION_ERROR:"VALIDATION_ERROR",CDN_MODIFICATION:"CLOUD_MODIFICATION",DATA_OUTPUT:"DATA_OUTPUT",DONE_FLOW:"DONE_FLOW",INIT_FLOW:"INIT_FLOW"};class Se{constructor(s){this.ctx=s.ctx,this.type=s.type,this.data=s.data}}class ve{static eName(s){return"LR_"+s}static emit(s,e=window,t=!0){let r=()=>{e.dispatchEvent(new CustomEvent(this.eName(s.type),{detail:s}))};if(!t){r();return}let n=s.type+s.ctx;this._timeoutStore[n]&&window.clearTimeout(this._timeoutStore[n]),this._timeoutStore[n]=window.setTimeout(()=>{r(),delete this._timeoutStore[n]},20)}}p(ve,"_timeoutStore",Object.create(null));const Qe=Object.freeze({LOCAL:"local",DROP_AREA:"drop-area",URL_TAB:"url-tab",CAMERA:"camera",EXTERNAL:"external",API:"js-api"}),Le=1e3,pt=Object.freeze({AUTO:"auto",BYTE:"byte",KB:"kb",MB:"mb",GB:"gb",TB:"tb",PB:"pb"}),ei=i=>Math.ceil(i*100)/100,Rl=(i,s=pt.AUTO)=>{const e=s===pt.AUTO;if(s===pt.BYTE||e&&i<Le**1){const t=$n("en-US",i),r={one:"byte",other:"bytes"}[t];return`${i} ${r}`}return s===pt.KB||e&&i<Le**2?`${ei(i/Le**1)} KB`:s===pt.MB||e&&i<Le**3?`${ei(i/Le**2)} MB`:s===pt.GB||e&&i<Le**4?`${ei(i/Le**3)} GB`:s===pt.TB||e&&i<Le**5?`${ei(i/Le**4)} TB`:`${ei(i/Le**5)} PB`};class W extends F{constructor(){super(...arguments);p(this,"couldBeUploadCollectionOwner",!1);p(this,"isUploadCollectionOwner",!1);p(this,"init$",Sn(this));p(this,"__initialUploadMetadata",null);p(this,"_validators",[this._validateMultipleLimit.bind(this),this._validateIsImage.bind(this),this._validateFileType.bind(this),this._validateMaxSizeLimit.bind(this)]);p(this,"_debouncedRunValidators",Ct(this._runValidators.bind(this),100));p(this,"_handleCollectionUpdate",e=>{const t=this.uploadCollection,r=[...new Set(Object.values(e).map(n=>[...n]).flat())].map(n=>t.read(n)).filter(Boolean);for(const n of r)this._runValidatorsForEntry(n);if(e.uploadProgress){let n=0,a=t.findItems(l=>!l.getValue("uploadError"));a.forEach(l=>{n+=t.readProp(l,"uploadProgress")});let o=Math.round(n/a.length);this.$["*commonProgress"]=o,ve.emit(new Se({type:oe.UPLOAD_PROGRESS,ctx:this.ctxName,data:o}),void 0,o===100)}if(e.fileInfo){let n=t.findItems(o=>!!o.getValue("fileInfo")),a=t.findItems(o=>!!o.getValue("uploadError")||!!o.getValue("validationErrorMsg"));if(t.size-a.length===n.length){let o=this.getOutputData(l=>!!l.getValue("fileInfo")&&!l.getValue("silentUpload"));o.length>0&&ve.emit(new Se({type:oe.UPLOAD_FINISH,ctx:this.ctxName,data:o}))}}e.uploadError&&t.findItems(a=>!!a.getValue("uploadError")).forEach(a=>{ve.emit(new Se({type:oe.UPLOAD_ERROR,ctx:this.ctxName,data:t.readProp(a,"uploadError")}),void 0,!1)}),e.validationErrorMsg&&t.findItems(a=>!!a.getValue("validationErrorMsg")).forEach(a=>{ve.emit(new Se({type:oe.VALIDATION_ERROR,ctx:this.ctxName,data:t.readProp(a,"validationErrorMsg")}),void 0,!1)}),e.cdnUrlModifiers&&t.findItems(a=>!!a.getValue("cdnUrlModifiers")).forEach(a=>{ve.emit(new Se({type:oe.CDN_MODIFICATION,ctx:this.ctxName,data:X.getCtx(a).store}),void 0,!1)})})}setUploadMetadata(e){xn("setUploadMetadata is deprecated. Use `metadata` instance property on `lr-config` block instead. See migration guide: https://uploadcare.com/docs/file-uploader/migration-to-0.25.0/"),this.connectedOnce?this.$["*uploadMetadata"]=e:this.__initialUploadMetadata=e}initCallback(){if(super.initCallback(),!this.has("*uploadCollection")){let t=new Ll({typedSchema:$l,watchList:["uploadProgress","fileInfo","uploadError","validationErrorMsg","validationMultipleLimitMsg","cdnUrlModifiers"]});this.add("*uploadCollection",t)}const e=()=>this.hasBlockInCtx(t=>t instanceof W?t.isUploadCollectionOwner&&t.isConnected&&t!==this:!1);this.couldBeUploadCollectionOwner&&!e()&&(this.isUploadCollectionOwner=!0,this.__uploadCollectionHandler=(t,r,n)=>{var a;this._runValidators();for(let o of n)(a=o==null?void 0:o.getValue("abortController"))==null||a.abort(),o==null||o.setValue("abortController",null),URL.revokeObjectURL(o==null?void 0:o.getValue("thumbUrl"));this.$["*uploadList"]=t.map(o=>({uid:o}))},this.uploadCollection.setHandler(this.__uploadCollectionHandler),this.uploadCollection.observe(this._handleCollectionUpdate),this.subConfigValue("maxLocalFileSizeBytes",()=>this._debouncedRunValidators()),this.subConfigValue("multipleMin",()=>this._debouncedRunValidators()),this.subConfigValue("multipleMax",()=>this._debouncedRunValidators()),this.subConfigValue("multiple",()=>this._debouncedRunValidators()),this.subConfigValue("imgOnly",()=>this._debouncedRunValidators()),this.subConfigValue("accept",()=>this._debouncedRunValidators())),this.__initialUploadMetadata&&(this.$["*uploadMetadata"]=this.__initialUploadMetadata),this.subConfigValue("maxConcurrentRequests",t=>{this.$["*uploadQueue"].concurrency=Number(t)||1})}destroyCallback(){super.destroyCallback(),this.isUploadCollectionOwner&&(this.uploadCollection.unobserve(this._handleCollectionUpdate),this.uploadCollection.getHandler()===this.__uploadCollectionHandler&&this.uploadCollection.removeHandler())}addFileFromUrl(e,{silent:t,fileName:r,source:n}={}){this.uploadCollection.add({externalUrl:e,fileName:r??null,silentUpload:t??!1,source:n??Qe.API})}addFileFromUuid(e,{silent:t,fileName:r,source:n}={}){this.uploadCollection.add({uuid:e,fileName:r??null,silentUpload:t??!1,source:n??Qe.API})}addFileFromObject(e,{silent:t,fileName:r,source:n}={}){this.uploadCollection.add({file:e,isImage:Is(e),mimeType:e.type,fileName:r??e.name,fileSize:e.size,silentUpload:t??!1,source:n??Qe.API})}addFiles(e){console.warn("`addFiles` method is deprecated. Please use `addFileFromObject`, `addFileFromUrl` or `addFileFromUuid` instead."),e.forEach(t=>{this.uploadCollection.add({file:t,isImage:Is(t),mimeType:t.type,fileName:t.name,fileSize:t.size})})}uploadAll(){this.$["*uploadTrigger"]={}}openSystemDialog(e={}){let t=Lr([this.cfg.accept??"",...this.cfg.imgOnly?Ui:[]]).join(",");this.cfg.accept&&this.cfg.imgOnly&&console.warn("There could be a mistake.\nBoth `accept` and `imgOnly` parameters are set.\nThe value of `accept` will be concatenated with the internal image mime types list."),this.fileInput=document.createElement("input"),this.fileInput.type="file",this.fileInput.multiple=this.cfg.multiple,e.captureCamera?(this.fileInput.capture="",this.fileInput.accept=Ui.join(",")):this.fileInput.accept=t,this.fileInput.dispatchEvent(new MouseEvent("click")),this.fileInput.onchange=()=>{[...this.fileInput.files].forEach(r=>this.addFileFromObject(r,{source:Qe.LOCAL})),this.$["*currentActivity"]=F.activities.UPLOAD_LIST,this.setForCtxTarget(Ee.StateConsumerScope,"*modalActive",!0),this.fileInput.value="",this.fileInput=null}}get sourceList(){let e=[];return this.cfg.sourceList&&(e=qe(this.cfg.sourceList)),e}initFlow(e=!1){var t,r;if((t=this.$["*uploadList"])!=null&&t.length&&!e)this.set$({"*currentActivity":F.activities.UPLOAD_LIST}),this.setForCtxTarget(Ee.StateConsumerScope,"*modalActive",!0);else if(((r=this.sourceList)==null?void 0:r.length)===1){let n=this.sourceList[0];n==="local"?(this.$["*currentActivity"]=F.activities.UPLOAD_LIST,this==null||this.openSystemDialog()):(Object.values(W.extSrcList).includes(n)?this.set$({"*currentActivityParams":{externalSourceType:n},"*currentActivity":F.activities.EXTERNAL}):this.$["*currentActivity"]=n,this.setForCtxTarget(Ee.StateConsumerScope,"*modalActive",!0))}else this.set$({"*currentActivity":F.activities.START_FROM}),this.setForCtxTarget(Ee.StateConsumerScope,"*modalActive",!0);ve.emit(new Se({type:oe.INIT_FLOW,ctx:this.ctxName}),void 0,!1)}doneFlow(){this.set$({"*currentActivity":this.doneActivity,"*history":this.doneActivity?[this.doneActivity]:[]}),this.$["*currentActivity"]||this.setForCtxTarget(Ee.StateConsumerScope,"*modalActive",!1),ve.emit(new Se({type:oe.DONE_FLOW,ctx:this.ctxName}),void 0,!1)}get uploadCollection(){return this.$["*uploadCollection"]}_validateFileType(e){const t=this.cfg.imgOnly,r=this.cfg.accept,n=Lr([...t?Ui:[],r]);if(!n.length)return;const a=e.getValue("mimeType"),o=e.getValue("fileName");if(!a||!o)return;const l=In(a,n),c=xl(o,n);if(!l&&!c)return this.l10n("file-type-not-allowed")}_validateMaxSizeLimit(e){const t=this.cfg.maxLocalFileSizeBytes,r=e.getValue("fileSize");if(t&&r&&r>t)return this.l10n("files-max-size-limit-error",{maxFileSize:Rl(t)})}_validateMultipleLimit(e){const r=this.uploadCollection.items().indexOf(e.uid),n=this.cfg.multiple?this.cfg.multipleMax:1;if(n&&r>=n)return this.l10n("files-count-allowed",{count:n})}_validateIsImage(e){const t=this.cfg.imgOnly,r=e.getValue("isImage");if(!(!t||r)&&!(!e.getValue("fileInfo")&&e.getValue("externalUrl"))&&!(!e.getValue("fileInfo")&&!e.getValue("mimeType")))return this.l10n("images-only-accepted")}_runValidatorsForEntry(e){for(const t of this._validators){const r=t(e);if(r){e.setValue("validationErrorMsg",r);return}}e.setValue("validationErrorMsg",null)}_runValidators(){for(const e of this.uploadCollection.items())setTimeout(()=>{const t=this.uploadCollection.read(e);t&&this._runValidatorsForEntry(t)})}async getMetadata(){const e=this.cfg.metadata??this.$["*uploadMetadata"];return typeof e=="function"?await e():e}async getUploadClientOptions(){let e={store:this.cfg.store,publicKey:this.cfg.pubkey,baseCDN:this.cfg.cdnCname,baseURL:this.cfg.baseUrl,userAgent:Il,integration:this.cfg.userAgentIntegration,secureSignature:this.cfg.secureSignature,secureExpire:this.cfg.secureExpire,retryThrottledRequestMaxTimes:this.cfg.retryThrottledRequestMaxTimes,multipartMinFileSize:this.cfg.multipartMinFileSize,multipartChunkSize:this.cfg.multipartChunkSize,maxConcurrentRequests:this.cfg.multipartMaxConcurrentRequests,multipartMaxAttempts:this.cfg.multipartMaxAttempts,checkForUrlDuplicates:!!this.cfg.checkForUrlDuplicates,saveUrlForRecurrentUploads:!!this.cfg.saveUrlForRecurrentUploads,metadata:await this.getMetadata()};return console.log("Upload client options:",e),e}getOutputData(e){let t=[];return this.uploadCollection.findItems(e).forEach(n=>{let a=X.getCtx(n).store,o=a.fileInfo||{name:a.fileName,fileSize:a.fileSize,isImage:a.isImage,mimeType:a.mimeType},l={...o,cdnUrlModifiers:a.cdnUrlModifiers,cdnUrl:a.cdnUrl||o.cdnUrl};t.push(l)}),t}}W.extSrcList=Object.freeze({FACEBOOK:"facebook",DROPBOX:"dropbox",GDRIVE:"gdrive",GPHOTOS:"gphotos",INSTAGRAM:"instagram",FLICKR:"flickr",VK:"vk",EVERNOTE:"evernote",BOX:"box",ONEDRIVE:"onedrive",HUDDLE:"huddle"});W.sourceTypes=Object.freeze({LOCAL:"local",URL:"url",CAMERA:"camera",DRAW:"draw",...W.extSrcList});Object.values(oe).forEach(i=>{let s=ve.eName(i);window.addEventListener(s,e=>{if([oe.UPLOAD_FINISH,oe.REMOVE,oe.CDN_MODIFICATION].includes(e.detail.type)){let r=X.getCtx(e.detail.ctx),n=r.read("uploadCollection"),a=[];n.items().forEach(o=>{let l=X.getCtx(o).store,c=l.fileInfo;if(c){let u={...c,cdnUrlModifiers:l.cdnUrlModifiers,cdnUrl:l.cdnUrl||c.cdnUrl};a.push(u)}}),ve.emit(new Se({type:oe.DATA_OUTPUT,ctx:e.detail.ctx,data:a})),r.pub("outputData",a)}})});const Pl="https://ucarecdn.com",Ul="https://upload.uploadcare.com",Nl="https://social.uploadcare.com",Ni=Object.freeze({pubkey:"",multiple:!0,multipleMin:0,multipleMax:0,confirmUpload:!1,imgOnly:!1,accept:"",externalSourcesPreferredTypes:"",store:"auto",cameraMirror:!1,sourceList:"local, url, camera, dropbox, gdrive",maxLocalFileSizeBytes:0,thumbSize:76,showEmptyList:!1,useLocalImageEditor:!1,useCloudImageEditor:!0,removeCopyright:!1,modalScrollLock:!0,modalBackdropStrokes:!1,sourceListWrap:!0,remoteTabSessionKey:"",cdnCname:Pl,baseUrl:Ul,socialBaseUrl:Nl,secureSignature:"",secureExpire:"",secureDeliveryProxy:"",retryThrottledRequestMaxTimes:1,multipartMinFileSize:26214400,multipartChunkSize:5242880,maxConcurrentRequests:10,multipartMaxConcurrentRequests:4,multipartMaxAttempts:3,checkForUrlDuplicates:!1,saveUrlForRecurrentUploads:!1,groupOutput:!1,userAgentIntegration:"",metadata:null}),_e=i=>String(i),Re=i=>Number(i),ae=i=>typeof i=="boolean"?i:i==="true"||i===""?!0:i==="false"?!1:!!i,Dl=i=>i==="auto"?i:ae(i),Ml={pubkey:_e,multiple:ae,multipleMin:Re,multipleMax:Re,confirmUpload:ae,imgOnly:ae,accept:_e,externalSourcesPreferredTypes:_e,store:Dl,cameraMirror:ae,sourceList:_e,maxLocalFileSizeBytes:Re,thumbSize:Re,showEmptyList:ae,useLocalImageEditor:ae,useCloudImageEditor:ae,removeCopyright:ae,modalScrollLock:ae,modalBackdropStrokes:ae,sourceListWrap:ae,remoteTabSessionKey:_e,cdnCname:_e,baseUrl:_e,socialBaseUrl:_e,secureSignature:_e,secureExpire:_e,secureDeliveryProxy:_e,retryThrottledRequestMaxTimes:Re,multipartMinFileSize:Re,multipartChunkSize:Re,maxConcurrentRequests:Re,multipartMaxConcurrentRequests:Re,multipartMaxAttempts:Re,checkForUrlDuplicates:ae,saveUrlForRecurrentUploads:ae,groupOutput:ae,userAgentIntegration:_e},Fl=(i,s)=>{if(!(typeof s>"u"||s===null))return Ml[i](s)},Hi=Object.keys(Ni),Vl=["metadata"],Bl=i=>Vl.includes(i),ks=Hi.filter(i=>!Bl(i)),zl={...Object.fromEntries(ks.map(i=>[bt(i),i])),...Object.fromEntries(ks.map(i=>[i.toLowerCase(),i]))},Hl={...Object.fromEntries(Hi.map(i=>[bt(i),he(i)])),...Object.fromEntries(Hi.map(i=>[i.toLowerCase(),he(i)]))};class Ln extends J{constructor(){super(...arguments);p(this,"ctxOwner",!0);p(this,"init$",{...this.init$,...Object.fromEntries(Object.entries(Ni).map(([e,t])=>[he(e),t]))})}initCallback(){super.initCallback();for(const e of Hi){const t=this;let r="__"+e;t[r]=t[e],Object.defineProperty(this,e,{set:n=>{if(t[r]=n,ks.includes(e)){const a=[...new Set([bt(e),e.toLowerCase()])];for(const o of a)typeof n>"u"||n===null?this.removeAttribute(o):this.setAttribute(o,n.toString())}this.$[he(e)]!==n&&(typeof n>"u"||n===null?this.$[he(e)]=Ni[e]:this.$[he(e)]=n)},get:()=>this.$[he(e)]}),typeof t[e]<"u"&&t[e]!==null&&(t[e]=t[r])}}attributeChangedCallback(e,t,r){if(t===r)return;const n=zl[e],o=Fl(n,r)??Ni[n],l=this;l[n]=o}}Ln.bindAttributes(Hl);class Ks extends J{constructor(){super(...arguments);p(this,"init$",{...this.init$,name:"",path:"",size:"24",viewBox:""})}initCallback(){super.initCallback(),this.sub("name",e=>{if(!e)return;let t=this.getCssData(`--icon-${e}`);t&&(this.$.path=t)}),this.sub("path",e=>{if(!e)return;e.trimStart().startsWith("<")?(this.setAttribute("raw",""),this.ref.svg.innerHTML=e):(this.removeAttribute("raw"),this.ref.svg.innerHTML=`<path fill-rule="evenodd" d="${e}"></path>`)}),this.sub("size",e=>{this.$.viewBox=`0 0 ${e} ${e}`})}}Ks.template=`
  <svg ref="svg" xmlns="http://www.w3.org/2000/svg" set="@viewBox: viewBox; @height: size; @width: size"></svg>
`;Ks.bindAttributes({name:"name",size:"size"});const Rn=i=>{if(typeof i!="string"||!i)return"";let s=i.trim();return s.startsWith("-/")?s=s.slice(2):s.startsWith("/")&&(s=s.slice(1)),s.endsWith("/")&&(s=s.slice(0,s.length-1)),s},Ys=(...i)=>i.filter(s=>typeof s=="string"&&s).map(s=>Rn(s)).join("/-/"),Ne=(...i)=>{let s=Ys(...i);return s?`-/${s}/`:""};function Pn(i){let s=new URL(i),e=s.pathname+s.search+s.hash,t=e.lastIndexOf("http"),r=e.lastIndexOf("/"),n="";return t>=0?n=e.slice(t):r>=0&&(n=e.slice(r+1)),n}function jl(i){let s=new URL(i),{pathname:e}=s;const t=e.indexOf("/"),r=e.indexOf("/",t+1);return e.substring(t+1,r)}function Wl(i){let s=Un(i),e=new URL(s),t=e.pathname.indexOf("/-/");return t===-1?[]:e.pathname.substring(t).split("/-/").filter(Boolean).map(n=>Rn(n))}function Un(i){let s=new URL(i),e=Pn(i),t=Nn(e)?Dn(e).pathname:e;return s.pathname=s.pathname.replace(t,""),s.search="",s.hash="",s.toString()}function Nn(i){return i.startsWith("http")}function Dn(i){let s=new URL(i);return{pathname:s.origin+s.pathname||"",search:s.search||"",hash:s.hash||""}}const Ce=(i,s,e)=>{let t=new URL(Un(i));if(e=e||Pn(i),t.pathname.startsWith("//")&&(t.pathname=t.pathname.replace("//","/")),Nn(e)){let r=Dn(e);t.pathname=t.pathname+(s||"")+(r.pathname||""),t.search=r.search,t.hash=r.hash}else t.pathname=t.pathname+(s||"")+(e||"");return t.toString()},li=(i,s)=>{let e=new URL(i);return e.pathname=s+"/",e.toString()},Gl="https://ucarecdn.com",Rt=Object.freeze({"dev-mode":{},pubkey:{},uuid:{},src:{},lazy:{default:1},intersection:{},breakpoints:{},"cdn-cname":{default:Gl},"proxy-cname":{},"secure-delivery-proxy":{},"hi-res-support":{default:1},"ultra-res-support":{},format:{default:"auto"},"cdn-operations":{},progressive:{},quality:{default:"smart"},"is-background-for":{}}),Xl=i=>[...new Set(i)],ri="--lr-img-",Pr="unresolved",$t=2,It=3,Ur=!window.location.host.trim()||window.location.host.includes(":")||window.location.hostname.includes("localhost"),Mn=Object.create(null);var an;for(let i in Rt)Mn[ri+i]=((an=Rt[i])==null?void 0:an.default)||"";class ql extends Yi{constructor(){super(...arguments);p(this,"cssInit$",Mn)}$$(e){return this.$[ri+e]}set$$(e){for(let t in e)this.$[ri+t]=e[t]}sub$$(e,t){this.sub(ri+e,r=>{r===null||r===""||t(r)})}_fmtAbs(e){return!e.includes("//")&&!Ur&&(e=new URL(e,document.baseURI).href),e}_getCdnModifiers(e=""){return Ne(e&&`resize/${e}`,this.$$("cdn-operations")||"",`format/${this.$$("format")||Rt.format.default}`,`quality/${this.$$("quality")||Rt.quality.default}`)}_getUrlBase(e=""){if(this.$$("src").startsWith("data:")||this.$$("src").startsWith("blob:"))return this.$$("src");if(Ur&&this.$$("src")&&!this.$$("src").includes("//"))return this._proxyUrl(this.$$("src"));let t=this._getCdnModifiers(e);if(this.$$("src").startsWith(this.$$("cdn-cname")))return Ce(this.$$("src"),t);if(this.$$("cdn-cname")&&this.$$("uuid"))return this._proxyUrl(Ce(li(this.$$("cdn-cname"),this.$$("uuid")),t));if(this.$$("uuid"))return this._proxyUrl(Ce(li(this.$$("cdn-cname"),this.$$("uuid")),t));if(this.$$("proxy-cname"))return this._proxyUrl(Ce(this.$$("proxy-cname"),t,this._fmtAbs(this.$$("src"))));if(this.$$("pubkey"))return this._proxyUrl(Ce(`https://${this.$$("pubkey")}.ucr.io/`,t,this._fmtAbs(this.$$("src"))))}_proxyUrl(e){return this.$$("secure-delivery-proxy")?xs(this.$$("secure-delivery-proxy"),{previewUrl:e},{transform:r=>window.encodeURIComponent(r)}):e}_getElSize(e,t=1,r=!0){let n=e.getBoundingClientRect(),a=t*Math.round(n.width),o=r?"":t*Math.round(n.height);return a||o?`${a||""}x${o||""}`:null}_setupEventProxy(e){let t=n=>{n.stopPropagation();let a=new Event(n.type,n);this.dispatchEvent(a)},r=["load","error"];for(let n of r)e.addEventListener(n,t)}get img(){return this._img||(this._img=new Image,this._setupEventProxy(this.img),this._img.setAttribute(Pr,""),this.img.onload=()=>{this.img.removeAttribute(Pr)},this.initAttributes(),this.appendChild(this._img)),this._img}get bgSelector(){return this.$$("is-background-for")}initAttributes(){[...this.attributes].forEach(e=>{Rt[e.name]||this.img.setAttribute(e.name,e.value)})}get breakpoints(){return this.$$("breakpoints")?Xl(qe(this.$$("breakpoints")).map(e=>Number(e))):null}renderBg(e){let t=new Set;this.breakpoints?this.breakpoints.forEach(n=>{t.add(`url("${this._getUrlBase(n+"x")}") ${n}w`),this.$$("hi-res-support")&&t.add(`url("${this._getUrlBase(n*$t+"x")}") ${n*$t}w`),this.$$("ultra-res-support")&&t.add(`url("${this._getUrlBase(n*It+"x")}") ${n*It}w`)}):(t.add(`url("${this._getUrlBase(this._getElSize(e))}") 1x`),this.$$("hi-res-support")&&t.add(`url("${this._getUrlBase(this._getElSize(e,$t))}") ${$t}x`),this.$$("ultra-res-support")&&t.add(`url("${this._getUrlBase(this._getElSize(e,It))}") ${It}x`));let r=`image-set(${[...t].join(", ")})`;e.style.setProperty("background-image",r),e.style.setProperty("background-image","-webkit-"+r)}getSrcset(){let e=new Set;return this.breakpoints?this.breakpoints.forEach(t=>{e.add(this._getUrlBase(t+"x")+` ${t}w`),this.$$("hi-res-support")&&e.add(this._getUrlBase(t*$t+"x")+` ${t*$t}w`),this.$$("ultra-res-support")&&e.add(this._getUrlBase(t*It+"x")+` ${t*It}w`)}):(e.add(this._getUrlBase(this._getElSize(this.img))+" 1x"),this.$$("hi-res-support")&&e.add(this._getUrlBase(this._getElSize(this.img,2))+" 2x"),this.$$("ultra-res-support")&&e.add(this._getUrlBase(this._getElSize(this.img,3))+" 3x")),[...e].join()}getSrc(){return this._getUrlBase()}init(){this.bgSelector?[...document.querySelectorAll(this.bgSelector)].forEach(e=>{this.$$("intersection")?this.initIntersection(e,()=>{this.renderBg(e)}):this.renderBg(e)}):this.$$("intersection")?this.initIntersection(this.img,()=>{this.img.srcset=this.getSrcset(),this.img.src=this.getSrc()}):(this.img.srcset=this.getSrcset(),this.img.src=this.getSrc())}initIntersection(e,t){let r={root:null,rootMargin:"0px"};this._isnObserver=new IntersectionObserver(n=>{n.forEach(a=>{a.isIntersecting&&(t(),this._isnObserver.unobserve(e))})},r),this._isnObserver.observe(e),this._observed||(this._observed=new Set),this._observed.add(e)}destroyCallback(){super.destroyCallback(),this._isnObserver&&(this._observed.forEach(e=>{this._isnObserver.unobserve(e)}),this._isnObserver=null)}static get observedAttributes(){return Object.keys(Rt)}attributeChangedCallback(e,t,r){window.setTimeout(()=>{this.$[ri+e]=r})}}class Kl extends ql{initCallback(){super.initCallback(),this.sub$$("src",()=>{this.init()}),this.sub$$("uuid",()=>{this.init()}),this.sub$$("lazy",s=>{this.$$("is-background-for")||(this.img.loading=s?"lazy":"eager")})}}class Fn extends W{constructor(){super(...arguments);p(this,"init$",{...this.init$,"*simpleButtonText":"",onClick:()=>{this.initFlow()}})}initCallback(){super.initCallback(),this.subConfigValue("multiple",e=>{this.$["*simpleButtonText"]=e?this.l10n("upload-files"):this.l10n("upload-file")})}}Fn.template=`
  <lr-drop-area>
    <button type="button" set="onclick: onClick">
      <lr-icon name="upload"></lr-icon>
      <span>{{*simpleButtonText}}</span>
      <slot></slot>
      <div class="visual-drop-area"></div>
    </button>
  </lr-drop-area>
`;class Yl extends F{constructor(){super(...arguments);p(this,"historyTracked",!0);p(this,"activityType","start-from")}initCallback(){super.initCallback(),this.registerActivity(this.activityType)}}function Zl(i){return new Promise(s=>{typeof window.FileReader!="function"&&s(!1);try{let e=new FileReader;e.onerror=()=>{s(!0)};let t=r=>{r.type!=="loadend"&&e.abort(),s(!1)};e.onloadend=t,e.onprogress=t,e.readAsDataURL(i)}catch{s(!1)}})}function Jl(i,s){return new Promise(e=>{let t=0,r=[],n=o=>{o||(console.warn("Unexpectedly received empty content entry",{scope:"drag-and-drop"}),e(null)),o.isFile?(t++,o.file(l=>{t--;const c=new File([l],l.name,{type:l.type||s});r.push(c),t===0&&e(r)})):o.isDirectory&&a(o.createReader())},a=o=>{t++,o.readEntries(l=>{t--;for(let c of l)n(c);t===0&&e(r)})};n(i)})}function Ql(i){let s=[],e=[];for(let t=0;t<i.items.length;t++){let r=i.items[t];if(r)if(r.kind==="file"){const n=r.type;if(typeof r.webkitGetAsEntry=="function"||typeof r.getAsEntry=="function"){let o=typeof r.webkitGetAsEntry=="function"?r.webkitGetAsEntry():r.getAsEntry();e.push(Jl(o,n).then(l=>{s.push(...l)}));continue}let a=r.getAsFile();e.push(Zl(a).then(o=>{o||s.push(a)}))}else r.kind==="string"&&r.type.match("^text/uri-list")&&e.push(new Promise(n=>{r.getAsString(a=>{s.push(a),n()})}))}return Promise.all(e).then(()=>s)}const ue={ACTIVE:0,INACTIVE:1,NEAR:2,OVER:3};let Nr=["focus"],ec=100,ys=new Map;function tc(i,s){let e=Math.max(Math.min(i[0],s.x+s.width),s.x),t=Math.max(Math.min(i[1],s.y+s.height),s.y);return Math.sqrt((i[0]-e)*(i[0]-e)+(i[1]-t)*(i[1]-t))}function Dr(i){let s=0,e=document.body,t=new Set,r=f=>t.add(f),n=ue.INACTIVE,a=f=>{i.shouldIgnore()&&f!==ue.INACTIVE||(n!==f&&t.forEach(g=>g(f)),n=f)},o=()=>s>0;r(f=>i.onChange(f));let l=()=>{s=0,a(ue.INACTIVE)},c=()=>{s+=1,n===ue.INACTIVE&&a(ue.ACTIVE)},u=()=>{s-=1,o()||a(ue.INACTIVE)},d=f=>{f.preventDefault(),s=0,a(ue.INACTIVE)},h=f=>{o()||(s+=1),f.preventDefault();let g=[f.x,f.y],b=i.element.getBoundingClientRect(),y=Math.floor(tc(g,b)),_=y<ec,v=f.composedPath().includes(i.element);ys.set(i.element,y);let O=Math.min(...ys.values())===y;a(v&&O?ue.OVER:_&&O?ue.NEAR:ue.ACTIVE)},m=async f=>{if(i.shouldIgnore())return;f.preventDefault();let g=await Ql(f.dataTransfer);i.onItems(g),a(ue.INACTIVE)};return e.addEventListener("drop",d),e.addEventListener("dragleave",u),e.addEventListener("dragenter",c),e.addEventListener("dragover",h),i.element.addEventListener("drop",m),Nr.forEach(f=>{window.addEventListener(f,l)}),()=>{ys.delete(i.element),e.removeEventListener("drop",d),e.removeEventListener("dragleave",u),e.removeEventListener("dragenter",c),e.removeEventListener("dragover",h),i.element.removeEventListener("drop",m),Nr.forEach(f=>{window.removeEventListener(f,l)})}}class Zs extends W{constructor(){super(...arguments);p(this,"init$",{...this.init$,state:ue.INACTIVE,withIcon:!1,isClickable:!1,isFullscreen:!1,isEnabled:!0,isVisible:!0,text:this.l10n("drop-files-here"),"lr-drop-area/targets":null})}isActive(){if(!this.$.isEnabled)return!1;const e=this.getBoundingClientRect(),t=e.width>0&&e.height>0,r=e.top>=0&&e.left>=0&&e.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&e.right<=(window.innerWidth||document.documentElement.clientWidth),n=window.getComputedStyle(this),a=n.visibility!=="hidden"&&n.display!=="none";return t&&a&&r}initCallback(){super.initCallback(),this.$["lr-drop-area/targets"]||(this.$["lr-drop-area/targets"]=new Set),this.$["lr-drop-area/targets"].add(this),this.defineAccessor("disabled",t=>{this.set$({isEnabled:!t})}),this.defineAccessor("clickable",t=>{this.set$({isClickable:typeof t=="string"})}),this.defineAccessor("with-icon",t=>{this.set$({withIcon:typeof t=="string"})}),this.defineAccessor("fullscreen",t=>{this.set$({isFullscreen:typeof t=="string"})}),this.defineAccessor("text",t=>{t?this.set$({text:this.l10n(t)||t}):this.set$({text:this.l10n("drop-files-here")})}),this._destroyDropzone=Dr({element:this,shouldIgnore:()=>this._shouldIgnore(),onChange:t=>{this.$.state=t},onItems:t=>{t.length&&(t.forEach(r=>{if(typeof r=="string"){this.addFileFromUrl(r,{source:Qe.DROP_AREA});return}this.addFileFromObject(r,{source:Qe.DROP_AREA})}),this.uploadCollection.size&&(this.set$({"*currentActivity":F.activities.UPLOAD_LIST}),this.setForCtxTarget(Ee.StateConsumerScope,"*modalActive",!0)))}});let e=this.ref["content-wrapper"];e&&(this._destroyContentWrapperDropzone=Dr({element:e,onChange:t=>{var n;const r=(n=Object.entries(ue).find(([,a])=>a===t))==null?void 0:n[0].toLowerCase();r&&e.setAttribute("drag-state",r)},onItems:()=>{},shouldIgnore:()=>this._shouldIgnore()})),this.sub("state",t=>{var n;const r=(n=Object.entries(ue).find(([,a])=>a===t))==null?void 0:n[0].toLowerCase();r&&this.setAttribute("drag-state",r)}),this.subConfigValue("sourceList",t=>{const r=qe(t);this.$.isEnabled=r.includes(W.sourceTypes.LOCAL),this.$.isVisible=this.$.isEnabled||!this.querySelector("[data-default-slot]")}),this.sub("isVisible",t=>{this.toggleAttribute("hidden",!t)}),this.$.isClickable&&(this._onAreaClicked=()=>{this.openSystemDialog()},this.addEventListener("click",this._onAreaClicked))}_shouldIgnore(){return!this.$.isEnabled||!this._couldHandleFiles()?!0:this.$.isFullscreen?[...this.$["lr-drop-area/targets"]].filter(r=>r!==this).filter(r=>r.isActive()).length>0:!1}_couldHandleFiles(){let e=this.cfg.multiple,t=this.cfg.multipleMax,r=this.uploadCollection.size;return!(e&&t&&r>=t||!e&&r>0)}destroyCallback(){var e,t,r,n;super.destroyCallback(),(t=(e=this.$["lr-drop-area/targets"])==null?void 0:e.remove)==null||t.call(e,this),(r=this._destroyDropzone)==null||r.call(this),(n=this._destroyContentWrapperDropzone)==null||n.call(this),this._onAreaClicked&&this.removeEventListener("click",this._onAreaClicked)}}Zs.template=`
  <slot>
    <div data-default-slot hidden></div>
    <div ref="content-wrapper" class="content-wrapper" set="@hidden: !isVisible">
      <div class="icon-container" set="@hidden: !withIcon">
        <lr-icon name="default"></lr-icon>
        <lr-icon name="arrow-down"></lr-icon>
      </div>
      <span class="text">{{text}}</span>
    </div>
  </slot>
`;Zs.bindAttributes({"with-icon":null,clickable:null,text:null,fullscreen:null,disabled:null});const ic="src-type-";class ss extends W{constructor(){super(...arguments);p(this,"_registeredTypes",{});p(this,"init$",{...this.init$,iconName:"default"})}initTypes(){this.registerType({type:W.sourceTypes.LOCAL,onClick:()=>{this.openSystemDialog()}}),this.registerType({type:W.sourceTypes.URL,activity:F.activities.URL,textKey:"from-url"}),this.registerType({type:W.sourceTypes.CAMERA,activity:F.activities.CAMERA,onClick:()=>{var t=document.createElement("input").capture!==void 0;return t&&this.openSystemDialog({captureCamera:!0}),!t}}),this.registerType({type:"draw",activity:F.activities.DRAW,icon:"edit-draw"});for(let e of Object.values(W.extSrcList))this.registerType({type:e,activity:F.activities.EXTERNAL,activityParams:{externalSourceType:e}})}initCallback(){super.initCallback(),this.initTypes(),this.setAttribute("role","button"),this.defineAccessor("type",e=>{e&&this.applyType(e)})}registerType(e){this._registeredTypes[e.type]=e}getType(e){return this._registeredTypes[e]}applyType(e){const t=this._registeredTypes[e];if(!t){console.warn("Unsupported source type: "+e);return}const{textKey:r=e,icon:n=e,activity:a,onClick:o,activityParams:l={}}=t;this.applyL10nKey("src-type",`${ic}${r}`),this.$.iconName=n,this.onclick=c=>{(o?o(c):!!a)&&this.set$({"*currentActivityParams":l,"*currentActivity":a})}}}ss.template=`
  <lr-icon set="@name: iconName"></lr-icon>
  <div class="txt" l10n="src-type"></div>
`;ss.bindAttributes({type:null});class sc extends J{initCallback(){super.initCallback(),this.subConfigValue("sourceList",s=>{let e=qe(s),t="";e.forEach(r=>{t+=`<lr-source-btn type="${r}"></lr-source-btn>`}),this.cfg.sourceListWrap?this.innerHTML=t:this.outerHTML=t})}}function Vn(i){let s=new Blob([i],{type:"image/svg+xml"});return URL.createObjectURL(s)}function rc(i="#fff",s="rgba(0, 0, 0, .1)"){return Vn(`<svg height="20" width="20" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
    <rect x="0" y="0" width="20" height="20" fill="${i}" />
    <rect x="0" y="0" width="10" height="10" fill="${s}" />
    <rect x="10" y="10" width="10" height="10" fill="${s}" />
  </svg>`)}function Os(i="hsl(209, 21%, 65%)",s=32,e=32){return Vn(`
  <svg width="${s}" height="${e}" viewBox="0 0 30 30" fill="none" xmlns="http://www.w3.org/2000/svg">
    <path fill-rule="evenodd" fill="${i}" d="M9.68848 8.70068C9.68848 8.42454 9.91233 8.20068 10.1885 8.20068H15.0885C15.2211 8.20068 15.3483 8.25336 15.442 8.34713L20.342 13.2471C20.4358 13.3409 20.4885 13.4681 20.4885 13.6007V21.3007C20.4885 21.5768 20.2646 21.8007 19.9885 21.8007H10.1885C9.91233 21.8007 9.68848 21.5768 9.68848 21.3007V8.70068ZM10.6885 9.20068V20.8007H19.4885V14.1007L15.0885 14.1007C14.8123 14.1007 14.5885 13.8768 14.5885 13.6007L14.5885 9.20068H10.6885ZM15.5885 9.90779L18.7814 13.1007L15.5885 13.1007L15.5885 9.90779Z"/>
  </svg>
  `)}function nc(i,s=40){if(i.type==="image/svg+xml")return URL.createObjectURL(i);let e=document.createElement("canvas"),t=e.getContext("2d"),r=new Image,n=new Promise((a,o)=>{r.onload=()=>{let l=r.height/r.width;l>1?(e.width=s,e.height=s*l):(e.height=s,e.width=s/l),t.fillStyle="rgb(240, 240, 240)",t.fillRect(0,0,e.width,e.height),t.drawImage(r,0,0,e.width,e.height),e.toBlob(c=>{if(!c){o();return}let u=URL.createObjectURL(c);a(u)})},r.onerror=l=>{o(l)}});return r.src=URL.createObjectURL(i),n}const re=Object.freeze({FINISHED:Symbol(0),FAILED:Symbol(1),UPLOADING:Symbol(2),IDLE:Symbol(3),LIMIT_OVERFLOW:Symbol(4)});class yt extends W{constructor(){super(...arguments);p(this,"pauseRender",!0);p(this,"_entrySubs",new Set);p(this,"_entry",null);p(this,"_isIntersecting",!1);p(this,"_debouncedGenerateThumb",Ct(this._generateThumbnail.bind(this),100));p(this,"_debouncedCalculateState",Ct(this._calculateState.bind(this),100));p(this,"_renderedOnce",!1);p(this,"init$",{...this.init$,uid:"",itemName:"",errorText:"",thumbUrl:"",progressValue:0,progressVisible:!1,progressUnknown:!1,badgeIcon:"",isFinished:!1,isFailed:!1,isUploading:!1,isFocused:!1,isEditable:!1,isLimitOverflow:!1,state:re.IDLE,"*uploadTrigger":null,onEdit:()=>{this.set$({"*focusedEntry":this._entry}),this.hasBlockInCtx(e=>e.activityType===F.activities.DETAILS)?this.$["*currentActivity"]=F.activities.DETAILS:this.$["*currentActivity"]=F.activities.CLOUD_IMG_EDIT},onRemove:()=>{let e=this._entry.getValue("uuid");if(e){let t=this.getOutputData(r=>r.getValue("uuid")===e);ve.emit(new Se({type:oe.REMOVE,ctx:this.ctxName,data:t}))}this.uploadCollection.remove(this.$.uid)},onUpload:()=>{this.upload()}})}_reset(){for(let e of this._entrySubs)e.remove();this._debouncedGenerateThumb.cancel(),this._debouncedCalculateState.cancel(),this._entrySubs=new Set,this._entry=null}_observerCallback(e){let[t]=e;this._isIntersecting=t.isIntersecting,t.isIntersecting&&!this._renderedOnce&&(this.render(),this._renderedOnce=!0),t.intersectionRatio===0?this._debouncedGenerateThumb.cancel():this._debouncedGenerateThumb()}_calculateState(){if(!this._entry)return;let e=this._entry,t=re.IDLE;e.getValue("uploadError")||e.getValue("validationErrorMsg")?t=re.FAILED:e.getValue("validationMultipleLimitMsg")?t=re.LIMIT_OVERFLOW:e.getValue("isUploading")?t=re.UPLOADING:e.getValue("fileInfo")&&(t=re.FINISHED),this.$.state=t}async _generateThumbnail(){var t;if(!this._entry)return;let e=this._entry;if(e.getValue("fileInfo")&&e.getValue("isImage")){let r=this.cfg.thumbSize,n=this.proxyUrl(Ce(li(this.cfg.cdnCname,this._entry.getValue("uuid")),Ne(e.getValue("cdnUrlModifiers"),`scale_crop/${r}x${r}/center`))),a=e.getValue("thumbUrl");a!==n&&(e.setValue("thumbUrl",n),a!=null&&a.startsWith("blob:")&&URL.revokeObjectURL(a));return}if(!e.getValue("thumbUrl"))if((t=e.getValue("file"))!=null&&t.type.includes("image"))try{let r=await nc(e.getValue("file"),this.cfg.thumbSize);e.setValue("thumbUrl",r)}catch{let n=window.getComputedStyle(this).getPropertyValue("--clr-generic-file-icon");e.setValue("thumbUrl",Os(n))}else{let r=window.getComputedStyle(this).getPropertyValue("--clr-generic-file-icon");e.setValue("thumbUrl",Os(r))}}_subEntry(e,t){let r=this._entry.subscribe(e,n=>{this.isConnected&&t(n)});this._entrySubs.add(r)}_handleEntryId(e){var r;this._reset();let t=(r=this.uploadCollection)==null?void 0:r.read(e);this._entry=t,t&&(this._subEntry("uploadProgress",n=>{this.$.progressValue=n}),this._subEntry("fileName",n=>{this.$.itemName=n||t.getValue("externalUrl")||this.l10n("file-no-name"),this._debouncedCalculateState()}),this._subEntry("externalUrl",n=>{this.$.itemName=t.getValue("fileName")||n||this.l10n("file-no-name")}),this._subEntry("uuid",n=>{this._debouncedCalculateState(),n&&this._isIntersecting&&this._debouncedGenerateThumb()}),this._subEntry("cdnUrlModifiers",()=>{this._isIntersecting&&this._debouncedGenerateThumb()}),this._subEntry("thumbUrl",n=>{this.$.thumbUrl=n?`url(${n})`:""}),this._subEntry("validationMultipleLimitMsg",()=>this._debouncedCalculateState()),this._subEntry("validationErrorMsg",()=>this._debouncedCalculateState()),this._subEntry("uploadError",()=>this._debouncedCalculateState()),this._subEntry("isUploading",()=>this._debouncedCalculateState()),this._subEntry("fileSize",()=>this._debouncedCalculateState()),this._subEntry("mimeType",()=>this._debouncedCalculateState()),this._subEntry("isImage",()=>this._debouncedCalculateState()),this._isIntersecting&&this._debouncedGenerateThumb())}initCallback(){super.initCallback(),this.sub("uid",e=>{this._handleEntryId(e)}),this.sub("state",e=>{this._handleState(e)}),this.subConfigValue("useCloudImageEditor",()=>this._debouncedCalculateState()),this.onclick=()=>{yt.activeInstances.forEach(e=>{e===this?e.setAttribute("focused",""):e.removeAttribute("focused")})},this.$["*uploadTrigger"]=null,this.sub("*uploadTrigger",e=>{e&&setTimeout(()=>this.isConnected&&this.upload())}),yt.activeInstances.add(this)}_handleState(e){var t,r;this.set$({isFailed:e===re.FAILED,isLimitOverflow:e===re.LIMIT_OVERFLOW,isUploading:e===re.UPLOADING,isFinished:e===re.FINISHED,progressVisible:e===re.UPLOADING,isEditable:this.cfg.useCloudImageEditor&&e===re.FINISHED&&((t=this._entry)==null?void 0:t.getValue("isImage")),errorText:((r=this._entry.getValue("uploadError"))==null?void 0:r.message)||this._entry.getValue("validationErrorMsg")||this._entry.getValue("validationMultipleLimitMsg")}),e===re.FAILED||e===re.LIMIT_OVERFLOW?this.$.badgeIcon="badge-error":e===re.FINISHED&&(this.$.badgeIcon="badge-success"),e===re.UPLOADING?this.$.isFocused=!1:this.$.progressValue=0}destroyCallback(){super.destroyCallback(),yt.activeInstances.delete(this),this._reset()}connectedCallback(){super.connectedCallback(),this._observer=new window.IntersectionObserver(this._observerCallback.bind(this),{root:this.parentElement,rootMargin:"50% 0px 50% 0px",threshold:[0,1]}),this._observer.observe(this)}disconnectedCallback(){var e;super.disconnectedCallback(),this._debouncedGenerateThumb.cancel(),(e=this._observer)==null||e.disconnect()}async upload(){var n,a;let e=this._entry;if(!this.uploadCollection.read(e.uid)||e.getValue("fileInfo")||e.getValue("isUploading")||e.getValue("uploadError")||e.getValue("validationErrorMsg")||e.getValue("validationMultipleLimitMsg"))return;const t=this.cfg.multiple?this.cfg.multipleMax:1;if(t&&this.uploadCollection.size>t)return;let r=this.getOutputData(o=>!o.getValue("fileInfo"));ve.emit(new Se({type:oe.UPLOAD_START,ctx:this.ctxName,data:r})),this._debouncedCalculateState(),e.setValue("isUploading",!0),e.setValue("uploadError",null),e.setValue("validationErrorMsg",null),e.setValue("validationMultipleLimitMsg",null),!e.getValue("file")&&e.getValue("externalUrl")&&(this.$.progressUnknown=!0);try{let o=new AbortController;e.setValue("abortController",o);const l=async()=>{const u=await this.getUploadClientOptions();return wn(e.getValue("file")||e.getValue("externalUrl")||e.getValue("uuid"),{...u,fileName:e.getValue("fileName"),source:e.getValue("source"),onProgress:d=>{if(d.isComputable){let h=d.value*100;e.setValue("uploadProgress",h)}this.$.progressUnknown=!d.isComputable},signal:o.signal})};let c=await this.$["*uploadQueue"].add(l);e.setMultipleValues({fileInfo:c,isUploading:!1,fileName:c.originalFilename,fileSize:c.size,isImage:c.isImage,mimeType:((a=(n=c.contentInfo)==null?void 0:n.mime)==null?void 0:a.mime)??c.mimeType,uuid:c.uuid,cdnUrl:c.cdnUrl}),e===this._entry&&this._debouncedCalculateState()}catch(o){console.warn("Upload error",o),e.setMultipleValues({abortController:null,isUploading:!1,uploadProgress:0}),e===this._entry&&this._debouncedCalculateState(),o instanceof pe?o.isCancel||e.setValue("uploadError",o):e.setValue("uploadError",new Error("Unexpected error"))}}}yt.template=`
  <div
    class="inner"
    set="@finished: isFinished; @uploading: isUploading; @failed: isFailed; @limit-overflow: isLimitOverflow; @focused: isFocused"
  >
    <div class="thumb" set="style.backgroundImage: thumbUrl">
      <div class="badge">
        <lr-icon set="@name: badgeIcon"></lr-icon>
      </div>
    </div>
    <div class="file-name-wrapper">
      <span class="file-name" set="@title: itemName">{{itemName}}</span>
      <span class="file-error" set="@hidden: !errorText">{{errorText}}</span>
    </div>
    <div class="file-actions">
      <button type="button" class="edit-btn mini-btn" set="onclick: onEdit; @hidden: !isEditable">
        <lr-icon name="edit-file"></lr-icon>
      </button>
      <button type="button" class="remove-btn mini-btn" set="onclick: onRemove;">
        <lr-icon name="remove-file"></lr-icon>
      </button>
      <button type="button" class="upload-btn mini-btn" set="onclick: onUpload;">
        <lr-icon name="upload"></lr-icon>
      </button>
    </div>
    <lr-progress-bar
      class="progress-bar"
      set="value: progressValue; visible: progressVisible; unknown: progressUnknown"
    >
    </lr-progress-bar>
  </div>
`;yt.activeInstances=new Set;class ac{constructor(){p(this,"caption","");p(this,"text","");p(this,"iconName","");p(this,"isError",!1)}}class Bn extends J{constructor(){super(...arguments);p(this,"init$",{...this.init$,iconName:"info",captionTxt:"Message caption",msgTxt:"Message...","*message":null,onClose:()=>{this.$["*message"]=null}})}initCallback(){super.initCallback(),this.sub("*message",e=>{e?(this.setAttribute("active",""),this.set$({captionTxt:e.caption||"",msgTxt:e.text||"",iconName:e.isError?"error":"info"}),e.isError?this.setAttribute("error",""):this.removeAttribute("error")):this.removeAttribute("active")})}}Bn.template=`
  <div class="heading">
    <lr-icon set="@name: iconName"></lr-icon>
    <div class="caption">{{captionTxt}}</div>
    <button type="button" set="onclick: onClose">
      <lr-icon name="close"></lr-icon>
    </button>
  </div>
  <div class="msg">{{msgTxt}}</div>
`;class zn extends W{constructor(){super(...arguments);p(this,"couldBeUploadCollectionOwner",!0);p(this,"historyTracked",!0);p(this,"activityType",F.activities.UPLOAD_LIST);p(this,"init$",{...this.init$,doneBtnVisible:!1,doneBtnEnabled:!1,uploadBtnVisible:!1,addMoreBtnVisible:!1,addMoreBtnEnabled:!1,headerText:"",hasFiles:!1,onAdd:()=>{this.initFlow(!0)},onUpload:()=>{this.uploadAll(),this._updateUploadsState()},onDone:()=>{this.doneFlow()},onCancel:()=>{let e=this.getOutputData(t=>!!t.getValue("fileInfo"));ve.emit(new Se({type:oe.REMOVE,ctx:this.ctxName,data:e})),this.uploadCollection.clearAll()}});p(this,"_debouncedHandleCollectionUpdate",Ct(()=>{this.isConnected&&(this._updateUploadsState(),this._updateCountLimitMessage())},0))}_validateFilesCount(){let e=!!this.cfg.multiple,t=e?this.cfg.multipleMin??0:1,r=e?this.cfg.multipleMax??0:1,n=this.uploadCollection.size,a=t?n<t:!1,o=r?n>r:!1;return{passed:!a&&!o,tooFew:a,tooMany:o,min:t,max:r,exact:r===n}}_updateCountLimitMessage(){let e=this.uploadCollection.size,t=this._validateFilesCount();if(e&&!t.passed){let r=new ac,n=t.tooFew?"files-count-limit-error-too-few":"files-count-limit-error-too-many";r.caption=this.l10n("files-count-limit-error-title"),r.text=this.l10n(n,{min:t.min,max:t.max,total:e}),r.isError=!0,this.set$({"*message":r})}else this.set$({"*message":null})}_updateUploadsState(){let e=this.uploadCollection.items(),r={total:e.length,succeed:0,uploading:0,failed:0,limitOverflow:0};for(let m of e){let f=this.uploadCollection.read(m);f.getValue("fileInfo")&&!f.getValue("validationErrorMsg")&&(r.succeed+=1),f.getValue("isUploading")&&(r.uploading+=1),(f.getValue("validationErrorMsg")||f.getValue("uploadError"))&&(r.failed+=1),f.getValue("validationMultipleLimitMsg")&&(r.limitOverflow+=1)}const{passed:n,tooMany:a,exact:o}=this._validateFilesCount(),l=r.failed===0&&r.limitOverflow===0;let c=!1,u=!1,d=!1;r.total-r.succeed-r.uploading-r.failed>0&&n?c=!0:(u=!0,d=r.total===r.succeed&&n&&l),this.set$({doneBtnVisible:u,doneBtnEnabled:d,uploadBtnVisible:c,addMoreBtnEnabled:r.total===0||!a&&!o,addMoreBtnVisible:!o||this.cfg.multiple,headerText:this._getHeaderText(r)})}_getHeaderText(e){const t=r=>{const n=e[r];return this.l10n(`header-${r}`,{count:n})};return e.uploading>0?t("uploading"):e.failed>0?t("failed"):e.succeed>0?t("succeed"):t("total")}initCallback(){super.initCallback(),this.registerActivity(this.activityType),this.subConfigValue("multiple",this._debouncedHandleCollectionUpdate),this.subConfigValue("multipleMin",this._debouncedHandleCollectionUpdate),this.subConfigValue("multipleMax",this._debouncedHandleCollectionUpdate),this.sub("*currentActivity",e=>{var t;((t=this.uploadCollection)==null?void 0:t.size)===0&&!this.cfg.showEmptyList&&e===this.activityType&&(this.$["*currentActivity"]=this.initActivity)}),this.uploadCollection.observe(this._debouncedHandleCollectionUpdate),this.sub("*uploadList",e=>{this._debouncedHandleCollectionUpdate(),this.set$({hasFiles:e.length>0}),(e==null?void 0:e.length)===0&&!this.cfg.showEmptyList&&this.historyBack(),this.cfg.confirmUpload||this.add$({"*uploadTrigger":{}},!0)})}destroyCallback(){super.destroyCallback(),this.uploadCollection.unobserve(this._debouncedHandleCollectionUpdate)}}zn.template=`
  <lr-activity-header>
    <span class="header-text">{{headerText}}</span>
    <button type="button" class="mini-btn close-btn" set="onclick: *closeModal">
      <lr-icon name="close"></lr-icon>
    </button>
  </lr-activity-header>

  <div class="no-files" set="@hidden: hasFiles">
    <slot name="empty"><span l10n="no-files"></span></slot>
  </div>

  <div class="files" repeat="*uploadList" repeat-item-tag="lr-file-item"></div>

  <div class="toolbar">
    <button type="button" class="cancel-btn secondary-btn" set="onclick: onCancel;" l10n="clear"></button>
    <div class="toolbar-spacer"></div>
    <button
      type="button"
      class="add-more-btn secondary-btn"
      set="onclick: onAdd; @disabled: !addMoreBtnEnabled; @hidden: !addMoreBtnVisible"
    >
      <lr-icon name="add"></lr-icon><span l10n="add-more"></span>
    </button>
    <button
      type="button"
      class="upload-btn primary-btn"
      set="@hidden: !uploadBtnVisible; onclick: onUpload;"
      l10n="upload"
    ></button>
    <button
      type="button"
      class="done-btn primary-btn"
      set="@hidden: !doneBtnVisible; onclick: onDone;  @disabled: !doneBtnEnabled"
      l10n="done"
    ></button>
  </div>

  <lr-drop-area ghost></lr-drop-area>
`;class Hn extends W{constructor(){super(...arguments);p(this,"activityType",F.activities.URL);p(this,"init$",{...this.init$,importDisabled:!0,onUpload:e=>{e.preventDefault();let t=this.ref.input.value;this.addFileFromUrl(t,{source:Qe.URL_TAB}),this.$["*currentActivity"]=F.activities.UPLOAD_LIST},onCancel:()=>{this.historyBack()},onInput:e=>{let t=e.target.value;this.set$({importDisabled:!t})}})}initCallback(){super.initCallback(),this.registerActivity(this.activityType,{onActivate:()=>{this.ref.input.value="",this.ref.input.focus()}})}}Hn.template=`
  <lr-activity-header>
    <button type="button" class="mini-btn" set="onclick: *historyBack">
      <lr-icon name="back"></lr-icon>
    </button>
    <div>
      <lr-icon name="url"></lr-icon>
      <span l10n="caption-from-url"></span>
    </div>
    <button type="button" class="mini-btn close-btn" set="onclick: *closeModal">
      <lr-icon name="close"></lr-icon>
    </button>
  </lr-activity-header>
  <form class="content">
    <input placeholder="https://" class="url-input" type="text" ref="input" set="oninput: onInput" />
    <button
      type="submit"
      class="url-upload-btn primary-btn"
      set="onclick: onUpload; @disabled: importDisabled"
    ></button>
  </form>
`;const Mr=()=>typeof navigator.permissions<"u";class jn extends W{constructor(){super(...arguments);p(this,"activityType",F.activities.CAMERA);p(this,"_unsubPermissions",null);p(this,"init$",{...this.init$,video:null,videoTransformCss:null,shotBtnDisabled:!0,videoHidden:!0,messageHidden:!0,requestBtnHidden:Mr(),l10nMessage:null,originalErrorMessage:null,cameraSelectOptions:null,cameraSelectHidden:!0,onCameraSelectChange:e=>{this._selectedCameraId=e.target.value,this._capture()},onCancel:()=>{this.historyBack()},onShot:()=>{this._shot()},onRequestPermissions:()=>{this._capture()}});p(this,"_onActivate",()=>{Mr()&&this._subscribePermissions(),this._capture()});p(this,"_onDeactivate",()=>{this._unsubPermissions&&this._unsubPermissions(),this._stopCapture()});p(this,"_handlePermissionsChange",()=>{this._capture()});p(this,"_setPermissionsState",Ct(e=>{this.$.originalErrorMessage=null,this.classList.toggle("initialized",e==="granted"),e==="granted"?this.set$({videoHidden:!1,shotBtnDisabled:!1,messageHidden:!0}):e==="prompt"?(this.$.l10nMessage=this.l10n("camera-permissions-prompt"),this.set$({videoHidden:!0,shotBtnDisabled:!0,messageHidden:!1}),this._stopCapture()):(this.$.l10nMessage=this.l10n("camera-permissions-denied"),this.set$({videoHidden:!0,shotBtnDisabled:!0,messageHidden:!1}),this._stopCapture())},300))}async _subscribePermissions(){try{(await navigator.permissions.query({name:"camera"})).addEventListener("change",this._handlePermissionsChange)}catch(e){console.log("Failed to use permissions API. Fallback to manual request mode.",e),this._capture()}}async _capture(){let e={video:{width:{ideal:1920},height:{ideal:1080},frameRate:{ideal:30}},audio:!1};this._selectedCameraId&&(e.video.deviceId={exact:this._selectedCameraId}),this._canvas=document.createElement("canvas"),this._ctx=this._canvas.getContext("2d");try{this._setPermissionsState("prompt");let t=await navigator.mediaDevices.getUserMedia(e);t.addEventListener("inactive",()=>{this._setPermissionsState("denied")}),this.$.video=t,this._capturing=!0,this._setPermissionsState("granted")}catch(t){this._setPermissionsState("denied"),this.$.originalErrorMessage=t.message}}_stopCapture(){var e;this._capturing&&((e=this.$.video)==null||e.getTracks()[0].stop(),this.$.video=null,this._capturing=!1)}_shot(){this._canvas.height=this.ref.video.videoHeight,this._canvas.width=this.ref.video.videoWidth,this._ctx.drawImage(this.ref.video,0,0);let e=Date.now(),t=`camera-${e}.png`;this._canvas.toBlob(r=>{let n=new File([r],t,{lastModified:e,type:"image/png"});this.addFileFromObject(n,{source:Qe.CAMERA}),this.set$({"*currentActivity":F.activities.UPLOAD_LIST})})}async initCallback(){super.initCallback(),this.registerActivity(this.activityType,{onActivate:this._onActivate,onDeactivate:this._onDeactivate}),this.subConfigValue("cameraMirror",e=>{this.$.videoTransformCss=e?"scaleX(-1)":null});try{let t=(await navigator.mediaDevices.enumerateDevices()).filter(r=>r.kind==="videoinput").map((r,n)=>({text:r.label.trim()||`${this.l10n("caption-camera")} ${n+1}`,value:r.deviceId}));t.length>1&&(this.$.cameraSelectOptions=t,this.$.cameraSelectHidden=!1)}catch{}}}jn.template=`
  <lr-activity-header>
    <button type="button" class="mini-btn" set="onclick: *historyBack">
      <lr-icon name="back"></lr-icon>
    </button>
    <div set="@hidden: !cameraSelectHidden">
      <lr-icon name="camera"></lr-icon>
      <span l10n="caption-camera"></span>
    </div>
    <lr-select
      class="camera-select"
      set="$.options: cameraSelectOptions; @hidden: cameraSelectHidden; onchange: onCameraSelectChange"
    >
    </lr-select>
    <button type="button" class="mini-btn close-btn" set="onclick: *closeModal">
      <lr-icon name="close"></lr-icon>
    </button>
  </lr-activity-header>
  <div class="content">
    <video
      autoplay
      playsinline
      set="srcObject: video; style.transform: videoTransformCss; @hidden: videoHidden"
      ref="video"
    ></video>
    <div class="message-box" set="@hidden: messageHidden">
      <span>{{l10nMessage}}</span>
      <span>{{originalErrorMessage}}</span>
      <button
        type="button"
        set="onclick: onRequestPermissions; @hidden: requestBtnHidden"
        l10n="camera-permissions-request"
      ></button>
    </div>
    <button type="button" class="shot-btn" set="onclick: onShot; @disabled: shotBtnDisabled">
      <lr-icon name="camera"></lr-icon>
    </button>
  </div>
`;class oc extends W{}class Wn extends W{constructor(){super(...arguments);p(this,"activityType",F.activities.DETAILS);p(this,"pauseRender",!0);p(this,"init$",{...this.init$,checkerboard:!1,fileSize:null,fileName:"",cdnUrl:"",errorTxt:"",cloudEditBtnHidden:!0,onNameInput:null,onBack:()=>{this.historyBack()},onRemove:()=>{this.uploadCollection.remove(this.entry.uid),this.historyBack()},onCloudEdit:()=>{this.entry.getValue("uuid")&&(this.$["*currentActivity"]=F.activities.CLOUD_IMG_EDIT)}})}showNonImageThumb(){let e=window.getComputedStyle(this).getPropertyValue("--clr-generic-file-icon"),t=Os(e,108,108);this.ref.filePreview.setImageUrl(t),this.set$({checkerboard:!1})}initCallback(){super.initCallback(),this.render(),this.$.fileSize=this.l10n("file-size-unknown"),this.registerActivity(this.activityType,{onDeactivate:()=>{this.ref.filePreview.clear()}}),this.sub("*focusedEntry",e=>{if(!e)return;this._entrySubs?this._entrySubs.forEach(n=>{this._entrySubs.delete(n),n.remove()}):this._entrySubs=new Set,this.entry=e;let t=e.getValue("file");if(t){this._file=t;let n=Is(this._file);n&&!e.getValue("cdnUrl")&&(this.ref.filePreview.setImageFile(this._file),this.set$({checkerboard:!0})),n||this.showNonImageThumb()}let r=(n,a)=>{this._entrySubs.add(this.entry.subscribe(n,a))};r("fileName",n=>{this.$.fileName=n,this.$.onNameInput=()=>{let a=this.ref.file_name_input.value;Object.defineProperty(this._file,"name",{writable:!0,value:a}),this.entry.setValue("fileName",a)}}),r("fileSize",n=>{this.$.fileSize=Number.isFinite(n)?this.fileSizeFmt(n):this.l10n("file-size-unknown")}),r("uploadError",n=>{this.$.errorTxt=n==null?void 0:n.message}),r("externalUrl",n=>{n&&(this.entry.getValue("uuid")||this.showNonImageThumb())}),r("cdnUrl",n=>{const a=this.cfg.useCloudImageEditor&&n&&this.entry.getValue("isImage");if(n&&this.ref.filePreview.clear(),this.set$({cdnUrl:n,cloudEditBtnHidden:!a}),n&&this.entry.getValue("isImage")){let o=Ce(n,Ne("format/auto","preview"));this.ref.filePreview.setImageUrl(this.proxyUrl(o))}})})}}Wn.template=`
  <lr-activity-header>
    <button type="button" class="mini-btn" set="onclick: *historyBack">
      <lr-icon name="back"></lr-icon>
    </button>
    <span l10n="caption-edit-file"></span>
    <button type="button" class="mini-btn close-btn" set="onclick: *closeModal">
      <lr-icon name="close"></lr-icon>
    </button>
  </lr-activity-header>
  <div class="content">
    <lr-tabs tab-list="tab-view, tab-details">
      <div tab-ctx="tab-details" class="details">
        <div class="info-block">
          <div class="info-block_name" l10n="file-name"></div>
          <input
            name="name-input"
            ref="file_name_input"
            set="value: fileName; oninput: onNameInput; @disabled: !!cdnUrl"
            type="text"
          />
        </div>

        <div class="info-block">
          <div class="info-block_name" l10n="file-size"></div>
          <div>{{fileSize}}</div>
        </div>

        <div class="info-block">
          <div class="info-block_name" l10n="cdn-url"></div>
          <a class="cdn-link" target="_blank" set="@href: cdnUrl; @disabled: !cdnUrl">{{cdnUrl}}</a>
        </div>

        <div>{{errorTxt}}</div>
      </div>

      <lr-file-preview tab-ctx="tab-view" set="@checkerboard: checkerboard;" ref="filePreview"> </lr-file-preview>
    </lr-tabs>

    <div class="toolbar" set="@edit-disabled: cloudEditBtnHidden">
      <button type="button" class="edit-btn secondary-btn" set="onclick: onCloudEdit; @hidden: cloudEditBtnHidden;">
        <lr-icon name="edit"></lr-icon>
        <span l10n="edit-image"></span>
      </button>
      <button type="button" class="remove-btn secondary-btn" set="onclick: onRemove">
        <lr-icon name="remove"></lr-icon>
        <span l10n="remove-from-list"></span>
      </button>
      <div></div>
      <button type="button" class="back-btn primary-btn" set="onclick: onBack">
        <span l10n="ok"></span>
      </button>
    </div>
  </div>
`;class lc{constructor(){p(this,"captionL10nStr","confirm-your-action");p(this,"messageL10Str","are-you-sure");p(this,"confirmL10nStr","yes");p(this,"denyL10nStr","no")}confirmAction(){console.log("Confirmed")}denyAction(){this.historyBack()}}class Gn extends F{constructor(){super(...arguments);p(this,"activityType",F.activities.CONFIRMATION);p(this,"_defaults",new lc);p(this,"init$",{...this.init$,activityCaption:"",messageTxt:"",confirmBtnTxt:"",denyBtnTxt:"","*confirmation":null,onConfirm:this._defaults.confirmAction,onDeny:this._defaults.denyAction.bind(this)})}initCallback(){super.initCallback(),this.set$({messageTxt:this.l10n(this._defaults.messageL10Str),confirmBtnTxt:this.l10n(this._defaults.confirmL10nStr),denyBtnTxt:this.l10n(this._defaults.denyL10nStr)}),this.sub("*confirmation",e=>{e&&this.set$({"*currentActivity":F.activities.CONFIRMATION,activityCaption:this.l10n(e.captionL10nStr),messageTxt:this.l10n(e.messageL10Str),confirmBtnTxt:this.l10n(e.confirmL10nStr),denyBtnTxt:this.l10n(e.denyL10nStr),onDeny:()=>{e.denyAction()},onConfirm:()=>{e.confirmAction()}})})}}Gn.template=`
  <lr-activity-header>
    <button type="button" class="mini-btn" set="onclick: *historyBack">
      <lr-icon name="back"></lr-icon>
    </button>
    <span>{{activityCaption}}</span>
    <button type="button" class="mini-btn close-btn" set="onclick: *closeModal">
      <lr-icon name="close"></lr-icon>
    </button>
  </lr-activity-header>

  <div class="message">{{messageTxt}}</div>
  <div class="toolbar">
    <button type="button" class="deny-btn secondary-btn" set="onclick: onDeny">{{denyBtnTxt}}</button>
    <button type="button" class="confirm-btn primary-btn" set="onclick: onConfirm">{{confirmBtnTxt}}</button>
  </div>
`;class Xn extends W{constructor(){super(...arguments);p(this,"init$",{...this.init$,visible:!1,unknown:!1,value:0,"*commonProgress":0})}initCallback(){super.initCallback(),this.uploadCollection.observe(()=>{let e=this.uploadCollection.items().some(t=>this.uploadCollection.read(t).getValue("isUploading"));this.$.visible=e}),this.sub("visible",e=>{e?this.setAttribute("active",""):this.removeAttribute("active")}),this.sub("*commonProgress",e=>{this.$.value=e})}}Xn.template=`
  <lr-progress-bar set="visible: visible; unknown: unknown; value: value"></lr-progress-bar>
`;class qn extends J{constructor(){super(...arguments);p(this,"_value",0);p(this,"_unknownMode",!1);p(this,"init$",{...this.init$,width:0,opacity:0})}initCallback(){super.initCallback(),this.defineAccessor("value",e=>{e!==void 0&&(this._value=e,this._unknownMode||this.style.setProperty("--l-width",this._value.toString()))}),this.defineAccessor("visible",e=>{this.ref.line.classList.toggle("progress--hidden",!e)}),this.defineAccessor("unknown",e=>{this._unknownMode=e,this.ref.line.classList.toggle("progress--unknown",e)})}}qn.template=' <div ref="line" class="progress"></div> ';const st="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mNkYAAAAAYAAjCB0C8AAAAASUVORK5CYII=";class Js extends J{constructor(){super();p(this,"init$",{...this.init$,checkerboard:!1,src:st})}initCallback(){super.initCallback(),this.sub("checkerboard",()=>{this.style.backgroundImage=this.hasAttribute("checkerboard")?`url(${rc()})`:"unset"})}destroyCallback(){super.destroyCallback(),URL.revokeObjectURL(this._lastObjectUrl)}setImage(e){this.$.src=e.src}setImageFile(e){let t=URL.createObjectURL(e);this.$.src=t,this._lastObjectUrl=t}setImageUrl(e){this.$.src=e}clear(){URL.revokeObjectURL(this._lastObjectUrl),this.$.src=st}}Js.template=' <lr-img class="img-view" ref="img" set="@src: src; style.aa: src;" /> ';Js.bindAttributes({checkerboard:"checkerboard"});const Fr="--cfg-ctx-name";class ct extends J{get cfgCssCtxName(){return this.getCssData(Fr,!0)}get cfgCtxName(){var e;const s=((e=this.getAttribute("ctx-name"))==null?void 0:e.trim())||this.cfgCssCtxName||this.__cachedCfgCtxName;return this.__cachedCfgCtxName=s,s}connectedCallback(){var s;if(!this.connectedOnce){const e=(s=this.getAttribute("ctx-name"))==null?void 0:s.trim();e&&this.style.setProperty(Fr,`'${e}'`)}super.connectedCallback()}parseCfgProp(s){return{...super.parseCfgProp(s),ctx:X.getCtx(this.cfgCtxName)}}}function Kn(...i){return i.reduce((s,e)=>{if(typeof e=="string")return s[e]=!0,s;for(let t of Object.keys(e))s[t]=e[t];return s},{})}function ke(...i){let s=Kn(...i);return Object.keys(s).reduce((e,t)=>(s[t]&&e.push(t),e),[]).join(" ")}function cc(i,...s){let e=Kn(...s);for(let t of Object.keys(e))i.classList.toggle(t,e[t])}function Ht(i,s){let e,t=(...r)=>{clearTimeout(e),e=setTimeout(()=>i(...r),s)};return t.cancel=()=>{clearTimeout(e)},t}const be={brightness:0,exposure:0,gamma:100,contrast:0,saturation:0,vibrance:0,warmth:0,enhance:0,filter:0,rotate:0};function uc(i,s){if(typeof s=="number")return be[i]!==s?`${i}/${s}`:"";if(typeof s=="boolean")return s&&be[i]!==s?`${i}`:"";if(i==="filter"){if(!s||be[i]===s.amount)return"";let{name:e,amount:t}=s;return`${i}/${e}/${t}`}if(i==="crop"){if(!s)return"";let{dimensions:e,coords:t}=s;return`${i}/${e.join("x")}/${t.join(",")}`}return""}const Yn=["enhance","brightness","exposure","gamma","contrast","saturation","vibrance","warmth","filter","mirror","flip","rotate","crop"];function rs(i){return Ys(...Yn.filter(s=>typeof i[s]<"u"&&i[s]!==null).map(s=>{let e=i[s];return uc(s,e)}).filter(s=>!!s))}const Zn=Ys("format/auto","progressive/yes"),Be=([i])=>typeof i<"u"?Number(i):void 0,Vr=()=>!0,dc=([i,s])=>({name:i,amount:typeof s<"u"?Number(s):100}),hc=([i,s])=>({dimensions:qe(i,"x").map(Number),coords:qe(s).map(Number)}),fc={enhance:Be,brightness:Be,exposure:Be,gamma:Be,contrast:Be,saturation:Be,vibrance:Be,warmth:Be,filter:dc,mirror:Vr,flip:Vr,rotate:Be,crop:hc};function pc(i){let s={};for(let e of i){let[t,...r]=e.split("/");if(!Yn.includes(t))continue;const n=fc[t],a=n(r);s[t]=a}return s}function mc(i){return{"*originalUrl":null,"*faderEl":null,"*cropperEl":null,"*imgEl":null,"*imgContainerEl":null,"*networkProblems":!1,"*imageSize":null,"*editorTransformations":{},entry:null,extension:null,editorMode:!1,modalCaption:"",isImage:!1,msg:"",src:st,fileType:"",showLoader:!1,uuid:null,cdnUrl:null,"presence.networkProblems":!1,"presence.modalCaption":!0,"presence.editorToolbar":!1,"presence.viewerToolbar":!0,"*on.retryNetwork":()=>{let s=i.querySelectorAll("img");for(let e of s){let t=e.src;e.src=st,e.src=t}i.$["*networkProblems"]=!1},"*on.apply":s=>{if(!s)return;let e=i.$["*originalUrl"],t=Ne(rs(s)),r=Ce(e,Ne(t,"preview")),n={originalUrl:e,cdnUrlModifiers:t,cdnUrl:r,transformations:s};i.dispatchEvent(new CustomEvent("apply",{detail:n,bubbles:!0,composed:!0})),i.remove()},"*on.cancel":()=>{i.remove(),i.dispatchEvent(new CustomEvent("cancel",{bubbles:!0,composed:!0}))}}}const gc=`
  <div class="wrapper wrapper_desktop">
    <lr-presence-toggle class="network_problems_splash" set="visible: presence.networkProblems;">
      <div class="network_problems_content">
        <div class="network_problems_icon">
          <lr-icon size="20" name="sad"></lr-icon>
        </div>
        <div class="network_problems_text">Network error</div>
      </div>
      <div class="network_problems_footer">
        <lr-btn-ui theme="primary" text="Retry" set="onclick: *on.retryNetwork"></lr-btn-ui>
      </div>
    </lr-presence-toggle>
    <div class="viewport">
      <div class="file_type_outer">
        <div class="file_type">{{fileType}}</div>
      </div>
      <div class="image_container" ref="img-container-el">
        <img src="${st}" class="image image_visible_from_editor" ref="img-el" />
        <lr-editor-image-cropper ref="cropper-el"></lr-editor-image-cropper>
        <lr-editor-image-fader ref="fader-el"></lr-editor-image-fader>
      </div>
      <div class="info_pan">{{msg}}</div>
    </div>
    <div class="toolbar">
      <lr-line-loader-ui set="active: showLoader"></lr-line-loader-ui>
      <div class="toolbar_content toolbar_content__editor">
        <lr-editor-toolbar></lr-editor-toolbar>
      </div>
    </div>
  </div>
`,ge={CROP:"crop",SLIDERS:"sliders",FILTERS:"filters"},Ls=[ge.CROP,ge.SLIDERS,ge.FILTERS],vc=["brightness","exposure","gamma","contrast","saturation","vibrance","warmth","enhance"],_c=["adaris","briaril","calarel","carris","cynarel","cyren","elmet","elonni","enzana","erydark","fenralan","ferand","galen","gavin","gethriel","iorill","iothari","iselva","jadis","lavra","misiara","namala","nerion","nethari","pamaya","sarnar","sedis","sewen","sorahel","sorlen","tarian","thellassan","varriel","varven","vevera","virkas","yedis","yllara","zatvel","zevcen"],bc=["rotate","mirror","flip"],jt={brightness:{zero:be.brightness,range:[-100,100],keypointsNumber:2},exposure:{zero:be.exposure,range:[-500,500],keypointsNumber:2},gamma:{zero:be.gamma,range:[0,1e3],keypointsNumber:2},contrast:{zero:be.contrast,range:[-100,500],keypointsNumber:2},saturation:{zero:be.saturation,range:[-100,500],keypointsNumber:1},vibrance:{zero:be.vibrance,range:[-100,500],keypointsNumber:1},warmth:{zero:be.warmth,range:[-100,100],keypointsNumber:1},enhance:{zero:be.enhance,range:[0,100],keypointsNumber:1},filter:{zero:be.filter,range:[0,100],keypointsNumber:1}};class Xt extends ct{constructor(){super(...arguments);p(this,"init$",{...this.init$,...mc(this)});p(this,"_debouncedShowLoader",Ht(this._showLoader.bind(this),300))}get ctxName(){return this.autoCtxName}_showLoader(e){this.$.showLoader=e}_waitForSize(){return new Promise((t,r)=>{const n=setTimeout(()=>{r(new Error("[cloud-image-editor] timeout waiting for non-zero container size"))},3e3),a=new ResizeObserver(([o])=>{o.contentRect.width>0&&o.contentRect.height>0&&(t(),clearTimeout(n),a.disconnect())});a.observe(this)})}initCallback(){super.initCallback(),this.$["*faderEl"]=this.ref["fader-el"],this.$["*cropperEl"]=this.ref["cropper-el"],this.$["*imgContainerEl"]=this.ref["img-container-el"],this.initEditor()}async initEditor(){try{await this._waitForSize()}catch(e){this.isConnected&&console.error(e.message);return}if(this.ref["img-el"].addEventListener("load",()=>{this._imgLoading=!1,this._debouncedShowLoader(!1),this.$.src!==st&&(this.$["*networkProblems"]=!1)}),this.ref["img-el"].addEventListener("error",()=>{this._imgLoading=!1,this._debouncedShowLoader(!1),this.$["*networkProblems"]=!0}),this.sub("src",e=>{let t=this.ref["img-el"];t.src!==e&&(this._imgLoading=!0,t.src=e||st)}),this.sub("*tabId",e=>{this.ref["img-el"].className=ke("image",{image_hidden_to_cropper:e===ge.CROP,image_hidden_effects:e!==ge.CROP})}),this.$.cdnUrl){let e=jl(this.$.cdnUrl);this.$["*originalUrl"]=li(this.$.cdnUrl,e);let t=Wl(this.$.cdnUrl),r=pc(t);this.$["*editorTransformations"]=r}else if(this.$.uuid)this.$["*originalUrl"]=li(this.cfg.cdnCname,this.$.uuid);else throw new Error("No UUID nor CDN URL provided");this.classList.add("editor_ON"),this.sub("*networkProblems",e=>{this.$["presence.networkProblems"]=e,this.$["presence.modalCaption"]=!e}),this.sub("*editorTransformations",e=>{let t=this.$["*originalUrl"],r=Ne(rs(e)),n=Ce(t,Ne(r,"preview")),a={originalUrl:t,cdnUrlModifiers:r,cdnUrl:n,transformations:e};this.dispatchEvent(new CustomEvent("change",{detail:a,bubbles:!0,composed:!0}))},!1);try{fetch(Ce(this.$["*originalUrl"],Ne("json"))).then(e=>e.json()).then(e=>{const{width:t,height:r}=e;this.$["*imageSize"]={width:t,height:r}})}catch(e){e&&console.error("Failed to load image info",e)}}}p(Xt,"className","cloud-image-editor");Xt.template=gc;Xt.bindAttributes({uuid:"uuid","cdn-url":"cdnUrl"});const yc=20,ji=24,ni=34,Jn=3,xe=Jn/2,mt=1,Ii=100/3,Pe=ji*2+ni;function kt(i,s){for(let e in s)i.setAttributeNS(null,e,s[e].toString())}function Ae(i,s={}){let e=document.createElementNS("http://www.w3.org/2000/svg",i);return kt(e,s),e}function Ec(i,s){let{x:e,y:t,width:r,height:n}=i,a=s.includes("w")?0:1,o=s.includes("n")?0:1,l=[-1,1][a],c=[-1,1][o],u=[e+a*r+xe*l,t+o*n+xe*c-ji*c],d=[e+a*r+xe*l,t+o*n+xe*c],h=[e+a*r-ji*l+xe*l,t+o*n+xe*c];return{d:`M ${u[0]} ${u[1]} L ${d[0]} ${d[1]} L ${h[0]} ${h[1]}`,center:d}}function Cc(i,s){let{x:e,y:t,width:r,height:n}=i,a=["n","s"].includes(s)?.5:{w:0,e:1}[s],o=["w","e"].includes(s)?.5:{n:0,s:1}[s],l=[-1,1][a],c=[-1,1][o],u,d;["n","s"].includes(s)?(u=[e+a*r-ni/2,t+o*n+xe*c],d=[e+a*r+ni/2,t+o*n+xe*c]):(u=[e+a*r+xe*l,t+o*n-ni/2],d=[e+a*r+xe*l,t+o*n+ni/2]);let h=`M ${u[0]} ${u[1]} L ${d[0]} ${d[1]}`,m=[d[0]-(d[0]-u[0])/2,d[1]-(d[1]-u[1])/2];return{d:h,center:m}}function wc(i){return i===""?"move":["e","w"].includes(i)?"ew-resize":["n","s"].includes(i)?"ns-resize":["nw","se"].includes(i)?"nwse-resize":"nesw-resize"}function Tc(i,[s,e]){return{...i,x:i.x+s,y:i.y+e}}function Qn(i,s){let{x:e}=i,{y:t}=i;return i.x<s.x?e=s.x:i.x+i.width>s.x+s.width&&(e=s.x+s.width-i.width),i.y<s.y?t=s.y:i.y+i.height>s.y+s.height&&(t=s.y+s.height-i.height),{...i,x:e,y:t}}function Ac(i,[s,e],t){let{x:r,y:n,width:a,height:o}=i;return t.includes("n")&&(n+=e,o-=e),t.includes("s")&&(o+=e),t.includes("w")&&(r+=s,a-=s),t.includes("e")&&(a+=s),{x:r,y:n,width:a,height:o}}function Sc(i,s){let e=Math.max(i.x,s.x),t=Math.min(i.x+i.width,s.x+s.width),r=Math.max(i.y,s.y),n=Math.min(i.y+i.height,s.y+s.height);return{x:e,y:r,width:t-e,height:n-r}}function ea(i,[s,e],t){let{x:r,y:n,width:a,height:o}=i;if(t.includes("n")){let l=o;o=Math.max(e,o),n=n+l-o}if(t.includes("s")&&(o=Math.max(e,o)),t.includes("w")){let l=a;a=Math.max(s,a),r=r+l-a}return t.includes("e")&&(a=Math.max(s,a)),{x:r,y:n,width:a,height:o}}function xc(i,[s,e]){return i.x<=s&&s<=i.x+i.width&&i.y<=e&&e<=i.y+i.height}class ta extends ct{constructor(){super();p(this,"init$",{...this.init$,dragging:!1});this._handlePointerUp=this._handlePointerUp_.bind(this),this._handlePointerMove=this._handlePointerMove_.bind(this),this._handleSvgPointerMove=this._handleSvgPointerMove_.bind(this)}_shouldThumbBeDisabled(e){let t=this.$["*imageBox"];if(!t)return;if(e===""&&t.height<=Pe&&t.width<=Pe)return!0;let r=t.height<=Pe&&(e.includes("n")||e.includes("s")),n=t.width<=Pe&&(e.includes("e")||e.includes("w"));return r||n}_createBackdrop(){let e=this.$["*cropBox"];if(!e)return;let{x:t,y:r,width:n,height:a}=e,o=this.ref["svg-el"],l=Ae("mask",{id:"backdrop-mask"}),c=Ae("rect",{x:0,y:0,width:"100%",height:"100%",fill:"white"}),u=Ae("rect",{x:t,y:r,width:n,height:a,fill:"black"});l.appendChild(c),l.appendChild(u);let d=Ae("rect",{x:0,y:0,width:"100%",height:"100%",fill:"var(--color-image-background)","fill-opacity":.85,mask:"url(#backdrop-mask)"});o.appendChild(d),o.appendChild(l),this._backdropMask=l,this._backdropMaskInner=u}_resizeBackdrop(){this._backdropMask&&(this._backdropMask.style.display="none",window.requestAnimationFrame(()=>{this._backdropMask.style.display="block"}))}_updateBackdrop(){let e=this.$["*cropBox"];if(!e)return;let{x:t,y:r,width:n,height:a}=e;kt(this._backdropMaskInner,{x:t,y:r,width:n,height:a})}_updateFrame(){let e=this.$["*cropBox"];if(!e)return;for(let r of Object.values(this._frameThumbs)){let{direction:n,pathNode:a,interactionNode:o,groupNode:l}=r,c=n==="",u=n.length===2;if(c){let{x:h,y:m,width:f,height:g}=e,b=[h+f/2,m+g/2];kt(o,{r:Math.min(f,g)/3,cx:b[0],cy:b[1]})}else{let{d:h,center:m}=u?Ec(e,n):Cc(e,n);kt(o,{cx:m[0],cy:m[1]}),kt(a,{d:h})}let d=this._shouldThumbBeDisabled(n);l.setAttribute("class",ke("thumb",{"thumb--hidden":d,"thumb--visible":!d}))}let t=this._frameGuides;kt(t,{x:e.x-mt*.5,y:e.y-mt*.5,width:e.width+mt,height:e.height+mt})}_createThumbs(){let e={};for(let t=0;t<3;t++)for(let r=0;r<3;r++){let n=`${["n","","s"][t]}${["w","","e"][r]}`,a=Ae("g");a.classList.add("thumb"),a.setAttribute("with-effects","");let o=Ae("circle",{r:ji+xe,fill:"transparent"}),l=Ae("path",{stroke:"currentColor",fill:"none","stroke-width":Jn});a.appendChild(l),a.appendChild(o),e[n]={direction:n,pathNode:l,interactionNode:o,groupNode:a},o.addEventListener("pointerdown",this._handlePointerDown.bind(this,n))}return e}_createGuides(){let e=Ae("svg"),t=Ae("rect",{x:0,y:0,width:"100%",height:"100%",fill:"none",stroke:"#000000","stroke-width":mt,"stroke-opacity":.5});e.appendChild(t);for(let r=1;r<=2;r++){let n=Ae("line",{x1:`${Ii*r}%`,y1:"0%",x2:`${Ii*r}%`,y2:"100%",stroke:"#000000","stroke-width":mt,"stroke-opacity":.3});e.appendChild(n)}for(let r=1;r<=2;r++){let n=Ae("line",{x1:"0%",y1:`${Ii*r}%`,x2:"100%",y2:`${Ii*r}%`,stroke:"#000000","stroke-width":mt,"stroke-opacity":.3});e.appendChild(n)}return e.classList.add("guides","guides--semi-hidden"),e}_createFrame(){let e=this.ref["svg-el"],t=document.createDocumentFragment(),r=this._createGuides();t.appendChild(r);let n=this._createThumbs();for(let{groupNode:a}of Object.values(n))t.appendChild(a);e.appendChild(t),this._frameThumbs=n,this._frameGuides=r}_handlePointerDown(e,t){let r=this._frameThumbs[e];if(this._shouldThumbBeDisabled(e))return;let n=this.$["*cropBox"],{x:a,y:o}=this.ref["svg-el"].getBoundingClientRect(),l=t.x-a,c=t.y-o;this.$.dragging=!0,this._draggingThumb=r,this._dragStartPoint=[l,c],this._dragStartCrop={...n}}_handlePointerUp_(e){this._updateCursor(),this.$.dragging&&(e.stopPropagation(),e.preventDefault(),this.$.dragging=!1)}_handlePointerMove_(e){if(!this.$.dragging)return;e.stopPropagation(),e.preventDefault();let t=this.ref["svg-el"],{x:r,y:n}=t.getBoundingClientRect(),a=e.x-r,o=e.y-n,l=a-this._dragStartPoint[0],c=o-this._dragStartPoint[1],{direction:u}=this._draggingThumb,d=this.$["*imageBox"],h=this._dragStartCrop;u===""?(h=Tc(h,[l,c]),h=Qn(h,d)):(h=Ac(h,[l,c],u),h=Sc(h,d));let m=[Math.min(d.width,Pe),Math.min(d.height,Pe)];if(h=ea(h,m,u),!Object.values(h).every(f=>Number.isFinite(f)&&f>=0)){console.error("CropFrame is trying to create invalid rectangle",{payload:h});return}this.$["*cropBox"]=h}_handleSvgPointerMove_(e){let t=Object.values(this._frameThumbs).find(r=>{if(this._shouldThumbBeDisabled(r.direction))return!1;let a=r.groupNode.getBoundingClientRect(),o={x:a.x,y:a.y,width:a.width,height:a.height};return xc(o,[e.x,e.y])});this._hoverThumb=t,this._updateCursor()}_updateCursor(){let e=this._hoverThumb;this.ref["svg-el"].style.cursor=e?wc(e.direction):"initial"}_render(){this._updateBackdrop(),this._updateFrame()}toggleThumbs(e){Object.values(this._frameThumbs).map(({groupNode:t})=>t).forEach(t=>{t.setAttribute("class",ke("thumb",{"thumb--hidden":!e,"thumb--visible":e}))})}initCallback(){super.initCallback(),this._createBackdrop(),this._createFrame(),this.sub("*imageBox",()=>{this._resizeBackdrop(),window.requestAnimationFrame(()=>{this._render()})}),this.sub("*cropBox",e=>{e&&(this._guidesHidden=e.height<=Pe||e.width<=Pe,window.requestAnimationFrame(()=>{this._render()}))}),this.sub("dragging",e=>{this._frameGuides.setAttribute("class",ke({"guides--hidden":this._guidesHidden,"guides--visible":!this._guidesHidden&&e,"guides--semi-hidden":!this._guidesHidden&&!e}))}),this.ref["svg-el"].addEventListener("pointermove",this._handleSvgPointerMove,!0),document.addEventListener("pointermove",this._handlePointerMove,!0),document.addEventListener("pointerup",this._handlePointerUp,!0)}destroyCallback(){super.destroyCallback(),document.removeEventListener("pointermove",this._handlePointerMove),document.removeEventListener("pointerup",this._handlePointerUp)}}ta.template=' <svg class="svg" ref="svg-el" xmlns="http://www.w3.org/2000/svg"></svg> ';class ns extends ct{constructor(){super(...arguments);p(this,"init$",{...this.init$,active:!1,title:"",icon:"","on.click":null})}initCallback(){super.initCallback(),this._titleEl=this.ref["title-el"],this._iconEl=this.ref["icon-el"],this.setAttribute("role","button"),this.tabIndex===-1&&(this.tabIndex=0),this.sub("title",e=>{this._titleEl&&(this._titleEl.style.display=e?"block":"none")}),this.sub("active",e=>{this.className=ke({active:e,not_active:!e})}),this.sub("on.click",e=>{this.onclick=e})}}ns.template=`
  <div class="before"></div>
  <lr-icon size="20" set="@name: icon;"></lr-icon>
  <div class="title" ref="title-el">{{title}}</div>
`;function $c(i){let s=i+90;return s=s>=360?0:s,s}function Ic(i,s){return i==="rotate"?$c(s):["mirror","flip"].includes(i)?!s:null}class Rs extends ns{initCallback(){super.initCallback(),this.defineAccessor("operation",s=>{s&&(this._operation=s,this.$.icon=s)}),this.$["on.click"]=s=>{let e=this.$["*cropperEl"].getValue(this._operation),t=Ic(this._operation,e);this.$["*cropperEl"].setValue(this._operation,t)}}}const ti={FILTER:"filter",COLOR_OPERATION:"color_operation"},tt="original";class ia extends ct{constructor(){super(...arguments);p(this,"init$",{...this.init$,disabled:!1,min:0,max:100,value:0,defaultValue:0,zero:0,"on.input":e=>{this.$["*faderEl"].set(e),this.$.value=e}})}setOperation(e,t){this._controlType=e==="filter"?ti.FILTER:ti.COLOR_OPERATION,this._operation=e,this._iconName=e,this._title=e.toUpperCase(),this._filter=t,this._initializeValues(),this.$["*faderEl"].activate({url:this.$["*originalUrl"],operation:this._operation,value:this._filter===tt?void 0:this.$.value,filter:this._filter===tt?void 0:this._filter,fromViewer:!1})}_initializeValues(){let{range:e,zero:t}=jt[this._operation],[r,n]=e;this.$.min=r,this.$.max=n,this.$.zero=t;let a=this.$["*editorTransformations"][this._operation];if(this._controlType===ti.FILTER){let o=n;if(a){let{name:l,amount:c}=a;o=l===this._filter?c:n}this.$.value=o,this.$.defaultValue=o}if(this._controlType===ti.COLOR_OPERATION){let o=typeof a<"u"?a:t;this.$.value=o,this.$.defaultValue=o}}apply(){let e;this._controlType===ti.FILTER?this._filter===tt?e=null:e={name:this._filter,amount:this.$.value}:e=this.$.value;let t={...this.$["*editorTransformations"],[this._operation]:e};this.$["*editorTransformations"]=t}cancel(){this.$["*faderEl"].deactivate({hide:!1})}initCallback(){super.initCallback(),this.sub("*originalUrl",e=>{this._originalUrl=e}),this.sub("value",e=>{let t=`${this._filter||this._operation} ${e}`;this.$["*operationTooltip"]=t})}}ia.template=`
  <lr-slider-ui
    ref="slider-el"
    set="disabled: disabled; min: min; max: max; defaultValue: defaultValue; zero: zero; onInput: on.input;"
  ></lr-slider-ui>
`;function Qs(i){let s=new Image;return{promise:new Promise((r,n)=>{s.src=i,s.onload=r,s.onerror=n}),image:s,cancel:()=>{s.naturalWidth===0&&(s.src=st)}}}function Ps(i){let s=[];for(let n of i){let a=Qs(n);s.push(a)}let e=s.map(n=>n.image);return{promise:Promise.allSettled(s.map(n=>n.promise)),images:e,cancel:()=>{s.forEach(n=>{n.cancel()})}}}class Wi extends ns{constructor(){super(...arguments);p(this,"init$",{...this.init$,active:!1,title:"",icon:"",isOriginal:!1,iconSize:"20","on.click":null})}_previewSrc(){let e=parseInt(window.getComputedStyle(this).getPropertyValue("--l-base-min-width"),10),t=window.devicePixelRatio,r=Math.ceil(t*e),n=t>=2?"lightest":"normal",a=100,o={...this.$["*editorTransformations"]};return o[this._operation]=this._filter!==tt?{name:this._filter,amount:a}:void 0,Ce(this._originalUrl,Ne(Zn,rs(o),`quality/${n}`,`scale_crop/${r}x${r}/center`))}_observerCallback(e,t){if(e[0].isIntersecting){let n=this.proxyUrl(this._previewSrc()),a=this.ref["preview-el"],{promise:o,cancel:l}=Qs(n);this._cancelPreload=l,o.catch(c=>{this.$["*networkProblems"]=!0,console.error("Failed to load image",{error:c})}).finally(()=>{a.style.backgroundImage=`url(${n})`,a.setAttribute("loaded",""),t.unobserve(this)})}else this._cancelPreload&&this._cancelPreload()}initCallback(){super.initCallback(),this.$["on.click"]=t=>{this.$.active?this.$.isOriginal||(this.$["*sliderEl"].setOperation(this._operation,this._filter),this.$["*showSlider"]=!0):(this.$["*sliderEl"].setOperation(this._operation,this._filter),this.$["*sliderEl"].apply()),this.$["*currentFilter"]=this._filter},this.defineAccessor("filter",t=>{this._operation="filter",this._filter=t,this.$.isOriginal=t===tt,this.$.icon=this.$.isOriginal?"original":"slider"}),this._observer=new window.IntersectionObserver(this._observerCallback.bind(this),{threshold:[0,1]});let e=this.$["*originalUrl"];this._originalUrl=e,this.$.isOriginal?this.ref["icon-el"].classList.add("original-icon"):this._observer.observe(this),this.sub("*currentFilter",t=>{this.$.active=t&&t===this._filter}),this.sub("isOriginal",t=>{this.$.iconSize=t?40:20}),this.sub("active",t=>{if(this.$.isOriginal)return;let r=this.ref["icon-el"];r.style.opacity=t?"1":"0";let n=this.ref["preview-el"];t?n.style.opacity="0":n.style.backgroundImage&&(n.style.opacity="1")}),this.sub("*networkProblems",t=>{if(!t){let r=this.proxyUrl(this._previewSrc()),n=this.ref["preview-el"];n.style.backgroundImage&&(n.style.backgroundImage="none",n.style.backgroundImage=`url(${r})`)}})}destroyCallback(){var e;super.destroyCallback(),(e=this._observer)==null||e.disconnect(),this._cancelPreload&&this._cancelPreload()}}Wi.template=`
  <div class="before"></div>
  <div class="preview" ref="preview-el"></div>
  <lr-icon size="40" ref="icon-el" set="@name: icon; @size: iconSize;"></lr-icon>
`;class Us extends ns{constructor(){super(...arguments);p(this,"_operation","")}initCallback(){super.initCallback(),this.$["on.click"]=e=>{this.$["*sliderEl"].setOperation(this._operation),this.$["*showSlider"]=!0,this.$["*currentOperation"]=this._operation},this.defineAccessor("operation",e=>{e&&(this._operation=e,this.$.icon=e,this.$.title=this.l10n(e))}),this.sub("*editorTransformations",e=>{if(!this._operation)return;let{zero:t}=jt[this._operation],r=e[this._operation],n=typeof r<"u"?r!==t:!1;this.$.active=n})}}function kc(i,s){let e={};for(let t of s){let r=i[t];(i.hasOwnProperty(t)||r!==void 0)&&(e[t]=r)}return e}function er(i,s,e){let r=window.devicePixelRatio,n=Math.min(Math.ceil(s*r),3e3),a=r>=2?"lightest":"normal";return Ce(i,Ne(Zn,rs(e),`quality/${a}`,`stretch/off/-/resize/${n}x`))}function ki(i,s,e){return Math.min(Math.max(i,s),e)}function ii({width:i,height:s},e){let t=e/90%2!==0;return{width:t?s:i,height:t?i:s}}function Oc(i){return i?[({dimensions:e,coords:t})=>[...e,...t].every(r=>Number.isInteger(r)&&Number.isFinite(r)),({dimensions:e,coords:t})=>e.every(r=>r>0)&&t.every(r=>r>=0)].every(e=>e(i)):!0}class sa extends ct{constructor(){super();p(this,"init$",{...this.init$,image:null,"*padding":yc,"*operations":{rotate:0,mirror:!1,flip:!1},"*imageBox":{x:0,y:0,width:0,height:0},"*cropBox":{x:0,y:0,width:0,height:0}});this._commitDebounced=Ht(this._commit.bind(this),300),this._handleResizeDebounced=Ht(this._handleResize.bind(this),10)}_handleResize(){this.isConnected&&(this.deactivate(),this.activate(this._imageSize,{fromViewer:!1}))}_syncTransformations(){let e=this.$["*editorTransformations"],t=kc(e,Object.keys(this.$["*operations"])),r={...this.$["*operations"],...t};this.$["*operations"]=r}_initCanvas(){let e=this.ref["canvas-el"],t=e.getContext("2d"),r=this.offsetWidth,n=this.offsetHeight,a=window.devicePixelRatio;e.style.width=`${r}px`,e.style.height=`${n}px`,e.width=r*a,e.height=n*a,t.scale(a,a),this._canvas=e,this._ctx=t}_alignImage(){if(!this._isActive||!this.$.image)return;let e=this.$.image,t=this.$["*padding"],r=this.$["*operations"],{rotate:n}=r,a={width:this.offsetWidth,height:this.offsetHeight},o=ii({width:e.naturalWidth,height:e.naturalHeight},n);if(o.width>a.width-t*2||o.height>a.height-t*2){let l=o.width/o.height,c=a.width/a.height;if(l>c){let u=a.width-t*2,d=u/l,h=0+t,m=t+(a.height-t*2)/2-d/2;this.$["*imageBox"]={x:h,y:m,width:u,height:d}}else{let u=a.height-t*2,d=u*l,h=t+(a.width-t*2)/2-d/2,m=0+t;this.$["*imageBox"]={x:h,y:m,width:d,height:u}}}else{let{width:l,height:c}=o,u=t+(a.width-t*2)/2-l/2,d=t+(a.height-t*2)/2-c/2;this.$["*imageBox"]={x:u,y:d,width:l,height:c}}}_alignCrop(){let e=this.$["*cropBox"],t=this.$["*imageBox"],r=this.$["*operations"],{rotate:n}=r,a=this.$["*editorTransformations"].crop;if(a){let{dimensions:[l,c],coords:[u,d]}=a,{width:h,x:m,y:f}=this.$["*imageBox"],{width:g}=ii(this._imageSize,n),b=h/g;e={x:m+u*b,y:f+d*b,width:l*b,height:c*b}}else e={x:t.x,y:t.y,width:t.width,height:t.height};let o=[Math.min(t.width,Pe),Math.min(t.height,Pe)];e=ea(e,o,"se"),e=Qn(e,t),this.$["*cropBox"]=e}_drawImage(){let e=this.$.image,t=this.$["*imageBox"],r=this.$["*operations"],{mirror:n,flip:a,rotate:o}=r,l=this._ctx,c=ii({width:t.width,height:t.height},o);l.save(),l.translate(t.x+t.width/2,t.y+t.height/2),l.rotate(o*Math.PI*-1/180),l.scale(n?-1:1,a?-1:1),l.drawImage(e,-c.width/2,-c.height/2,c.width,c.height),l.restore()}_draw(){if(!this._isActive||!this.$.image)return;let e=this._canvas;this._ctx.clearRect(0,0,e.width,e.height),this._drawImage()}_animateIn({fromViewer:e}){this.$.image&&(this.ref["frame-el"].toggleThumbs(!0),this._transitionToImage(),setTimeout(()=>{this.className=ke({active_from_viewer:e,active_from_editor:!e,inactive_to_editor:!1})}))}_calculateDimensions(){let e=this.$["*cropBox"],t=this.$["*imageBox"],r=this.$["*operations"],{rotate:n}=r,{width:a,height:o}=t,{width:l,height:c}=ii(this._imageSize,n),{width:u,height:d}=e,h=a/l,m=o/c;return[ki(Math.round(u/h),1,l),ki(Math.round(d/m),1,c)]}_calculateCrop(){let e=this.$["*cropBox"],t=this.$["*imageBox"],r=this.$["*operations"],{rotate:n}=r,{width:a,height:o,x:l,y:c}=t,{width:u,height:d}=ii(this._imageSize,n),{x:h,y:m}=e,f=a/u,g=o/d,b=this._calculateDimensions(),y={dimensions:b,coords:[ki(Math.round((h-l)/f),0,u-b[0]),ki(Math.round((m-c)/g),0,d-b[1])]};if(!Oc(y)){console.error("Cropper is trying to create invalid crop object",{payload:y});return}if(!(b[0]===u&&b[1]===d))return y}_commit(){if(!this.isConnected)return;let e=this.$["*operations"],{rotate:t,mirror:r,flip:n}=e,a=this._calculateCrop(),l={...this.$["*editorTransformations"],crop:a,rotate:t,mirror:r,flip:n};this.$["*editorTransformations"]=l}setValue(e,t){console.log(`Apply cropper operation [${e}=${t}]`),this.$["*operations"]={...this.$["*operations"],[e]:t},this._isActive&&(this._alignImage(),this._alignCrop(),this._draw())}getValue(e){return this.$["*operations"][e]}async activate(e,{fromViewer:t}){if(!this._isActive){this._isActive=!0,this._imageSize=e,this.removeEventListener("transitionend",this._reset),this._initCanvas();try{this.$.image=await this._waitForImage(this.$["*originalUrl"],this.$["*editorTransformations"]),this._syncTransformations(),this._alignImage(),this._alignCrop(),this._draw(),this._animateIn({fromViewer:t})}catch(r){console.error("Failed to activate cropper",{error:r})}}}deactivate(){this._isActive&&(this._commit(),this._isActive=!1,this._transitionToCrop(),this.className=ke({active_from_viewer:!1,active_from_editor:!1,inactive_to_editor:!0}),this.ref["frame-el"].toggleThumbs(!1),this.addEventListener("transitionend",this._reset,{once:!0}))}_transitionToCrop(){let e=this._calculateDimensions(),t=Math.min(this.offsetWidth,e[0])/this.$["*cropBox"].width,r=Math.min(this.offsetHeight,e[1])/this.$["*cropBox"].height,n=Math.min(t,r),a=this.$["*cropBox"].x+this.$["*cropBox"].width/2,o=this.$["*cropBox"].y+this.$["*cropBox"].height/2;this.style.transform=`scale(${n}) translate(${(this.offsetWidth/2-a)/n}px, ${(this.offsetHeight/2-o)/n}px)`,this.style.transformOrigin=`${a}px ${o}px`}_transitionToImage(){let e=this.$["*cropBox"].x+this.$["*cropBox"].width/2,t=this.$["*cropBox"].y+this.$["*cropBox"].height/2;this.style.transform="scale(1)",this.style.transformOrigin=`${e}px ${t}px`}_reset(){this._isActive||(this.$.image=null)}_waitForImage(e,t){let r=this.offsetWidth;t={...t,crop:void 0,rotate:void 0,flip:void 0,mirror:void 0};let n=this.proxyUrl(er(e,r,t)),{promise:a,cancel:o,image:l}=Qs(n),c=this._handleImageLoading(n);return l.addEventListener("load",c,{once:!0}),l.addEventListener("error",c,{once:!0}),this._cancelPreload&&this._cancelPreload(),this._cancelPreload=o,a.then(()=>l).catch(u=>(console.error("Failed to load image",{error:u}),this.$["*networkProblems"]=!0,Promise.resolve(l)))}_handleImageLoading(e){let t="crop",r=this.$["*loadingOperations"];return r.get(t)||r.set(t,new Map),r.get(t).get(e)||(r.set(t,r.get(t).set(e,!0)),this.$["*loadingOperations"]=r),()=>{var n;(n=r==null?void 0:r.get(t))!=null&&n.has(e)&&(r.get(t).delete(e),this.$["*loadingOperations"]=r)}}initCallback(){super.initCallback(),this._observer=new ResizeObserver(([e])=>{e.contentRect.width>0&&e.contentRect.height>0&&this._isActive&&this.$.image&&this._handleResizeDebounced()}),this._observer.observe(this),this.sub("*imageBox",()=>{this._draw()}),this.sub("*cropBox",e=>{this.$.image&&this._commitDebounced()}),setTimeout(()=>{this.sub("*networkProblems",e=>{e||this._isActive&&this.activate(this._imageSize,{fromViewer:!1})})},0)}destroyCallback(){var e;super.destroyCallback(),(e=this._observer)==null||e.disconnect()}}sa.template=`
  <canvas class="canvas" ref="canvas-el"></canvas>
  <lr-crop-frame ref="frame-el"></lr-crop-frame>
`;function Br(i,s,e){let t=Array(e);e--;for(let r=e;r>=0;r--)t[r]=Math.ceil((r*s+(e-r)*i)/e);return t}function Lc(i){return i.reduce((s,e,t)=>t<i.length-1?[...s,[e,i[t+1]]]:s,[])}function Rc(i,s,e){let t=Lc(i).find(([r,n])=>r<=s&&s<=n);return i.map(r=>{let n=Math.abs(t[0]-t[1]),a=Math.abs(s-t[0])/n;return t[0]===r?s>e?1:1-a:t[1]===r?s>=e?a:1:0})}function Pc(i,s){return i.map((e,t)=>e<s?i.length-t:t)}function zr(i,s){let e=jt[i].keypointsNumber,{range:t,zero:r}=jt[i];return[...new Set([...Br(t[0],r,e+1),...Br(r,t[1],e+1),r,s])].sort((n,a)=>n-a)}class Uc extends ct{constructor(){super(),this._isActive=!1,this._hidden=!0,this._addKeypointDebounced=Ht(this._addKeypoint.bind(this),600),this.classList.add("inactive_to_cropper")}_handleImageLoading(s){let e=this._operation,t=this.$["*loadingOperations"];return t.get(e)||t.set(e,new Map),t.get(e).get(s)||(t.set(e,t.get(e).set(s,!0)),this.$["*loadingOperations"]=t),()=>{var r;(r=t==null?void 0:t.get(e))!=null&&r.has(s)&&(t.get(e).delete(s),this.$["*loadingOperations"]=t)}}_flush(){window.cancelAnimationFrame(this._raf),this._raf=window.requestAnimationFrame(()=>{for(let s of this._keypoints){let{image:e}=s;e&&(e.style.opacity=s.opacity.toString(),e.style.zIndex=s.zIndex.toString())}})}_imageSrc({url:s=this._url,filter:e=this._filter,operation:t,value:r}={}){let n={...this._transformations};t&&(n[t]=e?{name:e,amount:r}:r);let a=this.offsetWidth;return this.proxyUrl(er(s,a,n))}_constructKeypoint(s,e){return{src:this._imageSrc({operation:s,value:e}),image:null,opacity:0,zIndex:0,value:e}}_isSame(s,e){return this._operation===s&&this._filter===e}_addKeypoint(s,e,t){let r=()=>!this._isSame(s,e)||this._value!==t||!!this._keypoints.find(l=>l.value===t);if(r())return;let n=this._constructKeypoint(s,t),a=new Image;a.src=n.src;let o=this._handleImageLoading(n.src);a.addEventListener("load",o,{once:!0}),a.addEventListener("error",o,{once:!0}),n.image=a,a.classList.add("fader-image"),a.addEventListener("load",()=>{if(r())return;let l=this._keypoints,c=l.findIndex(d=>d.value>t),u=c<l.length?l[c].image:null;!this._container||u&&!this._container.contains(u)||(l.splice(c,0,n),this._container.insertBefore(a,u),this._update(s,t))},{once:!0}),a.addEventListener("error",()=>{this.$["*networkProblems"]=!0},{once:!0})}set(s){s=typeof s=="string"?parseInt(s,10):s,this._update(this._operation,s),this._addKeypointDebounced(this._operation,this._filter,s)}_update(s,e){this._operation=s,this._value=e;let{zero:t}=jt[s],r=this._keypoints.map(o=>o.value),n=Rc(r,e,t),a=Pc(r,t);for(let[o,l]of Object.entries(this._keypoints))l.opacity=n[o],l.zIndex=a[o];this._flush()}_createPreviewImage(){let s=new Image;return s.classList.add("fader-image","fader-image--preview"),s.style.opacity="0",s}async _initNodes(){let s=document.createDocumentFragment();this._previewImage=this._previewImage||this._createPreviewImage(),!this.contains(this._previewImage)&&s.appendChild(this._previewImage);let e=document.createElement("div");s.appendChild(e);let t=this._keypoints.map(c=>c.src),{images:r,promise:n,cancel:a}=Ps(t);r.forEach(c=>{let u=this._handleImageLoading(c.src);c.addEventListener("load",u),c.addEventListener("error",u)}),this._cancelLastImages=()=>{a(),this._cancelLastImages=void 0};let o=this._operation,l=this._filter;await n,this._isActive&&this._isSame(o,l)&&(this._container&&this._container.remove(),this._container=e,this._keypoints.forEach((c,u)=>{let d=r[u];d.classList.add("fader-image"),c.image=d,this._container.appendChild(d)}),this.appendChild(s),this._flush())}setTransformations(s){if(this._transformations=s,this._previewImage){let e=this._imageSrc(),t=this._handleImageLoading(e);this._previewImage.src=e,this._previewImage.addEventListener("load",t,{once:!0}),this._previewImage.addEventListener("error",t,{once:!0}),this._previewImage.style.opacity="1",this._previewImage.addEventListener("error",()=>{this.$["*networkProblems"]=!0},{once:!0})}}preload({url:s,filter:e,operation:t,value:r}){this._cancelBatchPreload&&this._cancelBatchPreload();let a=zr(t,r).map(l=>this._imageSrc({url:s,filter:e,operation:t,value:l})),{cancel:o}=Ps(a);this._cancelBatchPreload=o}_setOriginalSrc(s){let e=this._previewImage||this._createPreviewImage();if(!this.contains(e)&&this.appendChild(e),this._previewImage=e,e.src===s){e.style.opacity="1",e.style.transform="scale(1)",this.className=ke({active_from_viewer:this._fromViewer,active_from_cropper:!this._fromViewer,inactive_to_cropper:!1});return}e.style.opacity="0";let t=this._handleImageLoading(s);e.addEventListener("error",t,{once:!0}),e.src=s,e.addEventListener("load",()=>{t(),e&&(e.style.opacity="1",e.style.transform="scale(1)",this.className=ke({active_from_viewer:this._fromViewer,active_from_cropper:!this._fromViewer,inactive_to_cropper:!1}))},{once:!0}),e.addEventListener("error",()=>{this.$["*networkProblems"]=!0},{once:!0})}activate({url:s,operation:e,value:t,filter:r,fromViewer:n}){if(this._isActive=!0,this._hidden=!1,this._url=s,this._operation=e||"initial",this._value=t,this._filter=r,this._fromViewer=n,typeof t!="number"&&!r){let o=this._imageSrc({operation:e,value:t});this._setOriginalSrc(o),this._container&&this._container.remove();return}this._keypoints=zr(e,t).map(o=>this._constructKeypoint(e,o)),this._update(e,t),this._initNodes()}deactivate({hide:s=!0}={}){this._isActive=!1,this._cancelLastImages&&this._cancelLastImages(),this._cancelBatchPreload&&this._cancelBatchPreload(),s&&!this._hidden?(this._hidden=!0,this._previewImage&&(this._previewImage.style.transform="scale(1)"),this.className=ke({active_from_viewer:!1,active_from_cropper:!1,inactive_to_cropper:!0}),this.addEventListener("transitionend",()=>{this._container&&this._container.remove()},{once:!0})):this._container&&this._container.remove()}}const Nc=1;class ra extends ct{initCallback(){super.initCallback(),this.addEventListener("wheel",s=>{s.preventDefault();let{deltaY:e,deltaX:t}=s;Math.abs(t)>Nc?this.scrollLeft+=t:this.scrollLeft+=e})}}ra.template=" <slot></slot> ";function Dc(i){return`
    <lr-btn-ui
      theme="boring"
      ref="tab-toggle-${i}"
      data-id="${i}"
      icon="${i}"
      tabindex="0"
      set="onclick: on.clickTab;"
    >
    </lr-btn-ui>
  `}function Mc(i){return`
    <lr-presence-toggle class="tab-content" set="visible: presence.tabContent.${i}; styles: presence.tabContentStyles">
      <lr-editor-scroller hidden-scrollbar>
        <div class="controls-list_align">
          <div class="controls-list_inner" ref="controls-list-${i}"></div>
        </div>
      </lr-editor-scroller>
    </lr-presence-toggle>
  `}class na extends ct{constructor(){super();p(this,"_updateInfoTooltip",Ht(()=>{var n,a;let e=this.$["*editorTransformations"],t="",r=!1;if(this.$["*tabId"]===ge.FILTERS)if(r=!0,this.$["*currentFilter"]&&((n=e==null?void 0:e.filter)==null?void 0:n.name)===this.$["*currentFilter"]){let o=((a=e==null?void 0:e.filter)==null?void 0:a.amount)||100;t=this.l10n(this.$["*currentFilter"])+" "+o}else t=this.l10n(tt);else if(this.$["*tabId"]===ge.SLIDERS&&this.$["*currentOperation"]){r=!0;let o=(e==null?void 0:e[this.$["*currentOperation"]])||jt[this.$["*currentOperation"]].zero;t=this.$["*currentOperation"]+" "+o}r&&(this.$["*operationTooltip"]=t),this.ref["tooltip-el"].classList.toggle("info-tooltip_visible",r)},0));this.init$={...this.init$,"*sliderEl":null,"*loadingOperations":new Map,"*showSlider":!1,"*currentFilter":tt,"*currentOperation":null,"*tabId":ge.CROP,showLoader:!1,filters:_c,colorOperations:vc,cropOperations:bc,"*operationTooltip":null,"l10n.cancel":this.l10n("cancel"),"l10n.apply":this.l10n("apply"),"presence.mainToolbar":!0,"presence.subToolbar":!1,"presence.tabContent.crop":!1,"presence.tabContent.sliders":!1,"presence.tabContent.filters":!1,"presence.subTopToolbarStyles":{hidden:"sub-toolbar--top-hidden",visible:"sub-toolbar--visible"},"presence.subBottomToolbarStyles":{hidden:"sub-toolbar--bottom-hidden",visible:"sub-toolbar--visible"},"presence.tabContentStyles":{hidden:"tab-content--hidden",visible:"tab-content--visible"},"on.cancel":e=>{this._cancelPreload&&this._cancelPreload(),this.$["*on.cancel"]()},"on.apply":e=>{this.$["*on.apply"](this.$["*editorTransformations"])},"on.applySlider":e=>{this.ref["slider-el"].apply(),this._onSliderClose()},"on.cancelSlider":e=>{this.ref["slider-el"].cancel(),this._onSliderClose()},"on.clickTab":e=>{let t=e.currentTarget.getAttribute("data-id");this._activateTab(t,{fromViewer:!1})}},this._debouncedShowLoader=Ht(this._showLoader.bind(this),500)}_onSliderClose(){this.$["*showSlider"]=!1,this.$["*tabId"]===ge.SLIDERS&&this.ref["tooltip-el"].classList.toggle("info-tooltip_visible",!1)}_createOperationControl(e){let t=Us.is&&new Us;return t.operation=e,t}_createFilterControl(e){let t=Wi.is&&new Wi;return t.filter=e,t}_createToggleControl(e){let t=Rs.is&&new Rs;return t.operation=e,t}_renderControlsList(e){let t=this.ref[`controls-list-${e}`],r=document.createDocumentFragment();e===ge.CROP?this.$.cropOperations.forEach(n=>{let a=this._createToggleControl(n);r.appendChild(a)}):e===ge.FILTERS?[tt,...this.$.filters].forEach(n=>{let a=this._createFilterControl(n);r.appendChild(a)}):e===ge.SLIDERS&&this.$.colorOperations.forEach(n=>{let a=this._createOperationControl(n);r.appendChild(a)}),r.childNodes.forEach((n,a)=>{a===r.childNodes.length-1&&n.classList.add("controls-list_last-item")}),t.innerHTML="",t.appendChild(r)}_activateTab(e,{fromViewer:t}){this.$["*tabId"]=e,e===ge.CROP?(this.$["*faderEl"].deactivate(),this.$["*cropperEl"].activate(this.$["*imageSize"],{fromViewer:t})):(this.$["*faderEl"].activate({url:this.$["*originalUrl"],fromViewer:t}),this.$["*cropperEl"].deactivate());for(let r of Ls){let n=r===e,a=this.ref[`tab-toggle-${r}`];a.active=n,n?(this._renderControlsList(e),this._syncTabIndicator()):this._unmountTabControls(r),this.$[`presence.tabContent.${r}`]=n}}_unmountTabControls(e){let t=this.ref[`controls-list-${e}`];t&&(t.innerHTML="")}_syncTabIndicator(){let e=this.ref[`tab-toggle-${this.$["*tabId"]}`],t=this.ref["tabs-indicator"];t.style.transform=`translateX(${e.offsetLeft}px)`}_preloadEditedImage(){if(this.$["*imgContainerEl"]&&this.$["*originalUrl"]){let e=this.$["*imgContainerEl"].offsetWidth,t=this.proxyUrl(er(this.$["*originalUrl"],e,this.$["*editorTransformations"]));this._cancelPreload&&this._cancelPreload();let{cancel:r}=Ps([t]);this._cancelPreload=()=>{r(),this._cancelPreload=void 0}}}_showLoader(e){this.$.showLoader=e}initCallback(){super.initCallback(),this.$["*sliderEl"]=this.ref["slider-el"],this.sub("*imageSize",e=>{e&&setTimeout(()=>{this._activateTab(this.$["*tabId"],{fromViewer:!0})},0)}),this.sub("*editorTransformations",e=>{var r;let t=(r=e==null?void 0:e.filter)==null?void 0:r.name;this.$["*currentFilter"]!==t&&(this.$["*currentFilter"]=t)}),this.sub("*currentFilter",()=>{this._updateInfoTooltip()}),this.sub("*currentOperation",()=>{this._updateInfoTooltip()}),this.sub("*tabId",()=>{this._updateInfoTooltip()}),this.sub("*originalUrl",e=>{this.$["*faderEl"]&&this.$["*faderEl"].deactivate()}),this.sub("*editorTransformations",e=>{this._preloadEditedImage(),this.$["*faderEl"]&&this.$["*faderEl"].setTransformations(e)}),this.sub("*loadingOperations",e=>{let t=!1;for(let[,r]of e.entries()){if(t)break;for(let[,n]of r.entries())if(n){t=!0;break}}this._debouncedShowLoader(t)}),this.sub("*showSlider",e=>{this.$["presence.subToolbar"]=e,this.$["presence.mainToolbar"]=!e}),this._updateInfoTooltip()}}na.template=`
  <lr-line-loader-ui set="active: showLoader"></lr-line-loader-ui>
  <div class="info-tooltip_container">
    <div class="info-tooltip_wrapper">
      <div ref="tooltip-el" class="info-tooltip info-tooltip_hidden">{{*operationTooltip}}</div>
    </div>
  </div>
  <div class="toolbar-container">
    <lr-presence-toggle class="sub-toolbar" set="visible: presence.mainToolbar; styles: presence.subTopToolbarStyles">
      <div class="tab-content-row">${Ls.map(Mc).join("")}</div>
      <div class="controls-row">
        <lr-btn-ui theme="boring" icon="closeMax" set="onclick: on.cancel"> </lr-btn-ui>
        <div class="tab-toggles">
          <div ref="tabs-indicator" class="tab-toggles_indicator"></div>
          ${Ls.map(Dc).join("")}
        </div>
        <lr-btn-ui theme="primary" icon="done" set="onclick: on.apply"> </lr-btn-ui>
      </div>
    </lr-presence-toggle>
    <lr-presence-toggle class="sub-toolbar" set="visible: presence.subToolbar; styles: presence.subBottomToolbarStyles">
      <div class="slider">
        <lr-editor-slider ref="slider-el"></lr-editor-slider>
      </div>
      <div class="controls-row">
        <lr-btn-ui theme="boring" set="@text: l10n.cancel; onclick: on.cancelSlider;"> </lr-btn-ui>
        <lr-btn-ui theme="primary" set="@text: l10n.apply; onclick: on.applySlider;"> </lr-btn-ui>
      </div>
    </lr-presence-toggle>
  </div>
`;class tr extends J{constructor(){super(),this._iconReversed=!1,this._iconSingle=!1,this._iconHidden=!1,this.init$={...this.init$,text:"",icon:"",iconCss:this._iconCss(),theme:null},this.defineAccessor("active",s=>{s?this.setAttribute("active",""):this.removeAttribute("active")})}_iconCss(){return ke("icon",{icon_left:!this._iconReversed,icon_right:this._iconReversed,icon_hidden:this._iconHidden,icon_single:this._iconSingle})}initCallback(){super.initCallback(),this.sub("icon",s=>{this._iconSingle=!this.$.text,this._iconHidden=!s,this.$.iconCss=this._iconCss()}),this.sub("theme",s=>{s!=="custom"&&(this.className=s)}),this.sub("text",s=>{this._iconSingle=!1}),this.setAttribute("role","button"),this.tabIndex===-1&&(this.tabIndex=0),this.hasAttribute("theme")||this.setAttribute("theme","default")}set reverse(s){this.hasAttribute("reverse")?(this.style.flexDirection="row-reverse",this._iconReversed=!0):(this._iconReversed=!1,this.style.flexDirection=null)}}tr.bindAttributes({text:"text",icon:"icon",reverse:"reverse",theme:"theme"});tr.template=`
  <lr-icon size="20" set="className: iconCss; @name: icon;"></lr-icon>
  <div class="text">{{text}}</div>
`;class aa extends J{constructor(){super(),this._active=!1,this._handleTransitionEndRight=()=>{let s=this.ref["line-el"];s.style.transition="initial",s.style.opacity="0",s.style.transform="translateX(-101%)",this._active&&this._start()}}initCallback(){super.initCallback(),this.defineAccessor("active",s=>{typeof s=="boolean"&&(s?this._start():this._stop())})}_start(){this._active=!0;let{width:s}=this.getBoundingClientRect(),e=this.ref["line-el"];e.style.transition="transform 1s",e.style.opacity="1",e.style.transform=`translateX(${s}px)`,e.addEventListener("transitionend",this._handleTransitionEndRight,{once:!0})}_stop(){this._active=!1}}aa.template=`
  <div class="inner">
    <div class="line" ref="line-el"></div>
  </div>
`;const Oi={transition:"transition",visible:"visible",hidden:"hidden"};class oa extends J{constructor(){super(),this._visible=!1,this._visibleStyle=Oi.visible,this._hiddenStyle=Oi.hidden,this._externalTransitions=!1,this.defineAccessor("styles",s=>{s&&(this._externalTransitions=!0,this._visibleStyle=s.visible,this._hiddenStyle=s.hidden)}),this.defineAccessor("visible",s=>{typeof s=="boolean"&&(this._visible=s,this._handleVisible())})}_handleVisible(){this.style.visibility=this._visible?"inherit":"hidden",cc(this,{[Oi.transition]:!this._externalTransitions,[this._visibleStyle]:this._visible,[this._hiddenStyle]:!this._visible}),this.setAttribute("aria-hidden",this._visible?"false":"true")}initCallback(){super.initCallback(),this.setAttribute("hidden",""),this._externalTransitions||this.classList.add(Oi.transition),this._handleVisible(),setTimeout(()=>this.removeAttribute("hidden"),0)}}oa.template=" <slot></slot> ";class la extends J{constructor(){super();p(this,"init$",{...this.init$,disabled:!1,min:0,max:100,onInput:null,onChange:null,defaultValue:null,"on.sliderInput":()=>{let e=parseInt(this.ref["input-el"].value,10);this._updateValue(e),this.$.onInput&&this.$.onInput(e)},"on.sliderChange":()=>{let e=parseInt(this.ref["input-el"].value,10);this.$.onChange&&this.$.onChange(e)}});this.setAttribute("with-effects","")}initCallback(){super.initCallback(),this.defineAccessor("disabled",t=>{this.$.disabled=t}),this.defineAccessor("min",t=>{this.$.min=t}),this.defineAccessor("max",t=>{this.$.max=t}),this.defineAccessor("defaultValue",t=>{this.$.defaultValue=t,this.ref["input-el"].value=t,this._updateValue(t)}),this.defineAccessor("zero",t=>{this._zero=t}),this.defineAccessor("onInput",t=>{t&&(this.$.onInput=t)}),this.defineAccessor("onChange",t=>{t&&(this.$.onChange=t)}),this._updateSteps(),this._observer=new ResizeObserver(()=>{this._updateSteps();let t=parseInt(this.ref["input-el"].value,10);this._updateValue(t)}),this._observer.observe(this),this._thumbSize=parseInt(window.getComputedStyle(this).getPropertyValue("--l-thumb-size"),10),setTimeout(()=>{let t=parseInt(this.ref["input-el"].value,10);this._updateValue(t)},0),this.sub("disabled",t=>{let r=this.ref["input-el"];t?r.setAttribute("disabled","disabled"):r.removeAttribute("disabled")});let e=this.ref["input-el"];e.addEventListener("focus",()=>{this.style.setProperty("--color-effect","var(--hover-color-rgb)")}),e.addEventListener("blur",()=>{this.style.setProperty("--color-effect","var(--idle-color-rgb)")})}_updateValue(e){this._updateZeroDot(e);let{width:t}=this.getBoundingClientRect(),a=100/(this.$.max-this.$.min)*(e-this.$.min)*(t-this._thumbSize)/100;window.requestAnimationFrame(()=>{this.ref["thumb-el"].style.transform=`translateX(${a}px)`})}_updateZeroDot(e){if(!this._zeroDotEl)return;e===this._zero?this._zeroDotEl.style.opacity="0":this._zeroDotEl.style.opacity="0.2";let{width:t}=this.getBoundingClientRect(),a=100/(this.$.max-this.$.min)*(this._zero-this.$.min)*(t-this._thumbSize)/100;window.requestAnimationFrame(()=>{this._zeroDotEl.style.transform=`translateX(${a}px)`})}_updateSteps(){let t=this.ref["steps-el"],{width:r}=t.getBoundingClientRect(),n=Math.ceil(r/2),a=Math.ceil(n/15)-2;if(this._stepsCount===a)return;let o=document.createDocumentFragment(),l=document.createElement("div"),c=document.createElement("div");l.className="minor-step",c.className="border-step",o.appendChild(c);for(let d=0;d<a;d++)o.appendChild(l.cloneNode());o.appendChild(c.cloneNode());for(let d=0;d<a;d++)o.appendChild(l.cloneNode());o.appendChild(c.cloneNode());let u=document.createElement("div");u.className="zero-dot",o.appendChild(u),this._zeroDotEl=u,t.innerHTML="",t.appendChild(o),this._stepsCount=a}destroyCallback(){var e;(e=this._observer)==null||e.disconnect()}}la.template=`
  <div class="steps" ref="steps-el"></div>
  <div ref="thumb-el" class="thumb"></div>
  <input
    class="input"
    type="range"
    ref="input-el"
    tabindex="0"
    set="oninput: on.sliderInput; onchange: on.sliderChange; @min: min; @max: max; @value: defaultValue;"
  />
`;class Fc extends W{constructor(){super(...arguments);p(this,"activityType",F.activities.CLOUD_IMG_EDIT);p(this,"init$",{...this.init$,cdnUrl:null})}initCallback(){super.initCallback(),this.registerActivity(this.activityType,{onActivate:()=>this.mountEditor(),onDeactivate:()=>this.unmountEditor()}),this.sub("*focusedEntry",e=>{e&&(this.entry=e,this.entry.subscribe("cdnUrl",t=>{t&&(this.$.cdnUrl=t)}))})}handleApply(e){let t=e.detail;this.entry.setMultipleValues({cdnUrl:t.cdnUrl,cdnUrlModifiers:t.cdnUrlModifiers}),this.historyBack()}handleCancel(){this.historyBack()}mountEditor(){let e=new Xt,t=this.$.cdnUrl;e.setAttribute("ctx-name",this.ctxName),e.setAttribute("cdn-url",t),e.addEventListener("apply",r=>this.handleApply(r)),e.addEventListener("cancel",()=>this.handleCancel()),this.innerHTML="",this.appendChild(e)}unmountEditor(){this.innerHTML=""}}const Vc=function(i){return i.replace(/[\\-\\[]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")},Bc=function(i,s="i"){const e=i.split("*").map(Vc);return new RegExp("^"+e.join(".+")+"$",s)};let zc=i=>Object.keys(i).reduce((e,t)=>{let r=i[t],n=Object.keys(r).reduce((a,o)=>{let l=r[o];return a+`${o}: ${l};`},"");return e+`${t}{${n}}`},"");function Hc({textColor:i,backgroundColor:s,linkColor:e,linkColorHover:t,shadeColor:r}){let n=`solid 1px ${r}`;return zc({body:{color:i,"background-color":s},".side-bar":{background:"inherit","border-right":n},".main-content":{background:"inherit"},".main-content-header":{background:"inherit"},".main-content-footer":{background:"inherit"},".list-table-row":{color:"inherit"},".list-table-row:hover":{background:r},".list-table-row .list-table-cell-a, .list-table-row .list-table-cell-b":{"border-top":n},".list-table-body .list-items":{"border-bottom":n},".bread-crumbs a":{color:e},".bread-crumbs a:hover":{color:t},".main-content.loading":{background:`${s} url(/static/images/loading_spinner.gif) center no-repeat`,"background-size":"25px 25px"},".list-icons-item":{"background-color":r},".source-gdrive .side-bar-menu a, .source-gphotos .side-bar-menu a":{color:e},".source-gdrive .side-bar-menu a, .source-gphotos .side-bar-menu a:hover":{color:t},".side-bar-menu a":{color:e},".side-bar-menu a:hover":{color:t},".source-gdrive .side-bar-menu .current, .source-gdrive .side-bar-menu a:hover, .source-gphotos .side-bar-menu .current, .source-gphotos .side-bar-menu a:hover":{color:t},".source-vk .side-bar-menu a":{color:e},".source-vk .side-bar-menu a:hover":{color:t,background:"none"}})}let it={};window.addEventListener("message",i=>{let s;try{s=JSON.parse(i.data)}catch{return}if((s==null?void 0:s.type)in it){let e=it[s.type];for(let[t,r]of e)i.source===t&&r(s)}});const jc=function(i,s,e){i in it||(it[i]=[]),it[i].push([s,e])},Wc=function(i,s){i in it&&(it[i]=it[i].filter(e=>e[0]!==s))};function Gc(i){let s=[];for(let[e,t]of Object.entries(i))t==null||typeof t=="string"&&t.length===0||s.push(`${e}=${encodeURIComponent(t)}`);return s.join("&")}class ca extends W{constructor(){super(...arguments);p(this,"activityType",F.activities.EXTERNAL);p(this,"init$",{...this.init$,activityIcon:"",activityCaption:"",counter:0,onDone:()=>{this.$["*currentActivity"]=F.activities.UPLOAD_LIST},onCancel:()=>{this.historyBack()}});p(this,"_iframe",null);p(this,"_inheritedUpdateCssData",this.updateCssData);p(this,"updateCssData",()=>{this.isActivityActive&&(this._inheritedUpdateCssData(),this.applyStyles())})}initCallback(){super.initCallback(),this.registerActivity(this.activityType,{onActivate:()=>{let{externalSourceType:e}=this.activityParams;this.set$({activityCaption:`${e==null?void 0:e[0].toUpperCase()}${e==null?void 0:e.slice(1)}`,activityIcon:e}),this.$.counter=0,this.mountIframe()}}),this.sub("*currentActivity",e=>{e!==this.activityType&&this.unmountIframe()})}sendMessage(e){var t,r;(r=(t=this._iframe)==null?void 0:t.contentWindow)==null||r.postMessage(JSON.stringify(e),"*")}async handleFileSelected(e){console.log(e),this.$.counter=this.$.counter+1;const t=(()=>{if(e.alternatives){const a=qe(this.cfg.externalSourcesPreferredTypes);for(const o of a){const l=Bc(o);for(const[c,u]of Object.entries(e.alternatives))if(l.test(c))return u}}return e.url})();let{filename:r}=e,{externalSourceType:n}=this.activityParams;this.addFileFromUrl(t,{fileName:r,source:n})}handleIframeLoad(){this.applyStyles()}getCssValue(e){return window.getComputedStyle(this).getPropertyValue(e).trim()}applyStyles(){let e={backgroundColor:this.getCssValue("--clr-background-light"),textColor:this.getCssValue("--clr-txt"),shadeColor:this.getCssValue("--clr-shade-lv1"),linkColor:"#157cfc",linkColorHover:"#3891ff"};this.sendMessage({type:"embed-css",style:Hc(e)})}remoteUrl(){var o,l;let e=this.cfg.pubkey,t=(!1).toString(),{externalSourceType:r}=this.activityParams,n={lang:((l=(o=this.getCssData("--l10n-locale-name"))==null?void 0:o.split("-"))==null?void 0:l[0])||"en",public_key:e,images_only:t,pass_window_open:!1,session_key:this.cfg.remoteTabSessionKey},a=new URL(this.cfg.socialBaseUrl);return a.pathname=`/window3/${r}`,a.search=Gc(n),a.toString()}mountIframe(){let e=js({tag:"iframe",attributes:{src:this.remoteUrl(),marginheight:0,marginwidth:0,frameborder:0,allowTransparency:!0}});e.addEventListener("load",this.handleIframeLoad.bind(this)),this.ref.iframeWrapper.innerHTML="",this.ref.iframeWrapper.appendChild(e),jc("file-selected",e.contentWindow,this.handleFileSelected.bind(this)),this._iframe=e}unmountIframe(){this._iframe&&Wc("file-selected",this._iframe.contentWindow),this.ref.iframeWrapper.innerHTML="",this._iframe=null}}ca.template=`
  <lr-activity-header>
    <button type="button" class="mini-btn" set="onclick: *historyBack">
      <lr-icon name="back"></lr-icon>
    </button>
    <div>
      <lr-icon set="@name: activityIcon"></lr-icon>
      <span>{{activityCaption}}</span>
    </div>
    <button type="button" class="mini-btn close-btn" set="onclick: *historyBack">
      <lr-icon name="close"></lr-icon>
    </button>
  </lr-activity-header>
  <div class="content">
    <div ref="iframeWrapper" class="iframe-wrapper"></div>
    <div class="toolbar">
      <button type="button" class="cancel-btn secondary-btn" set="onclick: onCancel" l10n="cancel"></button>
      <div></div>
      <div class="selected-counter"><span l10n="selected-count"></span>{{counter}}</div>
      <button type="button" class="done-btn primary-btn" set="onclick: onDone; @disabled: !counter">
        <lr-icon name="check"></lr-icon>
      </button>
    </div>
  </div>
`;class ir extends J{setCurrentTab(s){if(!s)return;[...this.ref.context.querySelectorAll("[tab-ctx]")].forEach(t=>{t.getAttribute("tab-ctx")===s?t.removeAttribute("hidden"):t.setAttribute("hidden","")});for(let t in this._tabMap)t===s?this._tabMap[t].setAttribute("current",""):this._tabMap[t].removeAttribute("current")}initCallback(){super.initCallback(),this._tabMap={},this.defineAccessor("tab-list",s=>{if(!s)return;qe(s).forEach(t=>{let r=js({tag:"div",attributes:{class:"tab"},properties:{onclick:()=>{this.setCurrentTab(t)}}});r.textContent=this.l10n(t),this.ref.row.appendChild(r),this._tabMap[t]=r})}),this.defineAccessor("default",s=>{this.setCurrentTab(s)}),this.hasAttribute("default")||this.setCurrentTab(Object.keys(this._tabMap)[0])}}ir.bindAttributes({"tab-list":null,default:null});ir.template=`
  <div ref="row" class="tabs-row"></div>
  <div ref="context" class="tabs-context">
    <slot></slot>
  </div>
`;class as extends W{constructor(){super(...arguments);p(this,"processInnerHtml",!0);p(this,"init$",{...this.init$,output:null,filesData:null})}get dict(){return as.dict}get validationInput(){return this._validationInputElement}initCallback(){if(super.initCallback(),this.hasAttribute(this.dict.FORM_INPUT_ATTR)&&(this._dynamicInputsContainer=document.createElement("div"),this.appendChild(this._dynamicInputsContainer),this.hasAttribute(this.dict.INPUT_REQUIRED))){let e=document.createElement("input");e.type="text",e.name="__UPLOADCARE_VALIDATION_INPUT__",e.required=!0,this.appendChild(e),this._validationInputElement=e}this.sub("output",e=>{if(e){if(this.hasAttribute(this.dict.FIRE_EVENT_ATTR)&&this.dispatchEvent(new CustomEvent(this.dict.EVENT_NAME,{bubbles:!0,composed:!0,detail:{timestamp:Date.now(),ctxName:this.ctxName,data:e}})),this.hasAttribute(this.dict.FORM_INPUT_ATTR)){this._dynamicInputsContainer.innerHTML="";let t=e.groupData?[e.groupData.cdnUrl]:e.map(r=>r.cdnUrl);for(let r of t){let n=document.createElement("input");n.type="hidden",n.name=this.getAttribute(this.dict.INPUT_NAME_ATTR)||this.ctxName,n.value=r,this._dynamicInputsContainer.appendChild(n)}this.hasAttribute(this.dict.INPUT_REQUIRED)&&(this._validationInputElement.value=t.length?"__VALUE__":"")}this.hasAttribute(this.dict.CONSOLE_ATTR)&&console.log(e)}},!1),this.sub(this.dict.SRC_CTX_KEY,async e=>{if(!e){this.$.output=null,this.$.filesData=null;return}if(this.$.filesData=e,this.cfg.groupOutput||this.hasAttribute(this.dict.GROUP_ATTR)){let t=e.map(a=>a.uuid);const r=await this.getUploadClientOptions();let n=await Tl(t,{...r});this.$.output={groupData:n,files:e}}else this.$.output=e},!1)}}as.dict=Object.freeze({SRC_CTX_KEY:"*outputData",EVENT_NAME:"lr-data-output",FIRE_EVENT_ATTR:"use-event",CONSOLE_ATTR:"use-console",GROUP_ATTR:"use-group",FORM_INPUT_ATTR:"use-input",INPUT_NAME_ATTR:"input-name",INPUT_REQUIRED:"input-required"});class Xc extends F{}class ua extends J{constructor(){super(...arguments);p(this,"init$",{...this.init$,currentText:"",options:[],selectHtml:"",onSelect:e=>{var t;e.preventDefault(),e.stopPropagation(),this.value=this.ref.select.value,this.$.currentText=((t=this.$.options.find(r=>r.value==this.value))==null?void 0:t.text)||"",this.dispatchEvent(new Event("change"))}})}initCallback(){super.initCallback(),this.sub("options",e=>{var r;this.$.currentText=((r=e==null?void 0:e[0])==null?void 0:r.text)||"";let t="";e==null||e.forEach(n=>{t+=`<option value="${n.value}">${n.text}</option>`}),this.$.selectHtml=t})}}ua.template=`
  <button>
    {{currentText}}
    <lr-icon name="select"></lr-icon>
    <select ref="select" set="innerHTML: selectHtml; onchange: onSelect"></select>
  </button>
`;const ce={PLAY:"play",PAUSE:"pause",FS_ON:"fullscreen-on",FS_OFF:"fullscreen-off",VOL_ON:"unmute",VOL_OFF:"mute",CAP_ON:"captions",CAP_OFF:"captions-off"},Hr={requestFullscreen:i=>{i.requestFullscreen?i.requestFullscreen():i.webkitRequestFullscreen&&i.webkitRequestFullscreen()},exitFullscreen:()=>{document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen&&document.webkitExitFullscreen()}};class He extends J{constructor(){super(...arguments);p(this,"init$",{...this.init$,src:"",ppIcon:ce.PLAY,fsIcon:ce.FS_ON,volIcon:ce.VOL_ON,capIcon:ce.CAP_OFF,totalTime:"00:00",currentTime:"00:00",progressCssWidth:"0",hasSubtitles:!1,volumeDisabled:!1,volumeValue:0,onPP:()=>{this.togglePlay()},onFs:()=>{this.toggleFullscreen()},onCap:()=>{this.toggleCaptions()},onMute:()=>{this.toggleSound()},onVolChange:e=>{let t=parseFloat(e.currentTarget.$.value);this.setVolume(t)},progressClicked:e=>{let t=this.progress.getBoundingClientRect();this._video.currentTime=this._video.duration*(e.offsetX/t.width)}})}togglePlay(){this._video.paused||this._video.ended?this._video.play():this._video.pause()}toggleFullscreen(){(document.fullscreenElement||document.webkitFullscreenElement)===this?Hr.exitFullscreen():Hr.requestFullscreen(this)}toggleCaptions(){this.$.capIcon===ce.CAP_OFF?(this.$.capIcon=ce.CAP_ON,this._video.textTracks[0].mode="showing",window.localStorage.setItem(He.is+":captions","1")):(this.$.capIcon=ce.CAP_OFF,this._video.textTracks[0].mode="hidden",window.localStorage.removeItem(He.is+":captions"))}toggleSound(){this.$.volIcon===ce.VOL_ON?(this.$.volIcon=ce.VOL_OFF,this.$.volumeDisabled=!0,this._video.muted=!0):(this.$.volIcon=ce.VOL_ON,this.$.volumeDisabled=!1,this._video.muted=!1)}setVolume(e){window.localStorage.setItem(He.is+":volume",e);let t=e?e/100:0;this._video.volume=t}get progress(){return this.ref.progress}_getUrl(e){return e.includes("/")?e:`https://ucarecdn.com/${e}/`}_desc2attrs(e){let t=[];for(let r in e){let n=r==="src"?this._getUrl(e[r]):e[r];t.push(`${r}="${n}"`)}return t.join(" ")}_timeFmt(e){let t=new Date(Math.round(e)*1e3);return[t.getMinutes(),t.getSeconds()].map(r=>r<10?"0"+r:r).join(":")}_initTracks(){[...this._video.textTracks].forEach(e=>{e.mode="hidden"}),window.localStorage.getItem(He.is+":captions")&&this.toggleCaptions()}_castAttributes(){let e=["autoplay","loop","muted"];[...this.attributes].forEach(t=>{e.includes(t.name)&&this._video.setAttribute(t.name,t.value)})}initCallback(){super.initCallback(),this._video=this.ref.video,this._castAttributes(),this._video.addEventListener("play",()=>{this.$.ppIcon=ce.PAUSE,this.setAttribute("playback","")}),this._video.addEventListener("pause",()=>{this.$.ppIcon=ce.PLAY,this.removeAttribute("playback")}),this.addEventListener("fullscreenchange",t=>{console.log(t),document.fullscreenElement===this?this.$.fsIcon=ce.FS_OFF:this.$.fsIcon=ce.FS_ON}),this.sub("src",t=>{if(!t)return;let r=this._getUrl(t);this._video.src=r}),this.sub("video",async t=>{if(!t)return;let r=await(await window.fetch(this._getUrl(t))).json();r.poster&&(this._video.poster=this._getUrl(r.poster));let n="";r==null||r.sources.forEach(a=>{n+=`<source ${this._desc2attrs(a)} />`}),r.tracks&&(r.tracks.forEach(a=>{n+=`<track ${this._desc2attrs(a)} />`}),this.$.hasSubtitles=!0),this._video.innerHTML+=n,this._initTracks(),console.log(r)}),this._video.addEventListener("loadedmetadata",t=>{this.$.currentTime=this._timeFmt(this._video.currentTime),this.$.totalTime=this._timeFmt(this._video.duration)}),this._video.addEventListener("timeupdate",t=>{let r=Math.round(100*(this._video.currentTime/this._video.duration));this.$.progressCssWidth=r+"%",this.$.currentTime=this._timeFmt(this._video.currentTime)});let e=window.localStorage.getItem(He.is+":volume");if(e){let t=parseFloat(e);this.setVolume(t),this.$.volumeValue=t}}}He.template=`
  <div class="video-wrapper">
    <video ref="video" preload="metadata" crossorigin="anonymous"></video>
  </div>

  <div class="toolbar">
    <div class="progress" ref="progress" set -onclick="progressClicked">
      <div class="bar" set -style.width="progressCssWidth"></div>
    </div>

    <div class="tb-block">
      <button set -onclick="onPP">
        <lr-icon set -@name="ppIcon"></lr-icon>
      </button>
      <div class="timer">{{currentTime}} / {{totalTime}}</div>
    </div>

    <div class="tb-block">
      <button set -onclick="onCap" -@hidden="!hasSubtitles">
        <lr-icon set -@name="capIcon"></lr-icon>
      </button>

      <button set -onclick="onMute">
        <lr-icon set -@name="volIcon"></lr-icon>
      </button>

      <lr-range type="range" set -onchange="onVolChange" -@disabled="volumeDisabled" -value="volumeValue"> </lr-range>

      <button set -onclick="onFs">
        <lr-icon set -@name="fsIcon"></lr-icon>
      </button>
    </div>
  </div>
`;He.bindAttributes({video:"video",src:"src"});const qc="css-src";function sr(i){return class extends i{constructor(){super(...arguments);p(this,"renderShadow",!0);p(this,"pauseRender",!0)}shadowReadyCallback(){}initCallback(){super.initCallback(),this.setAttribute("hidden",""),setTimeout(()=>{let e=this.getAttribute(qc);if(e){this.attachShadow({mode:"open"});let t=document.createElement("link");t.rel="stylesheet",t.type="text/css",t.href=e,t.onload=()=>{window.requestAnimationFrame(()=>{this.render(),window.setTimeout(()=>{this.removeAttribute("hidden"),this.shadowReadyCallback()})})},this.shadowRoot.prepend(t)}else console.error("Attribute `css-src` is required and it is not set. See migration guide: https://uploadcare.com/docs/file-uploader/migration-to-0.25.0/")})}}}class rr extends sr(J){}class da extends J{initCallback(){super.initCallback(),this.subConfigValue("removeCopyright",s=>{this.toggleAttribute("hidden",!!s)})}}p(da,"template",`
    <a
      href="https://uploadcare.com/?utm_source=copyright&utm_medium=referral&utm_campaign=v4"
      target="_blank noopener"
      class="credits"
      >Powered by Uploadcare</a
    >
  `);class nr extends rr{constructor(){super(...arguments);p(this,"init$",Sn(this));p(this,"_template",null)}static set template(e){this._template=e+"<slot></slot>"}static get template(){return this._template}}class ha extends nr{}ha.template=`
  <lr-simple-btn></lr-simple-btn>

  <lr-modal strokes block-body-scrolling>
    <lr-start-from>
      <lr-drop-area with-icon clickable></lr-drop-area>
      <lr-source-list wrap></lr-source-list>
      <lr-copyright></lr-copyright>
    </lr-start-from>
    <lr-upload-list></lr-upload-list>
    <lr-camera-source></lr-camera-source>
    <lr-url-source></lr-url-source>
    <lr-external-source></lr-external-source>
    <lr-cloud-image-editor-activity></lr-cloud-image-editor-activity>
  </lr-modal>

  <lr-message-box></lr-message-box>
  <lr-progress-bar-common></lr-progress-bar-common>
`;class fa extends nr{constructor(){super(...arguments);p(this,"pauseRender",!0)}shadowReadyCallback(){const e=this.ref.uBlock;this.sub("*currentActivity",t=>{t||(this.$["*currentActivity"]=e.initActivity||F.activities.START_FROM)}),this.sub("*uploadList",t=>{(t==null?void 0:t.length)>0?this.$["*currentActivity"]=F.activities.UPLOAD_LIST:this.$["*currentActivity"]=e.initActivity||F.activities.START_FROM}),this.sub(he("sourceList"),t=>{t!=="local"&&(this.$[he("sourceList")]="local")}),this.sub(he("confirmUpload"),t=>{t!==!1&&(this.$[he("confirmUpload")]=!1)})}}fa.template=`
  <lr-start-from>
    <lr-drop-area clickable l10n="choose-file"></lr-drop-area>
    <lr-copyright></lr-copyright>
  </lr-start-from>
  <lr-upload-list ref="uBlock"></lr-upload-list>
  <lr-message-box></lr-message-box>
`;class pa extends nr{shadowReadyCallback(){const s=this.ref.uBlock;this.sub("*currentActivity",e=>{e||(this.$["*currentActivity"]=s.initActivity||F.activities.START_FROM)}),this.sub("*uploadList",e=>{((e==null?void 0:e.length)>0&&this.$["*currentActivity"]===s.initActivity||F.activities.START_FROM)&&(this.$["*currentActivity"]=F.activities.UPLOAD_LIST)})}}pa.template=` <lr-start-from>
    <lr-drop-area with-icon clickable></lr-drop-area>
    <lr-source-list wrap></lr-source-list>
    <lr-copyright></lr-copyright>
  </lr-start-from>
  <lr-upload-list ref="uBlock"></lr-upload-list>
  <lr-camera-source></lr-camera-source>
  <lr-url-source></lr-url-source>
  <lr-external-source></lr-external-source>
  <lr-message-box></lr-message-box>
  <lr-progress-bar></lr-progress-bar>
  <lr-cloud-image-editor-activity></lr-cloud-image-editor-activity>`;class Kc extends sr(Xt){shadowReadyCallback(){this.__shadowReady=!0,this.$["*faderEl"]=this.ref["fader-el"],this.$["*cropperEl"]=this.ref["cropper-el"],this.$["*imgContainerEl"]=this.ref["img-container-el"],this.initEditor()}async initEditor(){this.__shadowReady&&await super.initEditor()}}function ar(i){for(let s in i){let e=[...s].reduce((t,r)=>(r.toUpperCase()===r&&(r="-"+r.toLowerCase()),t+=r),"");e.startsWith("-")&&(e=e.replace("-","")),e.startsWith("lr-")||(e="lr-"+e),i[s].reg&&i[s].reg(e)}}const Es="LR";async function Yc(i,s=!1){return new Promise((e,t)=>{if(typeof document!="object"){e(null);return}if(typeof window=="object"&&window[Es]){e(window[Es]);return}let r=document.createElement("script");r.async=!0,r.src=i,r.onerror=()=>{t()},r.onload=()=>{let n=window[Es];s&&ar(n),e(n)},document.head.appendChild(r)})}const Zc=Object.freeze(Object.defineProperty({__proto__:null,ActivityBlock:F,ActivityHeader:Xc,BaseComponent:Yi,Block:J,CameraSource:jn,CloudImageEditor:Kc,CloudImageEditorActivity:Fc,CloudImageEditorBlock:Xt,Config:Ln,ConfirmationDialog:Gn,Copyright:da,CropFrame:ta,Data:X,DataOutput:as,DropArea:Zs,EditorCropButtonControl:Rs,EditorFilterControl:Wi,EditorImageCropper:sa,EditorImageFader:Uc,EditorOperationControl:Us,EditorScroller:ra,EditorSlider:ia,EditorToolbar:na,ExternalSource:ca,FileItem:yt,FilePreview:Js,FileUploaderInline:pa,FileUploaderMinimal:fa,FileUploaderRegular:ha,Icon:Ks,Img:Kl,LineLoaderUi:aa,LrBtnUi:tr,MessageBox:Bn,Modal:Ee,PACKAGE_NAME:kn,PACKAGE_VERSION:On,PresenceToggle:oa,ProgressBar:qn,ProgressBarCommon:Xn,Select:ua,ShadowWrapper:rr,SimpleBtn:Fn,SliderUi:la,SourceBtn:ss,SourceList:sc,StartFrom:Yl,Tabs:ir,UploadCtxProvider:oc,UploadDetails:Wn,UploadList:zn,UploaderBlock:W,UrlSource:Hn,Video:He,connectBlocksFrom:Yc,registerBlocks:ar,shadowed:sr,toKebabCase:bt},Symbol.toStringTag,{value:"Module"}));class ma extends rr{}p(ma,"template",`
    <lr-simple-btn></lr-simple-btn>

    <lr-modal strokes block-body-scrolling>
      <lr-start-from>
        <lr-drop-area with-icon clickable></lr-drop-area>
        <lr-source-list wrap></lr-source-list>
        <lr-copyright></lr-copyright>
      </lr-start-from>
      <lr-upload-list></lr-upload-list>
      <lr-camera-source></lr-camera-source>
      <lr-url-source></lr-url-source>
      <lr-external-source></lr-external-source>
      <lr-cloud-image-editor-activity></lr-cloud-image-editor-activity>
      <lr-unsplash-source></lr-unsplash-source>
    </lr-modal>

    <lr-message-box></lr-message-box>
    <lr-progress-bar-common></lr-progress-bar-common>
  `);class Jc extends ss{initTypes(){super.initTypes(),this.registerType({type:"unsplash",activity:"unsplash",icon:"unsplash"})}}function jr(i,s){for(var e=0;e<s.length;e++){var t=s[e];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(i,t.key,t)}}function Qc(i,s,e){return s&&jr(i.prototype,s),e&&jr(i,e),Object.defineProperty(i,"prototype",{writable:!1}),i}/*!
 * Splide.js
 * Version  : 4.1.4
 * License  : MIT
 * Copyright: 2022 Naotoshi Fujita
 */var Wr="(prefers-reduced-motion: reduce)",Pt=1,eu=2,Wt=3,qt=4,bi=5,Di=6,Gi=7,tu={CREATED:Pt,MOUNTED:eu,IDLE:Wt,MOVING:qt,SCROLLING:bi,DRAGGING:Di,DESTROYED:Gi};function Ke(i){i.length=0}function ut(i,s,e){return Array.prototype.slice.call(i,s,e)}function G(i){return i.bind.apply(i,[null].concat(ut(arguments,1)))}var ga=setTimeout,Ns=function(){};function Gr(i){return requestAnimationFrame(i)}function os(i,s){return typeof s===i}function ci(i){return!lr(i)&&os("object",i)}var or=Array.isArray,va=G(os,"function"),rt=G(os,"string"),yi=G(os,"undefined");function lr(i){return i===null}function _a(i){try{return i instanceof(i.ownerDocument.defaultView||window).HTMLElement}catch{return!1}}function Ei(i){return or(i)?i:[i]}function Te(i,s){Ei(i).forEach(s)}function cr(i,s){return i.indexOf(s)>-1}function Mi(i,s){return i.push.apply(i,Ei(s)),i}function je(i,s,e){i&&Te(s,function(t){t&&i.classList[e?"add":"remove"](t)})}function De(i,s){je(i,rt(s)?s.split(" "):s,!0)}function Ci(i,s){Te(s,i.appendChild.bind(i))}function ur(i,s){Te(i,function(e){var t=(s||e).parentNode;t&&t.insertBefore(e,s)})}function ui(i,s){return _a(i)&&(i.msMatchesSelector||i.matches).call(i,s)}function ba(i,s){var e=i?ut(i.children):[];return s?e.filter(function(t){return ui(t,s)}):e}function wi(i,s){return s?ba(i,s)[0]:i.firstElementChild}var di=Object.keys;function Et(i,s,e){return i&&(e?di(i).reverse():di(i)).forEach(function(t){t!=="__proto__"&&s(i[t],t)}),i}function hi(i){return ut(arguments,1).forEach(function(s){Et(s,function(e,t){i[t]=s[t]})}),i}function et(i){return ut(arguments,1).forEach(function(s){Et(s,function(e,t){or(e)?i[t]=e.slice():ci(e)?i[t]=et({},ci(i[t])?i[t]:{},e):i[t]=e})}),i}function Xr(i,s){Te(s||di(i),function(e){delete i[e]})}function Me(i,s){Te(i,function(e){Te(s,function(t){e&&e.removeAttribute(t)})})}function M(i,s,e){ci(s)?Et(s,function(t,r){M(i,r,t)}):Te(i,function(t){lr(e)||e===""?Me(t,s):t.setAttribute(s,String(e))})}function Ut(i,s,e){var t=document.createElement(i);return s&&(rt(s)?De(t,s):M(t,s)),e&&Ci(e,t),t}function $e(i,s,e){if(yi(e))return getComputedStyle(i)[s];lr(e)||(i.style[s]=""+e)}function fi(i,s){$e(i,"display",s)}function ya(i){i.setActive&&i.setActive()||i.focus({preventScroll:!0})}function Ie(i,s){return i.getAttribute(s)}function qr(i,s){return i&&i.classList.contains(s)}function ye(i){return i.getBoundingClientRect()}function wt(i){Te(i,function(s){s&&s.parentNode&&s.parentNode.removeChild(s)})}function Ea(i){return wi(new DOMParser().parseFromString(i,"text/html").body)}function ze(i,s){i.preventDefault(),s&&(i.stopPropagation(),i.stopImmediatePropagation())}function Ca(i,s){return i&&i.querySelector(s)}function dr(i,s){return s?ut(i.querySelectorAll(s)):[]}function We(i,s){je(i,s,!1)}function Ds(i){return i.timeStamp}function gt(i){return rt(i)?i:i?i+"px":""}var Ti="splide",hr="data-"+Ti;function ai(i,s){if(!i)throw new Error("["+Ti+"] "+(s||""))}var nt=Math.min,Xi=Math.max,qi=Math.floor,pi=Math.ceil,fe=Math.abs;function wa(i,s,e){return fe(i-s)<e}function Fi(i,s,e,t){var r=nt(s,e),n=Xi(s,e);return t?r<i&&i<n:r<=i&&i<=n}function Ot(i,s,e){var t=nt(s,e),r=Xi(s,e);return nt(Xi(t,i),r)}function Ms(i){return+(i>0)-+(i<0)}function Fs(i,s){return Te(s,function(e){i=i.replace("%s",""+e)}),i}function fr(i){return i<10?"0"+i:""+i}var Kr={};function iu(i){return""+i+fr(Kr[i]=(Kr[i]||0)+1)}function Ta(){var i=[];function s(a,o,l,c){r(a,o,function(u,d,h){var m="addEventListener"in u,f=m?u.removeEventListener.bind(u,d,l,c):u.removeListener.bind(u,l);m?u.addEventListener(d,l,c):u.addListener(l),i.push([u,d,h,l,f])})}function e(a,o,l){r(a,o,function(c,u,d){i=i.filter(function(h){return h[0]===c&&h[1]===u&&h[2]===d&&(!l||h[3]===l)?(h[4](),!1):!0})})}function t(a,o,l){var c,u=!0;return typeof CustomEvent=="function"?c=new CustomEvent(o,{bubbles:u,detail:l}):(c=document.createEvent("CustomEvent"),c.initCustomEvent(o,u,!1,l)),a.dispatchEvent(c),c}function r(a,o,l){Te(a,function(c){c&&Te(o,function(u){u.split(" ").forEach(function(d){var h=d.split(".");l(c,h[0],h[1])})})})}function n(){i.forEach(function(a){a[4]()}),Ke(i)}return{bind:s,unbind:e,dispatch:t,destroy:n}}var St="mounted",Yr="ready",at="move",Ai="moved",Aa="click",su="active",ru="inactive",nu="visible",au="hidden",ee="refresh",me="updated",mi="resize",pr="resized",ou="drag",lu="dragging",cu="dragged",mr="scroll",Kt="scrolled",uu="overflow",Sa="destroy",du="arrows:mounted",hu="arrows:updated",fu="pagination:mounted",pu="pagination:updated",xa="navigation:mounted",$a="autoplay:play",mu="autoplay:playing",Ia="autoplay:pause",ka="lazyload:loaded",Oa="sk",La="sh",Ki="ei";function Y(i){var s=i?i.event.bus:document.createDocumentFragment(),e=Ta();function t(n,a){e.bind(s,Ei(n).join(" "),function(o){a.apply(a,or(o.detail)?o.detail:[])})}function r(n){e.dispatch(s,n,ut(arguments,1))}return i&&i.event.on(Sa,e.destroy),hi(e,{bus:s,on:t,off:G(e.unbind,s),emit:r})}function ls(i,s,e,t){var r=Date.now,n,a=0,o,l=!0,c=0;function u(){if(!l){if(a=i?nt((r()-n)/i,1):1,e&&e(a),a>=1&&(s(),n=r(),t&&++c>=t))return h();o=Gr(u)}}function d(y){y||f(),n=r()-(y?a*i:0),l=!1,o=Gr(u)}function h(){l=!0}function m(){n=r(),a=0,e&&e(a)}function f(){o&&cancelAnimationFrame(o),a=0,o=0,l=!0}function g(y){i=y}function b(){return l}return{start:d,rewind:m,pause:h,cancel:f,set:g,isPaused:b}}function gu(i){var s=i;function e(r){s=r}function t(r){return cr(Ei(r),s)}return{set:e,is:t}}function vu(i,s){var e=ls(s||0,i,null,1);return function(){e.isPaused()&&e.start()}}function _u(i,s,e){var t=i.state,r=e.breakpoints||{},n=e.reducedMotion||{},a=Ta(),o=[];function l(){var f=e.mediaQuery==="min";di(r).sort(function(g,b){return f?+g-+b:+b-+g}).forEach(function(g){u(r[g],"("+(f?"min":"max")+"-width:"+g+"px)")}),u(n,Wr),d()}function c(f){f&&a.destroy()}function u(f,g){var b=matchMedia(g);a.bind(b,"change",d),o.push([f,b])}function d(){var f=t.is(Gi),g=e.direction,b=o.reduce(function(y,_){return et(y,_[1].matches?_[0]:{})},{});Xr(e),m(b),e.destroy?i.destroy(e.destroy==="completely"):f?(c(!0),i.mount()):g!==e.direction&&i.refresh()}function h(f){matchMedia(Wr).matches&&(f?et(e,n):Xr(e,di(n)))}function m(f,g,b){et(e,f),g&&et(Object.getPrototypeOf(e),f),(b||!t.is(Pt))&&i.emit(me,e)}return{setup:l,destroy:c,reduce:h,set:m}}var cs="Arrow",us=cs+"Left",ds=cs+"Right",Ra=cs+"Up",Pa=cs+"Down",Zr="rtl",hs="ttb",Cs={width:["height"],left:["top","right"],right:["bottom","left"],x:["y"],X:["Y"],Y:["X"],ArrowLeft:[Ra,ds],ArrowRight:[Pa,us]};function bu(i,s,e){function t(n,a,o){o=o||e.direction;var l=o===Zr&&!a?1:o===hs?0:-1;return Cs[n]&&Cs[n][l]||n.replace(/width|left|right/i,function(c,u){var d=Cs[c.toLowerCase()][l]||c;return u>0?d.charAt(0).toUpperCase()+d.slice(1):d})}function r(n){return n*(e.direction===Zr?1:-1)}return{resolve:t,orient:r}}var Ge="role",Nt="tabindex",yu="disabled",Oe="aria-",Si=Oe+"controls",Ua=Oe+"current",Jr=Oe+"selected",we=Oe+"label",gr=Oe+"labelledby",Na=Oe+"hidden",vr=Oe+"orientation",gi=Oe+"roledescription",Qr=Oe+"live",en=Oe+"busy",tn=Oe+"atomic",_r=[Ge,Nt,yu,Si,Ua,we,gr,Na,vr,gi],Fe=Ti+"__",dt="is-",ws=Ti,sn=Fe+"track",Eu=Fe+"list",fs=Fe+"slide",Da=fs+"--clone",Cu=fs+"__container",br=Fe+"arrows",ps=Fe+"arrow",Ma=ps+"--prev",Fa=ps+"--next",ms=Fe+"pagination",Va=ms+"__page",wu=Fe+"progress",Tu=wu+"__bar",Au=Fe+"toggle",Su=Fe+"spinner",xu=Fe+"sr",$u=dt+"initialized",Tt=dt+"active",Ba=dt+"prev",za=dt+"next",Vs=dt+"visible",Bs=dt+"loading",Ha=dt+"focus-in",ja=dt+"overflow",Iu=[Tt,Vs,Ba,za,Bs,Ha,ja],ku={slide:fs,clone:Da,arrows:br,arrow:ps,prev:Ma,next:Fa,pagination:ms,page:Va,spinner:Su};function Ou(i,s){if(va(i.closest))return i.closest(s);for(var e=i;e&&e.nodeType===1&&!ui(e,s);)e=e.parentElement;return e}var Lu=5,rn=200,Wa="touchstart mousedown",Ts="touchmove mousemove",As="touchend touchcancel mouseup click";function Ru(i,s,e){var t=Y(i),r=t.on,n=t.bind,a=i.root,o=e.i18n,l={},c=[],u=[],d=[],h,m,f;function g(){v(),O(),_()}function b(){r(ee,y),r(ee,g),r(me,_),n(document,Wa+" keydown",function(E){f=E.type==="keydown"},{capture:!0}),n(a,"focusin",function(){je(a,Ha,!!f)})}function y(E){var S=_r.concat("style");Ke(c),We(a,u),We(h,d),Me([h,m],S),Me(a,E?S:["style",gi])}function _(){We(a,u),We(h,d),u=R(ws),d=R(sn),De(a,u),De(h,d),M(a,we,e.label),M(a,gr,e.labelledby)}function v(){h=x("."+sn),m=wi(h,"."+Eu),ai(h&&m,"A track/list element is missing."),Mi(c,ba(m,"."+fs+":not(."+Da+")")),Et({arrows:br,pagination:ms,prev:Ma,next:Fa,bar:Tu,toggle:Au},function(E,S){l[S]=x("."+E)}),hi(l,{root:a,track:h,list:m,slides:c})}function O(){var E=a.id||iu(Ti),S=e.role;a.id=E,h.id=h.id||E+"-track",m.id=m.id||E+"-list",!Ie(a,Ge)&&a.tagName!=="SECTION"&&S&&M(a,Ge,S),M(a,gi,o.carousel),M(m,Ge,"presentation")}function x(E){var S=Ca(a,E);return S&&Ou(S,"."+ws)===a?S:void 0}function R(E){return[E+"--"+e.type,E+"--"+e.direction,e.drag&&E+"--draggable",e.isNavigation&&E+"--nav",E===ws&&Tt]}return hi(l,{setup:g,mount:b,destroy:y})}var Gt="slide",Yt="loop",xi="fade";function Pu(i,s,e,t){var r=Y(i),n=r.on,a=r.emit,o=r.bind,l=i.Components,c=i.root,u=i.options,d=u.isNavigation,h=u.updateOnMove,m=u.i18n,f=u.pagination,g=u.slideFocus,b=l.Direction.resolve,y=Ie(t,"style"),_=Ie(t,we),v=e>-1,O=wi(t,"."+Cu),x;function R(){v||(t.id=c.id+"-slide"+fr(s+1),M(t,Ge,f?"tabpanel":"group"),M(t,gi,m.slide),M(t,we,_||Fs(m.slideLabel,[s+1,i.length]))),E()}function E(){o(t,"click",G(a,Aa,N)),o(t,"keydown",G(a,Oa,N)),n([Ai,La,Kt],C),n(xa,U),h&&n(at,$)}function S(){x=!0,r.destroy(),We(t,Iu),Me(t,_r),M(t,"style",y),M(t,we,_||"")}function U(){var P=i.splides.map(function(T){var L=T.splide.Components.Slides.getAt(s);return L?L.slide.id:""}).join(" ");M(t,we,Fs(m.slideX,(v?e:s)+1)),M(t,Si,P),M(t,Ge,g?"button":""),g&&Me(t,gi)}function $(){x||C()}function C(){if(!x){var P=i.index;A(),I(),je(t,Ba,s===P-1),je(t,za,s===P+1)}}function A(){var P=V();P!==qr(t,Tt)&&(je(t,Tt,P),M(t,Ua,d&&P||""),a(P?su:ru,N))}function I(){var P=Z(),T=!P&&(!V()||v);if(i.state.is([qt,bi])||M(t,Na,T||""),M(dr(t,u.focusableNodes||""),Nt,T?-1:""),g&&M(t,Nt,T?-1:0),P!==qr(t,Vs)&&(je(t,Vs,P),a(P?nu:au,N)),!P&&document.activeElement===t){var L=l.Slides.getAt(i.index);L&&ya(L.slide)}}function D(P,T,L){$e(L&&O||t,P,T)}function V(){var P=i.index;return P===s||u.cloneStatus&&P===e}function Z(){if(i.is(xi))return V();var P=ye(l.Elements.track),T=ye(t),L=b("left",!0),H=b("right",!0);return qi(P[L])<=pi(T[L])&&qi(T[H])<=pi(P[H])}function K(P,T){var L=fe(P-s);return!v&&(u.rewind||i.is(Yt))&&(L=nt(L,i.length-L)),L<=T}var N={index:s,slideIndex:e,slide:t,container:O,isClone:v,mount:R,destroy:S,update:C,style:D,isWithin:K};return N}function Uu(i,s,e){var t=Y(i),r=t.on,n=t.emit,a=t.bind,o=s.Elements,l=o.slides,c=o.list,u=[];function d(){h(),r(ee,m),r(ee,h)}function h(){l.forEach(function(C,A){g(C,A,-1)})}function m(){x(function(C){C.destroy()}),Ke(u)}function f(){x(function(C){C.update()})}function g(C,A,I){var D=Pu(i,A,I,C);D.mount(),u.push(D),u.sort(function(V,Z){return V.index-Z.index})}function b(C){return C?R(function(A){return!A.isClone}):u}function y(C){var A=s.Controller,I=A.toIndex(C),D=A.hasFocus()?1:e.perPage;return R(function(V){return Fi(V.index,I,I+D-1)})}function _(C){return R(C)[0]}function v(C,A){Te(C,function(I){if(rt(I)&&(I=Ea(I)),_a(I)){var D=l[A];D?ur(I,D):Ci(c,I),De(I,e.classes.slide),S(I,G(n,mi))}}),n(ee)}function O(C){wt(R(C).map(function(A){return A.slide})),n(ee)}function x(C,A){b(A).forEach(C)}function R(C){return u.filter(va(C)?C:function(A){return rt(C)?ui(A.slide,C):cr(Ei(C),A.index)})}function E(C,A,I){x(function(D){D.style(C,A,I)})}function S(C,A){var I=dr(C,"img"),D=I.length;D?I.forEach(function(V){a(V,"load error",function(){--D||A()})}):A()}function U(C){return C?l.length:u.length}function $(){return u.length>e.perPage}return{mount:d,destroy:m,update:f,register:g,get:b,getIn:y,getAt:_,add:v,remove:O,forEach:x,filter:R,style:E,getLength:U,isEnough:$}}function Nu(i,s,e){var t=Y(i),r=t.on,n=t.bind,a=t.emit,o=s.Slides,l=s.Direction.resolve,c=s.Elements,u=c.root,d=c.track,h=c.list,m=o.getAt,f=o.style,g,b,y;function _(){v(),n(window,"resize load",vu(G(a,mi))),r([me,ee],v),r(mi,O)}function v(){g=e.direction===hs,$e(u,"maxWidth",gt(e.width)),$e(d,l("paddingLeft"),x(!1)),$e(d,l("paddingRight"),x(!0)),O(!0)}function O(N){var P=ye(u);(N||b.width!==P.width||b.height!==P.height)&&($e(d,"height",R()),f(l("marginRight"),gt(e.gap)),f("width",S()),f("height",U(),!0),b=P,a(pr),y!==(y=K())&&(je(u,ja,y),a(uu,y)))}function x(N){var P=e.padding,T=l(N?"right":"left");return P&&gt(P[T]||(ci(P)?0:P))||"0px"}function R(){var N="";return g&&(N=E(),ai(N,"height or heightRatio is missing."),N="calc("+N+" - "+x(!1)+" - "+x(!0)+")"),N}function E(){return gt(e.height||ye(h).width*e.heightRatio)}function S(){return e.autoWidth?null:gt(e.fixedWidth)||(g?"":$())}function U(){return gt(e.fixedHeight)||(g?e.autoHeight?null:$():E())}function $(){var N=gt(e.gap);return"calc((100%"+(N&&" + "+N)+")/"+(e.perPage||1)+(N&&" - "+N)+")"}function C(){return ye(h)[l("width")]}function A(N,P){var T=m(N||0);return T?ye(T.slide)[l("width")]+(P?0:V()):0}function I(N,P){var T=m(N);if(T){var L=ye(T.slide)[l("right")],H=ye(h)[l("left")];return fe(L-H)+(P?0:V())}return 0}function D(N){return I(i.length-1)-I(0)+A(0,N)}function V(){var N=m(0);return N&&parseFloat($e(N.slide,l("marginRight")))||0}function Z(N){return parseFloat($e(d,l("padding"+(N?"Right":"Left"))))||0}function K(){return i.is(xi)||D(!0)>C()}return{mount:_,resize:O,listSize:C,slideSize:A,sliderSize:D,totalSize:I,getPadding:Z,isOverflow:K}}var Du=2;function Mu(i,s,e){var t=Y(i),r=t.on,n=s.Elements,a=s.Slides,o=s.Direction.resolve,l=[],c;function u(){r(ee,d),r([me,mi],m),(c=b())&&(f(c),s.Layout.resize(!0))}function d(){h(),u()}function h(){wt(l),Ke(l),t.destroy()}function m(){var y=b();c!==y&&(c<y||!y)&&t.emit(ee)}function f(y){var _=a.get().slice(),v=_.length;if(v){for(;_.length<y;)Mi(_,_);Mi(_.slice(-y),_.slice(0,y)).forEach(function(O,x){var R=x<y,E=g(O.slide,x);R?ur(E,_[0].slide):Ci(n.list,E),Mi(l,E),a.register(E,x-y+(R?0:v),O.index)})}}function g(y,_){var v=y.cloneNode(!0);return De(v,e.classes.clone),v.id=i.root.id+"-clone"+fr(_+1),v}function b(){var y=e.clones;if(!i.is(Yt))y=0;else if(yi(y)){var _=e[o("fixedWidth")]&&s.Layout.slideSize(0),v=_&&pi(ye(n.track)[o("width")]/_);y=v||e[o("autoWidth")]&&i.length||e.perPage*Du}return y}return{mount:u,destroy:h}}function Fu(i,s,e){var t=Y(i),r=t.on,n=t.emit,a=i.state.set,o=s.Layout,l=o.slideSize,c=o.getPadding,u=o.totalSize,d=o.listSize,h=o.sliderSize,m=s.Direction,f=m.resolve,g=m.orient,b=s.Elements,y=b.list,_=b.track,v;function O(){v=s.Transition,r([St,pr,me,ee],x)}function x(){s.Controller.isBusy()||(s.Scroll.cancel(),E(i.index),s.Slides.update())}function R(T,L,H,ie){T!==L&&N(T>H)&&(C(),S($(D(),T>H),!0)),a(qt),n(at,L,H,T),v.start(L,function(){a(Wt),n(Ai,L,H,T),ie&&ie()})}function E(T){S(I(T,!0))}function S(T,L){if(!i.is(xi)){var H=L?T:U(T);$e(y,"transform","translate"+f("X")+"("+H+"px)"),T!==H&&n(La)}}function U(T){if(i.is(Yt)){var L=A(T),H=L>s.Controller.getEnd(),ie=L<0;(ie||H)&&(T=$(T,H))}return T}function $(T,L){var H=T-K(L),ie=h();return T-=g(ie*(pi(fe(H)/ie)||1))*(L?1:-1),T}function C(){S(D(),!0),v.cancel()}function A(T){for(var L=s.Slides.get(),H=0,ie=1/0,te=0;te<L.length;te++){var Ze=L[te].index,w=fe(I(Ze,!0)-T);if(w<=ie)ie=w,H=Ze;else break}return H}function I(T,L){var H=g(u(T-1)-Z(T));return L?V(H):H}function D(){var T=f("left");return ye(y)[T]-ye(_)[T]+g(c(!1))}function V(T){return e.trimSpace&&i.is(Gt)&&(T=Ot(T,0,g(h(!0)-d()))),T}function Z(T){var L=e.focus;return L==="center"?(d()-l(T,!0))/2:+L*l(T)||0}function K(T){return I(T?s.Controller.getEnd():0,!!e.trimSpace)}function N(T){var L=g($(D(),T));return T?L>=0:L<=y[f("scrollWidth")]-ye(_)[f("width")]}function P(T,L){L=yi(L)?D():L;var H=T!==!0&&g(L)<g(K(!1)),ie=T!==!1&&g(L)>g(K(!0));return H||ie}return{mount:O,move:R,jump:E,translate:S,shift:$,cancel:C,toIndex:A,toPosition:I,getPosition:D,getLimit:K,exceededLimit:P,reposition:x}}function Vu(i,s,e){var t=Y(i),r=t.on,n=t.emit,a=s.Move,o=a.getPosition,l=a.getLimit,c=a.toPosition,u=s.Slides,d=u.isEnough,h=u.getLength,m=e.omitEnd,f=i.is(Yt),g=i.is(Gt),b=G(D,!1),y=G(D,!0),_=e.start||0,v,O=_,x,R,E;function S(){U(),r([me,ee,Ki],U),r(pr,$)}function U(){x=h(!0),R=e.perMove,E=e.perPage,v=N();var w=Ot(_,0,m?v:x-1);w!==_&&(_=w,a.reposition())}function $(){v!==N()&&n(Ki)}function C(w,j,le){if(!Ze()){var Q=I(w),ne=K(Q);ne>-1&&(j||ne!==_)&&(H(ne),a.move(Q,ne,O,le))}}function A(w,j,le,Q){s.Scroll.scroll(w,j,le,function(){var ne=K(a.toIndex(o()));H(m?nt(ne,v):ne),Q&&Q()})}function I(w){var j=_;if(rt(w)){var le=w.match(/([+\-<>])(\d+)?/)||[],Q=le[1],ne=le[2];Q==="+"||Q==="-"?j=V(_+ +(""+Q+(+ne||1)),_):Q===">"?j=ne?P(+ne):b(!0):Q==="<"&&(j=y(!0))}else j=f?w:Ot(w,0,v);return j}function D(w,j){var le=R||(te()?1:E),Q=V(_+le*(w?-1:1),_,!(R||te()));return Q===-1&&g&&!wa(o(),l(!w),1)?w?0:v:j?Q:K(Q)}function V(w,j,le){if(d()||te()){var Q=Z(w);Q!==w&&(j=w,w=Q,le=!1),w<0||w>v?!R&&(Fi(0,w,j,!0)||Fi(v,j,w,!0))?w=P(T(w)):f?w=le?w<0?-(x%E||E):x:w:e.rewind?w=w<0?v:0:w=-1:le&&w!==j&&(w=P(T(j)+(w<j?-1:1)))}else w=-1;return w}function Z(w){if(g&&e.trimSpace==="move"&&w!==_)for(var j=o();j===c(w,!0)&&Fi(w,0,i.length-1,!e.rewind);)w<_?--w:++w;return w}function K(w){return f?(w+x)%x||0:w}function N(){for(var w=x-(te()||f&&R?1:E);m&&w-- >0;)if(c(x-1,!0)!==c(w,!0)){w++;break}return Ot(w,0,x-1)}function P(w){return Ot(te()?w:E*w,0,v)}function T(w){return te()?nt(w,v):qi((w>=v?x-1:w)/E)}function L(w){var j=a.toIndex(w);return g?Ot(j,0,v):j}function H(w){w!==_&&(O=_,_=w)}function ie(w){return w?O:_}function te(){return!yi(e.focus)||e.isNavigation}function Ze(){return i.state.is([qt,bi])&&!!e.waitForTransition}return{mount:S,go:C,scroll:A,getNext:b,getPrev:y,getAdjacent:D,getEnd:N,setIndex:H,getIndex:ie,toIndex:P,toPage:T,toDest:L,hasFocus:te,isBusy:Ze}}var Bu="http://www.w3.org/2000/svg",zu="m15.5 0.932-4.3 4.38 14.5 14.6-14.5 14.5 4.3 4.4 14.6-14.6 4.4-4.3-4.4-4.4-14.6-14.6z",Li=40;function Hu(i,s,e){var t=Y(i),r=t.on,n=t.bind,a=t.emit,o=e.classes,l=e.i18n,c=s.Elements,u=s.Controller,d=c.arrows,h=c.track,m=d,f=c.prev,g=c.next,b,y,_={};function v(){x(),r(me,O)}function O(){R(),v()}function x(){var A=e.arrows;A&&!(f&&g)&&U(),f&&g&&(hi(_,{prev:f,next:g}),fi(m,A?"":"none"),De(m,y=br+"--"+e.direction),A&&(E(),C(),M([f,g],Si,h.id),a(du,f,g)))}function R(){t.destroy(),We(m,y),b?(wt(d?[f,g]:m),f=g=null):Me([f,g],_r)}function E(){r([St,Ai,ee,Kt,Ki],C),n(g,"click",G(S,">")),n(f,"click",G(S,"<"))}function S(A){u.go(A,!0)}function U(){m=d||Ut("div",o.arrows),f=$(!0),g=$(!1),b=!0,Ci(m,[f,g]),!d&&ur(m,h)}function $(A){var I='<button class="'+o.arrow+" "+(A?o.prev:o.next)+'" type="button"><svg xmlns="'+Bu+'" viewBox="0 0 '+Li+" "+Li+'" width="'+Li+'" height="'+Li+'" focusable="false"><path d="'+(e.arrowPath||zu)+'" />';return Ea(I)}function C(){if(f&&g){var A=i.index,I=u.getPrev(),D=u.getNext(),V=I>-1&&A<I?l.last:l.prev,Z=D>-1&&A>D?l.first:l.next;f.disabled=I<0,g.disabled=D<0,M(f,we,V),M(g,we,Z),a(hu,f,g,I,D)}}return{arrows:_,mount:v,destroy:R,update:C}}var ju=hr+"-interval";function Wu(i,s,e){var t=Y(i),r=t.on,n=t.bind,a=t.emit,o=ls(e.interval,i.go.bind(i,">"),E),l=o.isPaused,c=s.Elements,u=s.Elements,d=u.root,h=u.toggle,m=e.autoplay,f,g,b=m==="pause";function y(){m&&(_(),h&&M(h,Si,c.track.id),b||v(),R())}function _(){e.pauseOnHover&&n(d,"mouseenter mouseleave",function(U){f=U.type==="mouseenter",x()}),e.pauseOnFocus&&n(d,"focusin focusout",function(U){g=U.type==="focusin",x()}),h&&n(h,"click",function(){b?v():O(!0)}),r([at,mr,ee],o.rewind),r(at,S)}function v(){l()&&s.Slides.isEnough()&&(o.start(!e.resetProgress),g=f=b=!1,R(),a($a))}function O(U){U===void 0&&(U=!0),b=!!U,R(),l()||(o.pause(),a(Ia))}function x(){b||(f||g?O(!1):v())}function R(){h&&(je(h,Tt,!b),M(h,we,e.i18n[b?"play":"pause"]))}function E(U){var $=c.bar;$&&$e($,"width",U*100+"%"),a(mu,U)}function S(U){var $=s.Slides.getAt(U);o.set($&&+Ie($.slide,ju)||e.interval)}return{mount:y,destroy:o.cancel,play:v,pause:O,isPaused:l}}function Gu(i,s,e){var t=Y(i),r=t.on;function n(){e.cover&&(r(ka,G(o,!0)),r([St,me,ee],G(a,!0)))}function a(l){s.Slides.forEach(function(c){var u=wi(c.container||c.slide,"img");u&&u.src&&o(l,u,c)})}function o(l,c,u){u.style("background",l?'center/cover no-repeat url("'+c.src+'")':"",!0),fi(c,l?"none":"")}return{mount:n,destroy:G(a,!1)}}var Xu=10,qu=600,Ku=.6,Yu=1.5,Zu=800;function Ju(i,s,e){var t=Y(i),r=t.on,n=t.emit,a=i.state.set,o=s.Move,l=o.getPosition,c=o.getLimit,u=o.exceededLimit,d=o.translate,h=i.is(Gt),m,f,g=1;function b(){r(at,O),r([me,ee],x)}function y(E,S,U,$,C){var A=l();if(O(),U&&(!h||!u())){var I=s.Layout.sliderSize(),D=Ms(E)*I*qi(fe(E)/I)||0;E=o.toPosition(s.Controller.toDest(E%I))+D}var V=wa(A,E,1);g=1,S=V?0:S||Xi(fe(E-A)/Yu,Zu),f=$,m=ls(S,_,G(v,A,E,C),1),a(bi),n(mr),m.start()}function _(){a(Wt),f&&f(),n(Kt)}function v(E,S,U,$){var C=l(),A=E+(S-E)*R($),I=(A-C)*g;d(C+I),h&&!U&&u()&&(g*=Ku,fe(I)<Xu&&y(c(u(!0)),qu,!1,f,!0))}function O(){m&&m.cancel()}function x(){m&&!m.isPaused()&&(O(),_())}function R(E){var S=e.easingFunc;return S?S(E):1-Math.pow(1-E,4)}return{mount:b,destroy:O,scroll:y,cancel:x}}var Lt={passive:!1,capture:!0};function Qu(i,s,e){var t=Y(i),r=t.on,n=t.emit,a=t.bind,o=t.unbind,l=i.state,c=s.Move,u=s.Scroll,d=s.Controller,h=s.Elements.track,m=s.Media.reduce,f=s.Direction,g=f.resolve,b=f.orient,y=c.getPosition,_=c.exceededLimit,v,O,x,R,E,S=!1,U,$,C;function A(){a(h,Ts,Ns,Lt),a(h,As,Ns,Lt),a(h,Wa,D,Lt),a(h,"click",K,{capture:!0}),a(h,"dragstart",ze),r([St,me],I)}function I(){var k=e.drag;wr(!k),R=k==="free"}function D(k){if(U=!1,!$){var q=ne(k);Q(k.target)&&(q||!k.button)&&(d.isBusy()?ze(k,!0):(C=q?h:window,E=l.is([qt,bi]),x=null,a(C,Ts,V,Lt),a(C,As,Z,Lt),c.cancel(),u.cancel(),N(k)))}}function V(k){if(l.is(Di)||(l.set(Di),n(ou)),k.cancelable)if(E){c.translate(v+le(te(k)));var q=Ze(k)>rn,ht=S!==(S=_());(q||ht)&&N(k),U=!0,n(lu),ze(k)}else L(k)&&(E=T(k),ze(k))}function Z(k){l.is(Di)&&(l.set(Wt),n(cu)),E&&(P(k),ze(k)),o(C,Ts,V),o(C,As,Z),E=!1}function K(k){!$&&U&&ze(k,!0)}function N(k){x=O,O=k,v=y()}function P(k){var q=H(k),ht=ie(q),Zt=e.rewind&&e.rewindByDrag;m(!1),R?d.scroll(ht,0,e.snap):i.is(xi)?d.go(b(Ms(q))<0?Zt?"<":"-":Zt?">":"+"):i.is(Gt)&&S&&Zt?d.go(_(!0)?">":"<"):d.go(d.toDest(ht),!0),m(!0)}function T(k){var q=e.dragMinThreshold,ht=ci(q),Zt=ht&&q.mouse||0,Ka=(ht?q.touch:+q)||10;return fe(te(k))>(ne(k)?Ka:Zt)}function L(k){return fe(te(k))>fe(te(k,!0))}function H(k){if(i.is(Yt)||!S){var q=Ze(k);if(q&&q<rn)return te(k)/q}return 0}function ie(k){return y()+Ms(k)*nt(fe(k)*(e.flickPower||600),R?1/0:s.Layout.listSize()*(e.flickMaxPages||1))}function te(k,q){return j(k,q)-j(w(k),q)}function Ze(k){return Ds(k)-Ds(w(k))}function w(k){return O===k&&x||O}function j(k,q){return(ne(k)?k.changedTouches[0]:k)["page"+g(q?"Y":"X")]}function le(k){return k/(S&&i.is(Gt)?Lu:1)}function Q(k){var q=e.noDrag;return!ui(k,"."+Va+", ."+ps)&&(!q||!ui(k,q))}function ne(k){return typeof TouchEvent<"u"&&k instanceof TouchEvent}function qa(){return E}function wr(k){$=k}return{mount:A,disable:wr,isDragging:qa}}var ed={Spacebar:" ",Right:ds,Left:us,Up:Ra,Down:Pa};function yr(i){return i=rt(i)?i:i.key,ed[i]||i}var nn="keydown";function td(i,s,e){var t=Y(i),r=t.on,n=t.bind,a=t.unbind,o=i.root,l=s.Direction.resolve,c,u;function d(){h(),r(me,m),r(me,h),r(at,g)}function h(){var y=e.keyboard;y&&(c=y==="global"?window:o,n(c,nn,b))}function m(){a(c,nn)}function f(y){u=y}function g(){var y=u;u=!0,ga(function(){u=y})}function b(y){if(!u){var _=yr(y);_===l(us)?i.go("<"):_===l(ds)&&i.go(">")}}return{mount:d,destroy:m,disable:f}}var oi=hr+"-lazy",Vi=oi+"-srcset",id="["+oi+"], ["+Vi+"]";function sd(i,s,e){var t=Y(i),r=t.on,n=t.off,a=t.bind,o=t.emit,l=e.lazyLoad==="sequential",c=[Ai,Kt],u=[];function d(){e.lazyLoad&&(h(),r(ee,h))}function h(){Ke(u),m(),l?y():(n(c),r(c,f),f())}function m(){s.Slides.forEach(function(_){dr(_.slide,id).forEach(function(v){var O=Ie(v,oi),x=Ie(v,Vi);if(O!==v.src||x!==v.srcset){var R=e.classes.spinner,E=v.parentElement,S=wi(E,"."+R)||Ut("span",R,E);u.push([v,_,S]),v.src||fi(v,"none")}})})}function f(){u=u.filter(function(_){var v=e.perPage*((e.preloadPages||1)+1)-1;return _[1].isWithin(i.index,v)?g(_):!0}),u.length||n(c)}function g(_){var v=_[0];De(_[1].slide,Bs),a(v,"load error",G(b,_)),M(v,"src",Ie(v,oi)),M(v,"srcset",Ie(v,Vi)),Me(v,oi),Me(v,Vi)}function b(_,v){var O=_[0],x=_[1];We(x.slide,Bs),v.type!=="error"&&(wt(_[2]),fi(O,""),o(ka,O,x),o(mi)),l&&y()}function y(){u.length&&g(u.shift())}return{mount:d,destroy:G(Ke,u),check:f}}function rd(i,s,e){var t=Y(i),r=t.on,n=t.emit,a=t.bind,o=s.Slides,l=s.Elements,c=s.Controller,u=c.hasFocus,d=c.getIndex,h=c.go,m=s.Direction.resolve,f=l.pagination,g=[],b,y;function _(){v(),r([me,ee,Ki],_);var $=e.pagination;f&&fi(f,$?"":"none"),$&&(r([at,mr,Kt],U),O(),U(),n(fu,{list:b,items:g},S(i.index)))}function v(){b&&(wt(f?ut(b.children):b),We(b,y),Ke(g),b=null),t.destroy()}function O(){var $=i.length,C=e.classes,A=e.i18n,I=e.perPage,D=u()?c.getEnd()+1:pi($/I);b=f||Ut("ul",C.pagination,l.track.parentElement),De(b,y=ms+"--"+E()),M(b,Ge,"tablist"),M(b,we,A.select),M(b,vr,E()===hs?"vertical":"");for(var V=0;V<D;V++){var Z=Ut("li",null,b),K=Ut("button",{class:C.page,type:"button"},Z),N=o.getIn(V).map(function(T){return T.slide.id}),P=!u()&&I>1?A.pageX:A.slideX;a(K,"click",G(x,V)),e.paginationKeyboard&&a(K,"keydown",G(R,V)),M(Z,Ge,"presentation"),M(K,Ge,"tab"),M(K,Si,N.join(" ")),M(K,we,Fs(P,V+1)),M(K,Nt,-1),g.push({li:Z,button:K,page:V})}}function x($){h(">"+$,!0)}function R($,C){var A=g.length,I=yr(C),D=E(),V=-1;I===m(ds,!1,D)?V=++$%A:I===m(us,!1,D)?V=(--$+A)%A:I==="Home"?V=0:I==="End"&&(V=A-1);var Z=g[V];Z&&(ya(Z.button),h(">"+V),ze(C,!0))}function E(){return e.paginationDirection||e.direction}function S($){return g[c.toPage($)]}function U(){var $=S(d(!0)),C=S(d());if($){var A=$.button;We(A,Tt),Me(A,Jr),M(A,Nt,-1)}if(C){var I=C.button;De(I,Tt),M(I,Jr,!0),M(I,Nt,"")}n(pu,{list:b,items:g},$,C)}return{items:g,mount:_,destroy:v,getAt:S,update:U}}var nd=[" ","Enter"];function ad(i,s,e){var t=e.isNavigation,r=e.slideFocus,n=[];function a(){i.splides.forEach(function(f){f.isParent||(c(i,f.splide),c(f.splide,i))}),t&&u()}function o(){n.forEach(function(f){f.destroy()}),Ke(n)}function l(){o(),a()}function c(f,g){var b=Y(f);b.on(at,function(y,_,v){g.go(g.is(Yt)?v:y)}),n.push(b)}function u(){var f=Y(i),g=f.on;g(Aa,h),g(Oa,m),g([St,me],d),n.push(f),f.emit(xa,i.splides)}function d(){M(s.Elements.list,vr,e.direction===hs?"vertical":"")}function h(f){i.go(f.index)}function m(f,g){cr(nd,yr(g))&&(h(f),ze(g))}return{setup:G(s.Media.set,{slideFocus:yi(r)?t:r},!0),mount:a,destroy:o,remount:l}}function od(i,s,e){var t=Y(i),r=t.bind,n=0;function a(){e.wheel&&r(s.Elements.track,"wheel",o,Lt)}function o(c){if(c.cancelable){var u=c.deltaY,d=u<0,h=Ds(c),m=e.wheelMinThreshold||0,f=e.wheelSleep||0;fe(u)>m&&h-n>f&&(i.go(d?"<":">"),n=h),l(d)&&ze(c)}}function l(c){return!e.releaseWheel||i.state.is(qt)||s.Controller.getAdjacent(c)!==-1}return{mount:a}}var ld=90;function cd(i,s,e){var t=Y(i),r=t.on,n=s.Elements.track,a=e.live&&!e.isNavigation,o=Ut("span",xu),l=ls(ld,G(u,!1));function c(){a&&(h(!s.Autoplay.isPaused()),M(n,tn,!0),o.textContent="…",r($a,G(h,!0)),r(Ia,G(h,!1)),r([Ai,Kt],G(u,!0)))}function u(m){M(n,en,m),m?(Ci(n,o),l.start()):(wt(o),l.cancel())}function d(){Me(n,[Qr,tn,en]),wt(o)}function h(m){a&&M(n,Qr,m?"off":"polite")}return{mount:c,disable:h,destroy:d}}var ud=Object.freeze({__proto__:null,Media:_u,Direction:bu,Elements:Ru,Slides:Uu,Layout:Nu,Clones:Mu,Move:Fu,Controller:Vu,Arrows:Hu,Autoplay:Wu,Cover:Gu,Scroll:Ju,Drag:Qu,Keyboard:td,LazyLoad:sd,Pagination:rd,Sync:ad,Wheel:od,Live:cd}),dd={prev:"Previous slide",next:"Next slide",first:"Go to first slide",last:"Go to last slide",slideX:"Go to slide %s",pageX:"Go to page %s",play:"Start autoplay",pause:"Pause autoplay",carousel:"carousel",slide:"slide",select:"Select a slide to show",slideLabel:"%s of %s"},hd={type:"slide",role:"region",speed:400,perPage:1,cloneStatus:!0,arrows:!0,pagination:!0,paginationKeyboard:!0,interval:5e3,pauseOnHover:!0,pauseOnFocus:!0,resetProgress:!0,easing:"cubic-bezier(0.25, 1, 0.5, 1)",drag:!0,direction:"ltr",trimSpace:!0,focusableNodes:"a, button, textarea, input, select, iframe",live:!0,classes:ku,i18n:dd,reducedMotion:{speed:0,rewindSpeed:0,autoplay:"pause"}};function fd(i,s,e){var t=s.Slides;function r(){Y(i).on([St,ee],n)}function n(){t.forEach(function(o){o.style("transform","translateX(-"+100*o.index+"%)")})}function a(o,l){t.style("transition","opacity "+e.speed+"ms "+e.easing),ga(l)}return{mount:r,start:a,cancel:Ns}}function pd(i,s,e){var t=s.Move,r=s.Controller,n=s.Scroll,a=s.Elements.list,o=G($e,a,"transition"),l;function c(){Y(i).bind(a,"transitionend",function(m){m.target===a&&l&&(d(),l())})}function u(m,f){var g=t.toPosition(m,!0),b=t.getPosition(),y=h(m);fe(g-b)>=1&&y>=1?e.useScroll?n.scroll(g,y,!1,f):(o("transform "+y+"ms "+e.easing),t.translate(g,!0),l=f):(t.jump(m),f())}function d(){o(""),n.cancel()}function h(m){var f=e.rewindSpeed;if(i.is(Gt)&&f){var g=r.getIndex(!0),b=r.getEnd();if(g===0&&m>=b||g>=b&&m===0)return f}return e.speed}return{mount:c,start:u,cancel:d}}var md=function(){function i(e,t){this.event=Y(),this.Components={},this.state=gu(Pt),this.splides=[],this._o={},this._E={};var r=rt(e)?Ca(document,e):e;ai(r,r+" is invalid."),this.root=r,t=et({label:Ie(r,we)||"",labelledby:Ie(r,gr)||""},hd,i.defaults,t||{});try{et(t,JSON.parse(Ie(r,hr)))}catch{ai(!1,"Invalid JSON")}this._o=Object.create(et({},t))}var s=i.prototype;return s.mount=function(t,r){var n=this,a=this.state,o=this.Components;ai(a.is([Pt,Gi]),"Already mounted!"),a.set(Pt),this._C=o,this._T=r||this._T||(this.is(xi)?fd:pd),this._E=t||this._E;var l=hi({},ud,this._E,{Transition:this._T});return Et(l,function(c,u){var d=c(n,o,n._o);o[u]=d,d.setup&&d.setup()}),Et(o,function(c){c.mount&&c.mount()}),this.emit(St),De(this.root,$u),a.set(Wt),this.emit(Yr),this},s.sync=function(t){return this.splides.push({splide:t}),t.splides.push({splide:this,isParent:!0}),this.state.is(Wt)&&(this._C.Sync.remount(),t.Components.Sync.remount()),this},s.go=function(t){return this._C.Controller.go(t),this},s.on=function(t,r){return this.event.on(t,r),this},s.off=function(t){return this.event.off(t),this},s.emit=function(t){var r;return(r=this.event).emit.apply(r,[t].concat(ut(arguments,1))),this},s.add=function(t,r){return this._C.Slides.add(t,r),this},s.remove=function(t){return this._C.Slides.remove(t),this},s.is=function(t){return this._o.type===t},s.refresh=function(){return this.emit(ee),this},s.destroy=function(t){t===void 0&&(t=!0);var r=this.event,n=this.state;return n.is(Pt)?Y(this).on(Yr,this.destroy.bind(this,t)):(Et(this._C,function(a){a.destroy&&a.destroy(t)},!0),r.emit(Sa),r.destroy(),t&&Ke(this.splides),n.set(Gi)),this},Qc(i,[{key:"options",get:function(){return this._o},set:function(t){this._C.Media.set(t,!0,!0)}},{key:"length",get:function(){return this._C.Slides.getLength(!0)}},{key:"index",get:function(){return this._C.Controller.getIndex()}}]),i}(),Er=md;Er.defaults={};Er.STATES=tu;const gd=async i=>(await(await fetch(`https://api.unsplash.com/photos/random?client_id=${i}&orientation=landscape&count=5`)).json()).map(r=>({id:r.id,rawUrl:r.urls.full,url:r.urls.regular}));class Ga extends W{constructor(){super(...arguments);p(this,"activityType","unsplash");p(this,"_currentItemId",null);p(this,"init$",{handleNext:()=>{this.next()},handlePick:()=>{this.pick()}});p(this,"cssInit$",{"--cfg-unsplash-token":null})}get token(){return this.getCssData("--cfg-unsplash-token")}async fetch(){const e=await gd(this.token);this._items.push(...e);for(const t of e)this._splide.add(`<li data-id="${t.id}" class="splide__slide"><img src="${t.url}" /></li>`)}mount(){this.unmount();const e=this.ref.slider;this._items=[],this._splide=new Er(e).mount(),this._splide.options={arrows:!1},this._splide.on("move",()=>{this._items.shift()}),this._splide.on("active",({slide:t})=>{const r=t.dataset.id;this._currentItemId=r})}unmount(){var e;(e=this._splide)==null||e.destroy()}next(){this._items.length<3&&this.fetch(),this._splide.go(">")}pick(){const e=this._items.find(t=>t.id===this._currentItemId);this.uploadCollection.add({externalUrl:e.rawUrl}),this.$["*currentActivity"]=F.activities.UPLOAD_LIST}initCallback(){super.initCallback(),this.registerActivity(this.activityType,{onActivate:()=>{this.fetch(),this.mount()},onDeactivate:()=>{this.unmount()}})}}p(Ga,"template",`
    <lr-activity-header>
      <button
        type="button"
        class="mini-btn close-btn"
        set="onclick: *historyBack"
      >
        <lr-icon name="back"></lr-icon>
      </button>
      <div>
        <lr-icon name="unsplash"></lr-icon>
        <span>Unsplash</span>
      </div>
      <button
        type="button"
        class="mini-btn close-btn"
        set="onclick: *historyBack"
      >
        <lr-icon name="close"></lr-icon>
      </button>
    </lr-activity-header>
    <div class="content">
      <div ref="slider" class="splide">
        <div class="splide__track">
          <ul class="splide__list"></ul>
        </div>
      </div>
    </div>
    <div class="toolbar">
      <button
        type="button"
        class="done-btn primary-btn w-30"
        set="onclick: handlePick"
      >
        Pick
      </button>
      <button
        type="button"
        class="cancel-btn secondary-btn"
        set="onclick: handleNext"
      >
        Next →
      </button>
    </div>
  `);const vd="data:text/css;base64,QGltcG9ydCAnQHVwbG9hZGNhcmUvYmxvY2tzL3dlYi9sci1maWxlLXVwbG9hZGVyLXJlZ3VsYXIubWluLmNzcyc7CkBpbXBvcnQgJy4vdW5zcGxhc2gtc291cmNlLmNzcyc7Cg==";ar({...Zc,CustomFileUploader:ma,UnsplashSource:Ga,SourceBtn:Jc});const Xa=document.querySelector("lr-custom-file-uploader");Xa.setAttribute("css-src",vd);Xa.style.setProperty("--cfg-unsplash-token",'"VHt039vCvlgYs9GKZNk7IL3iYojG2v0Zz8lNRjipm3M"');
